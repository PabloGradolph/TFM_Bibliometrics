function tn(e,t){return e==null||t==null?NaN:e<t?-1:e>t?1:e>=t?0:NaN}function xa(e,t){return e==null||t==null?NaN:t<e?-1:t>e?1:t>=e?0:NaN}function Zr(e){let t,n,i;e.length!==2?(t=tn,n=(s,u)=>tn(e(s),u),i=(s,u)=>e(s)-u):(t=e===tn||e===xa?e:Ta,n=e,i=e);function r(s,u,l=0,c=s.length){if(l<c){if(t(u,u)!==0)return c;do{const h=l+c>>>1;n(s[h],u)<0?l=h+1:c=h}while(l<c)}return l}function o(s,u,l=0,c=s.length){if(l<c){if(t(u,u)!==0)return c;do{const h=l+c>>>1;n(s[h],u)<=0?l=h+1:c=h}while(l<c)}return l}function a(s,u,l=0,c=s.length){const h=r(s,u,l,c-1);return h>l&&i(s[h-1],u)>-i(s[h],u)?h-1:h}return{left:r,center:a,right:o}}function Ta(){return 0}function ka(e){return e===null?NaN:+e}const Sa=Zr(tn),Aa=Sa.right;Zr(ka).center;function Ca(e,t){let n,i;if(t===void 0)for(const r of e)r!=null&&(n===void 0?r>=r&&(n=i=r):(n>r&&(n=r),i<r&&(i=r)));else{let r=-1;for(let o of e)(o=t(o,++r,e))!=null&&(n===void 0?o>=o&&(n=i=o):(n>o&&(n=o),i<o&&(i=o)))}return[n,i]}class zi extends Map{constructor(t,n=Da){if(super(),Object.defineProperties(this,{_intern:{value:new Map},_key:{value:n}}),t!=null)for(const[i,r]of t)this.set(i,r)}get(t){return super.get(Oi(this,t))}has(t){return super.has(Oi(this,t))}set(t,n){return super.set(Ra(this,t),n)}delete(t){return super.delete(La(this,t))}}function Oi({_intern:e,_key:t},n){const i=t(n);return e.has(i)?e.get(i):n}function Ra({_intern:e,_key:t},n){const i=t(n);return e.has(i)?e.get(i):(e.set(i,n),n)}function La({_intern:e,_key:t},n){const i=t(n);return e.has(i)&&(n=e.get(i),e.delete(i)),n}function Da(e){return e!==null&&typeof e=="object"?e.valueOf():e}const $a=Math.sqrt(50),Ga=Math.sqrt(10),Na=Math.sqrt(2);function un(e,t,n){const i=(t-e)/Math.max(0,n),r=Math.floor(Math.log10(i)),o=i/Math.pow(10,r),a=o>=$a?10:o>=Ga?5:o>=Na?2:1;let s,u,l;return r<0?(l=Math.pow(10,-r)/a,s=Math.round(e*l),u=Math.round(t*l),s/l<e&&++s,u/l>t&&--u,l=-l):(l=Math.pow(10,r)*a,s=Math.round(e/l),u=Math.round(t/l),s*l<e&&++s,u*l>t&&--u),u<s&&.5<=n&&n<2?un(e,t,n*2):[s,u,l]}function Pa(e,t,n){if(t=+t,e=+e,n=+n,!(n>0))return[];if(e===t)return[e];const i=t<e,[r,o,a]=i?un(t,e,n):un(e,t,n);if(!(o>=r))return[];const s=o-r+1,u=new Array(s);if(i)if(a<0)for(let l=0;l<s;++l)u[l]=(o-l)/-a;else for(let l=0;l<s;++l)u[l]=(o-l)*a;else if(a<0)for(let l=0;l<s;++l)u[l]=(r+l)/-a;else for(let l=0;l<s;++l)u[l]=(r+l)*a;return u}function Jn(e,t,n){return t=+t,e=+e,n=+n,un(e,t,n)[2]}function Fa(e,t,n){t=+t,e=+e,n=+n;const i=t<e,r=i?Jn(t,e,n):Jn(e,t,n);return(i?-1:1)*(r<0?1/-r:r)}function Ui(e,t){let n;if(t===void 0)for(const i of e)i!=null&&(n<i||n===void 0&&i>=i)&&(n=i);else{let i=-1;for(let r of e)(r=t(r,++i,e))!=null&&(n<r||n===void 0&&r>=r)&&(n=r)}return n}function Ia(e,t,n){e=+e,t=+t,n=(r=arguments.length)<2?(t=e,e=0,1):r<3?1:+n;for(var i=-1,r=Math.max(0,Math.ceil((t-e)/n))|0,o=new Array(r);++i<r;)o[i]=e+i*n;return o}function Rn(e,t){let n=0;if(t===void 0)for(let i of e)(i=+i)&&(n+=i);else{let i=-1;for(let r of e)(r=+t(r,++i,e))&&(n+=r)}return n}function Ma(e){return e}var Ln=1,Dn=2,Qn=3,Lt=4,Bi=1e-6;function za(e){return"translate("+e+",0)"}function Oa(e){return"translate(0,"+e+")"}function Ua(e){return t=>+e(t)}function Ba(e,t){return t=Math.max(0,e.bandwidth()-t*2)/2,e.round()&&(t=Math.round(t)),n=>+e(n)+t}function Ha(){return!this.__axis}function Jr(e,t){var n=[],i=null,r=null,o=6,a=6,s=3,u=typeof window<"u"&&window.devicePixelRatio>1?0:.5,l=e===Ln||e===Lt?-1:1,c=e===Lt||e===Dn?"x":"y",h=e===Ln||e===Qn?za:Oa;function d(f){var p=i??(t.ticks?t.ticks.apply(t,n):t.domain()),m=r??(t.tickFormat?t.tickFormat.apply(t,n):Ma),_=Math.max(o,0)+s,T=t.range(),x=+T[0]+u,k=+T[T.length-1]+u,v=(t.bandwidth?Ba:Ua)(t.copy(),u),b=f.selection?f.selection():f,C=b.selectAll(".domain").data([null]),R=b.selectAll(".tick").data(p,t).order(),B=R.exit(),I=R.enter().append("g").attr("class","tick"),O=R.select("line"),M=R.select("text");C=C.merge(C.enter().insert("path",".tick").attr("class","domain").attr("stroke","currentColor")),R=R.merge(I),O=O.merge(I.append("line").attr("stroke","currentColor").attr(c+"2",l*o)),M=M.merge(I.append("text").attr("fill","currentColor").attr(c,l*_).attr("dy",e===Ln?"0em":e===Qn?"0.71em":"0.32em")),f!==b&&(C=C.transition(f),R=R.transition(f),O=O.transition(f),M=M.transition(f),B=B.transition(f).attr("opacity",Bi).attr("transform",function(z){return isFinite(z=v(z))?h(z+u):this.getAttribute("transform")}),I.attr("opacity",Bi).attr("transform",function(z){var g=this.parentNode.__axis;return h((g&&isFinite(g=g(z))?g:v(z))+u)})),B.remove(),C.attr("d",e===Lt||e===Dn?a?"M"+l*a+","+x+"H"+u+"V"+k+"H"+l*a:"M"+u+","+x+"V"+k:a?"M"+x+","+l*a+"V"+u+"H"+k+"V"+l*a:"M"+x+","+u+"H"+k),R.attr("opacity",1).attr("transform",function(z){return h(v(z)+u)}),O.attr(c+"2",l*o),M.attr(c,l*_).text(m),b.filter(Ha).attr("fill","none").attr("font-size",10).attr("font-family","sans-serif").attr("text-anchor",e===Dn?"start":e===Lt?"end":"middle"),b.each(function(){this.__axis=v})}return d.scale=function(f){return arguments.length?(t=f,d):t},d.ticks=function(){return n=Array.from(arguments),d},d.tickArguments=function(f){return arguments.length?(n=f==null?[]:Array.from(f),d):n.slice()},d.tickValues=function(f){return arguments.length?(i=f==null?null:Array.from(f),d):i&&i.slice()},d.tickFormat=function(f){return arguments.length?(r=f,d):r},d.tickSize=function(f){return arguments.length?(o=a=+f,d):o},d.tickSizeInner=function(f){return arguments.length?(o=+f,d):o},d.tickSizeOuter=function(f){return arguments.length?(a=+f,d):a},d.tickPadding=function(f){return arguments.length?(s=+f,d):s},d.offset=function(f){return arguments.length?(u=+f,d):u},d}function $n(e){return Jr(Qn,e)}function Hi(e){return Jr(Lt,e)}var Wa={value:()=>{}};function Qr(){for(var e=0,t=arguments.length,n={},i;e<t;++e){if(!(i=arguments[e]+"")||i in n||/[\s.]/.test(i))throw new Error("illegal type: "+i);n[i]=[]}return new nn(n)}function nn(e){this._=e}function Va(e,t){return e.trim().split(/^|\s+/).map(function(n){var i="",r=n.indexOf(".");if(r>=0&&(i=n.slice(r+1),n=n.slice(0,r)),n&&!t.hasOwnProperty(n))throw new Error("unknown type: "+n);return{type:n,name:i}})}nn.prototype=Qr.prototype={constructor:nn,on:function(e,t){var n=this._,i=Va(e+"",n),r,o=-1,a=i.length;if(arguments.length<2){for(;++o<a;)if((r=(e=i[o]).type)&&(r=ja(n[r],e.name)))return r;return}if(t!=null&&typeof t!="function")throw new Error("invalid callback: "+t);for(;++o<a;)if(r=(e=i[o]).type)n[r]=Wi(n[r],e.name,t);else if(t==null)for(r in n)n[r]=Wi(n[r],e.name,null);return this},copy:function(){var e={},t=this._;for(var n in t)e[n]=t[n].slice();return new nn(e)},call:function(e,t){if((r=arguments.length-2)>0)for(var n=new Array(r),i=0,r,o;i<r;++i)n[i]=arguments[i+2];if(!this._.hasOwnProperty(e))throw new Error("unknown type: "+e);for(o=this._[e],i=0,r=o.length;i<r;++i)o[i].value.apply(t,n)},apply:function(e,t,n){if(!this._.hasOwnProperty(e))throw new Error("unknown type: "+e);for(var i=this._[e],r=0,o=i.length;r<o;++r)i[r].value.apply(t,n)}};function ja(e,t){for(var n=0,i=e.length,r;n<i;++n)if((r=e[n]).name===t)return r.value}function Wi(e,t,n){for(var i=0,r=e.length;i<r;++i)if(e[i].name===t){e[i]=Wa,e=e.slice(0,i).concat(e.slice(i+1));break}return n!=null&&e.push({name:t,value:n}),e}var ei="http://www.w3.org/1999/xhtml";const Vi={svg:"http://www.w3.org/2000/svg",xhtml:ei,xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/"};function En(e){var t=e+="",n=t.indexOf(":");return n>=0&&(t=e.slice(0,n))!=="xmlns"&&(e=e.slice(n+1)),Vi.hasOwnProperty(t)?{space:Vi[t],local:e}:e}function qa(e){return function(){var t=this.ownerDocument,n=this.namespaceURI;return n===ei&&t.documentElement.namespaceURI===ei?t.createElement(e):t.createElementNS(n,e)}}function Xa(e){return function(){return this.ownerDocument.createElementNS(e.space,e.local)}}function eo(e){var t=En(e);return(t.local?Xa:qa)(t)}function Ya(){}function vi(e){return e==null?Ya:function(){return this.querySelector(e)}}function Ka(e){typeof e!="function"&&(e=vi(e));for(var t=this._groups,n=t.length,i=new Array(n),r=0;r<n;++r)for(var o=t[r],a=o.length,s=i[r]=new Array(a),u,l,c=0;c<a;++c)(u=o[c])&&(l=e.call(u,u.__data__,c,o))&&("__data__"in u&&(l.__data__=u.__data__),s[c]=l);return new Ae(i,this._parents)}function Za(e){return e==null?[]:Array.isArray(e)?e:Array.from(e)}function Ja(){return[]}function to(e){return e==null?Ja:function(){return this.querySelectorAll(e)}}function Qa(e){return function(){return Za(e.apply(this,arguments))}}function es(e){typeof e=="function"?e=Qa(e):e=to(e);for(var t=this._groups,n=t.length,i=[],r=[],o=0;o<n;++o)for(var a=t[o],s=a.length,u,l=0;l<s;++l)(u=a[l])&&(i.push(e.call(u,u.__data__,l,a)),r.push(u));return new Ae(i,r)}function no(e){return function(){return this.matches(e)}}function io(e){return function(t){return t.matches(e)}}var ts=Array.prototype.find;function ns(e){return function(){return ts.call(this.children,e)}}function is(){return this.firstElementChild}function rs(e){return this.select(e==null?is:ns(typeof e=="function"?e:io(e)))}var os=Array.prototype.filter;function as(){return Array.from(this.children)}function ss(e){return function(){return os.call(this.children,e)}}function us(e){return this.selectAll(e==null?as:ss(typeof e=="function"?e:io(e)))}function ls(e){typeof e!="function"&&(e=no(e));for(var t=this._groups,n=t.length,i=new Array(n),r=0;r<n;++r)for(var o=t[r],a=o.length,s=i[r]=[],u,l=0;l<a;++l)(u=o[l])&&e.call(u,u.__data__,l,o)&&s.push(u);return new Ae(i,this._parents)}function ro(e){return new Array(e.length)}function cs(){return new Ae(this._enter||this._groups.map(ro),this._parents)}function ln(e,t){this.ownerDocument=e.ownerDocument,this.namespaceURI=e.namespaceURI,this._next=null,this._parent=e,this.__data__=t}ln.prototype={constructor:ln,appendChild:function(e){return this._parent.insertBefore(e,this._next)},insertBefore:function(e,t){return this._parent.insertBefore(e,t)},querySelector:function(e){return this._parent.querySelector(e)},querySelectorAll:function(e){return this._parent.querySelectorAll(e)}};function hs(e){return function(){return e}}function ds(e,t,n,i,r,o){for(var a=0,s,u=t.length,l=o.length;a<l;++a)(s=t[a])?(s.__data__=o[a],i[a]=s):n[a]=new ln(e,o[a]);for(;a<u;++a)(s=t[a])&&(r[a]=s)}function fs(e,t,n,i,r,o,a){var s,u,l=new Map,c=t.length,h=o.length,d=new Array(c),f;for(s=0;s<c;++s)(u=t[s])&&(d[s]=f=a.call(u,u.__data__,s,t)+"",l.has(f)?r[s]=u:l.set(f,u));for(s=0;s<h;++s)f=a.call(e,o[s],s,o)+"",(u=l.get(f))?(i[s]=u,u.__data__=o[s],l.delete(f)):n[s]=new ln(e,o[s]);for(s=0;s<c;++s)(u=t[s])&&l.get(d[s])===u&&(r[s]=u)}function gs(e){return e.__data__}function ps(e,t){if(!arguments.length)return Array.from(this,gs);var n=t?fs:ds,i=this._parents,r=this._groups;typeof e!="function"&&(e=hs(e));for(var o=r.length,a=new Array(o),s=new Array(o),u=new Array(o),l=0;l<o;++l){var c=i[l],h=r[l],d=h.length,f=ms(e.call(c,c&&c.__data__,l,i)),p=f.length,m=s[l]=new Array(p),_=a[l]=new Array(p),T=u[l]=new Array(d);n(c,h,m,_,T,f,t);for(var x=0,k=0,v,b;x<p;++x)if(v=m[x]){for(x>=k&&(k=x+1);!(b=_[k])&&++k<p;);v._next=b||null}}return a=new Ae(a,i),a._enter=s,a._exit=u,a}function ms(e){return typeof e=="object"&&"length"in e?e:Array.from(e)}function vs(){return new Ae(this._exit||this._groups.map(ro),this._parents)}function ys(e,t,n){var i=this.enter(),r=this,o=this.exit();return typeof e=="function"?(i=e(i),i&&(i=i.selection())):i=i.append(e+""),t!=null&&(r=t(r),r&&(r=r.selection())),n==null?o.remove():n(o),i&&r?i.merge(r).order():r}function bs(e){for(var t=e.selection?e.selection():e,n=this._groups,i=t._groups,r=n.length,o=i.length,a=Math.min(r,o),s=new Array(r),u=0;u<a;++u)for(var l=n[u],c=i[u],h=l.length,d=s[u]=new Array(h),f,p=0;p<h;++p)(f=l[p]||c[p])&&(d[p]=f);for(;u<r;++u)s[u]=n[u];return new Ae(s,this._parents)}function ws(){for(var e=this._groups,t=-1,n=e.length;++t<n;)for(var i=e[t],r=i.length-1,o=i[r],a;--r>=0;)(a=i[r])&&(o&&a.compareDocumentPosition(o)^4&&o.parentNode.insertBefore(a,o),o=a);return this}function _s(e){e||(e=Es);function t(h,d){return h&&d?e(h.__data__,d.__data__):!h-!d}for(var n=this._groups,i=n.length,r=new Array(i),o=0;o<i;++o){for(var a=n[o],s=a.length,u=r[o]=new Array(s),l,c=0;c<s;++c)(l=a[c])&&(u[c]=l);u.sort(t)}return new Ae(r,this._parents).order()}function Es(e,t){return e<t?-1:e>t?1:e>=t?0:NaN}function xs(){var e=arguments[0];return arguments[0]=this,e.apply(null,arguments),this}function Ts(){return Array.from(this)}function ks(){for(var e=this._groups,t=0,n=e.length;t<n;++t)for(var i=e[t],r=0,o=i.length;r<o;++r){var a=i[r];if(a)return a}return null}function Ss(){let e=0;for(const t of this)++e;return e}function As(){return!this.node()}function Cs(e){for(var t=this._groups,n=0,i=t.length;n<i;++n)for(var r=t[n],o=0,a=r.length,s;o<a;++o)(s=r[o])&&e.call(s,s.__data__,o,r);return this}function Rs(e){return function(){this.removeAttribute(e)}}function Ls(e){return function(){this.removeAttributeNS(e.space,e.local)}}function Ds(e,t){return function(){this.setAttribute(e,t)}}function $s(e,t){return function(){this.setAttributeNS(e.space,e.local,t)}}function Gs(e,t){return function(){var n=t.apply(this,arguments);n==null?this.removeAttribute(e):this.setAttribute(e,n)}}function Ns(e,t){return function(){var n=t.apply(this,arguments);n==null?this.removeAttributeNS(e.space,e.local):this.setAttributeNS(e.space,e.local,n)}}function Ps(e,t){var n=En(e);if(arguments.length<2){var i=this.node();return n.local?i.getAttributeNS(n.space,n.local):i.getAttribute(n)}return this.each((t==null?n.local?Ls:Rs:typeof t=="function"?n.local?Ns:Gs:n.local?$s:Ds)(n,t))}function oo(e){return e.ownerDocument&&e.ownerDocument.defaultView||e.document&&e||e.defaultView}function Fs(e){return function(){this.style.removeProperty(e)}}function Is(e,t,n){return function(){this.style.setProperty(e,t,n)}}function Ms(e,t,n){return function(){var i=t.apply(this,arguments);i==null?this.style.removeProperty(e):this.style.setProperty(e,i,n)}}function zs(e,t,n){return arguments.length>1?this.each((t==null?Fs:typeof t=="function"?Ms:Is)(e,t,n??"")):ft(this.node(),e)}function ft(e,t){return e.style.getPropertyValue(t)||oo(e).getComputedStyle(e,null).getPropertyValue(t)}function Os(e){return function(){delete this[e]}}function Us(e,t){return function(){this[e]=t}}function Bs(e,t){return function(){var n=t.apply(this,arguments);n==null?delete this[e]:this[e]=n}}function Hs(e,t){return arguments.length>1?this.each((t==null?Os:typeof t=="function"?Bs:Us)(e,t)):this.node()[e]}function ao(e){return e.trim().split(/^|\s+/)}function yi(e){return e.classList||new so(e)}function so(e){this._node=e,this._names=ao(e.getAttribute("class")||"")}so.prototype={add:function(e){var t=this._names.indexOf(e);t<0&&(this._names.push(e),this._node.setAttribute("class",this._names.join(" ")))},remove:function(e){var t=this._names.indexOf(e);t>=0&&(this._names.splice(t,1),this._node.setAttribute("class",this._names.join(" ")))},contains:function(e){return this._names.indexOf(e)>=0}};function uo(e,t){for(var n=yi(e),i=-1,r=t.length;++i<r;)n.add(t[i])}function lo(e,t){for(var n=yi(e),i=-1,r=t.length;++i<r;)n.remove(t[i])}function Ws(e){return function(){uo(this,e)}}function Vs(e){return function(){lo(this,e)}}function js(e,t){return function(){(t.apply(this,arguments)?uo:lo)(this,e)}}function qs(e,t){var n=ao(e+"");if(arguments.length<2){for(var i=yi(this.node()),r=-1,o=n.length;++r<o;)if(!i.contains(n[r]))return!1;return!0}return this.each((typeof t=="function"?js:t?Ws:Vs)(n,t))}function Xs(){this.textContent=""}function Ys(e){return function(){this.textContent=e}}function Ks(e){return function(){var t=e.apply(this,arguments);this.textContent=t??""}}function Zs(e){return arguments.length?this.each(e==null?Xs:(typeof e=="function"?Ks:Ys)(e)):this.node().textContent}function Js(){this.innerHTML=""}function Qs(e){return function(){this.innerHTML=e}}function eu(e){return function(){var t=e.apply(this,arguments);this.innerHTML=t??""}}function tu(e){return arguments.length?this.each(e==null?Js:(typeof e=="function"?eu:Qs)(e)):this.node().innerHTML}function nu(){this.nextSibling&&this.parentNode.appendChild(this)}function iu(){return this.each(nu)}function ru(){this.previousSibling&&this.parentNode.insertBefore(this,this.parentNode.firstChild)}function ou(){return this.each(ru)}function au(e){var t=typeof e=="function"?e:eo(e);return this.select(function(){return this.appendChild(t.apply(this,arguments))})}function su(){return null}function uu(e,t){var n=typeof e=="function"?e:eo(e),i=t==null?su:typeof t=="function"?t:vi(t);return this.select(function(){return this.insertBefore(n.apply(this,arguments),i.apply(this,arguments)||null)})}function lu(){var e=this.parentNode;e&&e.removeChild(this)}function cu(){return this.each(lu)}function hu(){var e=this.cloneNode(!1),t=this.parentNode;return t?t.insertBefore(e,this.nextSibling):e}function du(){var e=this.cloneNode(!0),t=this.parentNode;return t?t.insertBefore(e,this.nextSibling):e}function fu(e){return this.select(e?du:hu)}function gu(e){return arguments.length?this.property("__data__",e):this.node().__data__}function pu(e){return function(t){e.call(this,t,this.__data__)}}function mu(e){return e.trim().split(/^|\s+/).map(function(t){var n="",i=t.indexOf(".");return i>=0&&(n=t.slice(i+1),t=t.slice(0,i)),{type:t,name:n}})}function vu(e){return function(){var t=this.__on;if(t){for(var n=0,i=-1,r=t.length,o;n<r;++n)o=t[n],(!e.type||o.type===e.type)&&o.name===e.name?this.removeEventListener(o.type,o.listener,o.options):t[++i]=o;++i?t.length=i:delete this.__on}}}function yu(e,t,n){return function(){var i=this.__on,r,o=pu(t);if(i){for(var a=0,s=i.length;a<s;++a)if((r=i[a]).type===e.type&&r.name===e.name){this.removeEventListener(r.type,r.listener,r.options),this.addEventListener(r.type,r.listener=o,r.options=n),r.value=t;return}}this.addEventListener(e.type,o,n),r={type:e.type,name:e.name,value:t,listener:o,options:n},i?i.push(r):this.__on=[r]}}function bu(e,t,n){var i=mu(e+""),r,o=i.length,a;if(arguments.length<2){var s=this.node().__on;if(s){for(var u=0,l=s.length,c;u<l;++u)for(r=0,c=s[u];r<o;++r)if((a=i[r]).type===c.type&&a.name===c.name)return c.value}return}for(s=t?yu:vu,r=0;r<o;++r)this.each(s(i[r],t,n));return this}function co(e,t,n){var i=oo(e),r=i.CustomEvent;typeof r=="function"?r=new r(t,n):(r=i.document.createEvent("Event"),n?(r.initEvent(t,n.bubbles,n.cancelable),r.detail=n.detail):r.initEvent(t,!1,!1)),e.dispatchEvent(r)}function wu(e,t){return function(){return co(this,e,t)}}function _u(e,t){return function(){return co(this,e,t.apply(this,arguments))}}function Eu(e,t){return this.each((typeof t=="function"?_u:wu)(e,t))}function*xu(){for(var e=this._groups,t=0,n=e.length;t<n;++t)for(var i=e[t],r=0,o=i.length,a;r<o;++r)(a=i[r])&&(yield a)}var ho=[null];function Ae(e,t){this._groups=e,this._parents=t}function Ut(){return new Ae([[document.documentElement]],ho)}function Tu(){return this}Ae.prototype=Ut.prototype={constructor:Ae,select:Ka,selectAll:es,selectChild:rs,selectChildren:us,filter:ls,data:ps,enter:cs,exit:vs,join:ys,merge:bs,selection:Tu,order:ws,sort:_s,call:xs,nodes:Ts,node:ks,size:Ss,empty:As,each:Cs,attr:Ps,style:zs,property:Hs,classed:qs,text:Zs,html:tu,raise:iu,lower:ou,append:au,insert:uu,remove:cu,clone:fu,datum:gu,on:bu,dispatch:Eu,[Symbol.iterator]:xu};function Re(e){return typeof e=="string"?new Ae([[document.querySelector(e)]],[document.documentElement]):new Ae([[e]],ho)}function Oe(e){return new Ae([document.querySelectorAll(e)],[document.documentElement])}function bi(e,t,n){e.prototype=t.prototype=n,n.constructor=e}function fo(e,t){var n=Object.create(e.prototype);for(var i in t)n[i]=t[i];return n}function Bt(){}var It=.7,cn=1/It,ht="\\s*([+-]?\\d+)\\s*",Mt="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)\\s*",Be="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)%\\s*",ku=/^#([0-9a-f]{3,8})$/,Su=new RegExp(`^rgb\\(${ht},${ht},${ht}\\)$`),Au=new RegExp(`^rgb\\(${Be},${Be},${Be}\\)$`),Cu=new RegExp(`^rgba\\(${ht},${ht},${ht},${Mt}\\)$`),Ru=new RegExp(`^rgba\\(${Be},${Be},${Be},${Mt}\\)$`),Lu=new RegExp(`^hsl\\(${Mt},${Be},${Be}\\)$`),Du=new RegExp(`^hsla\\(${Mt},${Be},${Be},${Mt}\\)$`),ji={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074};bi(Bt,at,{copy(e){return Object.assign(new this.constructor,this,e)},displayable(){return this.rgb().displayable()},hex:qi,formatHex:qi,formatHex8:$u,formatHsl:Gu,formatRgb:Xi,toString:Xi});function qi(){return this.rgb().formatHex()}function $u(){return this.rgb().formatHex8()}function Gu(){return go(this).formatHsl()}function Xi(){return this.rgb().formatRgb()}function at(e){var t,n;return e=(e+"").trim().toLowerCase(),(t=ku.exec(e))?(n=t[1].length,t=parseInt(t[1],16),n===6?Yi(t):n===3?new Se(t>>8&15|t>>4&240,t>>4&15|t&240,(t&15)<<4|t&15,1):n===8?Wt(t>>24&255,t>>16&255,t>>8&255,(t&255)/255):n===4?Wt(t>>12&15|t>>8&240,t>>8&15|t>>4&240,t>>4&15|t&240,((t&15)<<4|t&15)/255):null):(t=Su.exec(e))?new Se(t[1],t[2],t[3],1):(t=Au.exec(e))?new Se(t[1]*255/100,t[2]*255/100,t[3]*255/100,1):(t=Cu.exec(e))?Wt(t[1],t[2],t[3],t[4]):(t=Ru.exec(e))?Wt(t[1]*255/100,t[2]*255/100,t[3]*255/100,t[4]):(t=Lu.exec(e))?Ji(t[1],t[2]/100,t[3]/100,1):(t=Du.exec(e))?Ji(t[1],t[2]/100,t[3]/100,t[4]):ji.hasOwnProperty(e)?Yi(ji[e]):e==="transparent"?new Se(NaN,NaN,NaN,0):null}function Yi(e){return new Se(e>>16&255,e>>8&255,e&255,1)}function Wt(e,t,n,i){return i<=0&&(e=t=n=NaN),new Se(e,t,n,i)}function Nu(e){return e instanceof Bt||(e=at(e)),e?(e=e.rgb(),new Se(e.r,e.g,e.b,e.opacity)):new Se}function ti(e,t,n,i){return arguments.length===1?Nu(e):new Se(e,t,n,i??1)}function Se(e,t,n,i){this.r=+e,this.g=+t,this.b=+n,this.opacity=+i}bi(Se,ti,fo(Bt,{brighter(e){return e=e==null?cn:Math.pow(cn,e),new Se(this.r*e,this.g*e,this.b*e,this.opacity)},darker(e){return e=e==null?It:Math.pow(It,e),new Se(this.r*e,this.g*e,this.b*e,this.opacity)},rgb(){return this},clamp(){return new Se(ot(this.r),ot(this.g),ot(this.b),hn(this.opacity))},displayable(){return-.5<=this.r&&this.r<255.5&&-.5<=this.g&&this.g<255.5&&-.5<=this.b&&this.b<255.5&&0<=this.opacity&&this.opacity<=1},hex:Ki,formatHex:Ki,formatHex8:Pu,formatRgb:Zi,toString:Zi}));function Ki(){return`#${rt(this.r)}${rt(this.g)}${rt(this.b)}`}function Pu(){return`#${rt(this.r)}${rt(this.g)}${rt(this.b)}${rt((isNaN(this.opacity)?1:this.opacity)*255)}`}function Zi(){const e=hn(this.opacity);return`${e===1?"rgb(":"rgba("}${ot(this.r)}, ${ot(this.g)}, ${ot(this.b)}${e===1?")":`, ${e})`}`}function hn(e){return isNaN(e)?1:Math.max(0,Math.min(1,e))}function ot(e){return Math.max(0,Math.min(255,Math.round(e)||0))}function rt(e){return e=ot(e),(e<16?"0":"")+e.toString(16)}function Ji(e,t,n,i){return i<=0?e=t=n=NaN:n<=0||n>=1?e=t=NaN:t<=0&&(e=NaN),new Ie(e,t,n,i)}function go(e){if(e instanceof Ie)return new Ie(e.h,e.s,e.l,e.opacity);if(e instanceof Bt||(e=at(e)),!e)return new Ie;if(e instanceof Ie)return e;e=e.rgb();var t=e.r/255,n=e.g/255,i=e.b/255,r=Math.min(t,n,i),o=Math.max(t,n,i),a=NaN,s=o-r,u=(o+r)/2;return s?(t===o?a=(n-i)/s+(n<i)*6:n===o?a=(i-t)/s+2:a=(t-n)/s+4,s/=u<.5?o+r:2-o-r,a*=60):s=u>0&&u<1?0:a,new Ie(a,s,u,e.opacity)}function Fu(e,t,n,i){return arguments.length===1?go(e):new Ie(e,t,n,i??1)}function Ie(e,t,n,i){this.h=+e,this.s=+t,this.l=+n,this.opacity=+i}bi(Ie,Fu,fo(Bt,{brighter(e){return e=e==null?cn:Math.pow(cn,e),new Ie(this.h,this.s,this.l*e,this.opacity)},darker(e){return e=e==null?It:Math.pow(It,e),new Ie(this.h,this.s,this.l*e,this.opacity)},rgb(){var e=this.h%360+(this.h<0)*360,t=isNaN(e)||isNaN(this.s)?0:this.s,n=this.l,i=n+(n<.5?n:1-n)*t,r=2*n-i;return new Se(Gn(e>=240?e-240:e+120,r,i),Gn(e,r,i),Gn(e<120?e+240:e-120,r,i),this.opacity)},clamp(){return new Ie(Qi(this.h),Vt(this.s),Vt(this.l),hn(this.opacity))},displayable(){return(0<=this.s&&this.s<=1||isNaN(this.s))&&0<=this.l&&this.l<=1&&0<=this.opacity&&this.opacity<=1},formatHsl(){const e=hn(this.opacity);return`${e===1?"hsl(":"hsla("}${Qi(this.h)}, ${Vt(this.s)*100}%, ${Vt(this.l)*100}%${e===1?")":`, ${e})`}`}}));function Qi(e){return e=(e||0)%360,e<0?e+360:e}function Vt(e){return Math.max(0,Math.min(1,e||0))}function Gn(e,t,n){return(e<60?t+(n-t)*e/60:e<180?n:e<240?t+(n-t)*(240-e)/60:t)*255}const wi=e=>()=>e;function Iu(e,t){return function(n){return e+n*t}}function Mu(e,t,n){return e=Math.pow(e,n),t=Math.pow(t,n)-e,n=1/n,function(i){return Math.pow(e+i*t,n)}}function zu(e){return(e=+e)==1?po:function(t,n){return n-t?Mu(t,n,e):wi(isNaN(t)?n:t)}}function po(e,t){var n=t-e;return n?Iu(e,n):wi(isNaN(e)?t:e)}const dn=function e(t){var n=zu(t);function i(r,o){var a=n((r=ti(r)).r,(o=ti(o)).r),s=n(r.g,o.g),u=n(r.b,o.b),l=po(r.opacity,o.opacity);return function(c){return r.r=a(c),r.g=s(c),r.b=u(c),r.opacity=l(c),r+""}}return i.gamma=e,i}(1);function Ou(e,t){t||(t=[]);var n=e?Math.min(t.length,e.length):0,i=t.slice(),r;return function(o){for(r=0;r<n;++r)i[r]=e[r]*(1-o)+t[r]*o;return i}}function Uu(e){return ArrayBuffer.isView(e)&&!(e instanceof DataView)}function Bu(e,t){var n=t?t.length:0,i=e?Math.min(n,e.length):0,r=new Array(i),o=new Array(n),a;for(a=0;a<i;++a)r[a]=_i(e[a],t[a]);for(;a<n;++a)o[a]=t[a];return function(s){for(a=0;a<i;++a)o[a]=r[a](s);return o}}function Hu(e,t){var n=new Date;return e=+e,t=+t,function(i){return n.setTime(e*(1-i)+t*i),n}}function Fe(e,t){return e=+e,t=+t,function(n){return e*(1-n)+t*n}}function Wu(e,t){var n={},i={},r;(e===null||typeof e!="object")&&(e={}),(t===null||typeof t!="object")&&(t={});for(r in t)r in e?n[r]=_i(e[r],t[r]):i[r]=t[r];return function(o){for(r in n)i[r]=n[r](o);return i}}var ni=/[-+]?(?:\d+\.?\d*|\.?\d+)(?:[eE][-+]?\d+)?/g,Nn=new RegExp(ni.source,"g");function Vu(e){return function(){return e}}function ju(e){return function(t){return e(t)+""}}function mo(e,t){var n=ni.lastIndex=Nn.lastIndex=0,i,r,o,a=-1,s=[],u=[];for(e=e+"",t=t+"";(i=ni.exec(e))&&(r=Nn.exec(t));)(o=r.index)>n&&(o=t.slice(n,o),s[a]?s[a]+=o:s[++a]=o),(i=i[0])===(r=r[0])?s[a]?s[a]+=r:s[++a]=r:(s[++a]=null,u.push({i:a,x:Fe(i,r)})),n=Nn.lastIndex;return n<t.length&&(o=t.slice(n),s[a]?s[a]+=o:s[++a]=o),s.length<2?u[0]?ju(u[0].x):Vu(t):(t=u.length,function(l){for(var c=0,h;c<t;++c)s[(h=u[c]).i]=h.x(l);return s.join("")})}function _i(e,t){var n=typeof t,i;return t==null||n==="boolean"?wi(t):(n==="number"?Fe:n==="string"?(i=at(t))?(t=i,dn):mo:t instanceof at?dn:t instanceof Date?Hu:Uu(t)?Ou:Array.isArray(t)?Bu:typeof t.valueOf!="function"&&typeof t.toString!="function"||isNaN(t)?Wu:Fe)(e,t)}function qu(e,t){return e=+e,t=+t,function(n){return Math.round(e*(1-n)+t*n)}}var er=180/Math.PI,ii={translateX:0,translateY:0,rotate:0,skewX:0,scaleX:1,scaleY:1};function vo(e,t,n,i,r,o){var a,s,u;return(a=Math.sqrt(e*e+t*t))&&(e/=a,t/=a),(u=e*n+t*i)&&(n-=e*u,i-=t*u),(s=Math.sqrt(n*n+i*i))&&(n/=s,i/=s,u/=s),e*i<t*n&&(e=-e,t=-t,u=-u,a=-a),{translateX:r,translateY:o,rotate:Math.atan2(t,e)*er,skewX:Math.atan(u)*er,scaleX:a,scaleY:s}}var jt;function Xu(e){const t=new(typeof DOMMatrix=="function"?DOMMatrix:WebKitCSSMatrix)(e+"");return t.isIdentity?ii:vo(t.a,t.b,t.c,t.d,t.e,t.f)}function Yu(e){return e==null||(jt||(jt=document.createElementNS("http://www.w3.org/2000/svg","g")),jt.setAttribute("transform",e),!(e=jt.transform.baseVal.consolidate()))?ii:(e=e.matrix,vo(e.a,e.b,e.c,e.d,e.e,e.f))}function yo(e,t,n,i){function r(l){return l.length?l.pop()+" ":""}function o(l,c,h,d,f,p){if(l!==h||c!==d){var m=f.push("translate(",null,t,null,n);p.push({i:m-4,x:Fe(l,h)},{i:m-2,x:Fe(c,d)})}else(h||d)&&f.push("translate("+h+t+d+n)}function a(l,c,h,d){l!==c?(l-c>180?c+=360:c-l>180&&(l+=360),d.push({i:h.push(r(h)+"rotate(",null,i)-2,x:Fe(l,c)})):c&&h.push(r(h)+"rotate("+c+i)}function s(l,c,h,d){l!==c?d.push({i:h.push(r(h)+"skewX(",null,i)-2,x:Fe(l,c)}):c&&h.push(r(h)+"skewX("+c+i)}function u(l,c,h,d,f,p){if(l!==h||c!==d){var m=f.push(r(f)+"scale(",null,",",null,")");p.push({i:m-4,x:Fe(l,h)},{i:m-2,x:Fe(c,d)})}else(h!==1||d!==1)&&f.push(r(f)+"scale("+h+","+d+")")}return function(l,c){var h=[],d=[];return l=e(l),c=e(c),o(l.translateX,l.translateY,c.translateX,c.translateY,h,d),a(l.rotate,c.rotate,h,d),s(l.skewX,c.skewX,h,d),u(l.scaleX,l.scaleY,c.scaleX,c.scaleY,h,d),l=c=null,function(f){for(var p=-1,m=d.length,_;++p<m;)h[(_=d[p]).i]=_.x(f);return h.join("")}}}var Ku=yo(Xu,"px, ","px)","deg)"),Zu=yo(Yu,", ",")",")"),gt=0,Dt=0,Et=0,bo=1e3,fn,$t,gn=0,st=0,xn=0,zt=typeof performance=="object"&&performance.now?performance:Date,wo=typeof window=="object"&&window.requestAnimationFrame?window.requestAnimationFrame.bind(window):function(e){setTimeout(e,17)};function Ei(){return st||(wo(Ju),st=zt.now()+xn)}function Ju(){st=0}function pn(){this._call=this._time=this._next=null}pn.prototype=_o.prototype={constructor:pn,restart:function(e,t,n){if(typeof e!="function")throw new TypeError("callback is not a function");n=(n==null?Ei():+n)+(t==null?0:+t),!this._next&&$t!==this&&($t?$t._next=this:fn=this,$t=this),this._call=e,this._time=n,ri()},stop:function(){this._call&&(this._call=null,this._time=1/0,ri())}};function _o(e,t,n){var i=new pn;return i.restart(e,t,n),i}function Qu(){Ei(),++gt;for(var e=fn,t;e;)(t=st-e._time)>=0&&e._call.call(void 0,t),e=e._next;--gt}function tr(){st=(gn=zt.now())+xn,gt=Dt=0;try{Qu()}finally{gt=0,tl(),st=0}}function el(){var e=zt.now(),t=e-gn;t>bo&&(xn-=t,gn=e)}function tl(){for(var e,t=fn,n,i=1/0;t;)t._call?(i>t._time&&(i=t._time),e=t,t=t._next):(n=t._next,t._next=null,t=e?e._next=n:fn=n);$t=e,ri(i)}function ri(e){if(!gt){Dt&&(Dt=clearTimeout(Dt));var t=e-st;t>24?(e<1/0&&(Dt=setTimeout(tr,e-zt.now()-xn)),Et&&(Et=clearInterval(Et))):(Et||(gn=zt.now(),Et=setInterval(el,bo)),gt=1,wo(tr))}}function nr(e,t,n){var i=new pn;return t=t==null?0:+t,i.restart(r=>{i.stop(),e(r+t)},t,n),i}var nl=Qr("start","end","cancel","interrupt"),il=[],Eo=0,ir=1,oi=2,rn=3,rr=4,ai=5,on=6;function Tn(e,t,n,i,r,o){var a=e.__transition;if(!a)e.__transition={};else if(n in a)return;rl(e,n,{name:t,index:i,group:r,on:nl,tween:il,time:o.time,delay:o.delay,duration:o.duration,ease:o.ease,timer:null,state:Eo})}function xi(e,t){var n=ze(e,t);if(n.state>Eo)throw new Error("too late; already scheduled");return n}function He(e,t){var n=ze(e,t);if(n.state>rn)throw new Error("too late; already running");return n}function ze(e,t){var n=e.__transition;if(!n||!(n=n[t]))throw new Error("transition not found");return n}function rl(e,t,n){var i=e.__transition,r;i[t]=n,n.timer=_o(o,0,n.time);function o(l){n.state=ir,n.timer.restart(a,n.delay,n.time),n.delay<=l&&a(l-n.delay)}function a(l){var c,h,d,f;if(n.state!==ir)return u();for(c in i)if(f=i[c],f.name===n.name){if(f.state===rn)return nr(a);f.state===rr?(f.state=on,f.timer.stop(),f.on.call("interrupt",e,e.__data__,f.index,f.group),delete i[c]):+c<t&&(f.state=on,f.timer.stop(),f.on.call("cancel",e,e.__data__,f.index,f.group),delete i[c])}if(nr(function(){n.state===rn&&(n.state=rr,n.timer.restart(s,n.delay,n.time),s(l))}),n.state=oi,n.on.call("start",e,e.__data__,n.index,n.group),n.state===oi){for(n.state=rn,r=new Array(d=n.tween.length),c=0,h=-1;c<d;++c)(f=n.tween[c].value.call(e,e.__data__,n.index,n.group))&&(r[++h]=f);r.length=h+1}}function s(l){for(var c=l<n.duration?n.ease.call(null,l/n.duration):(n.timer.restart(u),n.state=ai,1),h=-1,d=r.length;++h<d;)r[h].call(e,c);n.state===ai&&(n.on.call("end",e,e.__data__,n.index,n.group),u())}function u(){n.state=on,n.timer.stop(),delete i[t];for(var l in i)return;delete e.__transition}}function ol(e,t){var n=e.__transition,i,r,o=!0,a;if(n){t=t==null?null:t+"";for(a in n){if((i=n[a]).name!==t){o=!1;continue}r=i.state>oi&&i.state<ai,i.state=on,i.timer.stop(),i.on.call(r?"interrupt":"cancel",e,e.__data__,i.index,i.group),delete n[a]}o&&delete e.__transition}}function al(e){return this.each(function(){ol(this,e)})}function sl(e,t){var n,i;return function(){var r=He(this,e),o=r.tween;if(o!==n){i=n=o;for(var a=0,s=i.length;a<s;++a)if(i[a].name===t){i=i.slice(),i.splice(a,1);break}}r.tween=i}}function ul(e,t,n){var i,r;if(typeof n!="function")throw new Error;return function(){var o=He(this,e),a=o.tween;if(a!==i){r=(i=a).slice();for(var s={name:t,value:n},u=0,l=r.length;u<l;++u)if(r[u].name===t){r[u]=s;break}u===l&&r.push(s)}o.tween=r}}function ll(e,t){var n=this._id;if(e+="",arguments.length<2){for(var i=ze(this.node(),n).tween,r=0,o=i.length,a;r<o;++r)if((a=i[r]).name===e)return a.value;return null}return this.each((t==null?sl:ul)(n,e,t))}function Ti(e,t,n){var i=e._id;return e.each(function(){var r=He(this,i);(r.value||(r.value={}))[t]=n.apply(this,arguments)}),function(r){return ze(r,i).value[t]}}function xo(e,t){var n;return(typeof t=="number"?Fe:t instanceof at?dn:(n=at(t))?(t=n,dn):mo)(e,t)}function cl(e){return function(){this.removeAttribute(e)}}function hl(e){return function(){this.removeAttributeNS(e.space,e.local)}}function dl(e,t,n){var i,r=n+"",o;return function(){var a=this.getAttribute(e);return a===r?null:a===i?o:o=t(i=a,n)}}function fl(e,t,n){var i,r=n+"",o;return function(){var a=this.getAttributeNS(e.space,e.local);return a===r?null:a===i?o:o=t(i=a,n)}}function gl(e,t,n){var i,r,o;return function(){var a,s=n(this),u;return s==null?void this.removeAttribute(e):(a=this.getAttribute(e),u=s+"",a===u?null:a===i&&u===r?o:(r=u,o=t(i=a,s)))}}function pl(e,t,n){var i,r,o;return function(){var a,s=n(this),u;return s==null?void this.removeAttributeNS(e.space,e.local):(a=this.getAttributeNS(e.space,e.local),u=s+"",a===u?null:a===i&&u===r?o:(r=u,o=t(i=a,s)))}}function ml(e,t){var n=En(e),i=n==="transform"?Zu:xo;return this.attrTween(e,typeof t=="function"?(n.local?pl:gl)(n,i,Ti(this,"attr."+e,t)):t==null?(n.local?hl:cl)(n):(n.local?fl:dl)(n,i,t))}function vl(e,t){return function(n){this.setAttribute(e,t.call(this,n))}}function yl(e,t){return function(n){this.setAttributeNS(e.space,e.local,t.call(this,n))}}function bl(e,t){var n,i;function r(){var o=t.apply(this,arguments);return o!==i&&(n=(i=o)&&yl(e,o)),n}return r._value=t,r}function wl(e,t){var n,i;function r(){var o=t.apply(this,arguments);return o!==i&&(n=(i=o)&&vl(e,o)),n}return r._value=t,r}function _l(e,t){var n="attr."+e;if(arguments.length<2)return(n=this.tween(n))&&n._value;if(t==null)return this.tween(n,null);if(typeof t!="function")throw new Error;var i=En(e);return this.tween(n,(i.local?bl:wl)(i,t))}function El(e,t){return function(){xi(this,e).delay=+t.apply(this,arguments)}}function xl(e,t){return t=+t,function(){xi(this,e).delay=t}}function Tl(e){var t=this._id;return arguments.length?this.each((typeof e=="function"?El:xl)(t,e)):ze(this.node(),t).delay}function kl(e,t){return function(){He(this,e).duration=+t.apply(this,arguments)}}function Sl(e,t){return t=+t,function(){He(this,e).duration=t}}function Al(e){var t=this._id;return arguments.length?this.each((typeof e=="function"?kl:Sl)(t,e)):ze(this.node(),t).duration}function Cl(e,t){if(typeof t!="function")throw new Error;return function(){He(this,e).ease=t}}function Rl(e){var t=this._id;return arguments.length?this.each(Cl(t,e)):ze(this.node(),t).ease}function Ll(e,t){return function(){var n=t.apply(this,arguments);if(typeof n!="function")throw new Error;He(this,e).ease=n}}function Dl(e){if(typeof e!="function")throw new Error;return this.each(Ll(this._id,e))}function $l(e){typeof e!="function"&&(e=no(e));for(var t=this._groups,n=t.length,i=new Array(n),r=0;r<n;++r)for(var o=t[r],a=o.length,s=i[r]=[],u,l=0;l<a;++l)(u=o[l])&&e.call(u,u.__data__,l,o)&&s.push(u);return new Ye(i,this._parents,this._name,this._id)}function Gl(e){if(e._id!==this._id)throw new Error;for(var t=this._groups,n=e._groups,i=t.length,r=n.length,o=Math.min(i,r),a=new Array(i),s=0;s<o;++s)for(var u=t[s],l=n[s],c=u.length,h=a[s]=new Array(c),d,f=0;f<c;++f)(d=u[f]||l[f])&&(h[f]=d);for(;s<i;++s)a[s]=t[s];return new Ye(a,this._parents,this._name,this._id)}function Nl(e){return(e+"").trim().split(/^|\s+/).every(function(t){var n=t.indexOf(".");return n>=0&&(t=t.slice(0,n)),!t||t==="start"})}function Pl(e,t,n){var i,r,o=Nl(t)?xi:He;return function(){var a=o(this,e),s=a.on;s!==i&&(r=(i=s).copy()).on(t,n),a.on=r}}function Fl(e,t){var n=this._id;return arguments.length<2?ze(this.node(),n).on.on(e):this.each(Pl(n,e,t))}function Il(e){return function(){var t=this.parentNode;for(var n in this.__transition)if(+n!==e)return;t&&t.removeChild(this)}}function Ml(){return this.on("end.remove",Il(this._id))}function zl(e){var t=this._name,n=this._id;typeof e!="function"&&(e=vi(e));for(var i=this._groups,r=i.length,o=new Array(r),a=0;a<r;++a)for(var s=i[a],u=s.length,l=o[a]=new Array(u),c,h,d=0;d<u;++d)(c=s[d])&&(h=e.call(c,c.__data__,d,s))&&("__data__"in c&&(h.__data__=c.__data__),l[d]=h,Tn(l[d],t,n,d,l,ze(c,n)));return new Ye(o,this._parents,t,n)}function Ol(e){var t=this._name,n=this._id;typeof e!="function"&&(e=to(e));for(var i=this._groups,r=i.length,o=[],a=[],s=0;s<r;++s)for(var u=i[s],l=u.length,c,h=0;h<l;++h)if(c=u[h]){for(var d=e.call(c,c.__data__,h,u),f,p=ze(c,n),m=0,_=d.length;m<_;++m)(f=d[m])&&Tn(f,t,n,m,d,p);o.push(d),a.push(c)}return new Ye(o,a,t,n)}var Ul=Ut.prototype.constructor;function Bl(){return new Ul(this._groups,this._parents)}function Hl(e,t){var n,i,r;return function(){var o=ft(this,e),a=(this.style.removeProperty(e),ft(this,e));return o===a?null:o===n&&a===i?r:r=t(n=o,i=a)}}function To(e){return function(){this.style.removeProperty(e)}}function Wl(e,t,n){var i,r=n+"",o;return function(){var a=ft(this,e);return a===r?null:a===i?o:o=t(i=a,n)}}function Vl(e,t,n){var i,r,o;return function(){var a=ft(this,e),s=n(this),u=s+"";return s==null&&(u=s=(this.style.removeProperty(e),ft(this,e))),a===u?null:a===i&&u===r?o:(r=u,o=t(i=a,s))}}function jl(e,t){var n,i,r,o="style."+t,a="end."+o,s;return function(){var u=He(this,e),l=u.on,c=u.value[o]==null?s||(s=To(t)):void 0;(l!==n||r!==c)&&(i=(n=l).copy()).on(a,r=c),u.on=i}}function ql(e,t,n){var i=(e+="")=="transform"?Ku:xo;return t==null?this.styleTween(e,Hl(e,i)).on("end.style."+e,To(e)):typeof t=="function"?this.styleTween(e,Vl(e,i,Ti(this,"style."+e,t))).each(jl(this._id,e)):this.styleTween(e,Wl(e,i,t),n).on("end.style."+e,null)}function Xl(e,t,n){return function(i){this.style.setProperty(e,t.call(this,i),n)}}function Yl(e,t,n){var i,r;function o(){var a=t.apply(this,arguments);return a!==r&&(i=(r=a)&&Xl(e,a,n)),i}return o._value=t,o}function Kl(e,t,n){var i="style."+(e+="");if(arguments.length<2)return(i=this.tween(i))&&i._value;if(t==null)return this.tween(i,null);if(typeof t!="function")throw new Error;return this.tween(i,Yl(e,t,n??""))}function Zl(e){return function(){this.textContent=e}}function Jl(e){return function(){var t=e(this);this.textContent=t??""}}function Ql(e){return this.tween("text",typeof e=="function"?Jl(Ti(this,"text",e)):Zl(e==null?"":e+""))}function ec(e){return function(t){this.textContent=e.call(this,t)}}function tc(e){var t,n;function i(){var r=e.apply(this,arguments);return r!==n&&(t=(n=r)&&ec(r)),t}return i._value=e,i}function nc(e){var t="text";if(arguments.length<1)return(t=this.tween(t))&&t._value;if(e==null)return this.tween(t,null);if(typeof e!="function")throw new Error;return this.tween(t,tc(e))}function ic(){for(var e=this._name,t=this._id,n=ko(),i=this._groups,r=i.length,o=0;o<r;++o)for(var a=i[o],s=a.length,u,l=0;l<s;++l)if(u=a[l]){var c=ze(u,t);Tn(u,e,n,l,a,{time:c.time+c.delay+c.duration,delay:0,duration:c.duration,ease:c.ease})}return new Ye(i,this._parents,e,n)}function rc(){var e,t,n=this,i=n._id,r=n.size();return new Promise(function(o,a){var s={value:a},u={value:function(){--r===0&&o()}};n.each(function(){var l=He(this,i),c=l.on;c!==e&&(t=(e=c).copy(),t._.cancel.push(s),t._.interrupt.push(s),t._.end.push(u)),l.on=t}),r===0&&o()})}var oc=0;function Ye(e,t,n,i){this._groups=e,this._parents=t,this._name=n,this._id=i}function ko(){return++oc}var We=Ut.prototype;Ye.prototype={constructor:Ye,select:zl,selectAll:Ol,selectChild:We.selectChild,selectChildren:We.selectChildren,filter:$l,merge:Gl,selection:Bl,transition:ic,call:We.call,nodes:We.nodes,node:We.node,size:We.size,empty:We.empty,each:We.each,on:Fl,attr:ml,attrTween:_l,style:ql,styleTween:Kl,text:Ql,textTween:nc,remove:Ml,tween:ll,delay:Tl,duration:Al,ease:Rl,easeVarying:Dl,end:rc,[Symbol.iterator]:We[Symbol.iterator]};function ac(e){return((e*=2)<=1?e*e*e:(e-=2)*e*e+2)/2}var sc={time:null,delay:0,duration:250,ease:ac};function uc(e,t){for(var n;!(n=e.__transition)||!(n=n[t]);)if(!(e=e.parentNode))throw new Error(`transition ${t} not found`);return n}function lc(e){var t,n;e instanceof Ye?(t=e._id,e=e._name):(t=ko(),(n=sc).time=Ei(),e=e==null?null:e+"");for(var i=this._groups,r=i.length,o=0;o<r;++o)for(var a=i[o],s=a.length,u,l=0;l<s;++l)(u=a[l])&&Tn(u,e,t,l,a,n||uc(u,t));return new Ye(i,this._parents,e,t)}Ut.prototype.interrupt=al;Ut.prototype.transition=lc;const si=Math.PI,ui=2*si,it=1e-6,cc=ui-it;function So(e){this._+=e[0];for(let t=1,n=e.length;t<n;++t)this._+=arguments[t]+e[t]}function hc(e){let t=Math.floor(e);if(!(t>=0))throw new Error(`invalid digits: ${e}`);if(t>15)return So;const n=10**t;return function(i){this._+=i[0];for(let r=1,o=i.length;r<o;++r)this._+=Math.round(arguments[r]*n)/n+i[r]}}class dc{constructor(t){this._x0=this._y0=this._x1=this._y1=null,this._="",this._append=t==null?So:hc(t)}moveTo(t,n){this._append`M${this._x0=this._x1=+t},${this._y0=this._y1=+n}`}closePath(){this._x1!==null&&(this._x1=this._x0,this._y1=this._y0,this._append`Z`)}lineTo(t,n){this._append`L${this._x1=+t},${this._y1=+n}`}quadraticCurveTo(t,n,i,r){this._append`Q${+t},${+n},${this._x1=+i},${this._y1=+r}`}bezierCurveTo(t,n,i,r,o,a){this._append`C${+t},${+n},${+i},${+r},${this._x1=+o},${this._y1=+a}`}arcTo(t,n,i,r,o){if(t=+t,n=+n,i=+i,r=+r,o=+o,o<0)throw new Error(`negative radius: ${o}`);let a=this._x1,s=this._y1,u=i-t,l=r-n,c=a-t,h=s-n,d=c*c+h*h;if(this._x1===null)this._append`M${this._x1=t},${this._y1=n}`;else if(d>it)if(!(Math.abs(h*u-l*c)>it)||!o)this._append`L${this._x1=t},${this._y1=n}`;else{let f=i-a,p=r-s,m=u*u+l*l,_=f*f+p*p,T=Math.sqrt(m),x=Math.sqrt(d),k=o*Math.tan((si-Math.acos((m+d-_)/(2*T*x)))/2),v=k/x,b=k/T;Math.abs(v-1)>it&&this._append`L${t+v*c},${n+v*h}`,this._append`A${o},${o},0,0,${+(h*f>c*p)},${this._x1=t+b*u},${this._y1=n+b*l}`}}arc(t,n,i,r,o,a){if(t=+t,n=+n,i=+i,a=!!a,i<0)throw new Error(`negative radius: ${i}`);let s=i*Math.cos(r),u=i*Math.sin(r),l=t+s,c=n+u,h=1^a,d=a?r-o:o-r;this._x1===null?this._append`M${l},${c}`:(Math.abs(this._x1-l)>it||Math.abs(this._y1-c)>it)&&this._append`L${l},${c}`,i&&(d<0&&(d=d%ui+ui),d>cc?this._append`A${i},${i},0,1,${h},${t-s},${n-u}A${i},${i},0,1,${h},${this._x1=l},${this._y1=c}`:d>it&&this._append`A${i},${i},0,${+(d>=si)},${h},${this._x1=t+i*Math.cos(o)},${this._y1=n+i*Math.sin(o)}`)}rect(t,n,i,r){this._append`M${this._x0=this._x1=+t},${this._y0=this._y1=+n}h${i=+i}v${+r}h${-i}Z`}toString(){return this._}}function fc(e){return Math.abs(e=Math.round(e))>=1e21?e.toLocaleString("en").replace(/,/g,""):e.toString(10)}function mn(e,t){if((n=(e=t?e.toExponential(t-1):e.toExponential()).indexOf("e"))<0)return null;var n,i=e.slice(0,n);return[i.length>1?i[0]+i.slice(2):i,+e.slice(n+1)]}function pt(e){return e=mn(Math.abs(e)),e?e[1]:NaN}function gc(e,t){return function(n,i){for(var r=n.length,o=[],a=0,s=e[0],u=0;r>0&&s>0&&(u+s+1>i&&(s=Math.max(1,i-u)),o.push(n.substring(r-=s,r+s)),!((u+=s+1)>i));)s=e[a=(a+1)%e.length];return o.reverse().join(t)}}function pc(e){return function(t){return t.replace(/[0-9]/g,function(n){return e[+n]})}}var mc=/^(?:(.)?([<>=^]))?([+\-( ])?([$#])?(0)?(\d+)?(,)?(\.\d+)?(~)?([a-z%])?$/i;function vn(e){if(!(t=mc.exec(e)))throw new Error("invalid format: "+e);var t;return new ki({fill:t[1],align:t[2],sign:t[3],symbol:t[4],zero:t[5],width:t[6],comma:t[7],precision:t[8]&&t[8].slice(1),trim:t[9],type:t[10]})}vn.prototype=ki.prototype;function ki(e){this.fill=e.fill===void 0?" ":e.fill+"",this.align=e.align===void 0?">":e.align+"",this.sign=e.sign===void 0?"-":e.sign+"",this.symbol=e.symbol===void 0?"":e.symbol+"",this.zero=!!e.zero,this.width=e.width===void 0?void 0:+e.width,this.comma=!!e.comma,this.precision=e.precision===void 0?void 0:+e.precision,this.trim=!!e.trim,this.type=e.type===void 0?"":e.type+""}ki.prototype.toString=function(){return this.fill+this.align+this.sign+this.symbol+(this.zero?"0":"")+(this.width===void 0?"":Math.max(1,this.width|0))+(this.comma?",":"")+(this.precision===void 0?"":"."+Math.max(0,this.precision|0))+(this.trim?"~":"")+this.type};function vc(e){e:for(var t=e.length,n=1,i=-1,r;n<t;++n)switch(e[n]){case".":i=r=n;break;case"0":i===0&&(i=n),r=n;break;default:if(!+e[n])break e;i>0&&(i=0);break}return i>0?e.slice(0,i)+e.slice(r+1):e}var Ao;function yc(e,t){var n=mn(e,t);if(!n)return e+"";var i=n[0],r=n[1],o=r-(Ao=Math.max(-8,Math.min(8,Math.floor(r/3)))*3)+1,a=i.length;return o===a?i:o>a?i+new Array(o-a+1).join("0"):o>0?i.slice(0,o)+"."+i.slice(o):"0."+new Array(1-o).join("0")+mn(e,Math.max(0,t+o-1))[0]}function or(e,t){var n=mn(e,t);if(!n)return e+"";var i=n[0],r=n[1];return r<0?"0."+new Array(-r).join("0")+i:i.length>r+1?i.slice(0,r+1)+"."+i.slice(r+1):i+new Array(r-i.length+2).join("0")}const ar={"%":(e,t)=>(e*100).toFixed(t),b:e=>Math.round(e).toString(2),c:e=>e+"",d:fc,e:(e,t)=>e.toExponential(t),f:(e,t)=>e.toFixed(t),g:(e,t)=>e.toPrecision(t),o:e=>Math.round(e).toString(8),p:(e,t)=>or(e*100,t),r:or,s:yc,X:e=>Math.round(e).toString(16).toUpperCase(),x:e=>Math.round(e).toString(16)};function sr(e){return e}var ur=Array.prototype.map,lr=["y","z","a","f","p","n","µ","m","","k","M","G","T","P","E","Z","Y"];function bc(e){var t=e.grouping===void 0||e.thousands===void 0?sr:gc(ur.call(e.grouping,Number),e.thousands+""),n=e.currency===void 0?"":e.currency[0]+"",i=e.currency===void 0?"":e.currency[1]+"",r=e.decimal===void 0?".":e.decimal+"",o=e.numerals===void 0?sr:pc(ur.call(e.numerals,String)),a=e.percent===void 0?"%":e.percent+"",s=e.minus===void 0?"−":e.minus+"",u=e.nan===void 0?"NaN":e.nan+"";function l(h){h=vn(h);var d=h.fill,f=h.align,p=h.sign,m=h.symbol,_=h.zero,T=h.width,x=h.comma,k=h.precision,v=h.trim,b=h.type;b==="n"?(x=!0,b="g"):ar[b]||(k===void 0&&(k=12),v=!0,b="g"),(_||d==="0"&&f==="=")&&(_=!0,d="0",f="=");var C=m==="$"?n:m==="#"&&/[boxX]/.test(b)?"0"+b.toLowerCase():"",R=m==="$"?i:/[%p]/.test(b)?a:"",B=ar[b],I=/[defgprs%]/.test(b);k=k===void 0?6:/[gprs]/.test(b)?Math.max(1,Math.min(21,k)):Math.max(0,Math.min(20,k));function O(M){var z=C,g=R,j,re,D;if(b==="c")g=B(M)+g,M="";else{M=+M;var w=M<0||1/M<0;if(M=isNaN(M)?u:B(Math.abs(M),k),v&&(M=vc(M)),w&&+M==0&&p!=="+"&&(w=!1),z=(w?p==="("?p:s:p==="-"||p==="("?"":p)+z,g=(b==="s"?lr[8+Ao/3]:"")+g+(w&&p==="("?")":""),I){for(j=-1,re=M.length;++j<re;)if(D=M.charCodeAt(j),48>D||D>57){g=(D===46?r+M.slice(j+1):M.slice(j))+g,M=M.slice(0,j);break}}}x&&!_&&(M=t(M,1/0));var Q=z.length+M.length+g.length,ee=Q<T?new Array(T-Q+1).join(d):"";switch(x&&_&&(M=t(ee+M,ee.length?T-g.length:1/0),ee=""),f){case"<":M=z+M+g+ee;break;case"=":M=z+ee+M+g;break;case"^":M=ee.slice(0,Q=ee.length>>1)+z+M+g+ee.slice(Q);break;default:M=ee+z+M+g;break}return o(M)}return O.toString=function(){return h+""},O}function c(h,d){var f=l((h=vn(h),h.type="f",h)),p=Math.max(-8,Math.min(8,Math.floor(pt(d)/3)))*3,m=Math.pow(10,-p),_=lr[8+p/3];return function(T){return f(m*T)+_}}return{format:l,formatPrefix:c}}var qt,Si,Co;wc({thousands:",",grouping:[3],currency:["$",""]});function wc(e){return qt=bc(e),Si=qt.format,Co=qt.formatPrefix,qt}function _c(e){return Math.max(0,-pt(Math.abs(e)))}function Ec(e,t){return Math.max(0,Math.max(-8,Math.min(8,Math.floor(pt(t)/3)))*3-pt(Math.abs(e)))}function xc(e,t){return e=Math.abs(e),t=Math.abs(t)-e,Math.max(0,pt(t)-pt(e))+1}function Ai(e,t){switch(arguments.length){case 0:break;case 1:this.range(e);break;default:this.range(t).domain(e);break}return this}const cr=Symbol("implicit");function Pt(){var e=new zi,t=[],n=[],i=cr;function r(o){let a=e.get(o);if(a===void 0){if(i!==cr)return i;e.set(o,a=t.push(o)-1)}return n[a%n.length]}return r.domain=function(o){if(!arguments.length)return t.slice();t=[],e=new zi;for(const a of o)e.has(a)||e.set(a,t.push(a)-1);return r},r.range=function(o){return arguments.length?(n=Array.from(o),r):n.slice()},r.unknown=function(o){return arguments.length?(i=o,r):i},r.copy=function(){return Pt(t,n).unknown(i)},Ai.apply(r,arguments),r}function Ro(){var e=Pt().unknown(void 0),t=e.domain,n=e.range,i=0,r=1,o,a,s=!1,u=0,l=0,c=.5;delete e.unknown;function h(){var d=t().length,f=r<i,p=f?r:i,m=f?i:r;o=(m-p)/Math.max(1,d-u+l*2),s&&(o=Math.floor(o)),p+=(m-p-o*(d-u))*c,a=o*(1-u),s&&(p=Math.round(p),a=Math.round(a));var _=Ia(d).map(function(T){return p+o*T});return n(f?_.reverse():_)}return e.domain=function(d){return arguments.length?(t(d),h()):t()},e.range=function(d){return arguments.length?([i,r]=d,i=+i,r=+r,h()):[i,r]},e.rangeRound=function(d){return[i,r]=d,i=+i,r=+r,s=!0,h()},e.bandwidth=function(){return a},e.step=function(){return o},e.round=function(d){return arguments.length?(s=!!d,h()):s},e.padding=function(d){return arguments.length?(u=Math.min(1,l=+d),h()):u},e.paddingInner=function(d){return arguments.length?(u=Math.min(1,d),h()):u},e.paddingOuter=function(d){return arguments.length?(l=+d,h()):l},e.align=function(d){return arguments.length?(c=Math.max(0,Math.min(1,d)),h()):c},e.copy=function(){return Ro(t(),[i,r]).round(s).paddingInner(u).paddingOuter(l).align(c)},Ai.apply(h(),arguments)}function Tc(e){return function(){return e}}function kc(e){return+e}var hr=[0,1];function lt(e){return e}function li(e,t){return(t-=e=+e)?function(n){return(n-e)/t}:Tc(isNaN(t)?NaN:.5)}function Sc(e,t){var n;return e>t&&(n=e,e=t,t=n),function(i){return Math.max(e,Math.min(t,i))}}function Ac(e,t,n){var i=e[0],r=e[1],o=t[0],a=t[1];return r<i?(i=li(r,i),o=n(a,o)):(i=li(i,r),o=n(o,a)),function(s){return o(i(s))}}function Cc(e,t,n){var i=Math.min(e.length,t.length)-1,r=new Array(i),o=new Array(i),a=-1;for(e[i]<e[0]&&(e=e.slice().reverse(),t=t.slice().reverse());++a<i;)r[a]=li(e[a],e[a+1]),o[a]=n(t[a],t[a+1]);return function(s){var u=Aa(e,s,1,i)-1;return o[u](r[u](s))}}function Rc(e,t){return t.domain(e.domain()).range(e.range()).interpolate(e.interpolate()).clamp(e.clamp()).unknown(e.unknown())}function Lc(){var e=hr,t=hr,n=_i,i,r,o,a=lt,s,u,l;function c(){var d=Math.min(e.length,t.length);return a!==lt&&(a=Sc(e[0],e[d-1])),s=d>2?Cc:Ac,u=l=null,h}function h(d){return d==null||isNaN(d=+d)?o:(u||(u=s(e.map(i),t,n)))(i(a(d)))}return h.invert=function(d){return a(r((l||(l=s(t,e.map(i),Fe)))(d)))},h.domain=function(d){return arguments.length?(e=Array.from(d,kc),c()):e.slice()},h.range=function(d){return arguments.length?(t=Array.from(d),c()):t.slice()},h.rangeRound=function(d){return t=Array.from(d),n=qu,c()},h.clamp=function(d){return arguments.length?(a=d?!0:lt,c()):a!==lt},h.interpolate=function(d){return arguments.length?(n=d,c()):n},h.unknown=function(d){return arguments.length?(o=d,h):o},function(d,f){return i=d,r=f,c()}}function Dc(){return Lc()(lt,lt)}function $c(e,t,n,i){var r=Fa(e,t,n),o;switch(i=vn(i??",f"),i.type){case"s":{var a=Math.max(Math.abs(e),Math.abs(t));return i.precision==null&&!isNaN(o=Ec(r,a))&&(i.precision=o),Co(i,a)}case"":case"e":case"g":case"p":case"r":{i.precision==null&&!isNaN(o=xc(r,Math.max(Math.abs(e),Math.abs(t))))&&(i.precision=o-(i.type==="e"));break}case"f":case"%":{i.precision==null&&!isNaN(o=_c(r))&&(i.precision=o-(i.type==="%")*2);break}}return Si(i)}function Gc(e){var t=e.domain;return e.ticks=function(n){var i=t();return Pa(i[0],i[i.length-1],n??10)},e.tickFormat=function(n,i){var r=t();return $c(r[0],r[r.length-1],n??10,i)},e.nice=function(n){n==null&&(n=10);var i=t(),r=0,o=i.length-1,a=i[r],s=i[o],u,l,c=10;for(s<a&&(l=a,a=s,s=l,l=r,r=o,o=l);c-- >0;){if(l=Jn(a,s,n),l===u)return i[r]=a,i[o]=s,t(i);if(l>0)a=Math.floor(a/l)*l,s=Math.ceil(s/l)*l;else if(l<0)a=Math.ceil(a*l)/l,s=Math.floor(s*l)/l;else break;u=l}return e},e}function Gt(){var e=Dc();return e.copy=function(){return Rc(e,Gt())},Ai.apply(e,arguments),Gc(e)}function Nc(e){for(var t=e.length/6|0,n=new Array(t),i=0;i<t;)n[i]="#"+e.slice(i*6,++i*6);return n}const dr=Nc("1f77b4ff7f0e2ca02cd627289467bd8c564be377c27f7f7fbcbd2217becf");function ce(e){return function(){return e}}const fr=Math.abs,_e=Math.atan2,tt=Math.cos,Pc=Math.max,Pn=Math.min,Ue=Math.sin,ct=Math.sqrt,ke=1e-12,Ot=Math.PI,yn=Ot/2,an=2*Ot;function Fc(e){return e>1?0:e<-1?Ot:Math.acos(e)}function gr(e){return e>=1?yn:e<=-1?-yn:Math.asin(e)}function Ci(e){let t=3;return e.digits=function(n){if(!arguments.length)return t;if(n==null)t=null;else{const i=Math.floor(n);if(!(i>=0))throw new RangeError(`invalid digits: ${n}`);t=i}return e},()=>new dc(t)}function Ic(e){return e.innerRadius}function Mc(e){return e.outerRadius}function zc(e){return e.startAngle}function Oc(e){return e.endAngle}function Uc(e){return e&&e.padAngle}function Bc(e,t,n,i,r,o,a,s){var u=n-e,l=i-t,c=a-r,h=s-o,d=h*u-c*l;if(!(d*d<ke))return d=(c*(t-o)-h*(e-r))/d,[e+d*u,t+d*l]}function Xt(e,t,n,i,r,o,a){var s=e-n,u=t-i,l=(a?o:-o)/ct(s*s+u*u),c=l*u,h=-l*s,d=e+c,f=t+h,p=n+c,m=i+h,_=(d+p)/2,T=(f+m)/2,x=p-d,k=m-f,v=x*x+k*k,b=r-o,C=d*m-p*f,R=(k<0?-1:1)*ct(Pc(0,b*b*v-C*C)),B=(C*k-x*R)/v,I=(-C*x-k*R)/v,O=(C*k+x*R)/v,M=(-C*x+k*R)/v,z=B-_,g=I-T,j=O-_,re=M-T;return z*z+g*g>j*j+re*re&&(B=O,I=M),{cx:B,cy:I,x01:-c,y01:-h,x11:B*(r/b-1),y11:I*(r/b-1)}}function Hc(){var e=Ic,t=Mc,n=ce(0),i=null,r=zc,o=Oc,a=Uc,s=null,u=Ci(l);function l(){var c,h,d=+e.apply(this,arguments),f=+t.apply(this,arguments),p=r.apply(this,arguments)-yn,m=o.apply(this,arguments)-yn,_=fr(m-p),T=m>p;if(s||(s=c=u()),f<d&&(h=f,f=d,d=h),!(f>ke))s.moveTo(0,0);else if(_>an-ke)s.moveTo(f*tt(p),f*Ue(p)),s.arc(0,0,f,p,m,!T),d>ke&&(s.moveTo(d*tt(m),d*Ue(m)),s.arc(0,0,d,m,p,T));else{var x=p,k=m,v=p,b=m,C=_,R=_,B=a.apply(this,arguments)/2,I=B>ke&&(i?+i.apply(this,arguments):ct(d*d+f*f)),O=Pn(fr(f-d)/2,+n.apply(this,arguments)),M=O,z=O,g,j;if(I>ke){var re=gr(I/d*Ue(B)),D=gr(I/f*Ue(B));(C-=re*2)>ke?(re*=T?1:-1,v+=re,b-=re):(C=0,v=b=(p+m)/2),(R-=D*2)>ke?(D*=T?1:-1,x+=D,k-=D):(R=0,x=k=(p+m)/2)}var w=f*tt(x),Q=f*Ue(x),ee=d*tt(b),oe=d*Ue(b);if(O>ke){var he=f*tt(k),ue=f*Ue(k),X=d*tt(v),Te=d*Ue(v),de;if(_<Ot)if(de=Bc(w,Q,X,Te,he,ue,ee,oe)){var ve=w-de[0],Ce=Q-de[1],ye=he-de[0],E=ue-de[1],$=1/Ue(Fc((ve*ye+Ce*E)/(ct(ve*ve+Ce*Ce)*ct(ye*ye+E*E)))/2),G=ct(de[0]*de[0]+de[1]*de[1]);M=Pn(O,(d-G)/($-1)),z=Pn(O,(f-G)/($+1))}else M=z=0}R>ke?z>ke?(g=Xt(X,Te,w,Q,f,z,T),j=Xt(he,ue,ee,oe,f,z,T),s.moveTo(g.cx+g.x01,g.cy+g.y01),z<O?s.arc(g.cx,g.cy,z,_e(g.y01,g.x01),_e(j.y01,j.x01),!T):(s.arc(g.cx,g.cy,z,_e(g.y01,g.x01),_e(g.y11,g.x11),!T),s.arc(0,0,f,_e(g.cy+g.y11,g.cx+g.x11),_e(j.cy+j.y11,j.cx+j.x11),!T),s.arc(j.cx,j.cy,z,_e(j.y11,j.x11),_e(j.y01,j.x01),!T))):(s.moveTo(w,Q),s.arc(0,0,f,x,k,!T)):s.moveTo(w,Q),!(d>ke)||!(C>ke)?s.lineTo(ee,oe):M>ke?(g=Xt(ee,oe,he,ue,d,-M,T),j=Xt(w,Q,X,Te,d,-M,T),s.lineTo(g.cx+g.x01,g.cy+g.y01),M<O?s.arc(g.cx,g.cy,M,_e(g.y01,g.x01),_e(j.y01,j.x01),!T):(s.arc(g.cx,g.cy,M,_e(g.y01,g.x01),_e(g.y11,g.x11),!T),s.arc(0,0,d,_e(g.cy+g.y11,g.cx+g.x11),_e(j.cy+j.y11,j.cx+j.x11),T),s.arc(j.cx,j.cy,M,_e(j.y11,j.x11),_e(j.y01,j.x01),!T))):s.arc(0,0,d,b,v,T)}if(s.closePath(),c)return s=null,c+""||null}return l.centroid=function(){var c=(+e.apply(this,arguments)+ +t.apply(this,arguments))/2,h=(+r.apply(this,arguments)+ +o.apply(this,arguments))/2-Ot/2;return[tt(h)*c,Ue(h)*c]},l.innerRadius=function(c){return arguments.length?(e=typeof c=="function"?c:ce(+c),l):e},l.outerRadius=function(c){return arguments.length?(t=typeof c=="function"?c:ce(+c),l):t},l.cornerRadius=function(c){return arguments.length?(n=typeof c=="function"?c:ce(+c),l):n},l.padRadius=function(c){return arguments.length?(i=c==null?null:typeof c=="function"?c:ce(+c),l):i},l.startAngle=function(c){return arguments.length?(r=typeof c=="function"?c:ce(+c),l):r},l.endAngle=function(c){return arguments.length?(o=typeof c=="function"?c:ce(+c),l):o},l.padAngle=function(c){return arguments.length?(a=typeof c=="function"?c:ce(+c),l):a},l.context=function(c){return arguments.length?(s=c??null,l):s},l}function Ri(e){return typeof e=="object"&&"length"in e?e:Array.from(e)}function Lo(e){this._context=e}Lo.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._point=0},lineEnd:function(){(this._line||this._line!==0&&this._point===1)&&this._context.closePath(),this._line=1-this._line},point:function(e,t){switch(e=+e,t=+t,this._point){case 0:this._point=1,this._line?this._context.lineTo(e,t):this._context.moveTo(e,t);break;case 1:this._point=2;default:this._context.lineTo(e,t);break}}};function Do(e){return new Lo(e)}function $o(e){return e[0]}function Go(e){return e[1]}function No(e,t){var n=ce(!0),i=null,r=Do,o=null,a=Ci(s);e=typeof e=="function"?e:e===void 0?$o:ce(e),t=typeof t=="function"?t:t===void 0?Go:ce(t);function s(u){var l,c=(u=Ri(u)).length,h,d=!1,f;for(i==null&&(o=r(f=a())),l=0;l<=c;++l)!(l<c&&n(h=u[l],l,u))===d&&((d=!d)?o.lineStart():o.lineEnd()),d&&o.point(+e(h,l,u),+t(h,l,u));if(f)return o=null,f+""||null}return s.x=function(u){return arguments.length?(e=typeof u=="function"?u:ce(+u),s):e},s.y=function(u){return arguments.length?(t=typeof u=="function"?u:ce(+u),s):t},s.defined=function(u){return arguments.length?(n=typeof u=="function"?u:ce(!!u),s):n},s.curve=function(u){return arguments.length?(r=u,i!=null&&(o=r(i)),s):r},s.context=function(u){return arguments.length?(u==null?i=o=null:o=r(i=u),s):i},s}function Wc(e,t,n){var i=null,r=ce(!0),o=null,a=Do,s=null,u=Ci(l);e=typeof e=="function"?e:e===void 0?$o:ce(+e),t=typeof t=="function"?t:ce(t===void 0?0:+t),n=typeof n=="function"?n:n===void 0?Go:ce(+n);function l(h){var d,f,p,m=(h=Ri(h)).length,_,T=!1,x,k=new Array(m),v=new Array(m);for(o==null&&(s=a(x=u())),d=0;d<=m;++d){if(!(d<m&&r(_=h[d],d,h))===T)if(T=!T)f=d,s.areaStart(),s.lineStart();else{for(s.lineEnd(),s.lineStart(),p=d-1;p>=f;--p)s.point(k[p],v[p]);s.lineEnd(),s.areaEnd()}T&&(k[d]=+e(_,d,h),v[d]=+t(_,d,h),s.point(i?+i(_,d,h):k[d],n?+n(_,d,h):v[d]))}if(x)return s=null,x+""||null}function c(){return No().defined(r).curve(a).context(o)}return l.x=function(h){return arguments.length?(e=typeof h=="function"?h:ce(+h),i=null,l):e},l.x0=function(h){return arguments.length?(e=typeof h=="function"?h:ce(+h),l):e},l.x1=function(h){return arguments.length?(i=h==null?null:typeof h=="function"?h:ce(+h),l):i},l.y=function(h){return arguments.length?(t=typeof h=="function"?h:ce(+h),n=null,l):t},l.y0=function(h){return arguments.length?(t=typeof h=="function"?h:ce(+h),l):t},l.y1=function(h){return arguments.length?(n=h==null?null:typeof h=="function"?h:ce(+h),l):n},l.lineX0=l.lineY0=function(){return c().x(e).y(t)},l.lineY1=function(){return c().x(e).y(n)},l.lineX1=function(){return c().x(i).y(t)},l.defined=function(h){return arguments.length?(r=typeof h=="function"?h:ce(!!h),l):r},l.curve=function(h){return arguments.length?(a=h,o!=null&&(s=a(o)),l):a},l.context=function(h){return arguments.length?(h==null?o=s=null:s=a(o=h),l):o},l}function Vc(e,t){return t<e?-1:t>e?1:t>=e?0:NaN}function jc(e){return e}function qc(){var e=jc,t=Vc,n=null,i=ce(0),r=ce(an),o=ce(0);function a(s){var u,l=(s=Ri(s)).length,c,h,d=0,f=new Array(l),p=new Array(l),m=+i.apply(this,arguments),_=Math.min(an,Math.max(-an,r.apply(this,arguments)-m)),T,x=Math.min(Math.abs(_)/l,o.apply(this,arguments)),k=x*(_<0?-1:1),v;for(u=0;u<l;++u)(v=p[f[u]=u]=+e(s[u],u,s))>0&&(d+=v);for(t!=null?f.sort(function(b,C){return t(p[b],p[C])}):n!=null&&f.sort(function(b,C){return n(s[b],s[C])}),u=0,h=d?(_-l*k)/d:0;u<l;++u,m=T)c=f[u],v=p[c],T=m+(v>0?v*h:0)+k,p[c]={data:s[c],index:u,value:v,startAngle:m,endAngle:T,padAngle:x};return p}return a.value=function(s){return arguments.length?(e=typeof s=="function"?s:ce(+s),a):e},a.sortValues=function(s){return arguments.length?(t=s,n=null,a):t},a.sort=function(s){return arguments.length?(n=s,t=null,a):n},a.startAngle=function(s){return arguments.length?(i=typeof s=="function"?s:ce(+s),a):i},a.endAngle=function(s){return arguments.length?(r=typeof s=="function"?s:ce(+s),a):r},a.padAngle=function(s){return arguments.length?(o=typeof s=="function"?s:ce(+s),a):o},a}function pr(e){return e<0?-1:1}function mr(e,t,n){var i=e._x1-e._x0,r=t-e._x1,o=(e._y1-e._y0)/(i||r<0&&-0),a=(n-e._y1)/(r||i<0&&-0),s=(o*r+a*i)/(i+r);return(pr(o)+pr(a))*Math.min(Math.abs(o),Math.abs(a),.5*Math.abs(s))||0}function vr(e,t){var n=e._x1-e._x0;return n?(3*(e._y1-e._y0)/n-t)/2:t}function Fn(e,t,n){var i=e._x0,r=e._y0,o=e._x1,a=e._y1,s=(o-i)/3;e._context.bezierCurveTo(i+s,r+s*t,o-s,a-s*n,o,a)}function bn(e){this._context=e}bn.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._y0=this._y1=this._t0=NaN,this._point=0},lineEnd:function(){switch(this._point){case 2:this._context.lineTo(this._x1,this._y1);break;case 3:Fn(this,this._t0,vr(this,this._t0));break}(this._line||this._line!==0&&this._point===1)&&this._context.closePath(),this._line=1-this._line},point:function(e,t){var n=NaN;if(e=+e,t=+t,!(e===this._x1&&t===this._y1)){switch(this._point){case 0:this._point=1,this._line?this._context.lineTo(e,t):this._context.moveTo(e,t);break;case 1:this._point=2;break;case 2:this._point=3,Fn(this,vr(this,n=mr(this,e,t)),n);break;default:Fn(this,this._t0,n=mr(this,e,t));break}this._x0=this._x1,this._x1=e,this._y0=this._y1,this._y1=t,this._t0=n}}};Object.create(bn.prototype).point=function(e,t){bn.prototype.point.call(this,t,e)};function yr(e){return new bn(e)}function Nt(e,t,n){this.k=e,this.x=t,this.y=n}Nt.prototype={constructor:Nt,scale:function(e){return e===1?this:new Nt(this.k*e,this.x,this.y)},translate:function(e,t){return e===0&t===0?this:new Nt(this.k,this.x+this.k*e,this.y+this.k*t)},apply:function(e){return[e[0]*this.k+this.x,e[1]*this.k+this.y]},applyX:function(e){return e*this.k+this.x},applyY:function(e){return e*this.k+this.y},invert:function(e){return[(e[0]-this.x)/this.k,(e[1]-this.y)/this.k]},invertX:function(e){return(e-this.x)/this.k},invertY:function(e){return(e-this.y)/this.k},rescaleX:function(e){return e.copy().domain(e.range().map(this.invertX,this).map(e.invert,e))},rescaleY:function(e){return e.copy().domain(e.range().map(this.invertY,this).map(e.invert,e))},toString:function(){return"translate("+this.x+","+this.y+") scale("+this.k+")"}};Nt.prototype;function Xc(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}var Yt={exports:{}},br;function Yc(){if(br)return Yt.exports;br=1;var e=typeof Reflect=="object"?Reflect:null,t=e&&typeof e.apply=="function"?e.apply:function(b,C,R){return Function.prototype.apply.call(b,C,R)},n;e&&typeof e.ownKeys=="function"?n=e.ownKeys:Object.getOwnPropertySymbols?n=function(b){return Object.getOwnPropertyNames(b).concat(Object.getOwnPropertySymbols(b))}:n=function(b){return Object.getOwnPropertyNames(b)};function i(v){console&&console.warn&&console.warn(v)}var r=Number.isNaN||function(b){return b!==b};function o(){o.init.call(this)}Yt.exports=o,Yt.exports.once=T,o.EventEmitter=o,o.prototype._events=void 0,o.prototype._eventsCount=0,o.prototype._maxListeners=void 0;var a=10;function s(v){if(typeof v!="function")throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof v)}Object.defineProperty(o,"defaultMaxListeners",{enumerable:!0,get:function(){return a},set:function(v){if(typeof v!="number"||v<0||r(v))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+v+".");a=v}}),o.init=function(){(this._events===void 0||this._events===Object.getPrototypeOf(this)._events)&&(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},o.prototype.setMaxListeners=function(b){if(typeof b!="number"||b<0||r(b))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+b+".");return this._maxListeners=b,this};function u(v){return v._maxListeners===void 0?o.defaultMaxListeners:v._maxListeners}o.prototype.getMaxListeners=function(){return u(this)},o.prototype.emit=function(b){for(var C=[],R=1;R<arguments.length;R++)C.push(arguments[R]);var B=b==="error",I=this._events;if(I!==void 0)B=B&&I.error===void 0;else if(!B)return!1;if(B){var O;if(C.length>0&&(O=C[0]),O instanceof Error)throw O;var M=new Error("Unhandled error."+(O?" ("+O.message+")":""));throw M.context=O,M}var z=I[b];if(z===void 0)return!1;if(typeof z=="function")t(z,this,C);else for(var g=z.length,j=p(z,g),R=0;R<g;++R)t(j[R],this,C);return!0};function l(v,b,C,R){var B,I,O;if(s(C),I=v._events,I===void 0?(I=v._events=Object.create(null),v._eventsCount=0):(I.newListener!==void 0&&(v.emit("newListener",b,C.listener?C.listener:C),I=v._events),O=I[b]),O===void 0)O=I[b]=C,++v._eventsCount;else if(typeof O=="function"?O=I[b]=R?[C,O]:[O,C]:R?O.unshift(C):O.push(C),B=u(v),B>0&&O.length>B&&!O.warned){O.warned=!0;var M=new Error("Possible EventEmitter memory leak detected. "+O.length+" "+String(b)+" listeners added. Use emitter.setMaxListeners() to increase limit");M.name="MaxListenersExceededWarning",M.emitter=v,M.type=b,M.count=O.length,i(M)}return v}o.prototype.addListener=function(b,C){return l(this,b,C,!1)},o.prototype.on=o.prototype.addListener,o.prototype.prependListener=function(b,C){return l(this,b,C,!0)};function c(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,arguments.length===0?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function h(v,b,C){var R={fired:!1,wrapFn:void 0,target:v,type:b,listener:C},B=c.bind(R);return B.listener=C,R.wrapFn=B,B}o.prototype.once=function(b,C){return s(C),this.on(b,h(this,b,C)),this},o.prototype.prependOnceListener=function(b,C){return s(C),this.prependListener(b,h(this,b,C)),this},o.prototype.removeListener=function(b,C){var R,B,I,O,M;if(s(C),B=this._events,B===void 0)return this;if(R=B[b],R===void 0)return this;if(R===C||R.listener===C)--this._eventsCount===0?this._events=Object.create(null):(delete B[b],B.removeListener&&this.emit("removeListener",b,R.listener||C));else if(typeof R!="function"){for(I=-1,O=R.length-1;O>=0;O--)if(R[O]===C||R[O].listener===C){M=R[O].listener,I=O;break}if(I<0)return this;I===0?R.shift():m(R,I),R.length===1&&(B[b]=R[0]),B.removeListener!==void 0&&this.emit("removeListener",b,M||C)}return this},o.prototype.off=o.prototype.removeListener,o.prototype.removeAllListeners=function(b){var C,R,B;if(R=this._events,R===void 0)return this;if(R.removeListener===void 0)return arguments.length===0?(this._events=Object.create(null),this._eventsCount=0):R[b]!==void 0&&(--this._eventsCount===0?this._events=Object.create(null):delete R[b]),this;if(arguments.length===0){var I=Object.keys(R),O;for(B=0;B<I.length;++B)O=I[B],O!=="removeListener"&&this.removeAllListeners(O);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if(C=R[b],typeof C=="function")this.removeListener(b,C);else if(C!==void 0)for(B=C.length-1;B>=0;B--)this.removeListener(b,C[B]);return this};function d(v,b,C){var R=v._events;if(R===void 0)return[];var B=R[b];return B===void 0?[]:typeof B=="function"?C?[B.listener||B]:[B]:C?_(B):p(B,B.length)}o.prototype.listeners=function(b){return d(this,b,!0)},o.prototype.rawListeners=function(b){return d(this,b,!1)},o.listenerCount=function(v,b){return typeof v.listenerCount=="function"?v.listenerCount(b):f.call(v,b)},o.prototype.listenerCount=f;function f(v){var b=this._events;if(b!==void 0){var C=b[v];if(typeof C=="function")return 1;if(C!==void 0)return C.length}return 0}o.prototype.eventNames=function(){return this._eventsCount>0?n(this._events):[]};function p(v,b){for(var C=new Array(b),R=0;R<b;++R)C[R]=v[R];return C}function m(v,b){for(;b+1<v.length;b++)v[b]=v[b+1];v.pop()}function _(v){for(var b=new Array(v.length),C=0;C<b.length;++C)b[C]=v[C].listener||v[C];return b}function T(v,b){return new Promise(function(C,R){function B(O){v.removeListener(b,I),R(O)}function I(){typeof v.removeListener=="function"&&v.removeListener("error",B),C([].slice.call(arguments))}k(v,b,I,{once:!0}),b!=="error"&&x(v,B,{once:!0})})}function x(v,b,C){typeof v.on=="function"&&k(v,"error",b,C)}function k(v,b,C,R){if(typeof v.on=="function")R.once?v.once(b,C):v.on(b,C);else if(typeof v.addEventListener=="function")v.addEventListener(b,function B(I){R.once&&v.removeEventListener(b,B),C(I)});else throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof v)}return Yt.exports}var Po=Yc();function Kc(){const e=arguments[0];for(let t=1,n=arguments.length;t<n;t++)if(arguments[t])for(const i in arguments[t])e[i]=arguments[t][i];return e}let me=Kc;typeof Object.assign=="function"&&(me=Object.assign);function De(e,t,n,i){const r=e._nodes.get(t);let o=null;return r&&(i==="mixed"?o=r.out&&r.out[n]||r.undirected&&r.undirected[n]:i==="directed"?o=r.out&&r.out[n]:o=r.undirected&&r.undirected[n]),o}function we(e){return typeof e=="object"&&e!==null}function Fo(e){let t;for(t in e)return!1;return!0}function Le(e,t,n){Object.defineProperty(e,t,{enumerable:!1,configurable:!1,writable:!0,value:n})}function Ne(e,t,n){const i={enumerable:!0,configurable:!0};typeof n=="function"?i.get=n:(i.value=n,i.writable=!1),Object.defineProperty(e,t,i)}function wr(e){return!(!we(e)||e.attributes&&!Array.isArray(e.attributes))}function Zc(){let e=Math.floor(Math.random()*256)&255;return()=>e++}function Xe(){const e=arguments;let t=null,n=-1;return{[Symbol.iterator](){return this},next(){let i=null;do{if(t===null){if(n++,n>=e.length)return{done:!0};t=e[n][Symbol.iterator]()}if(i=t.next(),i.done){t=null;continue}break}while(!0);return i}}}function yt(){return{[Symbol.iterator](){return this},next(){return{done:!0}}}}class Li extends Error{constructor(t){super(),this.name="GraphError",this.message=t}}class V extends Li{constructor(t){super(t),this.name="InvalidArgumentsGraphError",typeof Error.captureStackTrace=="function"&&Error.captureStackTrace(this,V.prototype.constructor)}}class U extends Li{constructor(t){super(t),this.name="NotFoundGraphError",typeof Error.captureStackTrace=="function"&&Error.captureStackTrace(this,U.prototype.constructor)}}class J extends Li{constructor(t){super(t),this.name="UsageGraphError",typeof Error.captureStackTrace=="function"&&Error.captureStackTrace(this,J.prototype.constructor)}}function Io(e,t){this.key=e,this.attributes=t,this.clear()}Io.prototype.clear=function(){this.inDegree=0,this.outDegree=0,this.undirectedDegree=0,this.undirectedLoops=0,this.directedLoops=0,this.in={},this.out={},this.undirected={}};function Mo(e,t){this.key=e,this.attributes=t,this.clear()}Mo.prototype.clear=function(){this.inDegree=0,this.outDegree=0,this.directedLoops=0,this.in={},this.out={}};function zo(e,t){this.key=e,this.attributes=t,this.clear()}zo.prototype.clear=function(){this.undirectedDegree=0,this.undirectedLoops=0,this.undirected={}};function bt(e,t,n,i,r){this.key=t,this.attributes=r,this.undirected=e,this.source=n,this.target=i}bt.prototype.attach=function(){let e="out",t="in";this.undirected&&(e=t="undirected");const n=this.source.key,i=this.target.key;this.source[e][i]=this,!(this.undirected&&n===i)&&(this.target[t][n]=this)};bt.prototype.attachMulti=function(){let e="out",t="in";const n=this.source.key,i=this.target.key;this.undirected&&(e=t="undirected");const r=this.source[e],o=r[i];if(typeof o>"u"){r[i]=this,this.undirected&&n===i||(this.target[t][n]=this);return}o.previous=this,this.next=o,r[i]=this,this.target[t][n]=this};bt.prototype.detach=function(){const e=this.source.key,t=this.target.key;let n="out",i="in";this.undirected&&(n=i="undirected"),delete this.source[n][t],delete this.target[i][e]};bt.prototype.detachMulti=function(){const e=this.source.key,t=this.target.key;let n="out",i="in";this.undirected&&(n=i="undirected"),this.previous===void 0?this.next===void 0?(delete this.source[n][t],delete this.target[i][e]):(this.next.previous=void 0,this.source[n][t]=this.next,this.target[i][e]=this.next):(this.previous.next=this.next,this.next!==void 0&&(this.next.previous=this.previous))};const Oo=0,Uo=1,Jc=2,Bo=3;function Ke(e,t,n,i,r,o,a){let s,u,l,c;if(i=""+i,n===Oo){if(s=e._nodes.get(i),!s)throw new U(`Graph.${t}: could not find the "${i}" node in the graph.`);l=r,c=o}else if(n===Bo){if(r=""+r,u=e._edges.get(r),!u)throw new U(`Graph.${t}: could not find the "${r}" edge in the graph.`);const h=u.source.key,d=u.target.key;if(i===h)s=u.target;else if(i===d)s=u.source;else throw new U(`Graph.${t}: the "${i}" node is not attached to the "${r}" edge (${h}, ${d}).`);l=o,c=a}else{if(u=e._edges.get(i),!u)throw new U(`Graph.${t}: could not find the "${i}" edge in the graph.`);n===Uo?s=u.source:s=u.target,l=r,c=o}return[s,l,c]}function Qc(e,t,n){e.prototype[t]=function(i,r,o){const[a,s]=Ke(this,t,n,i,r,o);return a.attributes[s]}}function eh(e,t,n){e.prototype[t]=function(i,r){const[o]=Ke(this,t,n,i,r);return o.attributes}}function th(e,t,n){e.prototype[t]=function(i,r,o){const[a,s]=Ke(this,t,n,i,r,o);return a.attributes.hasOwnProperty(s)}}function nh(e,t,n){e.prototype[t]=function(i,r,o,a){const[s,u,l]=Ke(this,t,n,i,r,o,a);return s.attributes[u]=l,this.emit("nodeAttributesUpdated",{key:s.key,type:"set",attributes:s.attributes,name:u}),this}}function ih(e,t,n){e.prototype[t]=function(i,r,o,a){const[s,u,l]=Ke(this,t,n,i,r,o,a);if(typeof l!="function")throw new V(`Graph.${t}: updater should be a function.`);const c=s.attributes,h=l(c[u]);return c[u]=h,this.emit("nodeAttributesUpdated",{key:s.key,type:"set",attributes:s.attributes,name:u}),this}}function rh(e,t,n){e.prototype[t]=function(i,r,o){const[a,s]=Ke(this,t,n,i,r,o);return delete a.attributes[s],this.emit("nodeAttributesUpdated",{key:a.key,type:"remove",attributes:a.attributes,name:s}),this}}function oh(e,t,n){e.prototype[t]=function(i,r,o){const[a,s]=Ke(this,t,n,i,r,o);if(!we(s))throw new V(`Graph.${t}: provided attributes are not a plain object.`);return a.attributes=s,this.emit("nodeAttributesUpdated",{key:a.key,type:"replace",attributes:a.attributes}),this}}function ah(e,t,n){e.prototype[t]=function(i,r,o){const[a,s]=Ke(this,t,n,i,r,o);if(!we(s))throw new V(`Graph.${t}: provided attributes are not a plain object.`);return me(a.attributes,s),this.emit("nodeAttributesUpdated",{key:a.key,type:"merge",attributes:a.attributes,data:s}),this}}function sh(e,t,n){e.prototype[t]=function(i,r,o){const[a,s]=Ke(this,t,n,i,r,o);if(typeof s!="function")throw new V(`Graph.${t}: provided updater is not a function.`);return a.attributes=s(a.attributes),this.emit("nodeAttributesUpdated",{key:a.key,type:"update",attributes:a.attributes}),this}}const uh=[{name:e=>`get${e}Attribute`,attacher:Qc},{name:e=>`get${e}Attributes`,attacher:eh},{name:e=>`has${e}Attribute`,attacher:th},{name:e=>`set${e}Attribute`,attacher:nh},{name:e=>`update${e}Attribute`,attacher:ih},{name:e=>`remove${e}Attribute`,attacher:rh},{name:e=>`replace${e}Attributes`,attacher:oh},{name:e=>`merge${e}Attributes`,attacher:ah},{name:e=>`update${e}Attributes`,attacher:sh}];function lh(e){uh.forEach(function({name:t,attacher:n}){n(e,t("Node"),Oo),n(e,t("Source"),Uo),n(e,t("Target"),Jc),n(e,t("Opposite"),Bo)})}function ch(e,t,n){e.prototype[t]=function(i,r){let o;if(this.type!=="mixed"&&n!=="mixed"&&n!==this.type)throw new J(`Graph.${t}: cannot find this type of edges in your ${this.type} graph.`);if(arguments.length>2){if(this.multi)throw new J(`Graph.${t}: cannot use a {source,target} combo when asking about an edge's attributes in a MultiGraph since we cannot infer the one you want information about.`);const a=""+i,s=""+r;if(r=arguments[2],o=De(this,a,s,n),!o)throw new U(`Graph.${t}: could not find an edge for the given path ("${a}" - "${s}").`)}else{if(n!=="mixed")throw new J(`Graph.${t}: calling this method with only a key (vs. a source and target) does not make sense since an edge with this key could have the other type.`);if(i=""+i,o=this._edges.get(i),!o)throw new U(`Graph.${t}: could not find the "${i}" edge in the graph.`)}return o.attributes[r]}}function hh(e,t,n){e.prototype[t]=function(i){let r;if(this.type!=="mixed"&&n!=="mixed"&&n!==this.type)throw new J(`Graph.${t}: cannot find this type of edges in your ${this.type} graph.`);if(arguments.length>1){if(this.multi)throw new J(`Graph.${t}: cannot use a {source,target} combo when asking about an edge's attributes in a MultiGraph since we cannot infer the one you want information about.`);const o=""+i,a=""+arguments[1];if(r=De(this,o,a,n),!r)throw new U(`Graph.${t}: could not find an edge for the given path ("${o}" - "${a}").`)}else{if(n!=="mixed")throw new J(`Graph.${t}: calling this method with only a key (vs. a source and target) does not make sense since an edge with this key could have the other type.`);if(i=""+i,r=this._edges.get(i),!r)throw new U(`Graph.${t}: could not find the "${i}" edge in the graph.`)}return r.attributes}}function dh(e,t,n){e.prototype[t]=function(i,r){let o;if(this.type!=="mixed"&&n!=="mixed"&&n!==this.type)throw new J(`Graph.${t}: cannot find this type of edges in your ${this.type} graph.`);if(arguments.length>2){if(this.multi)throw new J(`Graph.${t}: cannot use a {source,target} combo when asking about an edge's attributes in a MultiGraph since we cannot infer the one you want information about.`);const a=""+i,s=""+r;if(r=arguments[2],o=De(this,a,s,n),!o)throw new U(`Graph.${t}: could not find an edge for the given path ("${a}" - "${s}").`)}else{if(n!=="mixed")throw new J(`Graph.${t}: calling this method with only a key (vs. a source and target) does not make sense since an edge with this key could have the other type.`);if(i=""+i,o=this._edges.get(i),!o)throw new U(`Graph.${t}: could not find the "${i}" edge in the graph.`)}return o.attributes.hasOwnProperty(r)}}function fh(e,t,n){e.prototype[t]=function(i,r,o){let a;if(this.type!=="mixed"&&n!=="mixed"&&n!==this.type)throw new J(`Graph.${t}: cannot find this type of edges in your ${this.type} graph.`);if(arguments.length>3){if(this.multi)throw new J(`Graph.${t}: cannot use a {source,target} combo when asking about an edge's attributes in a MultiGraph since we cannot infer the one you want information about.`);const s=""+i,u=""+r;if(r=arguments[2],o=arguments[3],a=De(this,s,u,n),!a)throw new U(`Graph.${t}: could not find an edge for the given path ("${s}" - "${u}").`)}else{if(n!=="mixed")throw new J(`Graph.${t}: calling this method with only a key (vs. a source and target) does not make sense since an edge with this key could have the other type.`);if(i=""+i,a=this._edges.get(i),!a)throw new U(`Graph.${t}: could not find the "${i}" edge in the graph.`)}return a.attributes[r]=o,this.emit("edgeAttributesUpdated",{key:a.key,type:"set",attributes:a.attributes,name:r}),this}}function gh(e,t,n){e.prototype[t]=function(i,r,o){let a;if(this.type!=="mixed"&&n!=="mixed"&&n!==this.type)throw new J(`Graph.${t}: cannot find this type of edges in your ${this.type} graph.`);if(arguments.length>3){if(this.multi)throw new J(`Graph.${t}: cannot use a {source,target} combo when asking about an edge's attributes in a MultiGraph since we cannot infer the one you want information about.`);const s=""+i,u=""+r;if(r=arguments[2],o=arguments[3],a=De(this,s,u,n),!a)throw new U(`Graph.${t}: could not find an edge for the given path ("${s}" - "${u}").`)}else{if(n!=="mixed")throw new J(`Graph.${t}: calling this method with only a key (vs. a source and target) does not make sense since an edge with this key could have the other type.`);if(i=""+i,a=this._edges.get(i),!a)throw new U(`Graph.${t}: could not find the "${i}" edge in the graph.`)}if(typeof o!="function")throw new V(`Graph.${t}: updater should be a function.`);return a.attributes[r]=o(a.attributes[r]),this.emit("edgeAttributesUpdated",{key:a.key,type:"set",attributes:a.attributes,name:r}),this}}function ph(e,t,n){e.prototype[t]=function(i,r){let o;if(this.type!=="mixed"&&n!=="mixed"&&n!==this.type)throw new J(`Graph.${t}: cannot find this type of edges in your ${this.type} graph.`);if(arguments.length>2){if(this.multi)throw new J(`Graph.${t}: cannot use a {source,target} combo when asking about an edge's attributes in a MultiGraph since we cannot infer the one you want information about.`);const a=""+i,s=""+r;if(r=arguments[2],o=De(this,a,s,n),!o)throw new U(`Graph.${t}: could not find an edge for the given path ("${a}" - "${s}").`)}else{if(n!=="mixed")throw new J(`Graph.${t}: calling this method with only a key (vs. a source and target) does not make sense since an edge with this key could have the other type.`);if(i=""+i,o=this._edges.get(i),!o)throw new U(`Graph.${t}: could not find the "${i}" edge in the graph.`)}return delete o.attributes[r],this.emit("edgeAttributesUpdated",{key:o.key,type:"remove",attributes:o.attributes,name:r}),this}}function mh(e,t,n){e.prototype[t]=function(i,r){let o;if(this.type!=="mixed"&&n!=="mixed"&&n!==this.type)throw new J(`Graph.${t}: cannot find this type of edges in your ${this.type} graph.`);if(arguments.length>2){if(this.multi)throw new J(`Graph.${t}: cannot use a {source,target} combo when asking about an edge's attributes in a MultiGraph since we cannot infer the one you want information about.`);const a=""+i,s=""+r;if(r=arguments[2],o=De(this,a,s,n),!o)throw new U(`Graph.${t}: could not find an edge for the given path ("${a}" - "${s}").`)}else{if(n!=="mixed")throw new J(`Graph.${t}: calling this method with only a key (vs. a source and target) does not make sense since an edge with this key could have the other type.`);if(i=""+i,o=this._edges.get(i),!o)throw new U(`Graph.${t}: could not find the "${i}" edge in the graph.`)}if(!we(r))throw new V(`Graph.${t}: provided attributes are not a plain object.`);return o.attributes=r,this.emit("edgeAttributesUpdated",{key:o.key,type:"replace",attributes:o.attributes}),this}}function vh(e,t,n){e.prototype[t]=function(i,r){let o;if(this.type!=="mixed"&&n!=="mixed"&&n!==this.type)throw new J(`Graph.${t}: cannot find this type of edges in your ${this.type} graph.`);if(arguments.length>2){if(this.multi)throw new J(`Graph.${t}: cannot use a {source,target} combo when asking about an edge's attributes in a MultiGraph since we cannot infer the one you want information about.`);const a=""+i,s=""+r;if(r=arguments[2],o=De(this,a,s,n),!o)throw new U(`Graph.${t}: could not find an edge for the given path ("${a}" - "${s}").`)}else{if(n!=="mixed")throw new J(`Graph.${t}: calling this method with only a key (vs. a source and target) does not make sense since an edge with this key could have the other type.`);if(i=""+i,o=this._edges.get(i),!o)throw new U(`Graph.${t}: could not find the "${i}" edge in the graph.`)}if(!we(r))throw new V(`Graph.${t}: provided attributes are not a plain object.`);return me(o.attributes,r),this.emit("edgeAttributesUpdated",{key:o.key,type:"merge",attributes:o.attributes,data:r}),this}}function yh(e,t,n){e.prototype[t]=function(i,r){let o;if(this.type!=="mixed"&&n!=="mixed"&&n!==this.type)throw new J(`Graph.${t}: cannot find this type of edges in your ${this.type} graph.`);if(arguments.length>2){if(this.multi)throw new J(`Graph.${t}: cannot use a {source,target} combo when asking about an edge's attributes in a MultiGraph since we cannot infer the one you want information about.`);const a=""+i,s=""+r;if(r=arguments[2],o=De(this,a,s,n),!o)throw new U(`Graph.${t}: could not find an edge for the given path ("${a}" - "${s}").`)}else{if(n!=="mixed")throw new J(`Graph.${t}: calling this method with only a key (vs. a source and target) does not make sense since an edge with this key could have the other type.`);if(i=""+i,o=this._edges.get(i),!o)throw new U(`Graph.${t}: could not find the "${i}" edge in the graph.`)}if(typeof r!="function")throw new V(`Graph.${t}: provided updater is not a function.`);return o.attributes=r(o.attributes),this.emit("edgeAttributesUpdated",{key:o.key,type:"update",attributes:o.attributes}),this}}const bh=[{name:e=>`get${e}Attribute`,attacher:ch},{name:e=>`get${e}Attributes`,attacher:hh},{name:e=>`has${e}Attribute`,attacher:dh},{name:e=>`set${e}Attribute`,attacher:fh},{name:e=>`update${e}Attribute`,attacher:gh},{name:e=>`remove${e}Attribute`,attacher:ph},{name:e=>`replace${e}Attributes`,attacher:mh},{name:e=>`merge${e}Attributes`,attacher:vh},{name:e=>`update${e}Attributes`,attacher:yh}];function wh(e){bh.forEach(function({name:t,attacher:n}){n(e,t("Edge"),"mixed"),n(e,t("DirectedEdge"),"directed"),n(e,t("UndirectedEdge"),"undirected")})}const _h=[{name:"edges",type:"mixed"},{name:"inEdges",type:"directed",direction:"in"},{name:"outEdges",type:"directed",direction:"out"},{name:"inboundEdges",type:"mixed",direction:"in"},{name:"outboundEdges",type:"mixed",direction:"out"},{name:"directedEdges",type:"directed"},{name:"undirectedEdges",type:"undirected"}];function Eh(e,t,n,i){let r=!1;for(const o in t){if(o===i)continue;const a=t[o];if(r=n(a.key,a.attributes,a.source.key,a.target.key,a.source.attributes,a.target.attributes,a.undirected),e&&r)return a.key}}function xh(e,t,n,i){let r,o,a,s=!1;for(const u in t)if(u!==i){r=t[u];do{if(o=r.source,a=r.target,s=n(r.key,r.attributes,o.key,a.key,o.attributes,a.attributes,r.undirected),e&&s)return r.key;r=r.next}while(r!==void 0)}}function In(e,t){const n=Object.keys(e),i=n.length;let r,o=0;return{[Symbol.iterator](){return this},next(){do if(r)r=r.next;else{if(o>=i)return{done:!0};const a=n[o++];if(a===t){r=void 0;continue}r=e[a]}while(!r);return{done:!1,value:{edge:r.key,attributes:r.attributes,source:r.source.key,target:r.target.key,sourceAttributes:r.source.attributes,targetAttributes:r.target.attributes,undirected:r.undirected}}}}}function Th(e,t,n,i){const r=t[n];if(!r)return;const o=r.source,a=r.target;if(i(r.key,r.attributes,o.key,a.key,o.attributes,a.attributes,r.undirected)&&e)return r.key}function kh(e,t,n,i){let r=t[n];if(!r)return;let o=!1;do{if(o=i(r.key,r.attributes,r.source.key,r.target.key,r.source.attributes,r.target.attributes,r.undirected),e&&o)return r.key;r=r.next}while(r!==void 0)}function Mn(e,t){let n=e[t];if(n.next!==void 0)return{[Symbol.iterator](){return this},next(){if(!n)return{done:!0};const r={edge:n.key,attributes:n.attributes,source:n.source.key,target:n.target.key,sourceAttributes:n.source.attributes,targetAttributes:n.target.attributes,undirected:n.undirected};return n=n.next,{done:!1,value:r}}};let i=!1;return{[Symbol.iterator](){return this},next(){return i===!0?{done:!0}:(i=!0,{done:!1,value:{edge:n.key,attributes:n.attributes,source:n.source.key,target:n.target.key,sourceAttributes:n.source.attributes,targetAttributes:n.target.attributes,undirected:n.undirected}})}}}function Sh(e,t){if(e.size===0)return[];if(t==="mixed"||t===e.type)return Array.from(e._edges.keys());const n=t==="undirected"?e.undirectedSize:e.directedSize,i=new Array(n),r=t==="undirected",o=e._edges.values();let a=0,s,u;for(;s=o.next(),s.done!==!0;)u=s.value,u.undirected===r&&(i[a++]=u.key);return i}function Ho(e,t,n,i){if(t.size===0)return;const r=n!=="mixed"&&n!==t.type,o=n==="undirected";let a,s,u=!1;const l=t._edges.values();for(;a=l.next(),a.done!==!0;){if(s=a.value,r&&s.undirected!==o)continue;const{key:c,attributes:h,source:d,target:f}=s;if(u=i(c,h,d.key,f.key,d.attributes,f.attributes,s.undirected),e&&u)return c}}function Ah(e,t){if(e.size===0)return yt();const n=t!=="mixed"&&t!==e.type,i=t==="undirected",r=e._edges.values();return{[Symbol.iterator](){return this},next(){let o,a;for(;;){if(o=r.next(),o.done)return o;if(a=o.value,!(n&&a.undirected!==i))break}return{value:{edge:a.key,attributes:a.attributes,source:a.source.key,target:a.target.key,sourceAttributes:a.source.attributes,targetAttributes:a.target.attributes,undirected:a.undirected},done:!1}}}}function Di(e,t,n,i,r,o){const a=t?xh:Eh;let s;if(n!=="undirected"&&(i!=="out"&&(s=a(e,r.in,o),e&&s)||i!=="in"&&(s=a(e,r.out,o,i?void 0:r.key),e&&s))||n!=="directed"&&(s=a(e,r.undirected,o),e&&s))return s}function Ch(e,t,n,i){const r=[];return Di(!1,e,t,n,i,function(o){r.push(o)}),r}function Rh(e,t,n){let i=yt();return e!=="undirected"&&(t!=="out"&&typeof n.in<"u"&&(i=Xe(i,In(n.in))),t!=="in"&&typeof n.out<"u"&&(i=Xe(i,In(n.out,t?void 0:n.key)))),e!=="directed"&&typeof n.undirected<"u"&&(i=Xe(i,In(n.undirected))),i}function $i(e,t,n,i,r,o,a){const s=n?kh:Th;let u;if(t!=="undirected"&&(typeof r.in<"u"&&i!=="out"&&(u=s(e,r.in,o,a),e&&u)||typeof r.out<"u"&&i!=="in"&&(i||r.key!==o)&&(u=s(e,r.out,o,a),e&&u))||t!=="directed"&&typeof r.undirected<"u"&&(u=s(e,r.undirected,o,a),e&&u))return u}function Lh(e,t,n,i,r){const o=[];return $i(!1,e,t,n,i,r,function(a){o.push(a)}),o}function Dh(e,t,n,i){let r=yt();return e!=="undirected"&&(typeof n.in<"u"&&t!=="out"&&i in n.in&&(r=Xe(r,Mn(n.in,i))),typeof n.out<"u"&&t!=="in"&&i in n.out&&(t||n.key!==i)&&(r=Xe(r,Mn(n.out,i)))),e!=="directed"&&typeof n.undirected<"u"&&i in n.undirected&&(r=Xe(r,Mn(n.undirected,i))),r}function $h(e,t){const{name:n,type:i,direction:r}=t;e.prototype[n]=function(o,a){if(i!=="mixed"&&this.type!=="mixed"&&i!==this.type)return[];if(!arguments.length)return Sh(this,i);if(arguments.length===1){o=""+o;const s=this._nodes.get(o);if(typeof s>"u")throw new U(`Graph.${n}: could not find the "${o}" node in the graph.`);return Ch(this.multi,i==="mixed"?this.type:i,r,s)}if(arguments.length===2){o=""+o,a=""+a;const s=this._nodes.get(o);if(!s)throw new U(`Graph.${n}:  could not find the "${o}" source node in the graph.`);if(!this._nodes.has(a))throw new U(`Graph.${n}:  could not find the "${a}" target node in the graph.`);return Lh(i,this.multi,r,s,a)}throw new V(`Graph.${n}: too many arguments (expecting 0, 1 or 2 and got ${arguments.length}).`)}}function Gh(e,t){const{name:n,type:i,direction:r}=t,o="forEach"+n[0].toUpperCase()+n.slice(1,-1);e.prototype[o]=function(l,c,h){if(!(i!=="mixed"&&this.type!=="mixed"&&i!==this.type)){if(arguments.length===1)return h=l,Ho(!1,this,i,h);if(arguments.length===2){l=""+l,h=c;const d=this._nodes.get(l);if(typeof d>"u")throw new U(`Graph.${o}: could not find the "${l}" node in the graph.`);return Di(!1,this.multi,i==="mixed"?this.type:i,r,d,h)}if(arguments.length===3){l=""+l,c=""+c;const d=this._nodes.get(l);if(!d)throw new U(`Graph.${o}:  could not find the "${l}" source node in the graph.`);if(!this._nodes.has(c))throw new U(`Graph.${o}:  could not find the "${c}" target node in the graph.`);return $i(!1,i,this.multi,r,d,c,h)}throw new V(`Graph.${o}: too many arguments (expecting 1, 2 or 3 and got ${arguments.length}).`)}};const a="map"+n[0].toUpperCase()+n.slice(1);e.prototype[a]=function(){const l=Array.prototype.slice.call(arguments),c=l.pop();let h;if(l.length===0){let d=0;i!=="directed"&&(d+=this.undirectedSize),i!=="undirected"&&(d+=this.directedSize),h=new Array(d);let f=0;l.push((p,m,_,T,x,k,v)=>{h[f++]=c(p,m,_,T,x,k,v)})}else h=[],l.push((d,f,p,m,_,T,x)=>{h.push(c(d,f,p,m,_,T,x))});return this[o].apply(this,l),h};const s="filter"+n[0].toUpperCase()+n.slice(1);e.prototype[s]=function(){const l=Array.prototype.slice.call(arguments),c=l.pop(),h=[];return l.push((d,f,p,m,_,T,x)=>{c(d,f,p,m,_,T,x)&&h.push(d)}),this[o].apply(this,l),h};const u="reduce"+n[0].toUpperCase()+n.slice(1);e.prototype[u]=function(){let l=Array.prototype.slice.call(arguments);if(l.length<2||l.length>4)throw new V(`Graph.${u}: invalid number of arguments (expecting 2, 3 or 4 and got ${l.length}).`);if(typeof l[l.length-1]=="function"&&typeof l[l.length-2]!="function")throw new V(`Graph.${u}: missing initial value. You must provide it because the callback takes more than one argument and we cannot infer the initial value from the first iteration, as you could with a simple array.`);let c,h;l.length===2?(c=l[0],h=l[1],l=[]):l.length===3?(c=l[1],h=l[2],l=[l[0]]):l.length===4&&(c=l[2],h=l[3],l=[l[0],l[1]]);let d=h;return l.push((f,p,m,_,T,x,k)=>{d=c(d,f,p,m,_,T,x,k)}),this[o].apply(this,l),d}}function Nh(e,t){const{name:n,type:i,direction:r}=t,o="find"+n[0].toUpperCase()+n.slice(1,-1);e.prototype[o]=function(u,l,c){if(i!=="mixed"&&this.type!=="mixed"&&i!==this.type)return!1;if(arguments.length===1)return c=u,Ho(!0,this,i,c);if(arguments.length===2){u=""+u,c=l;const h=this._nodes.get(u);if(typeof h>"u")throw new U(`Graph.${o}: could not find the "${u}" node in the graph.`);return Di(!0,this.multi,i==="mixed"?this.type:i,r,h,c)}if(arguments.length===3){u=""+u,l=""+l;const h=this._nodes.get(u);if(!h)throw new U(`Graph.${o}:  could not find the "${u}" source node in the graph.`);if(!this._nodes.has(l))throw new U(`Graph.${o}:  could not find the "${l}" target node in the graph.`);return $i(!0,i,this.multi,r,h,l,c)}throw new V(`Graph.${o}: too many arguments (expecting 1, 2 or 3 and got ${arguments.length}).`)};const a="some"+n[0].toUpperCase()+n.slice(1,-1);e.prototype[a]=function(){const u=Array.prototype.slice.call(arguments),l=u.pop();return u.push((h,d,f,p,m,_,T)=>l(h,d,f,p,m,_,T)),!!this[o].apply(this,u)};const s="every"+n[0].toUpperCase()+n.slice(1,-1);e.prototype[s]=function(){const u=Array.prototype.slice.call(arguments),l=u.pop();return u.push((h,d,f,p,m,_,T)=>!l(h,d,f,p,m,_,T)),!this[o].apply(this,u)}}function Ph(e,t){const{name:n,type:i,direction:r}=t,o=n.slice(0,-1)+"Entries";e.prototype[o]=function(a,s){if(i!=="mixed"&&this.type!=="mixed"&&i!==this.type)return yt();if(!arguments.length)return Ah(this,i);if(arguments.length===1){a=""+a;const u=this._nodes.get(a);if(!u)throw new U(`Graph.${o}: could not find the "${a}" node in the graph.`);return Rh(i,r,u)}if(arguments.length===2){a=""+a,s=""+s;const u=this._nodes.get(a);if(!u)throw new U(`Graph.${o}:  could not find the "${a}" source node in the graph.`);if(!this._nodes.has(s))throw new U(`Graph.${o}:  could not find the "${s}" target node in the graph.`);return Dh(i,r,u,s)}throw new V(`Graph.${o}: too many arguments (expecting 0, 1 or 2 and got ${arguments.length}).`)}}function Fh(e){_h.forEach(t=>{$h(e,t),Gh(e,t),Nh(e,t),Ph(e,t)})}const Ih=[{name:"neighbors",type:"mixed"},{name:"inNeighbors",type:"directed",direction:"in"},{name:"outNeighbors",type:"directed",direction:"out"},{name:"inboundNeighbors",type:"mixed",direction:"in"},{name:"outboundNeighbors",type:"mixed",direction:"out"},{name:"directedNeighbors",type:"directed"},{name:"undirectedNeighbors",type:"undirected"}];function kn(){this.A=null,this.B=null}kn.prototype.wrap=function(e){this.A===null?this.A=e:this.B===null&&(this.B=e)};kn.prototype.has=function(e){return this.A!==null&&e in this.A||this.B!==null&&e in this.B};function xt(e,t,n,i,r){for(const o in i){const a=i[o],s=a.source,u=a.target,l=s===n?u:s;if(t&&t.has(l.key))continue;const c=r(l.key,l.attributes);if(e&&c)return l.key}}function Gi(e,t,n,i,r){if(t!=="mixed"){if(t==="undirected")return xt(e,null,i,i.undirected,r);if(typeof n=="string")return xt(e,null,i,i[n],r)}const o=new kn;let a;if(t!=="undirected"){if(n!=="out"){if(a=xt(e,null,i,i.in,r),e&&a)return a;o.wrap(i.in)}if(n!=="in"){if(a=xt(e,o,i,i.out,r),e&&a)return a;o.wrap(i.out)}}if(t!=="directed"&&(a=xt(e,o,i,i.undirected,r),e&&a))return a}function Mh(e,t,n){if(e!=="mixed"){if(e==="undirected")return Object.keys(n.undirected);if(typeof t=="string")return Object.keys(n[t])}const i=[];return Gi(!1,e,t,n,function(r){i.push(r)}),i}function Tt(e,t,n){const i=Object.keys(n),r=i.length;let o=0;return{[Symbol.iterator](){return this},next(){let a=null;do{if(o>=r)return e&&e.wrap(n),{done:!0};const s=n[i[o++]],u=s.source,l=s.target;if(a=u===t?l:u,e&&e.has(a.key)){a=null;continue}}while(a===null);return{done:!1,value:{neighbor:a.key,attributes:a.attributes}}}}}function zh(e,t,n){if(e!=="mixed"){if(e==="undirected")return Tt(null,n,n.undirected);if(typeof t=="string")return Tt(null,n,n[t])}let i=yt();const r=new kn;return e!=="undirected"&&(t!=="out"&&(i=Xe(i,Tt(r,n,n.in))),t!=="in"&&(i=Xe(i,Tt(r,n,n.out)))),e!=="directed"&&(i=Xe(i,Tt(r,n,n.undirected))),i}function Oh(e,t){const{name:n,type:i,direction:r}=t;e.prototype[n]=function(o){if(i!=="mixed"&&this.type!=="mixed"&&i!==this.type)return[];o=""+o;const a=this._nodes.get(o);if(typeof a>"u")throw new U(`Graph.${n}: could not find the "${o}" node in the graph.`);return Mh(i==="mixed"?this.type:i,r,a)}}function Uh(e,t){const{name:n,type:i,direction:r}=t,o="forEach"+n[0].toUpperCase()+n.slice(1,-1);e.prototype[o]=function(l,c){if(i!=="mixed"&&this.type!=="mixed"&&i!==this.type)return;l=""+l;const h=this._nodes.get(l);if(typeof h>"u")throw new U(`Graph.${o}: could not find the "${l}" node in the graph.`);Gi(!1,i==="mixed"?this.type:i,r,h,c)};const a="map"+n[0].toUpperCase()+n.slice(1);e.prototype[a]=function(l,c){const h=[];return this[o](l,(d,f)=>{h.push(c(d,f))}),h};const s="filter"+n[0].toUpperCase()+n.slice(1);e.prototype[s]=function(l,c){const h=[];return this[o](l,(d,f)=>{c(d,f)&&h.push(d)}),h};const u="reduce"+n[0].toUpperCase()+n.slice(1);e.prototype[u]=function(l,c,h){if(arguments.length<3)throw new V(`Graph.${u}: missing initial value. You must provide it because the callback takes more than one argument and we cannot infer the initial value from the first iteration, as you could with a simple array.`);let d=h;return this[o](l,(f,p)=>{d=c(d,f,p)}),d}}function Bh(e,t){const{name:n,type:i,direction:r}=t,o=n[0].toUpperCase()+n.slice(1,-1),a="find"+o;e.prototype[a]=function(l,c){if(i!=="mixed"&&this.type!=="mixed"&&i!==this.type)return;l=""+l;const h=this._nodes.get(l);if(typeof h>"u")throw new U(`Graph.${a}: could not find the "${l}" node in the graph.`);return Gi(!0,i==="mixed"?this.type:i,r,h,c)};const s="some"+o;e.prototype[s]=function(l,c){return!!this[a](l,c)};const u="every"+o;e.prototype[u]=function(l,c){return!this[a](l,(d,f)=>!c(d,f))}}function Hh(e,t){const{name:n,type:i,direction:r}=t,o=n.slice(0,-1)+"Entries";e.prototype[o]=function(a){if(i!=="mixed"&&this.type!=="mixed"&&i!==this.type)return yt();a=""+a;const s=this._nodes.get(a);if(typeof s>"u")throw new U(`Graph.${o}: could not find the "${a}" node in the graph.`);return zh(i==="mixed"?this.type:i,r,s)}}function Wh(e){Ih.forEach(t=>{Oh(e,t),Uh(e,t),Bh(e,t),Hh(e,t)})}function Kt(e,t,n,i,r){const o=i._nodes.values(),a=i.type;let s,u,l,c,h,d;for(;s=o.next(),s.done!==!0;){let f=!1;if(u=s.value,a!=="undirected"){c=u.out;for(l in c){h=c[l];do d=h.target,f=!0,r(u.key,d.key,u.attributes,d.attributes,h.key,h.attributes,h.undirected),h=h.next;while(h)}}if(a!=="directed"){c=u.undirected;for(l in c)if(!(t&&u.key>l)){h=c[l];do d=h.target,d.key!==l&&(d=h.source),f=!0,r(u.key,d.key,u.attributes,d.attributes,h.key,h.attributes,h.undirected),h=h.next;while(h)}}n&&!f&&r(u.key,null,u.attributes,null,null,null,null)}}function Vh(e,t){const n={key:e};return Fo(t.attributes)||(n.attributes=me({},t.attributes)),n}function jh(e,t,n){const i={key:t,source:n.source.key,target:n.target.key};return Fo(n.attributes)||(i.attributes=me({},n.attributes)),e==="mixed"&&n.undirected&&(i.undirected=!0),i}function qh(e){if(!we(e))throw new V('Graph.import: invalid serialized node. A serialized node should be a plain object with at least a "key" property.');if(!("key"in e))throw new V("Graph.import: serialized node is missing its key.");if("attributes"in e&&(!we(e.attributes)||e.attributes===null))throw new V("Graph.import: invalid attributes. Attributes should be a plain object, null or omitted.")}function Xh(e){if(!we(e))throw new V('Graph.import: invalid serialized edge. A serialized edge should be a plain object with at least a "source" & "target" property.');if(!("source"in e))throw new V("Graph.import: serialized edge is missing its source.");if(!("target"in e))throw new V("Graph.import: serialized edge is missing its target.");if("attributes"in e&&(!we(e.attributes)||e.attributes===null))throw new V("Graph.import: invalid attributes. Attributes should be a plain object, null or omitted.");if("undirected"in e&&typeof e.undirected!="boolean")throw new V("Graph.import: invalid undirectedness information. Undirected should be boolean or omitted.")}const Yh=Zc(),Kh=new Set(["directed","undirected","mixed"]),_r=new Set(["domain","_events","_eventsCount","_maxListeners"]),Zh=[{name:e=>`${e}Edge`,generateKey:!0},{name:e=>`${e}DirectedEdge`,generateKey:!0,type:"directed"},{name:e=>`${e}UndirectedEdge`,generateKey:!0,type:"undirected"},{name:e=>`${e}EdgeWithKey`},{name:e=>`${e}DirectedEdgeWithKey`,type:"directed"},{name:e=>`${e}UndirectedEdgeWithKey`,type:"undirected"}],Jh={allowSelfLoops:!0,multi:!1,type:"mixed"};function Qh(e,t,n){if(n&&!we(n))throw new V(`Graph.addNode: invalid attributes. Expecting an object but got "${n}"`);if(t=""+t,n=n||{},e._nodes.has(t))throw new J(`Graph.addNode: the "${t}" node already exist in the graph.`);const i=new e.NodeDataClass(t,n);return e._nodes.set(t,i),e.emit("nodeAdded",{key:t,attributes:n}),i}function Er(e,t,n){const i=new e.NodeDataClass(t,n);return e._nodes.set(t,i),e.emit("nodeAdded",{key:t,attributes:n}),i}function Wo(e,t,n,i,r,o,a,s){if(!i&&e.type==="undirected")throw new J(`Graph.${t}: you cannot add a directed edge to an undirected graph. Use the #.addEdge or #.addUndirectedEdge instead.`);if(i&&e.type==="directed")throw new J(`Graph.${t}: you cannot add an undirected edge to a directed graph. Use the #.addEdge or #.addDirectedEdge instead.`);if(s&&!we(s))throw new V(`Graph.${t}: invalid attributes. Expecting an object but got "${s}"`);if(o=""+o,a=""+a,s=s||{},!e.allowSelfLoops&&o===a)throw new J(`Graph.${t}: source & target are the same ("${o}"), thus creating a loop explicitly forbidden by this graph 'allowSelfLoops' option set to false.`);const u=e._nodes.get(o),l=e._nodes.get(a);if(!u)throw new U(`Graph.${t}: source node "${o}" not found.`);if(!l)throw new U(`Graph.${t}: target node "${a}" not found.`);const c={key:null,undirected:i,source:o,target:a,attributes:s};if(n)r=e._edgeKeyGenerator();else if(r=""+r,e._edges.has(r))throw new J(`Graph.${t}: the "${r}" edge already exists in the graph.`);if(!e.multi&&(i?typeof u.undirected[a]<"u":typeof u.out[a]<"u"))throw new J(`Graph.${t}: an edge linking "${o}" to "${a}" already exists. If you really want to add multiple edges linking those nodes, you should create a multi graph by using the 'multi' option.`);const h=new bt(i,r,u,l,s);e._edges.set(r,h);const d=o===a;return i?(u.undirectedDegree++,l.undirectedDegree++,d&&(u.undirectedLoops++,e._undirectedSelfLoopCount++)):(u.outDegree++,l.inDegree++,d&&(u.directedLoops++,e._directedSelfLoopCount++)),e.multi?h.attachMulti():h.attach(),i?e._undirectedSize++:e._directedSize++,c.key=r,e.emit("edgeAdded",c),r}function ed(e,t,n,i,r,o,a,s,u){if(!i&&e.type==="undirected")throw new J(`Graph.${t}: you cannot merge/update a directed edge to an undirected graph. Use the #.mergeEdge/#.updateEdge or #.addUndirectedEdge instead.`);if(i&&e.type==="directed")throw new J(`Graph.${t}: you cannot merge/update an undirected edge to a directed graph. Use the #.mergeEdge/#.updateEdge or #.addDirectedEdge instead.`);if(s){if(u){if(typeof s!="function")throw new V(`Graph.${t}: invalid updater function. Expecting a function but got "${s}"`)}else if(!we(s))throw new V(`Graph.${t}: invalid attributes. Expecting an object but got "${s}"`)}o=""+o,a=""+a;let l;if(u&&(l=s,s=void 0),!e.allowSelfLoops&&o===a)throw new J(`Graph.${t}: source & target are the same ("${o}"), thus creating a loop explicitly forbidden by this graph 'allowSelfLoops' option set to false.`);let c=e._nodes.get(o),h=e._nodes.get(a),d,f;if(!n&&(d=e._edges.get(r),d)){if((d.source.key!==o||d.target.key!==a)&&(!i||d.source.key!==a||d.target.key!==o))throw new J(`Graph.${t}: inconsistency detected when attempting to merge the "${r}" edge with "${o}" source & "${a}" target vs. ("${d.source.key}", "${d.target.key}").`);f=d}if(!f&&!e.multi&&c&&(f=i?c.undirected[a]:c.out[a]),f){const x=[f.key,!1,!1,!1];if(u?!l:!s)return x;if(u){const k=f.attributes;f.attributes=l(k),e.emit("edgeAttributesUpdated",{type:"replace",key:f.key,attributes:f.attributes})}else me(f.attributes,s),e.emit("edgeAttributesUpdated",{type:"merge",key:f.key,attributes:f.attributes,data:s});return x}s=s||{},u&&l&&(s=l(s));const p={key:null,undirected:i,source:o,target:a,attributes:s};if(n)r=e._edgeKeyGenerator();else if(r=""+r,e._edges.has(r))throw new J(`Graph.${t}: the "${r}" edge already exists in the graph.`);let m=!1,_=!1;c||(c=Er(e,o,{}),m=!0,o===a&&(h=c,_=!0)),h||(h=Er(e,a,{}),_=!0),d=new bt(i,r,c,h,s),e._edges.set(r,d);const T=o===a;return i?(c.undirectedDegree++,h.undirectedDegree++,T&&(c.undirectedLoops++,e._undirectedSelfLoopCount++)):(c.outDegree++,h.inDegree++,T&&(c.directedLoops++,e._directedSelfLoopCount++)),e.multi?d.attachMulti():d.attach(),i?e._undirectedSize++:e._directedSize++,p.key=r,e.emit("edgeAdded",p),[r,!0,m,_]}function ut(e,t){e._edges.delete(t.key);const{source:n,target:i,attributes:r}=t,o=t.undirected,a=n===i;o?(n.undirectedDegree--,i.undirectedDegree--,a&&(n.undirectedLoops--,e._undirectedSelfLoopCount--)):(n.outDegree--,i.inDegree--,a&&(n.directedLoops--,e._directedSelfLoopCount--)),e.multi?t.detachMulti():t.detach(),o?e._undirectedSize--:e._directedSize--,e.emit("edgeDropped",{key:t.key,attributes:r,source:n.key,target:i.key,undirected:o})}class fe extends Po.EventEmitter{constructor(t){if(super(),t=me({},Jh,t),typeof t.multi!="boolean")throw new V(`Graph.constructor: invalid 'multi' option. Expecting a boolean but got "${t.multi}".`);if(!Kh.has(t.type))throw new V(`Graph.constructor: invalid 'type' option. Should be one of "mixed", "directed" or "undirected" but got "${t.type}".`);if(typeof t.allowSelfLoops!="boolean")throw new V(`Graph.constructor: invalid 'allowSelfLoops' option. Expecting a boolean but got "${t.allowSelfLoops}".`);const n=t.type==="mixed"?Io:t.type==="directed"?Mo:zo;Le(this,"NodeDataClass",n);const i="geid_"+Yh()+"_";let r=0;const o=()=>{let a;do a=i+r++;while(this._edges.has(a));return a};Le(this,"_attributes",{}),Le(this,"_nodes",new Map),Le(this,"_edges",new Map),Le(this,"_directedSize",0),Le(this,"_undirectedSize",0),Le(this,"_directedSelfLoopCount",0),Le(this,"_undirectedSelfLoopCount",0),Le(this,"_edgeKeyGenerator",o),Le(this,"_options",t),_r.forEach(a=>Le(this,a,this[a])),Ne(this,"order",()=>this._nodes.size),Ne(this,"size",()=>this._edges.size),Ne(this,"directedSize",()=>this._directedSize),Ne(this,"undirectedSize",()=>this._undirectedSize),Ne(this,"selfLoopCount",()=>this._directedSelfLoopCount+this._undirectedSelfLoopCount),Ne(this,"directedSelfLoopCount",()=>this._directedSelfLoopCount),Ne(this,"undirectedSelfLoopCount",()=>this._undirectedSelfLoopCount),Ne(this,"multi",this._options.multi),Ne(this,"type",this._options.type),Ne(this,"allowSelfLoops",this._options.allowSelfLoops),Ne(this,"implementation",()=>"graphology")}_resetInstanceCounters(){this._directedSize=0,this._undirectedSize=0,this._directedSelfLoopCount=0,this._undirectedSelfLoopCount=0}hasNode(t){return this._nodes.has(""+t)}hasDirectedEdge(t,n){if(this.type==="undirected")return!1;if(arguments.length===1){const i=""+t,r=this._edges.get(i);return!!r&&!r.undirected}else if(arguments.length===2){t=""+t,n=""+n;const i=this._nodes.get(t);return i?i.out.hasOwnProperty(n):!1}throw new V(`Graph.hasDirectedEdge: invalid arity (${arguments.length}, instead of 1 or 2). You can either ask for an edge id or for the existence of an edge between a source & a target.`)}hasUndirectedEdge(t,n){if(this.type==="directed")return!1;if(arguments.length===1){const i=""+t,r=this._edges.get(i);return!!r&&r.undirected}else if(arguments.length===2){t=""+t,n=""+n;const i=this._nodes.get(t);return i?i.undirected.hasOwnProperty(n):!1}throw new V(`Graph.hasDirectedEdge: invalid arity (${arguments.length}, instead of 1 or 2). You can either ask for an edge id or for the existence of an edge between a source & a target.`)}hasEdge(t,n){if(arguments.length===1){const i=""+t;return this._edges.has(i)}else if(arguments.length===2){t=""+t,n=""+n;const i=this._nodes.get(t);return i?typeof i.out<"u"&&i.out.hasOwnProperty(n)||typeof i.undirected<"u"&&i.undirected.hasOwnProperty(n):!1}throw new V(`Graph.hasEdge: invalid arity (${arguments.length}, instead of 1 or 2). You can either ask for an edge id or for the existence of an edge between a source & a target.`)}directedEdge(t,n){if(this.type==="undirected")return;if(t=""+t,n=""+n,this.multi)throw new J("Graph.directedEdge: this method is irrelevant with multigraphs since there might be multiple edges between source & target. See #.directedEdges instead.");const i=this._nodes.get(t);if(!i)throw new U(`Graph.directedEdge: could not find the "${t}" source node in the graph.`);if(!this._nodes.has(n))throw new U(`Graph.directedEdge: could not find the "${n}" target node in the graph.`);const r=i.out&&i.out[n]||void 0;if(r)return r.key}undirectedEdge(t,n){if(this.type==="directed")return;if(t=""+t,n=""+n,this.multi)throw new J("Graph.undirectedEdge: this method is irrelevant with multigraphs since there might be multiple edges between source & target. See #.undirectedEdges instead.");const i=this._nodes.get(t);if(!i)throw new U(`Graph.undirectedEdge: could not find the "${t}" source node in the graph.`);if(!this._nodes.has(n))throw new U(`Graph.undirectedEdge: could not find the "${n}" target node in the graph.`);const r=i.undirected&&i.undirected[n]||void 0;if(r)return r.key}edge(t,n){if(this.multi)throw new J("Graph.edge: this method is irrelevant with multigraphs since there might be multiple edges between source & target. See #.edges instead.");t=""+t,n=""+n;const i=this._nodes.get(t);if(!i)throw new U(`Graph.edge: could not find the "${t}" source node in the graph.`);if(!this._nodes.has(n))throw new U(`Graph.edge: could not find the "${n}" target node in the graph.`);const r=i.out&&i.out[n]||i.undirected&&i.undirected[n]||void 0;if(r)return r.key}areDirectedNeighbors(t,n){t=""+t,n=""+n;const i=this._nodes.get(t);if(!i)throw new U(`Graph.areDirectedNeighbors: could not find the "${t}" node in the graph.`);return this.type==="undirected"?!1:n in i.in||n in i.out}areOutNeighbors(t,n){t=""+t,n=""+n;const i=this._nodes.get(t);if(!i)throw new U(`Graph.areOutNeighbors: could not find the "${t}" node in the graph.`);return this.type==="undirected"?!1:n in i.out}areInNeighbors(t,n){t=""+t,n=""+n;const i=this._nodes.get(t);if(!i)throw new U(`Graph.areInNeighbors: could not find the "${t}" node in the graph.`);return this.type==="undirected"?!1:n in i.in}areUndirectedNeighbors(t,n){t=""+t,n=""+n;const i=this._nodes.get(t);if(!i)throw new U(`Graph.areUndirectedNeighbors: could not find the "${t}" node in the graph.`);return this.type==="directed"?!1:n in i.undirected}areNeighbors(t,n){t=""+t,n=""+n;const i=this._nodes.get(t);if(!i)throw new U(`Graph.areNeighbors: could not find the "${t}" node in the graph.`);return this.type!=="undirected"&&(n in i.in||n in i.out)||this.type!=="directed"&&n in i.undirected}areInboundNeighbors(t,n){t=""+t,n=""+n;const i=this._nodes.get(t);if(!i)throw new U(`Graph.areInboundNeighbors: could not find the "${t}" node in the graph.`);return this.type!=="undirected"&&n in i.in||this.type!=="directed"&&n in i.undirected}areOutboundNeighbors(t,n){t=""+t,n=""+n;const i=this._nodes.get(t);if(!i)throw new U(`Graph.areOutboundNeighbors: could not find the "${t}" node in the graph.`);return this.type!=="undirected"&&n in i.out||this.type!=="directed"&&n in i.undirected}inDegree(t){t=""+t;const n=this._nodes.get(t);if(!n)throw new U(`Graph.inDegree: could not find the "${t}" node in the graph.`);return this.type==="undirected"?0:n.inDegree}outDegree(t){t=""+t;const n=this._nodes.get(t);if(!n)throw new U(`Graph.outDegree: could not find the "${t}" node in the graph.`);return this.type==="undirected"?0:n.outDegree}directedDegree(t){t=""+t;const n=this._nodes.get(t);if(!n)throw new U(`Graph.directedDegree: could not find the "${t}" node in the graph.`);return this.type==="undirected"?0:n.inDegree+n.outDegree}undirectedDegree(t){t=""+t;const n=this._nodes.get(t);if(!n)throw new U(`Graph.undirectedDegree: could not find the "${t}" node in the graph.`);return this.type==="directed"?0:n.undirectedDegree}inboundDegree(t){t=""+t;const n=this._nodes.get(t);if(!n)throw new U(`Graph.inboundDegree: could not find the "${t}" node in the graph.`);let i=0;return this.type!=="directed"&&(i+=n.undirectedDegree),this.type!=="undirected"&&(i+=n.inDegree),i}outboundDegree(t){t=""+t;const n=this._nodes.get(t);if(!n)throw new U(`Graph.outboundDegree: could not find the "${t}" node in the graph.`);let i=0;return this.type!=="directed"&&(i+=n.undirectedDegree),this.type!=="undirected"&&(i+=n.outDegree),i}degree(t){t=""+t;const n=this._nodes.get(t);if(!n)throw new U(`Graph.degree: could not find the "${t}" node in the graph.`);let i=0;return this.type!=="directed"&&(i+=n.undirectedDegree),this.type!=="undirected"&&(i+=n.inDegree+n.outDegree),i}inDegreeWithoutSelfLoops(t){t=""+t;const n=this._nodes.get(t);if(!n)throw new U(`Graph.inDegreeWithoutSelfLoops: could not find the "${t}" node in the graph.`);return this.type==="undirected"?0:n.inDegree-n.directedLoops}outDegreeWithoutSelfLoops(t){t=""+t;const n=this._nodes.get(t);if(!n)throw new U(`Graph.outDegreeWithoutSelfLoops: could not find the "${t}" node in the graph.`);return this.type==="undirected"?0:n.outDegree-n.directedLoops}directedDegreeWithoutSelfLoops(t){t=""+t;const n=this._nodes.get(t);if(!n)throw new U(`Graph.directedDegreeWithoutSelfLoops: could not find the "${t}" node in the graph.`);return this.type==="undirected"?0:n.inDegree+n.outDegree-n.directedLoops*2}undirectedDegreeWithoutSelfLoops(t){t=""+t;const n=this._nodes.get(t);if(!n)throw new U(`Graph.undirectedDegreeWithoutSelfLoops: could not find the "${t}" node in the graph.`);return this.type==="directed"?0:n.undirectedDegree-n.undirectedLoops*2}inboundDegreeWithoutSelfLoops(t){t=""+t;const n=this._nodes.get(t);if(!n)throw new U(`Graph.inboundDegreeWithoutSelfLoops: could not find the "${t}" node in the graph.`);let i=0,r=0;return this.type!=="directed"&&(i+=n.undirectedDegree,r+=n.undirectedLoops*2),this.type!=="undirected"&&(i+=n.inDegree,r+=n.directedLoops),i-r}outboundDegreeWithoutSelfLoops(t){t=""+t;const n=this._nodes.get(t);if(!n)throw new U(`Graph.outboundDegreeWithoutSelfLoops: could not find the "${t}" node in the graph.`);let i=0,r=0;return this.type!=="directed"&&(i+=n.undirectedDegree,r+=n.undirectedLoops*2),this.type!=="undirected"&&(i+=n.outDegree,r+=n.directedLoops),i-r}degreeWithoutSelfLoops(t){t=""+t;const n=this._nodes.get(t);if(!n)throw new U(`Graph.degreeWithoutSelfLoops: could not find the "${t}" node in the graph.`);let i=0,r=0;return this.type!=="directed"&&(i+=n.undirectedDegree,r+=n.undirectedLoops*2),this.type!=="undirected"&&(i+=n.inDegree+n.outDegree,r+=n.directedLoops*2),i-r}source(t){t=""+t;const n=this._edges.get(t);if(!n)throw new U(`Graph.source: could not find the "${t}" edge in the graph.`);return n.source.key}target(t){t=""+t;const n=this._edges.get(t);if(!n)throw new U(`Graph.target: could not find the "${t}" edge in the graph.`);return n.target.key}extremities(t){t=""+t;const n=this._edges.get(t);if(!n)throw new U(`Graph.extremities: could not find the "${t}" edge in the graph.`);return[n.source.key,n.target.key]}opposite(t,n){t=""+t,n=""+n;const i=this._edges.get(n);if(!i)throw new U(`Graph.opposite: could not find the "${n}" edge in the graph.`);const r=i.source.key,o=i.target.key;if(t===r)return o;if(t===o)return r;throw new U(`Graph.opposite: the "${t}" node is not attached to the "${n}" edge (${r}, ${o}).`)}hasExtremity(t,n){t=""+t,n=""+n;const i=this._edges.get(t);if(!i)throw new U(`Graph.hasExtremity: could not find the "${t}" edge in the graph.`);return i.source.key===n||i.target.key===n}isUndirected(t){t=""+t;const n=this._edges.get(t);if(!n)throw new U(`Graph.isUndirected: could not find the "${t}" edge in the graph.`);return n.undirected}isDirected(t){t=""+t;const n=this._edges.get(t);if(!n)throw new U(`Graph.isDirected: could not find the "${t}" edge in the graph.`);return!n.undirected}isSelfLoop(t){t=""+t;const n=this._edges.get(t);if(!n)throw new U(`Graph.isSelfLoop: could not find the "${t}" edge in the graph.`);return n.source===n.target}addNode(t,n){return Qh(this,t,n).key}mergeNode(t,n){if(n&&!we(n))throw new V(`Graph.mergeNode: invalid attributes. Expecting an object but got "${n}"`);t=""+t,n=n||{};let i=this._nodes.get(t);return i?(n&&(me(i.attributes,n),this.emit("nodeAttributesUpdated",{type:"merge",key:t,attributes:i.attributes,data:n})),[t,!1]):(i=new this.NodeDataClass(t,n),this._nodes.set(t,i),this.emit("nodeAdded",{key:t,attributes:n}),[t,!0])}updateNode(t,n){if(n&&typeof n!="function")throw new V(`Graph.updateNode: invalid updater function. Expecting a function but got "${n}"`);t=""+t;let i=this._nodes.get(t);if(i){if(n){const o=i.attributes;i.attributes=n(o),this.emit("nodeAttributesUpdated",{type:"replace",key:t,attributes:i.attributes})}return[t,!1]}const r=n?n({}):{};return i=new this.NodeDataClass(t,r),this._nodes.set(t,i),this.emit("nodeAdded",{key:t,attributes:r}),[t,!0]}dropNode(t){t=""+t;const n=this._nodes.get(t);if(!n)throw new U(`Graph.dropNode: could not find the "${t}" node in the graph.`);let i;if(this.type!=="undirected"){for(const r in n.out){i=n.out[r];do ut(this,i),i=i.next;while(i)}for(const r in n.in){i=n.in[r];do ut(this,i),i=i.next;while(i)}}if(this.type!=="directed")for(const r in n.undirected){i=n.undirected[r];do ut(this,i),i=i.next;while(i)}this._nodes.delete(t),this.emit("nodeDropped",{key:t,attributes:n.attributes})}dropEdge(t){let n;if(arguments.length>1){const i=""+arguments[0],r=""+arguments[1];if(n=De(this,i,r,this.type),!n)throw new U(`Graph.dropEdge: could not find the "${i}" -> "${r}" edge in the graph.`)}else if(t=""+t,n=this._edges.get(t),!n)throw new U(`Graph.dropEdge: could not find the "${t}" edge in the graph.`);return ut(this,n),this}dropDirectedEdge(t,n){if(arguments.length<2)throw new J("Graph.dropDirectedEdge: it does not make sense to try and drop a directed edge by key. What if the edge with this key is undirected? Use #.dropEdge for this purpose instead.");if(this.multi)throw new J("Graph.dropDirectedEdge: cannot use a {source,target} combo when dropping an edge in a MultiGraph since we cannot infer the one you want to delete as there could be multiple ones.");t=""+t,n=""+n;const i=De(this,t,n,"directed");if(!i)throw new U(`Graph.dropDirectedEdge: could not find a "${t}" -> "${n}" edge in the graph.`);return ut(this,i),this}dropUndirectedEdge(t,n){if(arguments.length<2)throw new J("Graph.dropUndirectedEdge: it does not make sense to drop a directed edge by key. What if the edge with this key is undirected? Use #.dropEdge for this purpose instead.");if(this.multi)throw new J("Graph.dropUndirectedEdge: cannot use a {source,target} combo when dropping an edge in a MultiGraph since we cannot infer the one you want to delete as there could be multiple ones.");const i=De(this,t,n,"undirected");if(!i)throw new U(`Graph.dropUndirectedEdge: could not find a "${t}" -> "${n}" edge in the graph.`);return ut(this,i),this}clear(){this._edges.clear(),this._nodes.clear(),this._resetInstanceCounters(),this.emit("cleared")}clearEdges(){const t=this._nodes.values();let n;for(;n=t.next(),n.done!==!0;)n.value.clear();this._edges.clear(),this._resetInstanceCounters(),this.emit("edgesCleared")}getAttribute(t){return this._attributes[t]}getAttributes(){return this._attributes}hasAttribute(t){return this._attributes.hasOwnProperty(t)}setAttribute(t,n){return this._attributes[t]=n,this.emit("attributesUpdated",{type:"set",attributes:this._attributes,name:t}),this}updateAttribute(t,n){if(typeof n!="function")throw new V("Graph.updateAttribute: updater should be a function.");const i=this._attributes[t];return this._attributes[t]=n(i),this.emit("attributesUpdated",{type:"set",attributes:this._attributes,name:t}),this}removeAttribute(t){return delete this._attributes[t],this.emit("attributesUpdated",{type:"remove",attributes:this._attributes,name:t}),this}replaceAttributes(t){if(!we(t))throw new V("Graph.replaceAttributes: provided attributes are not a plain object.");return this._attributes=t,this.emit("attributesUpdated",{type:"replace",attributes:this._attributes}),this}mergeAttributes(t){if(!we(t))throw new V("Graph.mergeAttributes: provided attributes are not a plain object.");return me(this._attributes,t),this.emit("attributesUpdated",{type:"merge",attributes:this._attributes,data:t}),this}updateAttributes(t){if(typeof t!="function")throw new V("Graph.updateAttributes: provided updater is not a function.");return this._attributes=t(this._attributes),this.emit("attributesUpdated",{type:"update",attributes:this._attributes}),this}updateEachNodeAttributes(t,n){if(typeof t!="function")throw new V("Graph.updateEachNodeAttributes: expecting an updater function.");if(n&&!wr(n))throw new V("Graph.updateEachNodeAttributes: invalid hints. Expecting an object having the following shape: {attributes?: [string]}");const i=this._nodes.values();let r,o;for(;r=i.next(),r.done!==!0;)o=r.value,o.attributes=t(o.key,o.attributes);this.emit("eachNodeAttributesUpdated",{hints:n||null})}updateEachEdgeAttributes(t,n){if(typeof t!="function")throw new V("Graph.updateEachEdgeAttributes: expecting an updater function.");if(n&&!wr(n))throw new V("Graph.updateEachEdgeAttributes: invalid hints. Expecting an object having the following shape: {attributes?: [string]}");const i=this._edges.values();let r,o,a,s;for(;r=i.next(),r.done!==!0;)o=r.value,a=o.source,s=o.target,o.attributes=t(o.key,o.attributes,a.key,s.key,a.attributes,s.attributes,o.undirected);this.emit("eachEdgeAttributesUpdated",{hints:n||null})}forEachAdjacencyEntry(t){if(typeof t!="function")throw new V("Graph.forEachAdjacencyEntry: expecting a callback.");Kt(!1,!1,!1,this,t)}forEachAdjacencyEntryWithOrphans(t){if(typeof t!="function")throw new V("Graph.forEachAdjacencyEntryWithOrphans: expecting a callback.");Kt(!1,!1,!0,this,t)}forEachAssymetricAdjacencyEntry(t){if(typeof t!="function")throw new V("Graph.forEachAssymetricAdjacencyEntry: expecting a callback.");Kt(!1,!0,!1,this,t)}forEachAssymetricAdjacencyEntryWithOrphans(t){if(typeof t!="function")throw new V("Graph.forEachAssymetricAdjacencyEntryWithOrphans: expecting a callback.");Kt(!1,!0,!0,this,t)}nodes(){return Array.from(this._nodes.keys())}forEachNode(t){if(typeof t!="function")throw new V("Graph.forEachNode: expecting a callback.");const n=this._nodes.values();let i,r;for(;i=n.next(),i.done!==!0;)r=i.value,t(r.key,r.attributes)}findNode(t){if(typeof t!="function")throw new V("Graph.findNode: expecting a callback.");const n=this._nodes.values();let i,r;for(;i=n.next(),i.done!==!0;)if(r=i.value,t(r.key,r.attributes))return r.key}mapNodes(t){if(typeof t!="function")throw new V("Graph.mapNode: expecting a callback.");const n=this._nodes.values();let i,r;const o=new Array(this.order);let a=0;for(;i=n.next(),i.done!==!0;)r=i.value,o[a++]=t(r.key,r.attributes);return o}someNode(t){if(typeof t!="function")throw new V("Graph.someNode: expecting a callback.");const n=this._nodes.values();let i,r;for(;i=n.next(),i.done!==!0;)if(r=i.value,t(r.key,r.attributes))return!0;return!1}everyNode(t){if(typeof t!="function")throw new V("Graph.everyNode: expecting a callback.");const n=this._nodes.values();let i,r;for(;i=n.next(),i.done!==!0;)if(r=i.value,!t(r.key,r.attributes))return!1;return!0}filterNodes(t){if(typeof t!="function")throw new V("Graph.filterNodes: expecting a callback.");const n=this._nodes.values();let i,r;const o=[];for(;i=n.next(),i.done!==!0;)r=i.value,t(r.key,r.attributes)&&o.push(r.key);return o}reduceNodes(t,n){if(typeof t!="function")throw new V("Graph.reduceNodes: expecting a callback.");if(arguments.length<2)throw new V("Graph.reduceNodes: missing initial value. You must provide it because the callback takes more than one argument and we cannot infer the initial value from the first iteration, as you could with a simple array.");let i=n;const r=this._nodes.values();let o,a;for(;o=r.next(),o.done!==!0;)a=o.value,i=t(i,a.key,a.attributes);return i}nodeEntries(){const t=this._nodes.values();return{[Symbol.iterator](){return this},next(){const n=t.next();if(n.done)return n;const i=n.value;return{value:{node:i.key,attributes:i.attributes},done:!1}}}}export(){const t=new Array(this._nodes.size);let n=0;this._nodes.forEach((r,o)=>{t[n++]=Vh(o,r)});const i=new Array(this._edges.size);return n=0,this._edges.forEach((r,o)=>{i[n++]=jh(this.type,o,r)}),{options:{type:this.type,multi:this.multi,allowSelfLoops:this.allowSelfLoops},attributes:this.getAttributes(),nodes:t,edges:i}}import(t,n=!1){if(t instanceof fe)return t.forEachNode((u,l)=>{n?this.mergeNode(u,l):this.addNode(u,l)}),t.forEachEdge((u,l,c,h,d,f,p)=>{n?p?this.mergeUndirectedEdgeWithKey(u,c,h,l):this.mergeDirectedEdgeWithKey(u,c,h,l):p?this.addUndirectedEdgeWithKey(u,c,h,l):this.addDirectedEdgeWithKey(u,c,h,l)}),this;if(!we(t))throw new V("Graph.import: invalid argument. Expecting a serialized graph or, alternatively, a Graph instance.");if(t.attributes){if(!we(t.attributes))throw new V("Graph.import: invalid attributes. Expecting a plain object.");n?this.mergeAttributes(t.attributes):this.replaceAttributes(t.attributes)}let i,r,o,a,s;if(t.nodes){if(o=t.nodes,!Array.isArray(o))throw new V("Graph.import: invalid nodes. Expecting an array.");for(i=0,r=o.length;i<r;i++){a=o[i],qh(a);const{key:u,attributes:l}=a;n?this.mergeNode(u,l):this.addNode(u,l)}}if(t.edges){let u=!1;if(this.type==="undirected"&&(u=!0),o=t.edges,!Array.isArray(o))throw new V("Graph.import: invalid edges. Expecting an array.");for(i=0,r=o.length;i<r;i++){s=o[i],Xh(s);const{source:l,target:c,attributes:h,undirected:d=u}=s;let f;"key"in s?(f=n?d?this.mergeUndirectedEdgeWithKey:this.mergeDirectedEdgeWithKey:d?this.addUndirectedEdgeWithKey:this.addDirectedEdgeWithKey,f.call(this,s.key,l,c,h)):(f=n?d?this.mergeUndirectedEdge:this.mergeDirectedEdge:d?this.addUndirectedEdge:this.addDirectedEdge,f.call(this,l,c,h))}}return this}nullCopy(t){const n=new fe(me({},this._options,t));return n.replaceAttributes(me({},this.getAttributes())),n}emptyCopy(t){const n=this.nullCopy(t);return this._nodes.forEach((i,r)=>{const o=me({},i.attributes);i=new n.NodeDataClass(r,o),n._nodes.set(r,i)}),n}copy(t){if(t=t||{},typeof t.type=="string"&&t.type!==this.type&&t.type!=="mixed")throw new J(`Graph.copy: cannot create an incompatible copy from "${this.type}" type to "${t.type}" because this would mean losing information about the current graph.`);if(typeof t.multi=="boolean"&&t.multi!==this.multi&&t.multi!==!0)throw new J("Graph.copy: cannot create an incompatible copy by downgrading a multi graph to a simple one because this would mean losing information about the current graph.");if(typeof t.allowSelfLoops=="boolean"&&t.allowSelfLoops!==this.allowSelfLoops&&t.allowSelfLoops!==!0)throw new J("Graph.copy: cannot create an incompatible copy from a graph allowing self loops to one that does not because this would mean losing information about the current graph.");const n=this.emptyCopy(t),i=this._edges.values();let r,o;for(;r=i.next(),r.done!==!0;)o=r.value,Wo(n,"copy",!1,o.undirected,o.key,o.source.key,o.target.key,me({},o.attributes));return n}toJSON(){return this.export()}toString(){return"[object Graph]"}inspect(){const t={};this._nodes.forEach((o,a)=>{t[a]=o.attributes});const n={},i={};this._edges.forEach((o,a)=>{const s=o.undirected?"--":"->";let u="",l=o.source.key,c=o.target.key,h;o.undirected&&l>c&&(h=l,l=c,c=h);const d=`(${l})${s}(${c})`;a.startsWith("geid_")?this.multi&&(typeof i[d]>"u"?i[d]=0:i[d]++,u+=`${i[d]}. `):u+=`[${a}]: `,u+=d,n[u]=o.attributes});const r={};for(const o in this)this.hasOwnProperty(o)&&!_r.has(o)&&typeof this[o]!="function"&&typeof o!="symbol"&&(r[o]=this[o]);return r.attributes=this._attributes,r.nodes=t,r.edges=n,Le(r,"constructor",this.constructor),r}}typeof Symbol<"u"&&(fe.prototype[Symbol.for("nodejs.util.inspect.custom")]=fe.prototype.inspect);Zh.forEach(e=>{["add","merge","update"].forEach(t=>{const n=e.name(t),i=t==="add"?Wo:ed;e.generateKey?fe.prototype[n]=function(r,o,a){return i(this,n,!0,(e.type||this.type)==="undirected",null,r,o,a,t==="update")}:fe.prototype[n]=function(r,o,a,s){return i(this,n,!1,(e.type||this.type)==="undirected",r,o,a,s,t==="update")}})});lh(fe);wh(fe);Fh(fe);Wh(fe);class Vo extends fe{constructor(t){const n=me({type:"directed"},t);if("multi"in n&&n.multi!==!1)throw new V("DirectedGraph.from: inconsistent indication that the graph should be multi in given options!");if(n.type!=="directed")throw new V('DirectedGraph.from: inconsistent "'+n.type+'" type in given options!');super(n)}}class jo extends fe{constructor(t){const n=me({type:"undirected"},t);if("multi"in n&&n.multi!==!1)throw new V("UndirectedGraph.from: inconsistent indication that the graph should be multi in given options!");if(n.type!=="undirected")throw new V('UndirectedGraph.from: inconsistent "'+n.type+'" type in given options!');super(n)}}class qo extends fe{constructor(t){const n=me({multi:!0},t);if("multi"in n&&n.multi!==!0)throw new V("MultiGraph.from: inconsistent indication that the graph should be simple in given options!");super(n)}}class Xo extends fe{constructor(t){const n=me({type:"directed",multi:!0},t);if("multi"in n&&n.multi!==!0)throw new V("MultiDirectedGraph.from: inconsistent indication that the graph should be simple in given options!");if(n.type!=="directed")throw new V('MultiDirectedGraph.from: inconsistent "'+n.type+'" type in given options!');super(n)}}class Yo extends fe{constructor(t){const n=me({type:"undirected",multi:!0},t);if("multi"in n&&n.multi!==!0)throw new V("MultiUndirectedGraph.from: inconsistent indication that the graph should be simple in given options!");if(n.type!=="undirected")throw new V('MultiUndirectedGraph.from: inconsistent "'+n.type+'" type in given options!');super(n)}}function wt(e){e.from=function(t,n){const i=me({},t.options,n),r=new e(i);return r.import(t),r}}wt(fe);wt(Vo);wt(jo);wt(qo);wt(Xo);wt(Yo);fe.Graph=fe;fe.DirectedGraph=Vo;fe.UndirectedGraph=jo;fe.MultiGraph=qo;fe.MultiDirectedGraph=Xo;fe.MultiUndirectedGraph=Yo;fe.InvalidArgumentsGraphError=V;fe.NotFoundGraphError=U;fe.UsageGraphError=J;function td(e,t){if(typeof e!="object"||!e)return e;var n=e[Symbol.toPrimitive];if(n!==void 0){var i=n.call(e,t);if(typeof i!="object")return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}function Ft(e){var t=td(e,"string");return typeof t=="symbol"?t:t+""}function Ee(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function xr(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,Ft(i.key),i)}}function xe(e,t,n){return t&&xr(e.prototype,t),n&&xr(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e}function mt(e){return mt=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},mt(e)}function Ko(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(Ko=function(){return!!e})()}function nd(e){if(e===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function id(e,t){if(t&&(typeof t=="object"||typeof t=="function"))return t;if(t!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return nd(e)}function $e(e,t,n){return t=mt(t),id(e,Ko()?Reflect.construct(t,n||[],mt(e).constructor):t.apply(e,n))}function ci(e,t){return ci=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(n,i){return n.__proto__=i,n},ci(e,t)}function Ge(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&ci(e,t)}function rd(e){if(Array.isArray(e))return e}function od(e,t){var n=e==null?null:typeof Symbol<"u"&&e[Symbol.iterator]||e["@@iterator"];if(n!=null){var i,r,o,a,s=[],u=!0,l=!1;try{if(o=(n=n.call(e)).next,t===0){if(Object(n)!==n)return;u=!1}else for(;!(u=(i=o.call(n)).done)&&(s.push(i.value),s.length!==t);u=!0);}catch(c){l=!0,r=c}finally{try{if(!u&&n.return!=null&&(a=n.return(),Object(a)!==a))return}finally{if(l)throw r}}return s}}function hi(e,t){(t==null||t>e.length)&&(t=e.length);for(var n=0,i=Array(t);n<t;n++)i[n]=e[n];return i}function Zo(e,t){if(e){if(typeof e=="string")return hi(e,t);var n={}.toString.call(e).slice(8,-1);return n==="Object"&&e.constructor&&(n=e.constructor.name),n==="Map"||n==="Set"?Array.from(e):n==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?hi(e,t):void 0}}function ad(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function vt(e,t){return rd(e)||od(e,t)||Zo(e,t)||ad()}var zn={black:"#000000",silver:"#C0C0C0",gray:"#808080",grey:"#808080",white:"#FFFFFF",maroon:"#800000",red:"#FF0000",purple:"#800080",fuchsia:"#FF00FF",green:"#008000",lime:"#00FF00",olive:"#808000",yellow:"#FFFF00",navy:"#000080",blue:"#0000FF",teal:"#008080",aqua:"#00FFFF",darkblue:"#00008B",mediumblue:"#0000CD",darkgreen:"#006400",darkcyan:"#008B8B",deepskyblue:"#00BFFF",darkturquoise:"#00CED1",mediumspringgreen:"#00FA9A",springgreen:"#00FF7F",cyan:"#00FFFF",midnightblue:"#191970",dodgerblue:"#1E90FF",lightseagreen:"#20B2AA",forestgreen:"#228B22",seagreen:"#2E8B57",darkslategray:"#2F4F4F",darkslategrey:"#2F4F4F",limegreen:"#32CD32",mediumseagreen:"#3CB371",turquoise:"#40E0D0",royalblue:"#4169E1",steelblue:"#4682B4",darkslateblue:"#483D8B",mediumturquoise:"#48D1CC",indigo:"#4B0082",darkolivegreen:"#556B2F",cadetblue:"#5F9EA0",cornflowerblue:"#6495ED",rebeccapurple:"#663399",mediumaquamarine:"#66CDAA",dimgray:"#696969",dimgrey:"#696969",slateblue:"#6A5ACD",olivedrab:"#6B8E23",slategray:"#708090",slategrey:"#708090",lightslategray:"#778899",lightslategrey:"#778899",mediumslateblue:"#7B68EE",lawngreen:"#7CFC00",chartreuse:"#7FFF00",aquamarine:"#7FFFD4",skyblue:"#87CEEB",lightskyblue:"#87CEFA",blueviolet:"#8A2BE2",darkred:"#8B0000",darkmagenta:"#8B008B",saddlebrown:"#8B4513",darkseagreen:"#8FBC8F",lightgreen:"#90EE90",mediumpurple:"#9370DB",darkviolet:"#9400D3",palegreen:"#98FB98",darkorchid:"#9932CC",yellowgreen:"#9ACD32",sienna:"#A0522D",brown:"#A52A2A",darkgray:"#A9A9A9",darkgrey:"#A9A9A9",lightblue:"#ADD8E6",greenyellow:"#ADFF2F",paleturquoise:"#AFEEEE",lightsteelblue:"#B0C4DE",powderblue:"#B0E0E6",firebrick:"#B22222",darkgoldenrod:"#B8860B",mediumorchid:"#BA55D3",rosybrown:"#BC8F8F",darkkhaki:"#BDB76B",mediumvioletred:"#C71585",indianred:"#CD5C5C",peru:"#CD853F",chocolate:"#D2691E",tan:"#D2B48C",lightgray:"#D3D3D3",lightgrey:"#D3D3D3",thistle:"#D8BFD8",orchid:"#DA70D6",goldenrod:"#DAA520",palevioletred:"#DB7093",crimson:"#DC143C",gainsboro:"#DCDCDC",plum:"#DDA0DD",burlywood:"#DEB887",lightcyan:"#E0FFFF",lavender:"#E6E6FA",darksalmon:"#E9967A",violet:"#EE82EE",palegoldenrod:"#EEE8AA",lightcoral:"#F08080",khaki:"#F0E68C",aliceblue:"#F0F8FF",honeydew:"#F0FFF0",azure:"#F0FFFF",sandybrown:"#F4A460",wheat:"#F5DEB3",beige:"#F5F5DC",whitesmoke:"#F5F5F5",mintcream:"#F5FFFA",ghostwhite:"#F8F8FF",salmon:"#FA8072",antiquewhite:"#FAEBD7",linen:"#FAF0E6",lightgoldenrodyellow:"#FAFAD2",oldlace:"#FDF5E6",magenta:"#FF00FF",deeppink:"#FF1493",orangered:"#FF4500",tomato:"#FF6347",hotpink:"#FF69B4",coral:"#FF7F50",darkorange:"#FF8C00",lightsalmon:"#FFA07A",orange:"#FFA500",lightpink:"#FFB6C1",pink:"#FFC0CB",gold:"#FFD700",peachpuff:"#FFDAB9",navajowhite:"#FFDEAD",moccasin:"#FFE4B5",bisque:"#FFE4C4",mistyrose:"#FFE4E1",blanchedalmond:"#FFEBCD",papayawhip:"#FFEFD5",lavenderblush:"#FFF0F5",seashell:"#FFF5EE",cornsilk:"#FFF8DC",lemonchiffon:"#FFFACD",floralwhite:"#FFFAF0",snow:"#FFFAFA",lightyellow:"#FFFFE0",ivory:"#FFFFF0"},Jo=new Int8Array(4),On=new Int32Array(Jo.buffer,0,1),sd=new Float32Array(Jo.buffer,0,1),ud=/^\s*rgba?\s*\(/,ld=/^\s*rgba?\s*\(\s*([0-9]*)\s*,\s*([0-9]*)\s*,\s*([0-9]*)(?:\s*,\s*(.*)?)?\)\s*$/;function cd(e){var t=0,n=0,i=0,r=1;if(e[0]==="#")e.length===4?(t=parseInt(e.charAt(1)+e.charAt(1),16),n=parseInt(e.charAt(2)+e.charAt(2),16),i=parseInt(e.charAt(3)+e.charAt(3),16)):(t=parseInt(e.charAt(1)+e.charAt(2),16),n=parseInt(e.charAt(3)+e.charAt(4),16),i=parseInt(e.charAt(5)+e.charAt(6),16)),e.length===9&&(r=parseInt(e.charAt(7)+e.charAt(8),16)/255);else if(ud.test(e)){var o=e.match(ld);o&&(t=+o[1],n=+o[2],i=+o[3],o[4]&&(r=+o[4]))}return{r:t,g:n,b:i,a:r}}var dt={};for(var Zt in zn)dt[Zt]=_t(zn[Zt]),dt[zn[Zt]]=dt[Zt];function Qo(e,t,n,i,r){return On[0]=i<<24|n<<16|t<<8|e,On[0]=On[0]&4278190079,sd[0]}function _t(e){if(e=e.toLowerCase(),typeof dt[e]<"u")return dt[e];var t=cd(e),n=t.r,i=t.g,r=t.b,o=t.a;o=o*255|0;var a=Qo(n,i,r,o);return dt[e]=a,a}var Un={};function ea(e){if(typeof Un[e]<"u")return Un[e];var t=(e&16711680)>>>16,n=(e&65280)>>>8,i=e&255,r=255,o=Qo(t,n,i,r);return Un[e]=o,o}function Tr(e,t,n,i){return n+(t<<8)+(e<<16)}function kr(e,t,n,i,r,o){var a=Math.floor(n/o*r),s=Math.floor(e.drawingBufferHeight/o-i/o*r),u=new Uint8Array(4);e.bindFramebuffer(e.FRAMEBUFFER,t),e.readPixels(a,s,1,1,e.RGBA,e.UNSIGNED_BYTE,u);var l=vt(u,4),c=l[0],h=l[1],d=l[2],f=l[3];return[c,h,d,f]}function N(e,t,n){return(t=Ft(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function Sr(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable})),n.push.apply(n,i)}return n}function K(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?Sr(Object(n),!0).forEach(function(i){N(e,i,n[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Sr(Object(n)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(n,i))})}return e}function hd(e,t){for(;!{}.hasOwnProperty.call(e,t)&&(e=mt(e))!==null;);return e}function di(){return di=typeof Reflect<"u"&&Reflect.get?Reflect.get.bind():function(e,t,n){var i=hd(e,t);if(i){var r=Object.getOwnPropertyDescriptor(i,t);return r.get?r.get.call(arguments.length<3?e:n):r.value}},di.apply(null,arguments)}function ta(e,t,n,i){var r=di(mt(e.prototype),t,n);return typeof r=="function"?function(o){return r.apply(n,o)}:r}function dd(e){return e.normalized?1:e.size}function Bn(e){var t=0;return e.forEach(function(n){return t+=dd(n)}),t}function na(e,t,n){var i=e==="VERTEX"?t.VERTEX_SHADER:t.FRAGMENT_SHADER,r=t.createShader(i);if(r===null)throw new Error("loadShader: error while creating the shader");t.shaderSource(r,n),t.compileShader(r);var o=t.getShaderParameter(r,t.COMPILE_STATUS);if(!o){var a=t.getShaderInfoLog(r);throw t.deleteShader(r),new Error(`loadShader: error while compiling the shader:
`.concat(a,`
`).concat(n))}return r}function fd(e,t){return na("VERTEX",e,t)}function gd(e,t){return na("FRAGMENT",e,t)}function pd(e,t){var n=e.createProgram();if(n===null)throw new Error("loadProgram: error while creating the program.");var i,r;for(i=0,r=t.length;i<r;i++)e.attachShader(n,t[i]);e.linkProgram(n);var o=e.getProgramParameter(n,e.LINK_STATUS);if(!o)throw e.deleteProgram(n),new Error("loadProgram: error while linking the program.");return n}function Ar(e){var t=e.gl,n=e.buffer,i=e.program,r=e.vertexShader,o=e.fragmentShader;t.deleteShader(r),t.deleteShader(o),t.deleteProgram(i),t.deleteBuffer(n)}var Cr=`#define PICKING_MODE
`,md=N(N(N(N(N(N(N(N({},WebGL2RenderingContext.BOOL,1),WebGL2RenderingContext.BYTE,1),WebGL2RenderingContext.UNSIGNED_BYTE,1),WebGL2RenderingContext.SHORT,2),WebGL2RenderingContext.UNSIGNED_SHORT,2),WebGL2RenderingContext.INT,4),WebGL2RenderingContext.UNSIGNED_INT,4),WebGL2RenderingContext.FLOAT,4),ia=function(){function e(t,n,i){Ee(this,e),N(this,"array",new Float32Array),N(this,"constantArray",new Float32Array),N(this,"capacity",0),N(this,"verticesCount",0);var r=this.getDefinition();if(this.VERTICES=r.VERTICES,this.VERTEX_SHADER_SOURCE=r.VERTEX_SHADER_SOURCE,this.FRAGMENT_SHADER_SOURCE=r.FRAGMENT_SHADER_SOURCE,this.UNIFORMS=r.UNIFORMS,this.ATTRIBUTES=r.ATTRIBUTES,this.METHOD=r.METHOD,this.CONSTANT_ATTRIBUTES="CONSTANT_ATTRIBUTES"in r?r.CONSTANT_ATTRIBUTES:[],this.CONSTANT_DATA="CONSTANT_DATA"in r?r.CONSTANT_DATA:[],this.isInstanced="CONSTANT_ATTRIBUTES"in r,this.ATTRIBUTES_ITEMS_COUNT=Bn(this.ATTRIBUTES),this.STRIDE=this.VERTICES*this.ATTRIBUTES_ITEMS_COUNT,this.renderer=i,this.normalProgram=this.getProgramInfo("normal",t,r.VERTEX_SHADER_SOURCE,r.FRAGMENT_SHADER_SOURCE,null),this.pickProgram=n?this.getProgramInfo("pick",t,Cr+r.VERTEX_SHADER_SOURCE,Cr+r.FRAGMENT_SHADER_SOURCE,n):null,this.isInstanced){var o=Bn(this.CONSTANT_ATTRIBUTES);if(this.CONSTANT_DATA.length!==this.VERTICES)throw new Error("Program: error while getting constant data (expected ".concat(this.VERTICES," items, received ").concat(this.CONSTANT_DATA.length," instead)"));this.constantArray=new Float32Array(this.CONSTANT_DATA.length*o);for(var a=0;a<this.CONSTANT_DATA.length;a++){var s=this.CONSTANT_DATA[a];if(s.length!==o)throw new Error("Program: error while getting constant data (one vector has ".concat(s.length," items instead of ").concat(o,")"));for(var u=0;u<s.length;u++)this.constantArray[a*o+u]=s[u]}this.STRIDE=this.ATTRIBUTES_ITEMS_COUNT}}return xe(e,[{key:"kill",value:function(){Ar(this.normalProgram),this.pickProgram&&(Ar(this.pickProgram),this.pickProgram=null)}},{key:"getProgramInfo",value:function(n,i,r,o,a){var s=this.getDefinition(),u=i.createBuffer();if(u===null)throw new Error("Program: error while creating the WebGL buffer.");var l=fd(i,r),c=gd(i,o),h=pd(i,[l,c]),d={};s.UNIFORMS.forEach(function(m){var _=i.getUniformLocation(h,m);_&&(d[m]=_)});var f={};s.ATTRIBUTES.forEach(function(m){f[m.name]=i.getAttribLocation(h,m.name)});var p;if("CONSTANT_ATTRIBUTES"in s&&(s.CONSTANT_ATTRIBUTES.forEach(function(m){f[m.name]=i.getAttribLocation(h,m.name)}),p=i.createBuffer(),p===null))throw new Error("Program: error while creating the WebGL constant buffer.");return{name:n,program:h,gl:i,frameBuffer:a,buffer:u,constantBuffer:p||{},uniformLocations:d,attributeLocations:f,isPicking:n==="pick",vertexShader:l,fragmentShader:c}}},{key:"bindProgram",value:function(n){var i=this,r=0,o=n.gl,a=n.buffer;this.isInstanced?(o.bindBuffer(o.ARRAY_BUFFER,n.constantBuffer),r=0,this.CONSTANT_ATTRIBUTES.forEach(function(s){return r+=i.bindAttribute(s,n,r,!1)}),o.bufferData(o.ARRAY_BUFFER,this.constantArray,o.STATIC_DRAW),o.bindBuffer(o.ARRAY_BUFFER,n.buffer),r=0,this.ATTRIBUTES.forEach(function(s){return r+=i.bindAttribute(s,n,r,!0)}),o.bufferData(o.ARRAY_BUFFER,this.array,o.DYNAMIC_DRAW)):(o.bindBuffer(o.ARRAY_BUFFER,a),r=0,this.ATTRIBUTES.forEach(function(s){return r+=i.bindAttribute(s,n,r)}),o.bufferData(o.ARRAY_BUFFER,this.array,o.DYNAMIC_DRAW)),o.bindBuffer(o.ARRAY_BUFFER,null)}},{key:"unbindProgram",value:function(n){var i=this;this.isInstanced?(this.CONSTANT_ATTRIBUTES.forEach(function(r){return i.unbindAttribute(r,n,!1)}),this.ATTRIBUTES.forEach(function(r){return i.unbindAttribute(r,n,!0)})):this.ATTRIBUTES.forEach(function(r){return i.unbindAttribute(r,n)})}},{key:"bindAttribute",value:function(n,i,r,o){var a=md[n.type];if(typeof a!="number")throw new Error('Program.bind: yet unsupported attribute type "'.concat(n.type,'"'));var s=i.attributeLocations[n.name],u=i.gl;if(s!==-1){u.enableVertexAttribArray(s);var l=this.isInstanced?(o?this.ATTRIBUTES_ITEMS_COUNT:Bn(this.CONSTANT_ATTRIBUTES))*Float32Array.BYTES_PER_ELEMENT:this.ATTRIBUTES_ITEMS_COUNT*Float32Array.BYTES_PER_ELEMENT;if(u.vertexAttribPointer(s,n.size,n.type,n.normalized||!1,l,r),this.isInstanced&&o)if(u instanceof WebGL2RenderingContext)u.vertexAttribDivisor(s,1);else{var c=u.getExtension("ANGLE_instanced_arrays");c&&c.vertexAttribDivisorANGLE(s,1)}}return n.size*a}},{key:"unbindAttribute",value:function(n,i,r){var o=i.attributeLocations[n.name],a=i.gl;if(o!==-1&&(a.disableVertexAttribArray(o),this.isInstanced&&r))if(a instanceof WebGL2RenderingContext)a.vertexAttribDivisor(o,0);else{var s=a.getExtension("ANGLE_instanced_arrays");s&&s.vertexAttribDivisorANGLE(o,0)}}},{key:"reallocate",value:function(n){n!==this.capacity&&(this.capacity=n,this.verticesCount=this.VERTICES*n,this.array=new Float32Array(this.isInstanced?this.capacity*this.ATTRIBUTES_ITEMS_COUNT:this.verticesCount*this.ATTRIBUTES_ITEMS_COUNT))}},{key:"hasNothingToRender",value:function(){return this.verticesCount===0}},{key:"renderProgram",value:function(n,i){var r=i.gl,o=i.program;r.enable(r.BLEND),r.useProgram(o),this.setUniforms(n,i),this.drawWebGL(this.METHOD,i)}},{key:"render",value:function(n){this.hasNothingToRender()||(this.pickProgram&&(this.pickProgram.gl.viewport(0,0,n.width*n.pixelRatio/n.downSizingRatio,n.height*n.pixelRatio/n.downSizingRatio),this.bindProgram(this.pickProgram),this.renderProgram(K(K({},n),{},{pixelRatio:n.pixelRatio/n.downSizingRatio}),this.pickProgram),this.unbindProgram(this.pickProgram)),this.normalProgram.gl.viewport(0,0,n.width*n.pixelRatio,n.height*n.pixelRatio),this.bindProgram(this.normalProgram),this.renderProgram(n,this.normalProgram),this.unbindProgram(this.normalProgram))}},{key:"drawWebGL",value:function(n,i){var r=i.gl,o=i.frameBuffer;if(r.bindFramebuffer(r.FRAMEBUFFER,o),!this.isInstanced)r.drawArrays(n,0,this.verticesCount);else if(r instanceof WebGL2RenderingContext)r.drawArraysInstanced(n,0,this.VERTICES,this.capacity);else{var a=r.getExtension("ANGLE_instanced_arrays");a&&a.drawArraysInstancedANGLE(n,0,this.VERTICES,this.capacity)}}}])}(),vd=function(e){function t(){return Ee(this,t),$e(this,t,arguments)}return Ge(t,e),xe(t,[{key:"kill",value:function(){ta(t,"kill",this)([])}},{key:"process",value:function(i,r,o){var a=r*this.STRIDE;if(o.hidden){for(var s=a+this.STRIDE;a<s;a++)this.array[a]=0;return}return this.processVisibleItem(ea(i),a,o)}}])}(ia),Sn=function(e){function t(){var n;Ee(this,t);for(var i=arguments.length,r=new Array(i),o=0;o<i;o++)r[o]=arguments[o];return n=$e(this,t,[].concat(r)),N(n,"drawLabel",void 0),n}return Ge(t,e),xe(t,[{key:"kill",value:function(){ta(t,"kill",this)([])}},{key:"process",value:function(i,r,o,a,s){var u=r*this.STRIDE;if(s.hidden||o.hidden||a.hidden){for(var l=u+this.STRIDE;u<l;u++)this.array[u]=0;return}return this.processVisibleItem(ea(i),u,o,a,s)}}])}(ia);function yd(e,t){return function(){function n(i,r,o){Ee(this,n),N(this,"drawLabel",t),this.programs=e.map(function(a){return new a(i,r,o)})}return xe(n,[{key:"reallocate",value:function(r){this.programs.forEach(function(o){return o.reallocate(r)})}},{key:"process",value:function(r,o,a,s,u){this.programs.forEach(function(l){return l.process(r,o,a,s,u)})}},{key:"render",value:function(r){this.programs.forEach(function(o){return o.render(r)})}},{key:"kill",value:function(){this.programs.forEach(function(r){return r.kill()})}}])}()}function bd(e,t,n,i,r){var o=r.edgeLabelSize,a=r.edgeLabelFont,s=r.edgeLabelWeight,u=r.edgeLabelColor.attribute?t[r.edgeLabelColor.attribute]||r.edgeLabelColor.color||"#000":r.edgeLabelColor.color,l=t.label;if(l){e.fillStyle=u,e.font="".concat(s," ").concat(o,"px ").concat(a);var c=n.size,h=i.size,d=n.x,f=n.y,p=i.x,m=i.y,_=(d+p)/2,T=(f+m)/2,x=p-d,k=m-f,v=Math.sqrt(x*x+k*k);if(!(v<c+h)){d+=x*c/v,f+=k*c/v,p-=x*h/v,m-=k*h/v,_=(d+p)/2,T=(f+m)/2,x=p-d,k=m-f,v=Math.sqrt(x*x+k*k);var b=e.measureText(l).width;if(b>v){var C="…";for(l=l+C,b=e.measureText(l).width;b>v&&l.length>1;)l=l.slice(0,-2)+C,b=e.measureText(l).width;if(l.length<4)return}var R;x>0?k>0?R=Math.acos(x/v):R=Math.asin(k/v):k>0?R=Math.acos(x/v)+Math.PI:R=Math.asin(x/v)+Math.PI/2,e.save(),e.translate(_,T),e.rotate(R),e.fillText(l,-b/2,t.size/2+o),e.restore()}}}function ra(e,t,n){if(t.label){var i=n.labelSize,r=n.labelFont,o=n.labelWeight,a=n.labelColor.attribute?t[n.labelColor.attribute]||n.labelColor.color||"#000":n.labelColor.color;e.fillStyle=a,e.font="".concat(o," ").concat(i,"px ").concat(r),e.fillText(t.label,t.x+t.size+3,t.y+i/3)}}function wd(e,t,n){var i=n.labelSize,r=n.labelFont,o=n.labelWeight;e.font="".concat(o," ").concat(i,"px ").concat(r),e.fillStyle="#FFF",e.shadowOffsetX=0,e.shadowOffsetY=0,e.shadowBlur=8,e.shadowColor="#000";var a=2;if(typeof t.label=="string"){var s=e.measureText(t.label).width,u=Math.round(s+5),l=Math.round(i+2*a),c=Math.max(t.size,i/2)+a,h=Math.asin(l/2/c),d=Math.sqrt(Math.abs(Math.pow(c,2)-Math.pow(l/2,2)));e.beginPath(),e.moveTo(t.x+d,t.y+l/2),e.lineTo(t.x+c+u,t.y+l/2),e.lineTo(t.x+c+u,t.y-l/2),e.lineTo(t.x+d,t.y-l/2),e.arc(t.x,t.y,c,h,-h),e.closePath(),e.fill()}else e.beginPath(),e.arc(t.x,t.y,t.size+a,0,Math.PI*2),e.closePath(),e.fill();e.shadowOffsetX=0,e.shadowOffsetY=0,e.shadowBlur=0,ra(e,t,n)}var _d=`
precision highp float;

varying vec4 v_color;
varying vec2 v_diffVector;
varying float v_radius;

uniform float u_correctionRatio;

const vec4 transparent = vec4(0.0, 0.0, 0.0, 0.0);

void main(void) {
  float border = u_correctionRatio * 2.0;
  float dist = length(v_diffVector) - v_radius + border;

  // No antialiasing for picking mode:
  #ifdef PICKING_MODE
  if (dist > border)
    gl_FragColor = transparent;
  else
    gl_FragColor = v_color;

  #else
  float t = 0.0;
  if (dist > border)
    t = 1.0;
  else if (dist > 0.0)
    t = dist / border;

  gl_FragColor = mix(v_color, transparent, t);
  #endif
}
`,Ed=_d,xd=`
attribute vec4 a_id;
attribute vec4 a_color;
attribute vec2 a_position;
attribute float a_size;
attribute float a_angle;

uniform mat3 u_matrix;
uniform float u_sizeRatio;
uniform float u_correctionRatio;

varying vec4 v_color;
varying vec2 v_diffVector;
varying float v_radius;
varying float v_border;

const float bias = 255.0 / 254.0;

void main() {
  float size = a_size * u_correctionRatio / u_sizeRatio * 4.0;
  vec2 diffVector = size * vec2(cos(a_angle), sin(a_angle));
  vec2 position = a_position + diffVector;
  gl_Position = vec4(
    (u_matrix * vec3(position, 1)).xy,
    0,
    1
  );

  v_diffVector = diffVector;
  v_radius = size / 2.0;

  #ifdef PICKING_MODE
  // For picking mode, we use the ID as the color:
  v_color = a_id;
  #else
  // For normal mode, we use the color:
  v_color = a_color;
  #endif

  v_color.a *= bias;
}
`,Td=xd,oa=WebGLRenderingContext,Rr=oa.UNSIGNED_BYTE,Hn=oa.FLOAT,kd=["u_sizeRatio","u_correctionRatio","u_matrix"],An=function(e){function t(){return Ee(this,t),$e(this,t,arguments)}return Ge(t,e),xe(t,[{key:"getDefinition",value:function(){return{VERTICES:3,VERTEX_SHADER_SOURCE:Td,FRAGMENT_SHADER_SOURCE:Ed,METHOD:WebGLRenderingContext.TRIANGLES,UNIFORMS:kd,ATTRIBUTES:[{name:"a_position",size:2,type:Hn},{name:"a_size",size:1,type:Hn},{name:"a_color",size:4,type:Rr,normalized:!0},{name:"a_id",size:4,type:Rr,normalized:!0}],CONSTANT_ATTRIBUTES:[{name:"a_angle",size:1,type:Hn}],CONSTANT_DATA:[[t.ANGLE_1],[t.ANGLE_2],[t.ANGLE_3]]}}},{key:"processVisibleItem",value:function(i,r,o){var a=this.array,s=_t(o.color);a[r++]=o.x,a[r++]=o.y,a[r++]=o.size,a[r++]=s,a[r++]=i}},{key:"setUniforms",value:function(i,r){var o=r.gl,a=r.uniformLocations,s=a.u_sizeRatio,u=a.u_correctionRatio,l=a.u_matrix;o.uniform1f(u,i.correctionRatio),o.uniform1f(s,i.sizeRatio),o.uniformMatrix3fv(l,!1,i.matrix)}}])}(vd);N(An,"ANGLE_1",0);N(An,"ANGLE_2",2*Math.PI/3);N(An,"ANGLE_3",4*Math.PI/3);var Sd=`
precision mediump float;

varying vec4 v_color;

void main(void) {
  gl_FragColor = v_color;
}
`,Ad=Sd,Cd=`
attribute vec2 a_position;
attribute vec2 a_normal;
attribute float a_radius;
attribute vec3 a_barycentric;

#ifdef PICKING_MODE
attribute vec4 a_id;
#else
attribute vec4 a_color;
#endif

uniform mat3 u_matrix;
uniform float u_sizeRatio;
uniform float u_correctionRatio;
uniform float u_minEdgeThickness;
uniform float u_lengthToThicknessRatio;
uniform float u_widenessToThicknessRatio;

varying vec4 v_color;

const float bias = 255.0 / 254.0;

void main() {
  float minThickness = u_minEdgeThickness;

  float normalLength = length(a_normal);
  vec2 unitNormal = a_normal / normalLength;

  // These first computations are taken from edge.vert.glsl and
  // edge.clamped.vert.glsl. Please read it to get better comments on what's
  // happening:
  float pixelsThickness = max(normalLength / u_sizeRatio, minThickness);
  float webGLThickness = pixelsThickness * u_correctionRatio;
  float webGLNodeRadius = a_radius * 2.0 * u_correctionRatio / u_sizeRatio;
  float webGLArrowHeadLength = webGLThickness * u_lengthToThicknessRatio * 2.0;
  float webGLArrowHeadThickness = webGLThickness * u_widenessToThicknessRatio;

  float da = a_barycentric.x;
  float db = a_barycentric.y;
  float dc = a_barycentric.z;

  vec2 delta = vec2(
      da * (webGLNodeRadius * unitNormal.y)
    + db * ((webGLNodeRadius + webGLArrowHeadLength) * unitNormal.y + webGLArrowHeadThickness * unitNormal.x)
    + dc * ((webGLNodeRadius + webGLArrowHeadLength) * unitNormal.y - webGLArrowHeadThickness * unitNormal.x),

      da * (-webGLNodeRadius * unitNormal.x)
    + db * (-(webGLNodeRadius + webGLArrowHeadLength) * unitNormal.x + webGLArrowHeadThickness * unitNormal.y)
    + dc * (-(webGLNodeRadius + webGLArrowHeadLength) * unitNormal.x - webGLArrowHeadThickness * unitNormal.y)
  );

  vec2 position = (u_matrix * vec3(a_position + delta, 1)).xy;

  gl_Position = vec4(position, 0, 1);

  #ifdef PICKING_MODE
  // For picking mode, we use the ID as the color:
  v_color = a_id;
  #else
  // For normal mode, we use the color:
  v_color = a_color;
  #endif

  v_color.a *= bias;
}
`,Rd=Cd,aa=WebGLRenderingContext,Lr=aa.UNSIGNED_BYTE,Jt=aa.FLOAT,Ld=["u_matrix","u_sizeRatio","u_correctionRatio","u_minEdgeThickness","u_lengthToThicknessRatio","u_widenessToThicknessRatio"],Cn={extremity:"target",lengthToThicknessRatio:2.5,widenessToThicknessRatio:2};function sa(e){var t=K(K({},Cn),{});return function(n){function i(){return Ee(this,i),$e(this,i,arguments)}return Ge(i,n),xe(i,[{key:"getDefinition",value:function(){return{VERTICES:3,VERTEX_SHADER_SOURCE:Rd,FRAGMENT_SHADER_SOURCE:Ad,METHOD:WebGLRenderingContext.TRIANGLES,UNIFORMS:Ld,ATTRIBUTES:[{name:"a_position",size:2,type:Jt},{name:"a_normal",size:2,type:Jt},{name:"a_radius",size:1,type:Jt},{name:"a_color",size:4,type:Lr,normalized:!0},{name:"a_id",size:4,type:Lr,normalized:!0}],CONSTANT_ATTRIBUTES:[{name:"a_barycentric",size:3,type:Jt}],CONSTANT_DATA:[[1,0,0],[0,1,0],[0,0,1]]}}},{key:"processVisibleItem",value:function(o,a,s,u,l){if(t.extremity==="source"){var c=[u,s];s=c[0],u=c[1]}var h=l.size||1,d=u.size||1,f=s.x,p=s.y,m=u.x,_=u.y,T=_t(l.color),x=m-f,k=_-p,v=x*x+k*k,b=0,C=0;v&&(v=1/Math.sqrt(v),b=-k*v*h,C=x*v*h);var R=this.array;R[a++]=m,R[a++]=_,R[a++]=-b,R[a++]=-C,R[a++]=d,R[a++]=T,R[a++]=o}},{key:"setUniforms",value:function(o,a){var s=a.gl,u=a.uniformLocations,l=u.u_matrix,c=u.u_sizeRatio,h=u.u_correctionRatio,d=u.u_minEdgeThickness,f=u.u_lengthToThicknessRatio,p=u.u_widenessToThicknessRatio;s.uniformMatrix3fv(l,!1,o.matrix),s.uniform1f(c,o.sizeRatio),s.uniform1f(h,o.correctionRatio),s.uniform1f(d,o.minEdgeThickness),s.uniform1f(f,t.lengthToThicknessRatio),s.uniform1f(p,t.widenessToThicknessRatio)}}])}(Sn)}sa();var Dd=`
precision mediump float;

varying vec4 v_color;
varying vec2 v_normal;
varying float v_thickness;
varying float v_feather;

const vec4 transparent = vec4(0.0, 0.0, 0.0, 0.0);

void main(void) {
  // We only handle antialiasing for normal mode:
  #ifdef PICKING_MODE
  gl_FragColor = v_color;
  #else
  float dist = length(v_normal) * v_thickness;

  float t = smoothstep(
    v_thickness - v_feather,
    v_thickness,
    dist
  );

  gl_FragColor = mix(v_color, transparent, t);
  #endif
}
`,ua=Dd,$d=`
attribute vec4 a_id;
attribute vec4 a_color;
attribute vec2 a_normal;
attribute float a_normalCoef;
attribute vec2 a_positionStart;
attribute vec2 a_positionEnd;
attribute float a_positionCoef;
attribute float a_radius;
attribute float a_radiusCoef;

uniform mat3 u_matrix;
uniform float u_zoomRatio;
uniform float u_sizeRatio;
uniform float u_pixelRatio;
uniform float u_correctionRatio;
uniform float u_minEdgeThickness;
uniform float u_lengthToThicknessRatio;
uniform float u_feather;

varying vec4 v_color;
varying vec2 v_normal;
varying float v_thickness;
varying float v_feather;

const float bias = 255.0 / 254.0;

void main() {
  float minThickness = u_minEdgeThickness;

  float radius = a_radius * a_radiusCoef;
  vec2 normal = a_normal * a_normalCoef;
  vec2 position = a_positionStart * (1.0 - a_positionCoef) + a_positionEnd * a_positionCoef;

  float normalLength = length(normal);
  vec2 unitNormal = normal / normalLength;

  // These first computations are taken from edge.vert.glsl. Please read it to
  // get better comments on what's happening:
  float pixelsThickness = max(normalLength, minThickness * u_sizeRatio);
  float webGLThickness = pixelsThickness * u_correctionRatio / u_sizeRatio;

  // Here, we move the point to leave space for the arrow head:
  float direction = sign(radius);
  float webGLNodeRadius = direction * radius * 2.0 * u_correctionRatio / u_sizeRatio;
  float webGLArrowHeadLength = webGLThickness * u_lengthToThicknessRatio * 2.0;

  vec2 compensationVector = vec2(-direction * unitNormal.y, direction * unitNormal.x) * (webGLNodeRadius + webGLArrowHeadLength);

  // Here is the proper position of the vertex
  gl_Position = vec4((u_matrix * vec3(position + unitNormal * webGLThickness + compensationVector, 1)).xy, 0, 1);

  v_thickness = webGLThickness / u_zoomRatio;

  v_normal = unitNormal;

  v_feather = u_feather * u_correctionRatio / u_zoomRatio / u_pixelRatio * 2.0;

  #ifdef PICKING_MODE
  // For picking mode, we use the ID as the color:
  v_color = a_id;
  #else
  // For normal mode, we use the color:
  v_color = a_color;
  #endif

  v_color.a *= bias;
}
`,Gd=$d,la=WebGLRenderingContext,Dr=la.UNSIGNED_BYTE,nt=la.FLOAT,Nd=["u_matrix","u_zoomRatio","u_sizeRatio","u_correctionRatio","u_pixelRatio","u_feather","u_minEdgeThickness","u_lengthToThicknessRatio"],Pd={lengthToThicknessRatio:Cn.lengthToThicknessRatio};function ca(e){var t=K(K({},Pd),{});return function(n){function i(){return Ee(this,i),$e(this,i,arguments)}return Ge(i,n),xe(i,[{key:"getDefinition",value:function(){return{VERTICES:6,VERTEX_SHADER_SOURCE:Gd,FRAGMENT_SHADER_SOURCE:ua,METHOD:WebGLRenderingContext.TRIANGLES,UNIFORMS:Nd,ATTRIBUTES:[{name:"a_positionStart",size:2,type:nt},{name:"a_positionEnd",size:2,type:nt},{name:"a_normal",size:2,type:nt},{name:"a_color",size:4,type:Dr,normalized:!0},{name:"a_id",size:4,type:Dr,normalized:!0},{name:"a_radius",size:1,type:nt}],CONSTANT_ATTRIBUTES:[{name:"a_positionCoef",size:1,type:nt},{name:"a_normalCoef",size:1,type:nt},{name:"a_radiusCoef",size:1,type:nt}],CONSTANT_DATA:[[0,1,0],[0,-1,0],[1,1,1],[1,1,1],[0,-1,0],[1,-1,-1]]}}},{key:"processVisibleItem",value:function(o,a,s,u,l){var c=l.size||1,h=s.x,d=s.y,f=u.x,p=u.y,m=_t(l.color),_=f-h,T=p-d,x=u.size||1,k=_*_+T*T,v=0,b=0;k&&(k=1/Math.sqrt(k),v=-T*k*c,b=_*k*c);var C=this.array;C[a++]=h,C[a++]=d,C[a++]=f,C[a++]=p,C[a++]=v,C[a++]=b,C[a++]=m,C[a++]=o,C[a++]=x}},{key:"setUniforms",value:function(o,a){var s=a.gl,u=a.uniformLocations,l=u.u_matrix,c=u.u_zoomRatio,h=u.u_feather,d=u.u_pixelRatio,f=u.u_correctionRatio,p=u.u_sizeRatio,m=u.u_minEdgeThickness,_=u.u_lengthToThicknessRatio;s.uniformMatrix3fv(l,!1,o.matrix),s.uniform1f(c,o.zoomRatio),s.uniform1f(p,o.sizeRatio),s.uniform1f(f,o.correctionRatio),s.uniform1f(d,o.pixelRatio),s.uniform1f(h,o.antiAliasingFeather),s.uniform1f(m,o.minEdgeThickness),s.uniform1f(_,t.lengthToThicknessRatio)}}])}(Sn)}ca();function Fd(e){return yd([ca(),sa()])}var Id=Fd(),Md=Id,zd=`
attribute vec4 a_id;
attribute vec4 a_color;
attribute vec2 a_normal;
attribute float a_normalCoef;
attribute vec2 a_positionStart;
attribute vec2 a_positionEnd;
attribute float a_positionCoef;

uniform mat3 u_matrix;
uniform float u_sizeRatio;
uniform float u_zoomRatio;
uniform float u_pixelRatio;
uniform float u_correctionRatio;
uniform float u_minEdgeThickness;
uniform float u_feather;

varying vec4 v_color;
varying vec2 v_normal;
varying float v_thickness;
varying float v_feather;

const float bias = 255.0 / 254.0;

void main() {
  float minThickness = u_minEdgeThickness;

  vec2 normal = a_normal * a_normalCoef;
  vec2 position = a_positionStart * (1.0 - a_positionCoef) + a_positionEnd * a_positionCoef;

  float normalLength = length(normal);
  vec2 unitNormal = normal / normalLength;

  // We require edges to be at least "minThickness" pixels thick *on screen*
  // (so we need to compensate the size ratio):
  float pixelsThickness = max(normalLength, minThickness * u_sizeRatio);

  // Then, we need to retrieve the normalized thickness of the edge in the WebGL
  // referential (in a ([0, 1], [0, 1]) space), using our "magic" correction
  // ratio:
  float webGLThickness = pixelsThickness * u_correctionRatio / u_sizeRatio;

  // Here is the proper position of the vertex
  gl_Position = vec4((u_matrix * vec3(position + unitNormal * webGLThickness, 1)).xy, 0, 1);

  // For the fragment shader though, we need a thickness that takes the "magic"
  // correction ratio into account (as in webGLThickness), but so that the
  // antialiasing effect does not depend on the zoom level. So here's yet
  // another thickness version:
  v_thickness = webGLThickness / u_zoomRatio;

  v_normal = unitNormal;

  v_feather = u_feather * u_correctionRatio / u_zoomRatio / u_pixelRatio * 2.0;

  #ifdef PICKING_MODE
  // For picking mode, we use the ID as the color:
  v_color = a_id;
  #else
  // For normal mode, we use the color:
  v_color = a_color;
  #endif

  v_color.a *= bias;
}
`,Od=zd,ha=WebGLRenderingContext,$r=ha.UNSIGNED_BYTE,kt=ha.FLOAT,Ud=["u_matrix","u_zoomRatio","u_sizeRatio","u_correctionRatio","u_pixelRatio","u_feather","u_minEdgeThickness"],Bd=function(e){function t(){return Ee(this,t),$e(this,t,arguments)}return Ge(t,e),xe(t,[{key:"getDefinition",value:function(){return{VERTICES:6,VERTEX_SHADER_SOURCE:Od,FRAGMENT_SHADER_SOURCE:ua,METHOD:WebGLRenderingContext.TRIANGLES,UNIFORMS:Ud,ATTRIBUTES:[{name:"a_positionStart",size:2,type:kt},{name:"a_positionEnd",size:2,type:kt},{name:"a_normal",size:2,type:kt},{name:"a_color",size:4,type:$r,normalized:!0},{name:"a_id",size:4,type:$r,normalized:!0}],CONSTANT_ATTRIBUTES:[{name:"a_positionCoef",size:1,type:kt},{name:"a_normalCoef",size:1,type:kt}],CONSTANT_DATA:[[0,1],[0,-1],[1,1],[1,1],[0,-1],[1,-1]]}}},{key:"processVisibleItem",value:function(i,r,o,a,s){var u=s.size||1,l=o.x,c=o.y,h=a.x,d=a.y,f=_t(s.color),p=h-l,m=d-c,_=p*p+m*m,T=0,x=0;_&&(_=1/Math.sqrt(_),T=-m*_*u,x=p*_*u);var k=this.array;k[r++]=l,k[r++]=c,k[r++]=h,k[r++]=d,k[r++]=T,k[r++]=x,k[r++]=f,k[r++]=i}},{key:"setUniforms",value:function(i,r){var o=r.gl,a=r.uniformLocations,s=a.u_matrix,u=a.u_zoomRatio,l=a.u_feather,c=a.u_pixelRatio,h=a.u_correctionRatio,d=a.u_sizeRatio,f=a.u_minEdgeThickness;o.uniformMatrix3fv(s,!1,i.matrix),o.uniform1f(u,i.zoomRatio),o.uniform1f(d,i.sizeRatio),o.uniform1f(h,i.correctionRatio),o.uniform1f(c,i.pixelRatio),o.uniform1f(l,i.antiAliasingFeather),o.uniform1f(f,i.minEdgeThickness)}}])}(Sn),Ni=function(e){function t(){var n;return Ee(this,t),n=$e(this,t),n.rawEmitter=n,n}return Ge(t,e),xe(t)}(Po.EventEmitter),Wn,Gr;function da(){return Gr||(Gr=1,Wn=function(t){return t!==null&&typeof t=="object"&&typeof t.addUndirectedEdgeWithKey=="function"&&typeof t.dropNode=="function"&&typeof t.multi=="boolean"}),Wn}var Hd=da();const Wd=Xc(Hd);var Vd=function(t){return t},jd=function(t){return t*t},qd=function(t){return t*(2-t)},Xd=function(t){return(t*=2)<1?.5*t*t:-.5*(--t*(t-2)-1)},Yd=function(t){return t*t*t},Kd=function(t){return--t*t*t+1},Zd=function(t){return(t*=2)<1?.5*t*t*t:.5*((t-=2)*t*t+2)},Jd={linear:Vd,quadraticIn:jd,quadraticOut:qd,quadraticInOut:Xd,cubicIn:Yd,cubicOut:Kd,cubicInOut:Zd},Qd={easing:"quadraticInOut",duration:150};function Pe(){return Float32Array.of(1,0,0,0,1,0,0,0,1)}function Qt(e,t,n){return e[0]=t,e[4]=typeof n=="number"?n:t,e}function Nr(e,t){var n=Math.sin(t),i=Math.cos(t);return e[0]=i,e[1]=n,e[3]=-n,e[4]=i,e}function Pr(e,t,n){return e[6]=t,e[7]=n,e}function Ze(e,t){var n=e[0],i=e[1],r=e[2],o=e[3],a=e[4],s=e[5],u=e[6],l=e[7],c=e[8],h=t[0],d=t[1],f=t[2],p=t[3],m=t[4],_=t[5],T=t[6],x=t[7],k=t[8];return e[0]=h*n+d*o+f*u,e[1]=h*i+d*a+f*l,e[2]=h*r+d*s+f*c,e[3]=p*n+m*o+_*u,e[4]=p*i+m*a+_*l,e[5]=p*r+m*s+_*c,e[6]=T*n+x*o+k*u,e[7]=T*i+x*a+k*l,e[8]=T*r+x*s+k*c,e}function fi(e,t){var n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:1,i=e[0],r=e[1],o=e[3],a=e[4],s=e[6],u=e[7],l=t.x,c=t.y;return{x:l*i+c*o+s*n,y:l*r+c*a+u*n}}function ef(e,t){var n=e.height/e.width,i=t.height/t.width;return n<1&&i>1||n>1&&i<1?1:Math.min(Math.max(i,1/i),Math.max(1/n,n))}function St(e,t,n,i,r){var o=e.angle,a=e.ratio,s=e.x,u=e.y,l=t.width,c=t.height,h=Pe(),d=Math.min(l,c)-2*i,f=ef(t,n);return r?(Ze(h,Pr(Pe(),s,u)),Ze(h,Qt(Pe(),a)),Ze(h,Nr(Pe(),o)),Ze(h,Qt(Pe(),l/d/2/f,c/d/2/f))):(Ze(h,Qt(Pe(),2*(d/l)*f,2*(d/c)*f)),Ze(h,Nr(Pe(),-o)),Ze(h,Qt(Pe(),1/a)),Ze(h,Pr(Pe(),-s,-u))),h}function tf(e,t,n){var i=fi(e,{x:Math.cos(t.angle),y:Math.sin(t.angle)},0),r=i.x,o=i.y;return 1/Math.sqrt(Math.pow(r,2)+Math.pow(o,2))/n.width}function nf(e){if(!e.order)return{x:[0,1],y:[0,1]};var t=1/0,n=-1/0,i=1/0,r=-1/0;return e.forEachNode(function(o,a){var s=a.x,u=a.y;s<t&&(t=s),s>n&&(n=s),u<i&&(i=u),u>r&&(r=u)}),{x:[t,n],y:[i,r]}}function rf(e){if(!Wd(e))throw new Error("Sigma: invalid graph instance.");e.forEachNode(function(t,n){if(!Number.isFinite(n.x)||!Number.isFinite(n.y))throw new Error("Sigma: Coordinates of node ".concat(t," are invalid. A node must have a numeric 'x' and 'y' attribute."))})}function of(e,t,n){var i=document.createElement(e);if(t)for(var r in t)i.style[r]=t[r];if(n)for(var o in n)i.setAttribute(o,n[o]);return i}function Fr(){return typeof window.devicePixelRatio<"u"?window.devicePixelRatio:1}function Ir(e,t,n){return n.sort(function(i,r){var o=t(i)||0,a=t(r)||0;return o<a?-1:o>a?1:0})}function Mr(e){var t=vt(e.x,2),n=t[0],i=t[1],r=vt(e.y,2),o=r[0],a=r[1],s=Math.max(i-n,a-o),u=(i+n)/2,l=(a+o)/2;(s===0||Math.abs(s)===1/0||isNaN(s))&&(s=1),isNaN(u)&&(u=0),isNaN(l)&&(l=0);var c=function(d){return{x:.5+(d.x-u)/s,y:.5+(d.y-l)/s}};return c.applyTo=function(h){h.x=.5+(h.x-u)/s,h.y=.5+(h.y-l)/s},c.inverse=function(h){return{x:u+s*(h.x-.5),y:l+s*(h.y-.5)}},c.ratio=s,c}function gi(e){"@babel/helpers - typeof";return gi=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},gi(e)}function zr(e,t){var n=t.size;if(n!==0){var i=e.length;e.length+=n;var r=0;t.forEach(function(o){e[i+r]=o,r++})}}function Vn(e){e=e||{};for(var t=0,n=arguments.length<=1?0:arguments.length-1;t<n;t++){var i=t+1<1||arguments.length<=t+1?void 0:arguments[t+1];i&&Object.assign(e,i)}return e}var Pi={hideEdgesOnMove:!1,hideLabelsOnMove:!1,renderLabels:!0,renderEdgeLabels:!1,enableEdgeEvents:!1,defaultNodeColor:"#999",defaultNodeType:"circle",defaultEdgeColor:"#ccc",defaultEdgeType:"line",labelFont:"Arial",labelSize:14,labelWeight:"normal",labelColor:{color:"#000"},edgeLabelFont:"Arial",edgeLabelSize:14,edgeLabelWeight:"normal",edgeLabelColor:{attribute:"color"},stagePadding:30,defaultDrawEdgeLabel:bd,defaultDrawNodeLabel:ra,defaultDrawNodeHover:wd,minEdgeThickness:1.7,antiAliasingFeather:1,dragTimeout:100,draggedEventsTolerance:3,inertiaDuration:200,inertiaRatio:3,zoomDuration:250,zoomingRatio:1.7,doubleClickTimeout:300,doubleClickZoomingRatio:2.2,doubleClickZoomingDuration:200,tapMoveTolerance:10,zoomToSizeRatioFunction:Math.sqrt,itemSizesReference:"screen",autoRescale:!0,autoCenter:!0,labelDensity:1,labelGridCellSize:100,labelRenderedSizeThreshold:6,nodeReducer:null,edgeReducer:null,zIndex:!1,minCameraRatio:null,maxCameraRatio:null,enableCameraZooming:!0,enableCameraPanning:!0,enableCameraRotation:!0,cameraPanBoundaries:null,allowInvalidContainer:!1,nodeProgramClasses:{},nodeHoverProgramClasses:{},edgeProgramClasses:{}},af={circle:An},sf={arrow:Md,line:Bd};function jn(e){if(typeof e.labelDensity!="number"||e.labelDensity<0)throw new Error("Settings: invalid `labelDensity`. Expecting a positive number.");var t=e.minCameraRatio,n=e.maxCameraRatio;if(typeof t=="number"&&typeof n=="number"&&n<t)throw new Error("Settings: invalid camera ratio boundaries. Expecting `maxCameraRatio` to be greater than `minCameraRatio`.")}function uf(e){var t=Vn({},Pi,e);return t.nodeProgramClasses=Vn({},af,t.nodeProgramClasses),t.edgeProgramClasses=Vn({},sf,t.edgeProgramClasses),t}var en=1.5,Or=function(e){function t(){var n;return Ee(this,t),n=$e(this,t),N(n,"x",.5),N(n,"y",.5),N(n,"angle",0),N(n,"ratio",1),N(n,"minRatio",null),N(n,"maxRatio",null),N(n,"enabledZooming",!0),N(n,"enabledPanning",!0),N(n,"enabledRotation",!0),N(n,"clean",null),N(n,"nextFrame",null),N(n,"previousState",null),N(n,"enabled",!0),n.previousState=n.getState(),n}return Ge(t,e),xe(t,[{key:"enable",value:function(){return this.enabled=!0,this}},{key:"disable",value:function(){return this.enabled=!1,this}},{key:"getState",value:function(){return{x:this.x,y:this.y,angle:this.angle,ratio:this.ratio}}},{key:"hasState",value:function(i){return this.x===i.x&&this.y===i.y&&this.ratio===i.ratio&&this.angle===i.angle}},{key:"getPreviousState",value:function(){var i=this.previousState;return i?{x:i.x,y:i.y,angle:i.angle,ratio:i.ratio}:null}},{key:"getBoundedRatio",value:function(i){var r=i;return typeof this.minRatio=="number"&&(r=Math.max(r,this.minRatio)),typeof this.maxRatio=="number"&&(r=Math.min(r,this.maxRatio)),r}},{key:"validateState",value:function(i){var r={};return this.enabledPanning&&typeof i.x=="number"&&(r.x=i.x),this.enabledPanning&&typeof i.y=="number"&&(r.y=i.y),this.enabledZooming&&typeof i.ratio=="number"&&(r.ratio=this.getBoundedRatio(i.ratio)),this.enabledRotation&&typeof i.angle=="number"&&(r.angle=i.angle),this.clean?this.clean(K(K({},this.getState()),r)):r}},{key:"isAnimated",value:function(){return!!this.nextFrame}},{key:"setState",value:function(i){if(!this.enabled)return this;this.previousState=this.getState();var r=this.validateState(i);return typeof r.x=="number"&&(this.x=r.x),typeof r.y=="number"&&(this.y=r.y),typeof r.ratio=="number"&&(this.ratio=r.ratio),typeof r.angle=="number"&&(this.angle=r.angle),this.hasState(this.previousState)||this.emit("updated",this.getState()),this}},{key:"updateState",value:function(i){return this.setState(i(this.getState())),this}},{key:"animate",value:function(i){var r=this,o=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},a=arguments.length>2?arguments[2]:void 0;if(!a)return new Promise(function(f){return r.animate(i,o,f)});if(this.enabled){var s=K(K({},Qd),o),u=this.validateState(i),l=typeof s.easing=="function"?s.easing:Jd[s.easing],c=Date.now(),h=this.getState(),d=function(){var p=(Date.now()-c)/s.duration;if(p>=1){r.nextFrame=null,r.setState(u),r.animationCallback&&(r.animationCallback.call(null),r.animationCallback=void 0);return}var m=l(p),_={};typeof u.x=="number"&&(_.x=h.x+(u.x-h.x)*m),typeof u.y=="number"&&(_.y=h.y+(u.y-h.y)*m),r.enabledRotation&&typeof u.angle=="number"&&(_.angle=h.angle+(u.angle-h.angle)*m),typeof u.ratio=="number"&&(_.ratio=h.ratio+(u.ratio-h.ratio)*m),r.setState(_),r.nextFrame=requestAnimationFrame(d)};this.nextFrame?(cancelAnimationFrame(this.nextFrame),this.animationCallback&&this.animationCallback.call(null),this.nextFrame=requestAnimationFrame(d)):d(),this.animationCallback=a}}},{key:"animatedZoom",value:function(i){return i?typeof i=="number"?this.animate({ratio:this.ratio/i}):this.animate({ratio:this.ratio/(i.factor||en)},i):this.animate({ratio:this.ratio/en})}},{key:"animatedUnzoom",value:function(i){return i?typeof i=="number"?this.animate({ratio:this.ratio*i}):this.animate({ratio:this.ratio*(i.factor||en)},i):this.animate({ratio:this.ratio*en})}},{key:"animatedReset",value:function(i){return this.animate({x:.5,y:.5,ratio:1,angle:0},i)}},{key:"copy",value:function(){return t.from(this.getState())}}],[{key:"from",value:function(i){var r=new t;return r.setState(i)}}])}(Ni);function Me(e,t){var n=t.getBoundingClientRect();return{x:e.clientX-n.left,y:e.clientY-n.top}}function je(e,t){var n=K(K({},Me(e,t)),{},{sigmaDefaultPrevented:!1,preventSigmaDefault:function(){n.sigmaDefaultPrevented=!0},original:e});return n}function At(e){var t="x"in e?e:K(K({},e.touches[0]||e.previousTouches[0]),{},{original:e.original,sigmaDefaultPrevented:e.sigmaDefaultPrevented,preventSigmaDefault:function(){e.sigmaDefaultPrevented=!0,t.sigmaDefaultPrevented=!0}});return t}function lf(e,t){return K(K({},je(e,t)),{},{delta:fa(e)})}var cf=2;function sn(e){for(var t=[],n=0,i=Math.min(e.length,cf);n<i;n++)t.push(e[n]);return t}function Ct(e,t,n){var i={touches:sn(e.touches).map(function(r){return Me(r,n)}),previousTouches:t.map(function(r){return Me(r,n)}),sigmaDefaultPrevented:!1,preventSigmaDefault:function(){i.sigmaDefaultPrevented=!0},original:e};return i}function fa(e){if(typeof e.deltaY<"u")return e.deltaY*-3/360;if(typeof e.detail<"u")return e.detail/-9;throw new Error("Captor: could not extract delta from event.")}var ga=function(e){function t(n,i){var r;return Ee(this,t),r=$e(this,t),r.container=n,r.renderer=i,r}return Ge(t,e),xe(t)}(Ni),hf=["doubleClickTimeout","doubleClickZoomingDuration","doubleClickZoomingRatio","dragTimeout","draggedEventsTolerance","inertiaDuration","inertiaRatio","zoomDuration","zoomingRatio"],df=hf.reduce(function(e,t){return K(K({},e),{},N({},t,Pi[t]))},{}),ff=function(e){function t(n,i){var r;return Ee(this,t),r=$e(this,t,[n,i]),N(r,"enabled",!0),N(r,"draggedEvents",0),N(r,"downStartTime",null),N(r,"lastMouseX",null),N(r,"lastMouseY",null),N(r,"isMouseDown",!1),N(r,"isMoving",!1),N(r,"movingTimeout",null),N(r,"startCameraState",null),N(r,"clicks",0),N(r,"doubleClickTimeout",null),N(r,"currentWheelDirection",0),N(r,"settings",df),r.handleClick=r.handleClick.bind(r),r.handleRightClick=r.handleRightClick.bind(r),r.handleDown=r.handleDown.bind(r),r.handleUp=r.handleUp.bind(r),r.handleMove=r.handleMove.bind(r),r.handleWheel=r.handleWheel.bind(r),r.handleLeave=r.handleLeave.bind(r),r.handleEnter=r.handleEnter.bind(r),n.addEventListener("click",r.handleClick,{capture:!1}),n.addEventListener("contextmenu",r.handleRightClick,{capture:!1}),n.addEventListener("mousedown",r.handleDown,{capture:!1}),n.addEventListener("wheel",r.handleWheel,{capture:!1}),n.addEventListener("mouseleave",r.handleLeave,{capture:!1}),n.addEventListener("mouseenter",r.handleEnter,{capture:!1}),document.addEventListener("mousemove",r.handleMove,{capture:!1}),document.addEventListener("mouseup",r.handleUp,{capture:!1}),r}return Ge(t,e),xe(t,[{key:"kill",value:function(){var i=this.container;i.removeEventListener("click",this.handleClick),i.removeEventListener("contextmenu",this.handleRightClick),i.removeEventListener("mousedown",this.handleDown),i.removeEventListener("wheel",this.handleWheel),i.removeEventListener("mouseleave",this.handleLeave),i.removeEventListener("mouseenter",this.handleEnter),document.removeEventListener("mousemove",this.handleMove),document.removeEventListener("mouseup",this.handleUp)}},{key:"handleClick",value:function(i){var r=this;if(this.enabled){if(this.clicks++,this.clicks===2)return this.clicks=0,typeof this.doubleClickTimeout=="number"&&(clearTimeout(this.doubleClickTimeout),this.doubleClickTimeout=null),this.handleDoubleClick(i);setTimeout(function(){r.clicks=0,r.doubleClickTimeout=null},this.settings.doubleClickTimeout),this.draggedEvents<this.settings.draggedEventsTolerance&&this.emit("click",je(i,this.container))}}},{key:"handleRightClick",value:function(i){this.enabled&&this.emit("rightClick",je(i,this.container))}},{key:"handleDoubleClick",value:function(i){if(this.enabled){i.preventDefault(),i.stopPropagation();var r=je(i,this.container);if(this.emit("doubleClick",r),!r.sigmaDefaultPrevented){var o=this.renderer.getCamera(),a=o.getBoundedRatio(o.getState().ratio/this.settings.doubleClickZoomingRatio);o.animate(this.renderer.getViewportZoomedState(Me(i,this.container),a),{easing:"quadraticInOut",duration:this.settings.doubleClickZoomingDuration})}}}},{key:"handleDown",value:function(i){if(this.enabled){if(i.button===0){this.startCameraState=this.renderer.getCamera().getState();var r=Me(i,this.container),o=r.x,a=r.y;this.lastMouseX=o,this.lastMouseY=a,this.draggedEvents=0,this.downStartTime=Date.now(),this.isMouseDown=!0}this.emit("mousedown",je(i,this.container))}}},{key:"handleUp",value:function(i){var r=this;if(!(!this.enabled||!this.isMouseDown)){var o=this.renderer.getCamera();this.isMouseDown=!1,typeof this.movingTimeout=="number"&&(clearTimeout(this.movingTimeout),this.movingTimeout=null);var a=Me(i,this.container),s=a.x,u=a.y,l=o.getState(),c=o.getPreviousState()||{x:0,y:0};this.isMoving?o.animate({x:l.x+this.settings.inertiaRatio*(l.x-c.x),y:l.y+this.settings.inertiaRatio*(l.y-c.y)},{duration:this.settings.inertiaDuration,easing:"quadraticOut"}):(this.lastMouseX!==s||this.lastMouseY!==u)&&o.setState({x:l.x,y:l.y}),this.isMoving=!1,setTimeout(function(){var h=r.draggedEvents>0;r.draggedEvents=0,h&&r.renderer.getSetting("hideEdgesOnMove")&&r.renderer.refresh()},0),this.emit("mouseup",je(i,this.container))}}},{key:"handleMove",value:function(i){var r=this;if(this.enabled){var o=je(i,this.container);if(this.emit("mousemovebody",o),(i.target===this.container||i.composedPath()[0]===this.container)&&this.emit("mousemove",o),!o.sigmaDefaultPrevented&&this.isMouseDown){this.isMoving=!0,this.draggedEvents++,typeof this.movingTimeout=="number"&&clearTimeout(this.movingTimeout),this.movingTimeout=window.setTimeout(function(){r.movingTimeout=null,r.isMoving=!1},this.settings.dragTimeout);var a=this.renderer.getCamera(),s=Me(i,this.container),u=s.x,l=s.y,c=this.renderer.viewportToFramedGraph({x:this.lastMouseX,y:this.lastMouseY}),h=this.renderer.viewportToFramedGraph({x:u,y:l}),d=c.x-h.x,f=c.y-h.y,p=a.getState(),m=p.x+d,_=p.y+f;a.setState({x:m,y:_}),this.lastMouseX=u,this.lastMouseY=l,i.preventDefault(),i.stopPropagation()}}}},{key:"handleLeave",value:function(i){this.emit("mouseleave",je(i,this.container))}},{key:"handleEnter",value:function(i){this.emit("mouseenter",je(i,this.container))}},{key:"handleWheel",value:function(i){var r=this,o=this.renderer.getCamera();if(!(!this.enabled||!o.enabledZooming)){var a=fa(i);if(a){var s=lf(i,this.container);if(this.emit("wheel",s),s.sigmaDefaultPrevented){i.preventDefault(),i.stopPropagation();return}var u=o.getState().ratio,l=a>0?1/this.settings.zoomingRatio:this.settings.zoomingRatio,c=o.getBoundedRatio(u*l),h=a>0?1:-1,d=Date.now();u!==c&&(i.preventDefault(),i.stopPropagation(),!(this.currentWheelDirection===h&&this.lastWheelTriggerTime&&d-this.lastWheelTriggerTime<this.settings.zoomDuration/5)&&(o.animate(this.renderer.getViewportZoomedState(Me(i,this.container),c),{easing:"quadraticOut",duration:this.settings.zoomDuration},function(){r.currentWheelDirection=0}),this.currentWheelDirection=h,this.lastWheelTriggerTime=d))}}}},{key:"setSettings",value:function(i){this.settings=i}}])}(ga),gf=["dragTimeout","inertiaDuration","inertiaRatio","doubleClickTimeout","doubleClickZoomingRatio","doubleClickZoomingDuration","tapMoveTolerance"],pf=gf.reduce(function(e,t){return K(K({},e),{},N({},t,Pi[t]))},{}),mf=function(e){function t(n,i){var r;return Ee(this,t),r=$e(this,t,[n,i]),N(r,"enabled",!0),N(r,"isMoving",!1),N(r,"hasMoved",!1),N(r,"touchMode",0),N(r,"startTouchesPositions",[]),N(r,"lastTouches",[]),N(r,"lastTap",null),N(r,"settings",pf),r.handleStart=r.handleStart.bind(r),r.handleLeave=r.handleLeave.bind(r),r.handleMove=r.handleMove.bind(r),n.addEventListener("touchstart",r.handleStart,{capture:!1}),n.addEventListener("touchcancel",r.handleLeave,{capture:!1}),document.addEventListener("touchend",r.handleLeave,{capture:!1,passive:!1}),document.addEventListener("touchmove",r.handleMove,{capture:!1,passive:!1}),r}return Ge(t,e),xe(t,[{key:"kill",value:function(){var i=this.container;i.removeEventListener("touchstart",this.handleStart),i.removeEventListener("touchcancel",this.handleLeave),document.removeEventListener("touchend",this.handleLeave),document.removeEventListener("touchmove",this.handleMove)}},{key:"getDimensions",value:function(){return{width:this.container.offsetWidth,height:this.container.offsetHeight}}},{key:"handleStart",value:function(i){var r=this;if(this.enabled){i.preventDefault();var o=sn(i.touches);if(this.touchMode=o.length,this.startCameraState=this.renderer.getCamera().getState(),this.startTouchesPositions=o.map(function(f){return Me(f,r.container)}),this.touchMode===2){var a=vt(this.startTouchesPositions,2),s=a[0],u=s.x,l=s.y,c=a[1],h=c.x,d=c.y;this.startTouchesAngle=Math.atan2(d-l,h-u),this.startTouchesDistance=Math.sqrt(Math.pow(h-u,2)+Math.pow(d-l,2))}this.emit("touchdown",Ct(i,this.lastTouches,this.container)),this.lastTouches=o,this.lastTouchesPositions=this.startTouchesPositions}}},{key:"handleLeave",value:function(i){if(!(!this.enabled||!this.startTouchesPositions.length)){switch(i.cancelable&&i.preventDefault(),this.movingTimeout&&(this.isMoving=!1,clearTimeout(this.movingTimeout)),this.touchMode){case 2:if(i.touches.length===1){this.handleStart(i),i.preventDefault();break}case 1:if(this.isMoving){var r=this.renderer.getCamera(),o=r.getState(),a=r.getPreviousState()||{x:0,y:0};r.animate({x:o.x+this.settings.inertiaRatio*(o.x-a.x),y:o.y+this.settings.inertiaRatio*(o.y-a.y)},{duration:this.settings.inertiaDuration,easing:"quadraticOut"})}this.hasMoved=!1,this.isMoving=!1,this.touchMode=0;break}if(this.emit("touchup",Ct(i,this.lastTouches,this.container)),!i.touches.length){var s=Me(this.lastTouches[0],this.container),u=this.startTouchesPositions[0],l=Math.pow(s.x-u.x,2)+Math.pow(s.y-u.y,2);if(!i.touches.length&&l<Math.pow(this.settings.tapMoveTolerance,2))if(this.lastTap&&Date.now()-this.lastTap.time<this.settings.doubleClickTimeout){var c=Ct(i,this.lastTouches,this.container);if(this.emit("doubletap",c),this.lastTap=null,!c.sigmaDefaultPrevented){var h=this.renderer.getCamera(),d=h.getBoundedRatio(h.getState().ratio/this.settings.doubleClickZoomingRatio);h.animate(this.renderer.getViewportZoomedState(s,d),{easing:"quadraticInOut",duration:this.settings.doubleClickZoomingDuration})}}else{var f=Ct(i,this.lastTouches,this.container);this.emit("tap",f),this.lastTap={time:Date.now(),position:f.touches[0]||f.previousTouches[0]}}}this.lastTouches=sn(i.touches),this.startTouchesPositions=[]}}},{key:"handleMove",value:function(i){var r=this;if(!(!this.enabled||!this.startTouchesPositions.length)){i.preventDefault();var o=sn(i.touches),a=o.map(function(he){return Me(he,r.container)}),s=this.lastTouches;this.lastTouches=o,this.lastTouchesPositions=a;var u=Ct(i,s,this.container);if(this.emit("touchmove",u),!u.sigmaDefaultPrevented&&(this.hasMoved||(this.hasMoved=a.some(function(he,ue){var X=r.startTouchesPositions[ue];return X&&(he.x!==X.x||he.y!==X.y)})),!!this.hasMoved)){this.isMoving=!0,this.movingTimeout&&clearTimeout(this.movingTimeout),this.movingTimeout=window.setTimeout(function(){r.isMoving=!1},this.settings.dragTimeout);var l=this.renderer.getCamera(),c=this.startCameraState,h=this.renderer.getSetting("stagePadding");switch(this.touchMode){case 1:{var d=this.renderer.viewportToFramedGraph((this.startTouchesPositions||[])[0]),f=d.x,p=d.y,m=this.renderer.viewportToFramedGraph(a[0]),_=m.x,T=m.y;l.setState({x:c.x+f-_,y:c.y+p-T});break}case 2:{var x={x:.5,y:.5,angle:0,ratio:1},k=a[0],v=k.x,b=k.y,C=a[1],R=C.x,B=C.y,I=Math.atan2(B-b,R-v)-this.startTouchesAngle,O=Math.hypot(B-b,R-v)/this.startTouchesDistance,M=l.getBoundedRatio(c.ratio/O);x.ratio=M,x.angle=c.angle+I;var z=this.getDimensions(),g=this.renderer.viewportToFramedGraph((this.startTouchesPositions||[])[0],{cameraState:c}),j=Math.min(z.width,z.height)-2*h,re=j/z.width,D=j/z.height,w=M/j,Q=v-j/2/re,ee=b-j/2/D,oe=[Q*Math.cos(-x.angle)-ee*Math.sin(-x.angle),ee*Math.cos(-x.angle)+Q*Math.sin(-x.angle)];Q=oe[0],ee=oe[1],x.x=g.x-Q*w,x.y=g.y+ee*w,l.setState(x);break}}}}}},{key:"setSettings",value:function(i){this.settings=i}}])}(ga);function vf(e){if(Array.isArray(e))return hi(e)}function yf(e){if(typeof Symbol<"u"&&e[Symbol.iterator]!=null||e["@@iterator"]!=null)return Array.from(e)}function bf(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function Ur(e){return vf(e)||yf(e)||Zo(e)||bf()}function wf(e,t){if(e==null)return{};var n={};for(var i in e)if({}.hasOwnProperty.call(e,i)){if(t.indexOf(i)!==-1)continue;n[i]=e[i]}return n}function qn(e,t){if(e==null)return{};var n,i,r=wf(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(i=0;i<o.length;i++)n=o[i],t.indexOf(n)===-1&&{}.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}var Br=function(){function e(t,n){Ee(this,e),this.key=t,this.size=n}return xe(e,null,[{key:"compare",value:function(n,i){return n.size>i.size?-1:n.size<i.size||n.key>i.key?1:-1}}])}(),Hr=function(){function e(){Ee(this,e),N(this,"width",0),N(this,"height",0),N(this,"cellSize",0),N(this,"columns",0),N(this,"rows",0),N(this,"cells",{})}return xe(e,[{key:"resizeAndClear",value:function(n,i){this.width=n.width,this.height=n.height,this.cellSize=i,this.columns=Math.ceil(n.width/i),this.rows=Math.ceil(n.height/i),this.cells={}}},{key:"getIndex",value:function(n){var i=Math.floor(n.x/this.cellSize),r=Math.floor(n.y/this.cellSize);return r*this.columns+i}},{key:"add",value:function(n,i,r){var o=new Br(n,i),a=this.getIndex(r),s=this.cells[a];s||(s=[],this.cells[a]=s),s.push(o)}},{key:"organize",value:function(){for(var n in this.cells){var i=this.cells[n];i.sort(Br.compare)}}},{key:"getLabelsToDisplay",value:function(n,i){var r=this.cellSize*this.cellSize,o=r/n/n,a=o*i/r,s=Math.ceil(a),u=[];for(var l in this.cells)for(var c=this.cells[l],h=0;h<Math.min(s,c.length);h++)u.push(c[h].key);return u}}])}();function _f(e){var t=e.graph,n=e.hoveredNode,i=e.highlightedNodes,r=e.displayedNodeLabels,o=[];return t.forEachEdge(function(a,s,u,l){(u===n||l===n||i.has(u)||i.has(l)||r.has(u)&&r.has(l))&&o.push(a)}),o}var Ef=150,xf=50,qe=Object.prototype.hasOwnProperty;function Tf(e,t,n){if(!qe.call(n,"x")||!qe.call(n,"y"))throw new Error('Sigma: could not find a valid position (x, y) for node "'.concat(t,'". All your nodes must have a number "x" and "y". Maybe your forgot to apply a layout or your "nodeReducer" is not returning the correct data?'));return n.color||(n.color=e.defaultNodeColor),!n.label&&n.label!==""&&(n.label=null),n.label!==void 0&&n.label!==null?n.label=""+n.label:n.label=null,n.size||(n.size=2),qe.call(n,"hidden")||(n.hidden=!1),qe.call(n,"highlighted")||(n.highlighted=!1),qe.call(n,"forceLabel")||(n.forceLabel=!1),(!n.type||n.type==="")&&(n.type=e.defaultNodeType),n.zIndex||(n.zIndex=0),n}function kf(e,t,n){return n.color||(n.color=e.defaultEdgeColor),n.label||(n.label=""),n.size||(n.size=.5),qe.call(n,"hidden")||(n.hidden=!1),qe.call(n,"forceLabel")||(n.forceLabel=!1),(!n.type||n.type==="")&&(n.type=e.defaultEdgeType),n.zIndex||(n.zIndex=0),n}var Sf=function(e){function t(n,i){var r,o=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};if(Ee(this,t),r=$e(this,t),N(r,"elements",{}),N(r,"canvasContexts",{}),N(r,"webGLContexts",{}),N(r,"pickingLayers",new Set),N(r,"textures",{}),N(r,"frameBuffers",{}),N(r,"activeListeners",{}),N(r,"labelGrid",new Hr),N(r,"nodeDataCache",{}),N(r,"edgeDataCache",{}),N(r,"nodeProgramIndex",{}),N(r,"edgeProgramIndex",{}),N(r,"nodesWithForcedLabels",new Set),N(r,"edgesWithForcedLabels",new Set),N(r,"nodeExtent",{x:[0,1],y:[0,1]}),N(r,"nodeZExtent",[1/0,-1/0]),N(r,"edgeZExtent",[1/0,-1/0]),N(r,"matrix",Pe()),N(r,"invMatrix",Pe()),N(r,"correctionRatio",1),N(r,"customBBox",null),N(r,"normalizationFunction",Mr({x:[0,1],y:[0,1]})),N(r,"graphToViewportRatio",1),N(r,"itemIDsIndex",{}),N(r,"nodeIndices",{}),N(r,"edgeIndices",{}),N(r,"width",0),N(r,"height",0),N(r,"pixelRatio",Fr()),N(r,"pickingDownSizingRatio",2*r.pixelRatio),N(r,"displayedNodeLabels",new Set),N(r,"displayedEdgeLabels",new Set),N(r,"highlightedNodes",new Set),N(r,"hoveredNode",null),N(r,"hoveredEdge",null),N(r,"renderFrame",null),N(r,"renderHighlightedNodesFrame",null),N(r,"needToProcess",!1),N(r,"checkEdgesEventsFrame",null),N(r,"nodePrograms",{}),N(r,"nodeHoverPrograms",{}),N(r,"edgePrograms",{}),r.settings=uf(o),jn(r.settings),rf(n),!(i instanceof HTMLElement))throw new Error("Sigma: container should be an html element.");r.graph=n,r.container=i,r.createWebGLContext("edges",{picking:o.enableEdgeEvents}),r.createCanvasContext("edgeLabels"),r.createWebGLContext("nodes",{picking:!0}),r.createCanvasContext("labels"),r.createCanvasContext("hovers"),r.createWebGLContext("hoverNodes"),r.createCanvasContext("mouse",{style:{touchAction:"none",userSelect:"none"}}),r.resize();for(var a in r.settings.nodeProgramClasses)r.registerNodeProgram(a,r.settings.nodeProgramClasses[a],r.settings.nodeHoverProgramClasses[a]);for(var s in r.settings.edgeProgramClasses)r.registerEdgeProgram(s,r.settings.edgeProgramClasses[s]);return r.camera=new Or,r.bindCameraHandlers(),r.mouseCaptor=new ff(r.elements.mouse,r),r.mouseCaptor.setSettings(r.settings),r.touchCaptor=new mf(r.elements.mouse,r),r.touchCaptor.setSettings(r.settings),r.bindEventHandlers(),r.bindGraphHandlers(),r.handleSettingsUpdate(),r.refresh(),r}return Ge(t,e),xe(t,[{key:"registerNodeProgram",value:function(i,r,o){return this.nodePrograms[i]&&this.nodePrograms[i].kill(),this.nodeHoverPrograms[i]&&this.nodeHoverPrograms[i].kill(),this.nodePrograms[i]=new r(this.webGLContexts.nodes,this.frameBuffers.nodes,this),this.nodeHoverPrograms[i]=new(o||r)(this.webGLContexts.hoverNodes,null,this),this}},{key:"registerEdgeProgram",value:function(i,r){return this.edgePrograms[i]&&this.edgePrograms[i].kill(),this.edgePrograms[i]=new r(this.webGLContexts.edges,this.frameBuffers.edges,this),this}},{key:"unregisterNodeProgram",value:function(i){if(this.nodePrograms[i]){var r=this.nodePrograms,o=r[i],a=qn(r,[i].map(Ft));o.kill(),this.nodePrograms=a}if(this.nodeHoverPrograms[i]){var s=this.nodeHoverPrograms,u=s[i],l=qn(s,[i].map(Ft));u.kill(),this.nodePrograms=l}return this}},{key:"unregisterEdgeProgram",value:function(i){if(this.edgePrograms[i]){var r=this.edgePrograms,o=r[i],a=qn(r,[i].map(Ft));o.kill(),this.edgePrograms=a}return this}},{key:"resetWebGLTexture",value:function(i){var r=this.webGLContexts[i],o=this.frameBuffers[i],a=this.textures[i];a&&r.deleteTexture(a);var s=r.createTexture();return r.bindFramebuffer(r.FRAMEBUFFER,o),r.bindTexture(r.TEXTURE_2D,s),r.texImage2D(r.TEXTURE_2D,0,r.RGBA,this.width,this.height,0,r.RGBA,r.UNSIGNED_BYTE,null),r.framebufferTexture2D(r.FRAMEBUFFER,r.COLOR_ATTACHMENT0,r.TEXTURE_2D,s,0),this.textures[i]=s,this}},{key:"bindCameraHandlers",value:function(){var i=this;return this.activeListeners.camera=function(){i.scheduleRender()},this.camera.on("updated",this.activeListeners.camera),this}},{key:"unbindCameraHandlers",value:function(){return this.camera.removeListener("updated",this.activeListeners.camera),this}},{key:"getNodeAtPosition",value:function(i){var r=i.x,o=i.y,a=kr(this.webGLContexts.nodes,this.frameBuffers.nodes,r,o,this.pixelRatio,this.pickingDownSizingRatio),s=Tr.apply(void 0,Ur(a)),u=this.itemIDsIndex[s];return u&&u.type==="node"?u.id:null}},{key:"bindEventHandlers",value:function(){var i=this;this.activeListeners.handleResize=function(){i.scheduleRefresh()},window.addEventListener("resize",this.activeListeners.handleResize),this.activeListeners.handleMove=function(o){var a=At(o),s={event:a,preventSigmaDefault:function(){a.preventSigmaDefault()}},u=i.getNodeAtPosition(a);if(u&&i.hoveredNode!==u&&!i.nodeDataCache[u].hidden){i.hoveredNode&&i.emit("leaveNode",K(K({},s),{},{node:i.hoveredNode})),i.hoveredNode=u,i.emit("enterNode",K(K({},s),{},{node:u})),i.scheduleHighlightedNodesRender();return}if(i.hoveredNode&&i.getNodeAtPosition(a)!==i.hoveredNode){var l=i.hoveredNode;i.hoveredNode=null,i.emit("leaveNode",K(K({},s),{},{node:l})),i.scheduleHighlightedNodesRender();return}if(i.settings.enableEdgeEvents){var c=i.hoveredNode?null:i.getEdgeAtPoint(s.event.x,s.event.y);c!==i.hoveredEdge&&(i.hoveredEdge&&i.emit("leaveEdge",K(K({},s),{},{edge:i.hoveredEdge})),c&&i.emit("enterEdge",K(K({},s),{},{edge:c})),i.hoveredEdge=c)}},this.activeListeners.handleMoveBody=function(o){var a=At(o);i.emit("moveBody",{event:a,preventSigmaDefault:function(){a.preventSigmaDefault()}})},this.activeListeners.handleLeave=function(o){var a=At(o),s={event:a,preventSigmaDefault:function(){a.preventSigmaDefault()}};i.hoveredNode&&(i.emit("leaveNode",K(K({},s),{},{node:i.hoveredNode})),i.scheduleHighlightedNodesRender()),i.settings.enableEdgeEvents&&i.hoveredEdge&&(i.emit("leaveEdge",K(K({},s),{},{edge:i.hoveredEdge})),i.scheduleHighlightedNodesRender()),i.emit("leaveStage",K({},s))},this.activeListeners.handleEnter=function(o){var a=At(o),s={event:a,preventSigmaDefault:function(){a.preventSigmaDefault()}};i.emit("enterStage",K({},s))};var r=function(a){return function(s){var u=At(s),l={event:u,preventSigmaDefault:function(){u.preventSigmaDefault()}},c=i.getNodeAtPosition(u);if(c)return i.emit("".concat(a,"Node"),K(K({},l),{},{node:c}));if(i.settings.enableEdgeEvents){var h=i.getEdgeAtPoint(u.x,u.y);if(h)return i.emit("".concat(a,"Edge"),K(K({},l),{},{edge:h}))}return i.emit("".concat(a,"Stage"),l)}};return this.activeListeners.handleClick=r("click"),this.activeListeners.handleRightClick=r("rightClick"),this.activeListeners.handleDoubleClick=r("doubleClick"),this.activeListeners.handleWheel=r("wheel"),this.activeListeners.handleDown=r("down"),this.activeListeners.handleUp=r("up"),this.mouseCaptor.on("mousemove",this.activeListeners.handleMove),this.mouseCaptor.on("mousemovebody",this.activeListeners.handleMoveBody),this.mouseCaptor.on("click",this.activeListeners.handleClick),this.mouseCaptor.on("rightClick",this.activeListeners.handleRightClick),this.mouseCaptor.on("doubleClick",this.activeListeners.handleDoubleClick),this.mouseCaptor.on("wheel",this.activeListeners.handleWheel),this.mouseCaptor.on("mousedown",this.activeListeners.handleDown),this.mouseCaptor.on("mouseup",this.activeListeners.handleUp),this.mouseCaptor.on("mouseleave",this.activeListeners.handleLeave),this.mouseCaptor.on("mouseenter",this.activeListeners.handleEnter),this.touchCaptor.on("touchdown",this.activeListeners.handleDown),this.touchCaptor.on("touchdown",this.activeListeners.handleMove),this.touchCaptor.on("touchup",this.activeListeners.handleUp),this.touchCaptor.on("touchmove",this.activeListeners.handleMove),this.touchCaptor.on("tap",this.activeListeners.handleClick),this.touchCaptor.on("doubletap",this.activeListeners.handleDoubleClick),this.touchCaptor.on("touchmove",this.activeListeners.handleMoveBody),this}},{key:"bindGraphHandlers",value:function(){var i=this,r=this.graph,o=new Set(["x","y","zIndex","type"]);return this.activeListeners.eachNodeAttributesUpdatedGraphUpdate=function(a){var s,u=(s=a.hints)===null||s===void 0?void 0:s.attributes;i.graph.forEachNode(function(c){return i.updateNode(c)});var l=!u||u.some(function(c){return o.has(c)});i.refresh({partialGraph:{nodes:r.nodes()},skipIndexation:!l,schedule:!0})},this.activeListeners.eachEdgeAttributesUpdatedGraphUpdate=function(a){var s,u=(s=a.hints)===null||s===void 0?void 0:s.attributes;i.graph.forEachEdge(function(c){return i.updateEdge(c)});var l=u&&["zIndex","type"].some(function(c){return u==null?void 0:u.includes(c)});i.refresh({partialGraph:{edges:r.edges()},skipIndexation:!l,schedule:!0})},this.activeListeners.addNodeGraphUpdate=function(a){var s=a.key;i.addNode(s),i.refresh({partialGraph:{nodes:[s]},skipIndexation:!1,schedule:!0})},this.activeListeners.updateNodeGraphUpdate=function(a){var s=a.key;i.refresh({partialGraph:{nodes:[s]},skipIndexation:!1,schedule:!0})},this.activeListeners.dropNodeGraphUpdate=function(a){var s=a.key;i.removeNode(s),i.refresh({schedule:!0})},this.activeListeners.addEdgeGraphUpdate=function(a){var s=a.key;i.addEdge(s),i.refresh({partialGraph:{edges:[s]},schedule:!0})},this.activeListeners.updateEdgeGraphUpdate=function(a){var s=a.key;i.refresh({partialGraph:{edges:[s]},skipIndexation:!1,schedule:!0})},this.activeListeners.dropEdgeGraphUpdate=function(a){var s=a.key;i.removeEdge(s),i.refresh({schedule:!0})},this.activeListeners.clearEdgesGraphUpdate=function(){i.clearEdgeState(),i.clearEdgeIndices(),i.refresh({schedule:!0})},this.activeListeners.clearGraphUpdate=function(){i.clearEdgeState(),i.clearNodeState(),i.clearEdgeIndices(),i.clearNodeIndices(),i.refresh({schedule:!0})},r.on("nodeAdded",this.activeListeners.addNodeGraphUpdate),r.on("nodeDropped",this.activeListeners.dropNodeGraphUpdate),r.on("nodeAttributesUpdated",this.activeListeners.updateNodeGraphUpdate),r.on("eachNodeAttributesUpdated",this.activeListeners.eachNodeAttributesUpdatedGraphUpdate),r.on("edgeAdded",this.activeListeners.addEdgeGraphUpdate),r.on("edgeDropped",this.activeListeners.dropEdgeGraphUpdate),r.on("edgeAttributesUpdated",this.activeListeners.updateEdgeGraphUpdate),r.on("eachEdgeAttributesUpdated",this.activeListeners.eachEdgeAttributesUpdatedGraphUpdate),r.on("edgesCleared",this.activeListeners.clearEdgesGraphUpdate),r.on("cleared",this.activeListeners.clearGraphUpdate),this}},{key:"unbindGraphHandlers",value:function(){var i=this.graph;i.removeListener("nodeAdded",this.activeListeners.addNodeGraphUpdate),i.removeListener("nodeDropped",this.activeListeners.dropNodeGraphUpdate),i.removeListener("nodeAttributesUpdated",this.activeListeners.updateNodeGraphUpdate),i.removeListener("eachNodeAttributesUpdated",this.activeListeners.eachNodeAttributesUpdatedGraphUpdate),i.removeListener("edgeAdded",this.activeListeners.addEdgeGraphUpdate),i.removeListener("edgeDropped",this.activeListeners.dropEdgeGraphUpdate),i.removeListener("edgeAttributesUpdated",this.activeListeners.updateEdgeGraphUpdate),i.removeListener("eachEdgeAttributesUpdated",this.activeListeners.eachEdgeAttributesUpdatedGraphUpdate),i.removeListener("edgesCleared",this.activeListeners.clearEdgesGraphUpdate),i.removeListener("cleared",this.activeListeners.clearGraphUpdate)}},{key:"getEdgeAtPoint",value:function(i,r){var o=kr(this.webGLContexts.edges,this.frameBuffers.edges,i,r,this.pixelRatio,this.pickingDownSizingRatio),a=Tr.apply(void 0,Ur(o)),s=this.itemIDsIndex[a];return s&&s.type==="edge"?s.id:null}},{key:"process",value:function(){var i=this;this.emit("beforeProcess");var r=this.graph,o=this.settings,a=this.getDimensions();if(this.nodeExtent=nf(this.graph),!this.settings.autoRescale){var s=a.width,u=a.height,l=this.nodeExtent,c=l.x,h=l.y;this.nodeExtent={x:[(c[0]+c[1])/2-s/2,(c[0]+c[1])/2+s/2],y:[(h[0]+h[1])/2-u/2,(h[0]+h[1])/2+u/2]}}this.normalizationFunction=Mr(this.customBBox||this.nodeExtent);var d=new Or,f=St(d.getState(),a,this.getGraphDimensions(),this.getStagePadding());this.labelGrid.resizeAndClear(a,o.labelGridCellSize);for(var p={},m={},_={},T={},x=1,k=r.nodes(),v=0,b=k.length;v<b;v++){var C=k[v],R=this.nodeDataCache[C],B=r.getNodeAttributes(C);R.x=B.x,R.y=B.y,this.normalizationFunction.applyTo(R),typeof R.label=="string"&&!R.hidden&&this.labelGrid.add(C,R.size,this.framedGraphToViewport(R,{matrix:f})),p[R.type]=(p[R.type]||0)+1}this.labelGrid.organize();for(var I in this.nodePrograms){if(!qe.call(this.nodePrograms,I))throw new Error('Sigma: could not find a suitable program for node type "'.concat(I,'"!'));this.nodePrograms[I].reallocate(p[I]||0),p[I]=0}this.settings.zIndex&&this.nodeZExtent[0]!==this.nodeZExtent[1]&&(k=Ir(this.nodeZExtent,function(de){return i.nodeDataCache[de].zIndex},k));for(var O=0,M=k.length;O<M;O++){var z=k[O];m[z]=x,T[m[z]]={type:"node",id:z},x++;var g=this.nodeDataCache[z];this.addNodeToProgram(z,m[z],p[g.type]++)}for(var j={},re=r.edges(),D=0,w=re.length;D<w;D++){var Q=re[D],ee=this.edgeDataCache[Q];j[ee.type]=(j[ee.type]||0)+1}this.settings.zIndex&&this.edgeZExtent[0]!==this.edgeZExtent[1]&&(re=Ir(this.edgeZExtent,function(de){return i.edgeDataCache[de].zIndex},re));for(var oe in this.edgePrograms){if(!qe.call(this.edgePrograms,oe))throw new Error('Sigma: could not find a suitable program for edge type "'.concat(oe,'"!'));this.edgePrograms[oe].reallocate(j[oe]||0),j[oe]=0}for(var he=0,ue=re.length;he<ue;he++){var X=re[he];_[X]=x,T[_[X]]={type:"edge",id:X},x++;var Te=this.edgeDataCache[X];this.addEdgeToProgram(X,_[X],j[Te.type]++)}return this.itemIDsIndex=T,this.nodeIndices=m,this.edgeIndices=_,this.emit("afterProcess"),this}},{key:"handleSettingsUpdate",value:function(i){var r=this,o=this.settings;if(this.camera.minRatio=o.minCameraRatio,this.camera.maxRatio=o.maxCameraRatio,this.camera.enabledZooming=o.enableCameraZooming,this.camera.enabledPanning=o.enableCameraPanning,this.camera.enabledRotation=o.enableCameraRotation,o.cameraPanBoundaries?this.camera.clean=function(c){return r.cleanCameraState(c,o.cameraPanBoundaries&&gi(o.cameraPanBoundaries)==="object"?o.cameraPanBoundaries:{})}:this.camera.clean=null,this.camera.setState(this.camera.validateState(this.camera.getState())),i){if(i.edgeProgramClasses!==o.edgeProgramClasses){for(var a in o.edgeProgramClasses)o.edgeProgramClasses[a]!==i.edgeProgramClasses[a]&&this.registerEdgeProgram(a,o.edgeProgramClasses[a]);for(var s in i.edgeProgramClasses)o.edgeProgramClasses[s]||this.unregisterEdgeProgram(s)}if(i.nodeProgramClasses!==o.nodeProgramClasses||i.nodeHoverProgramClasses!==o.nodeHoverProgramClasses){for(var u in o.nodeProgramClasses)(o.nodeProgramClasses[u]!==i.nodeProgramClasses[u]||o.nodeHoverProgramClasses[u]!==i.nodeHoverProgramClasses[u])&&this.registerNodeProgram(u,o.nodeProgramClasses[u],o.nodeHoverProgramClasses[u]);for(var l in i.nodeProgramClasses)o.nodeProgramClasses[l]||this.unregisterNodeProgram(l)}}return this.mouseCaptor.setSettings(this.settings),this.touchCaptor.setSettings(this.settings),this}},{key:"cleanCameraState",value:function(i){var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},o=r.tolerance,a=o===void 0?0:o,s=r.boundaries,u=K({},i),l=s||this.nodeExtent,c=vt(l.x,2),h=c[0],d=c[1],f=vt(l.y,2),p=f[0],m=f[1],_=[this.graphToViewport({x:h,y:p},{cameraState:i}),this.graphToViewport({x:d,y:p},{cameraState:i}),this.graphToViewport({x:h,y:m},{cameraState:i}),this.graphToViewport({x:d,y:m},{cameraState:i})],T=1/0,x=-1/0,k=1/0,v=-1/0;_.forEach(function(j){var re=j.x,D=j.y;T=Math.min(T,re),x=Math.max(x,re),k=Math.min(k,D),v=Math.max(v,D)});var b=x-T,C=v-k,R=this.getDimensions(),B=R.width,I=R.height,O=0,M=0;if(b>=B?x<B-a?O=x-(B-a):T>a&&(O=T-a):x>B+a?O=x-(B+a):T<-a&&(O=T+a),C>=I?v<I-a?M=v-(I-a):k>a&&(M=k-a):v>I+a?M=v-(I+a):k<-a&&(M=k+a),O||M){var z=this.viewportToFramedGraph({x:0,y:0},{cameraState:i}),g=this.viewportToFramedGraph({x:O,y:M},{cameraState:i});O=g.x-z.x,M=g.y-z.y,u.x+=O,u.y+=M}return u}},{key:"renderLabels",value:function(){if(!this.settings.renderLabels)return this;var i=this.camera.getState(),r=this.labelGrid.getLabelsToDisplay(i.ratio,this.settings.labelDensity);zr(r,this.nodesWithForcedLabels),this.displayedNodeLabels=new Set;for(var o=this.canvasContexts.labels,a=0,s=r.length;a<s;a++){var u=r[a],l=this.nodeDataCache[u];if(!this.displayedNodeLabels.has(u)&&!l.hidden){var c=this.framedGraphToViewport(l),h=c.x,d=c.y,f=this.scaleSize(l.size);if(!(!l.forceLabel&&f<this.settings.labelRenderedSizeThreshold)&&!(h<-150||h>this.width+Ef||d<-50||d>this.height+xf)){this.displayedNodeLabels.add(u);var p=this.settings.defaultDrawNodeLabel,m=this.nodePrograms[l.type],_=(m==null?void 0:m.drawLabel)||p;_(o,K(K({key:u},l),{},{size:f,x:h,y:d}),this.settings)}}}return this}},{key:"renderEdgeLabels",value:function(){if(!this.settings.renderEdgeLabels)return this;var i=this.canvasContexts.edgeLabels;i.clearRect(0,0,this.width,this.height);var r=_f({graph:this.graph,hoveredNode:this.hoveredNode,displayedNodeLabels:this.displayedNodeLabels,highlightedNodes:this.highlightedNodes});zr(r,this.edgesWithForcedLabels);for(var o=new Set,a=0,s=r.length;a<s;a++){var u=r[a],l=this.graph.extremities(u),c=this.nodeDataCache[l[0]],h=this.nodeDataCache[l[1]],d=this.edgeDataCache[u];if(!o.has(u)&&!(d.hidden||c.hidden||h.hidden)){var f=this.settings.defaultDrawEdgeLabel,p=this.edgePrograms[d.type],m=(p==null?void 0:p.drawLabel)||f;m(i,K(K({key:u},d),{},{size:this.scaleSize(d.size)}),K(K(K({key:l[0]},c),this.framedGraphToViewport(c)),{},{size:this.scaleSize(c.size)}),K(K(K({key:l[1]},h),this.framedGraphToViewport(h)),{},{size:this.scaleSize(h.size)}),this.settings),o.add(u)}}return this.displayedEdgeLabels=o,this}},{key:"renderHighlightedNodes",value:function(){var i=this,r=this.canvasContexts.hovers;r.clearRect(0,0,this.width,this.height);var o=function(f){var p=i.nodeDataCache[f],m=i.framedGraphToViewport(p),_=m.x,T=m.y,x=i.scaleSize(p.size),k=i.settings.defaultDrawNodeHover,v=i.nodePrograms[p.type],b=(v==null?void 0:v.drawHover)||k;b(r,K(K({key:f},p),{},{size:x,x:_,y:T}),i.settings)},a=[];this.hoveredNode&&!this.nodeDataCache[this.hoveredNode].hidden&&a.push(this.hoveredNode),this.highlightedNodes.forEach(function(d){d!==i.hoveredNode&&a.push(d)}),a.forEach(function(d){return o(d)});var s={};a.forEach(function(d){var f=i.nodeDataCache[d].type;s[f]=(s[f]||0)+1});for(var u in this.nodeHoverPrograms)this.nodeHoverPrograms[u].reallocate(s[u]||0),s[u]=0;a.forEach(function(d){var f=i.nodeDataCache[d];i.nodeHoverPrograms[f.type].process(0,s[f.type]++,f)}),this.webGLContexts.hoverNodes.clear(this.webGLContexts.hoverNodes.COLOR_BUFFER_BIT);var l=this.getRenderParams();for(var c in this.nodeHoverPrograms){var h=this.nodeHoverPrograms[c];h.render(l)}}},{key:"scheduleHighlightedNodesRender",value:function(){var i=this;this.renderHighlightedNodesFrame||this.renderFrame||(this.renderHighlightedNodesFrame=requestAnimationFrame(function(){i.renderHighlightedNodesFrame=null,i.renderHighlightedNodes(),i.renderEdgeLabels()}))}},{key:"render",value:function(){var i=this;this.emit("beforeRender");var r=function(){return i.emit("afterRender"),i};if(this.renderFrame&&(cancelAnimationFrame(this.renderFrame),this.renderFrame=null),this.resize(),this.needToProcess&&this.process(),this.needToProcess=!1,this.clear(),this.pickingLayers.forEach(function(_){return i.resetWebGLTexture(_)}),!this.graph.order)return r();var o=this.mouseCaptor,a=this.camera.isAnimated()||o.isMoving||o.draggedEvents||o.currentWheelDirection,s=this.camera.getState(),u=this.getDimensions(),l=this.getGraphDimensions(),c=this.getStagePadding();this.matrix=St(s,u,l,c),this.invMatrix=St(s,u,l,c,!0),this.correctionRatio=tf(this.matrix,s,u),this.graphToViewportRatio=this.getGraphToViewportRatio();var h=this.getRenderParams();for(var d in this.nodePrograms){var f=this.nodePrograms[d];f.render(h)}if(!this.settings.hideEdgesOnMove||!a)for(var p in this.edgePrograms){var m=this.edgePrograms[p];m.render(h)}return this.settings.hideLabelsOnMove&&a||(this.renderLabels(),this.renderEdgeLabels(),this.renderHighlightedNodes()),r()}},{key:"addNode",value:function(i){var r=Object.assign({},this.graph.getNodeAttributes(i));this.settings.nodeReducer&&(r=this.settings.nodeReducer(i,r));var o=Tf(this.settings,i,r);this.nodeDataCache[i]=o,this.nodesWithForcedLabels.delete(i),o.forceLabel&&!o.hidden&&this.nodesWithForcedLabels.add(i),this.highlightedNodes.delete(i),o.highlighted&&!o.hidden&&this.highlightedNodes.add(i),this.settings.zIndex&&(o.zIndex<this.nodeZExtent[0]&&(this.nodeZExtent[0]=o.zIndex),o.zIndex>this.nodeZExtent[1]&&(this.nodeZExtent[1]=o.zIndex))}},{key:"updateNode",value:function(i){this.addNode(i);var r=this.nodeDataCache[i];this.normalizationFunction.applyTo(r)}},{key:"removeNode",value:function(i){delete this.nodeDataCache[i],delete this.nodeProgramIndex[i],this.highlightedNodes.delete(i),this.hoveredNode===i&&(this.hoveredNode=null),this.nodesWithForcedLabels.delete(i)}},{key:"addEdge",value:function(i){var r=Object.assign({},this.graph.getEdgeAttributes(i));this.settings.edgeReducer&&(r=this.settings.edgeReducer(i,r));var o=kf(this.settings,i,r);this.edgeDataCache[i]=o,this.edgesWithForcedLabels.delete(i),o.forceLabel&&!o.hidden&&this.edgesWithForcedLabels.add(i),this.settings.zIndex&&(o.zIndex<this.edgeZExtent[0]&&(this.edgeZExtent[0]=o.zIndex),o.zIndex>this.edgeZExtent[1]&&(this.edgeZExtent[1]=o.zIndex))}},{key:"updateEdge",value:function(i){this.addEdge(i)}},{key:"removeEdge",value:function(i){delete this.edgeDataCache[i],delete this.edgeProgramIndex[i],this.hoveredEdge===i&&(this.hoveredEdge=null),this.edgesWithForcedLabels.delete(i)}},{key:"clearNodeIndices",value:function(){this.labelGrid=new Hr,this.nodeExtent={x:[0,1],y:[0,1]},this.nodeDataCache={},this.edgeProgramIndex={},this.nodesWithForcedLabels=new Set,this.nodeZExtent=[1/0,-1/0],this.highlightedNodes=new Set}},{key:"clearEdgeIndices",value:function(){this.edgeDataCache={},this.edgeProgramIndex={},this.edgesWithForcedLabels=new Set,this.edgeZExtent=[1/0,-1/0]}},{key:"clearIndices",value:function(){this.clearEdgeIndices(),this.clearNodeIndices()}},{key:"clearNodeState",value:function(){this.displayedNodeLabels=new Set,this.highlightedNodes=new Set,this.hoveredNode=null}},{key:"clearEdgeState",value:function(){this.displayedEdgeLabels=new Set,this.highlightedNodes=new Set,this.hoveredEdge=null}},{key:"clearState",value:function(){this.clearEdgeState(),this.clearNodeState()}},{key:"addNodeToProgram",value:function(i,r,o){var a=this.nodeDataCache[i],s=this.nodePrograms[a.type];if(!s)throw new Error('Sigma: could not find a suitable program for node type "'.concat(a.type,'"!'));s.process(r,o,a),this.nodeProgramIndex[i]=o}},{key:"addEdgeToProgram",value:function(i,r,o){var a=this.edgeDataCache[i],s=this.edgePrograms[a.type];if(!s)throw new Error('Sigma: could not find a suitable program for edge type "'.concat(a.type,'"!'));var u=this.graph.extremities(i),l=this.nodeDataCache[u[0]],c=this.nodeDataCache[u[1]];s.process(r,o,l,c,a),this.edgeProgramIndex[i]=o}},{key:"getRenderParams",value:function(){return{matrix:this.matrix,invMatrix:this.invMatrix,width:this.width,height:this.height,pixelRatio:this.pixelRatio,zoomRatio:this.camera.ratio,cameraAngle:this.camera.angle,sizeRatio:1/this.scaleSize(),correctionRatio:this.correctionRatio,downSizingRatio:this.pickingDownSizingRatio,minEdgeThickness:this.settings.minEdgeThickness,antiAliasingFeather:this.settings.antiAliasingFeather}}},{key:"getStagePadding",value:function(){var i=this.settings,r=i.stagePadding,o=i.autoRescale;return o&&r||0}},{key:"createLayer",value:function(i,r){var o=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};if(this.elements[i])throw new Error('Sigma: a layer named "'.concat(i,'" already exists'));var a=of(r,{position:"absolute"},{class:"sigma-".concat(i)});return o.style&&Object.assign(a.style,o.style),this.elements[i]=a,"beforeLayer"in o&&o.beforeLayer?this.elements[o.beforeLayer].before(a):"afterLayer"in o&&o.afterLayer?this.elements[o.afterLayer].after(a):this.container.appendChild(a),a}},{key:"createCanvas",value:function(i){var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return this.createLayer(i,"canvas",r)}},{key:"createCanvasContext",value:function(i){var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},o=this.createCanvas(i,r),a={preserveDrawingBuffer:!1,antialias:!1};return this.canvasContexts[i]=o.getContext("2d",a),this}},{key:"createWebGLContext",value:function(i){var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},o=(r==null?void 0:r.canvas)||this.createCanvas(i,r);r.hidden&&o.remove();var a=K({preserveDrawingBuffer:!1,antialias:!1},r),s;s=o.getContext("webgl2",a),s||(s=o.getContext("webgl",a)),s||(s=o.getContext("experimental-webgl",a));var u=s;if(this.webGLContexts[i]=u,u.blendFunc(u.ONE,u.ONE_MINUS_SRC_ALPHA),r.picking){this.pickingLayers.add(i);var l=u.createFramebuffer();if(!l)throw new Error("Sigma: cannot create a new frame buffer for layer ".concat(i));this.frameBuffers[i]=l}return u}},{key:"killLayer",value:function(i){var r=this.elements[i];if(!r)throw new Error("Sigma: cannot kill layer ".concat(i,", which does not exist"));if(this.webGLContexts[i]){var o,a=this.webGLContexts[i];(o=a.getExtension("WEBGL_lose_context"))===null||o===void 0||o.loseContext(),delete this.webGLContexts[i]}else this.canvasContexts[i]&&delete this.canvasContexts[i];return r.remove(),delete this.elements[i],this}},{key:"getCamera",value:function(){return this.camera}},{key:"setCamera",value:function(i){this.unbindCameraHandlers(),this.camera=i,this.bindCameraHandlers()}},{key:"getContainer",value:function(){return this.container}},{key:"getGraph",value:function(){return this.graph}},{key:"setGraph",value:function(i){i!==this.graph&&(this.hoveredNode&&!i.hasNode(this.hoveredNode)&&(this.hoveredNode=null),this.hoveredEdge&&!i.hasEdge(this.hoveredEdge)&&(this.hoveredEdge=null),this.unbindGraphHandlers(),this.checkEdgesEventsFrame!==null&&(cancelAnimationFrame(this.checkEdgesEventsFrame),this.checkEdgesEventsFrame=null),this.graph=i,this.bindGraphHandlers(),this.refresh())}},{key:"getMouseCaptor",value:function(){return this.mouseCaptor}},{key:"getTouchCaptor",value:function(){return this.touchCaptor}},{key:"getDimensions",value:function(){return{width:this.width,height:this.height}}},{key:"getGraphDimensions",value:function(){var i=this.customBBox||this.nodeExtent;return{width:i.x[1]-i.x[0]||1,height:i.y[1]-i.y[0]||1}}},{key:"getNodeDisplayData",value:function(i){var r=this.nodeDataCache[i];return r?Object.assign({},r):void 0}},{key:"getEdgeDisplayData",value:function(i){var r=this.edgeDataCache[i];return r?Object.assign({},r):void 0}},{key:"getNodeDisplayedLabels",value:function(){return new Set(this.displayedNodeLabels)}},{key:"getEdgeDisplayedLabels",value:function(){return new Set(this.displayedEdgeLabels)}},{key:"getSettings",value:function(){return K({},this.settings)}},{key:"getSetting",value:function(i){return this.settings[i]}},{key:"setSetting",value:function(i,r){var o=K({},this.settings);return this.settings[i]=r,jn(this.settings),this.handleSettingsUpdate(o),this.scheduleRefresh(),this}},{key:"updateSetting",value:function(i,r){return this.setSetting(i,r(this.settings[i])),this}},{key:"setSettings",value:function(i){var r=K({},this.settings);return this.settings=K(K({},this.settings),i),jn(this.settings),this.handleSettingsUpdate(r),this.scheduleRefresh(),this}},{key:"resize",value:function(i){var r=this.width,o=this.height;if(this.width=this.container.offsetWidth,this.height=this.container.offsetHeight,this.pixelRatio=Fr(),this.width===0)if(this.settings.allowInvalidContainer)this.width=1;else throw new Error("Sigma: Container has no width. You can set the allowInvalidContainer setting to true to stop seeing this error.");if(this.height===0)if(this.settings.allowInvalidContainer)this.height=1;else throw new Error("Sigma: Container has no height. You can set the allowInvalidContainer setting to true to stop seeing this error.");if(!i&&r===this.width&&o===this.height)return this;for(var a in this.elements){var s=this.elements[a];s.style.width=this.width+"px",s.style.height=this.height+"px"}for(var u in this.canvasContexts)this.elements[u].setAttribute("width",this.width*this.pixelRatio+"px"),this.elements[u].setAttribute("height",this.height*this.pixelRatio+"px"),this.pixelRatio!==1&&this.canvasContexts[u].scale(this.pixelRatio,this.pixelRatio);for(var l in this.webGLContexts){this.elements[l].setAttribute("width",this.width*this.pixelRatio+"px"),this.elements[l].setAttribute("height",this.height*this.pixelRatio+"px");var c=this.webGLContexts[l];if(c.viewport(0,0,this.width*this.pixelRatio,this.height*this.pixelRatio),this.pickingLayers.has(l)){var h=this.textures[l];h&&c.deleteTexture(h)}}return this.emit("resize"),this}},{key:"clear",value:function(){return this.emit("beforeClear"),this.webGLContexts.nodes.bindFramebuffer(WebGLRenderingContext.FRAMEBUFFER,null),this.webGLContexts.nodes.clear(WebGLRenderingContext.COLOR_BUFFER_BIT),this.webGLContexts.edges.bindFramebuffer(WebGLRenderingContext.FRAMEBUFFER,null),this.webGLContexts.edges.clear(WebGLRenderingContext.COLOR_BUFFER_BIT),this.webGLContexts.hoverNodes.clear(WebGLRenderingContext.COLOR_BUFFER_BIT),this.canvasContexts.labels.clearRect(0,0,this.width,this.height),this.canvasContexts.hovers.clearRect(0,0,this.width,this.height),this.canvasContexts.edgeLabels.clearRect(0,0,this.width,this.height),this.emit("afterClear"),this}},{key:"refresh",value:function(i){var r=this,o=(i==null?void 0:i.skipIndexation)!==void 0?i==null?void 0:i.skipIndexation:!1,a=(i==null?void 0:i.schedule)!==void 0?i.schedule:!1,s=!i||!i.partialGraph;if(s)this.clearEdgeIndices(),this.clearNodeIndices(),this.graph.forEachNode(function(v){return r.addNode(v)}),this.graph.forEachEdge(function(v){return r.addEdge(v)});else{for(var u,l,c=((u=i.partialGraph)===null||u===void 0?void 0:u.nodes)||[],h=0,d=(c==null?void 0:c.length)||0;h<d;h++){var f=c[h];if(this.updateNode(f),o){var p=this.nodeProgramIndex[f];if(p===void 0)throw new Error('Sigma: node "'.concat(f,`" can't be repaint`));this.addNodeToProgram(f,this.nodeIndices[f],p)}}for(var m=(i==null||(l=i.partialGraph)===null||l===void 0?void 0:l.edges)||[],_=0,T=m.length;_<T;_++){var x=m[_];if(this.updateEdge(x),o){var k=this.edgeProgramIndex[x];if(k===void 0)throw new Error('Sigma: edge "'.concat(x,`" can't be repaint`));this.addEdgeToProgram(x,this.edgeIndices[x],k)}}}return(s||!o)&&(this.needToProcess=!0),a?this.scheduleRender():this.render(),this}},{key:"scheduleRender",value:function(){var i=this;return this.renderFrame||(this.renderFrame=requestAnimationFrame(function(){i.render()})),this}},{key:"scheduleRefresh",value:function(i){return this.refresh(K(K({},i),{},{schedule:!0}))}},{key:"getViewportZoomedState",value:function(i,r){var o=this.camera.getState(),a=o.ratio,s=o.angle,u=o.x,l=o.y,c=this.settings,h=c.minCameraRatio,d=c.maxCameraRatio;typeof d=="number"&&(r=Math.min(r,d)),typeof h=="number"&&(r=Math.max(r,h));var f=r/a,p={x:this.width/2,y:this.height/2},m=this.viewportToFramedGraph(i),_=this.viewportToFramedGraph(p);return{angle:s,x:(m.x-_.x)*(1-f)+u,y:(m.y-_.y)*(1-f)+l,ratio:r}}},{key:"viewRectangle",value:function(){var i=this.viewportToFramedGraph({x:0,y:0}),r=this.viewportToFramedGraph({x:this.width,y:0}),o=this.viewportToFramedGraph({x:0,y:this.height});return{x1:i.x,y1:i.y,x2:r.x,y2:r.y,height:r.y-o.y}}},{key:"framedGraphToViewport",value:function(i){var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},o=!!r.cameraState||!!r.viewportDimensions||!!r.graphDimensions,a=r.matrix?r.matrix:o?St(r.cameraState||this.camera.getState(),r.viewportDimensions||this.getDimensions(),r.graphDimensions||this.getGraphDimensions(),r.padding||this.getStagePadding()):this.matrix,s=fi(a,i);return{x:(1+s.x)*this.width/2,y:(1-s.y)*this.height/2}}},{key:"viewportToFramedGraph",value:function(i){var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},o=!!r.cameraState||!!r.viewportDimensions||!r.graphDimensions,a=r.matrix?r.matrix:o?St(r.cameraState||this.camera.getState(),r.viewportDimensions||this.getDimensions(),r.graphDimensions||this.getGraphDimensions(),r.padding||this.getStagePadding(),!0):this.invMatrix,s=fi(a,{x:i.x/this.width*2-1,y:1-i.y/this.height*2});return isNaN(s.x)&&(s.x=0),isNaN(s.y)&&(s.y=0),s}},{key:"viewportToGraph",value:function(i){var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return this.normalizationFunction.inverse(this.viewportToFramedGraph(i,r))}},{key:"graphToViewport",value:function(i){var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return this.framedGraphToViewport(this.normalizationFunction(i),r)}},{key:"getGraphToViewportRatio",value:function(){var i={x:0,y:0},r={x:1,y:1},o=Math.sqrt(Math.pow(i.x-r.x,2)+Math.pow(i.y-r.y,2)),a=this.graphToViewport(i),s=this.graphToViewport(r),u=Math.sqrt(Math.pow(a.x-s.x,2)+Math.pow(a.y-s.y,2));return u/o}},{key:"getBBox",value:function(){return this.nodeExtent}},{key:"getCustomBBox",value:function(){return this.customBBox}},{key:"setCustomBBox",value:function(i){return this.customBBox=i,this.scheduleRender(),this}},{key:"kill",value:function(){this.emit("kill"),this.removeAllListeners(),this.unbindCameraHandlers(),window.removeEventListener("resize",this.activeListeners.handleResize),this.mouseCaptor.kill(),this.touchCaptor.kill(),this.unbindGraphHandlers(),this.clearIndices(),this.clearState(),this.nodeDataCache={},this.edgeDataCache={},this.highlightedNodes.clear(),this.renderFrame&&(cancelAnimationFrame(this.renderFrame),this.renderFrame=null),this.renderHighlightedNodesFrame&&(cancelAnimationFrame(this.renderHighlightedNodesFrame),this.renderHighlightedNodesFrame=null);for(var i=this.container;i.firstChild;)i.removeChild(i.firstChild);for(var r in this.nodePrograms)this.nodePrograms[r].kill();for(var o in this.nodeHoverPrograms)this.nodeHoverPrograms[o].kill();for(var a in this.edgePrograms)this.edgePrograms[a].kill();this.nodePrograms={},this.nodeHoverPrograms={},this.edgePrograms={};for(var s in this.elements)this.killLayer(s);this.canvasContexts={},this.webGLContexts={},this.elements={}}},{key:"scaleSize",value:function(){var i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:1,r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:this.camera.ratio;return i/this.settings.zoomToSizeRatioFunction(r)*(this.getSetting("itemSizesReference")==="positions"?r*this.graphToViewportRatio:1)}},{key:"getCanvases",value:function(){var i={};for(var r in this.elements)this.elements[r]instanceof HTMLCanvasElement&&(i[r]=this.elements[r]);return i}}])}(Ni),Af=Sf,Rt={},Wr;function Cf(){if(Wr)return Rt;Wr=1;function e(i){return typeof i!="number"||isNaN(i)?1:i}function t(i,r){var o={},a=function(l){return typeof l>"u"?r:l};typeof r=="function"&&(a=r);var s=function(l){return a(l[i])},u=function(){return a(void 0)};return typeof i=="string"?(o.fromAttributes=s,o.fromGraph=function(l,c){return s(l.getNodeAttributes(c))},o.fromEntry=function(l,c){return s(c)}):typeof i=="function"?(o.fromAttributes=function(){throw new Error("graphology-utils/getters/createNodeValueGetter: irrelevant usage.")},o.fromGraph=function(l,c){return a(i(c,l.getNodeAttributes(c)))},o.fromEntry=function(l,c){return a(i(l,c))}):(o.fromAttributes=u,o.fromGraph=u,o.fromEntry=u),o}function n(i,r){var o={},a=function(l){return typeof l>"u"?r:l};typeof r=="function"&&(a=r);var s=function(l){return a(l[i])},u=function(){return a(void 0)};return typeof i=="string"?(o.fromAttributes=s,o.fromGraph=function(l,c){return s(l.getEdgeAttributes(c))},o.fromEntry=function(l,c){return s(c)},o.fromPartialEntry=o.fromEntry,o.fromMinimalEntry=o.fromEntry):typeof i=="function"?(o.fromAttributes=function(){throw new Error("graphology-utils/getters/createEdgeValueGetter: irrelevant usage.")},o.fromGraph=function(l,c){var h=l.extremities(c);return a(i(c,l.getEdgeAttributes(c),h[0],h[1],l.getNodeAttributes(h[0]),l.getNodeAttributes(h[1]),l.isUndirected(c)))},o.fromEntry=function(l,c,h,d,f,p,m){return a(i(l,c,h,d,f,p,m))},o.fromPartialEntry=function(l,c,h,d){return a(i(l,c,h,d))},o.fromMinimalEntry=function(l,c){return a(i(l,c))}):(o.fromAttributes=u,o.fromGraph=u,o.fromEntry=u,o.fromMinimalEntry=u),o}return Rt.createNodeValueGetter=t,Rt.createEdgeValueGetter=n,Rt.createEdgeWeightGetter=function(i){return n(i,e)},Rt}var Xn,Vr;function Rf(){if(Vr)return Xn;Vr=1;var e=0,t=1,n=2,i=3,r=4,o=5,a=6,s=7,u=8,l=9,c=0,h=1,d=2,f=0,p=1,m=2,_=3,T=4,x=5,k=6,v=7,b=8,C=3,R=10,B=3,I=9,O=10;return Xn=function(z,g,j){var re,D,w,Q,ee,oe,he,ue,X,Te,de=g.length,ve=j.length,Ce=z.adjustSizes,ye=z.barnesHutTheta*z.barnesHutTheta,E,$,G,S,Y,L,A,y=[];for(w=0;w<de;w+=R)g[w+r]=g[w+n],g[w+o]=g[w+i],g[w+n]=0,g[w+i]=0;if(z.outboundAttractionDistribution){for(E=0,w=0;w<de;w+=R)E+=g[w+a];E/=de/R}if(z.barnesHutOptimize){var te=1/0,se=-1/0,Z=1/0,W=-1/0,H,P,q;for(w=0;w<de;w+=R)te=Math.min(te,g[w+e]),se=Math.max(se,g[w+e]),Z=Math.min(Z,g[w+t]),W=Math.max(W,g[w+t]);var F=se-te,le=W-Z;for(F>le?(Z-=(F-le)/2,W=Z+F):(te-=(le-F)/2,se=te+le),y[0+f]=-1,y[0+p]=(te+se)/2,y[0+m]=(Z+W)/2,y[0+_]=Math.max(se-te,W-Z),y[0+T]=-1,y[0+x]=-1,y[0+k]=0,y[0+v]=0,y[0+b]=0,re=1,w=0;w<de;w+=R)for(D=0,q=C;;)if(y[D+x]>=0){g[w+e]<y[D+p]?g[w+t]<y[D+m]?H=y[D+x]:H=y[D+x]+I:g[w+t]<y[D+m]?H=y[D+x]+I*2:H=y[D+x]+I*3,y[D+v]=(y[D+v]*y[D+k]+g[w+e]*g[w+a])/(y[D+k]+g[w+a]),y[D+b]=(y[D+b]*y[D+k]+g[w+t]*g[w+a])/(y[D+k]+g[w+a]),y[D+k]+=g[w+a],D=H;continue}else if(y[D+f]<0){y[D+f]=w;break}else{if(y[D+x]=re*I,ue=y[D+_]/2,X=y[D+x],y[X+f]=-1,y[X+p]=y[D+p]-ue,y[X+m]=y[D+m]-ue,y[X+_]=ue,y[X+T]=X+I,y[X+x]=-1,y[X+k]=0,y[X+v]=0,y[X+b]=0,X+=I,y[X+f]=-1,y[X+p]=y[D+p]-ue,y[X+m]=y[D+m]+ue,y[X+_]=ue,y[X+T]=X+I,y[X+x]=-1,y[X+k]=0,y[X+v]=0,y[X+b]=0,X+=I,y[X+f]=-1,y[X+p]=y[D+p]+ue,y[X+m]=y[D+m]-ue,y[X+_]=ue,y[X+T]=X+I,y[X+x]=-1,y[X+k]=0,y[X+v]=0,y[X+b]=0,X+=I,y[X+f]=-1,y[X+p]=y[D+p]+ue,y[X+m]=y[D+m]+ue,y[X+_]=ue,y[X+T]=y[D+T],y[X+x]=-1,y[X+k]=0,y[X+v]=0,y[X+b]=0,re+=4,g[y[D+f]+e]<y[D+p]?g[y[D+f]+t]<y[D+m]?H=y[D+x]:H=y[D+x]+I:g[y[D+f]+t]<y[D+m]?H=y[D+x]+I*2:H=y[D+x]+I*3,y[D+k]=g[y[D+f]+a],y[D+v]=g[y[D+f]+e],y[D+b]=g[y[D+f]+t],y[H+f]=y[D+f],y[D+f]=-1,g[w+e]<y[D+p]?g[w+t]<y[D+m]?P=y[D+x]:P=y[D+x]+I:g[w+t]<y[D+m]?P=y[D+x]+I*2:P=y[D+x]+I*3,H===P)if(q--){D=H;continue}else{q=C;break}y[P+f]=w;break}}if(z.barnesHutOptimize)for($=z.scalingRatio,w=0;w<de;w+=R)for(D=0;;)if(y[D+x]>=0)if(L=Math.pow(g[w+e]-y[D+v],2)+Math.pow(g[w+t]-y[D+b],2),Te=y[D+_],4*Te*Te/L<ye){if(G=g[w+e]-y[D+v],S=g[w+t]-y[D+b],Ce===!0?L>0?(A=$*g[w+a]*y[D+k]/L,g[w+n]+=G*A,g[w+i]+=S*A):L<0&&(A=-$*g[w+a]*y[D+k]/Math.sqrt(L),g[w+n]+=G*A,g[w+i]+=S*A):L>0&&(A=$*g[w+a]*y[D+k]/L,g[w+n]+=G*A,g[w+i]+=S*A),D=y[D+T],D<0)break;continue}else{D=y[D+x];continue}else{if(oe=y[D+f],oe>=0&&oe!==w&&(G=g[w+e]-g[oe+e],S=g[w+t]-g[oe+t],L=G*G+S*S,Ce===!0?L>0?(A=$*g[w+a]*g[oe+a]/L,g[w+n]+=G*A,g[w+i]+=S*A):L<0&&(A=-$*g[w+a]*g[oe+a]/Math.sqrt(L),g[w+n]+=G*A,g[w+i]+=S*A):L>0&&(A=$*g[w+a]*g[oe+a]/L,g[w+n]+=G*A,g[w+i]+=S*A)),D=y[D+T],D<0)break;continue}else for($=z.scalingRatio,Q=0;Q<de;Q+=R)for(ee=0;ee<Q;ee+=R)G=g[Q+e]-g[ee+e],S=g[Q+t]-g[ee+t],Ce===!0?(L=Math.sqrt(G*G+S*S)-g[Q+u]-g[ee+u],L>0?(A=$*g[Q+a]*g[ee+a]/L/L,g[Q+n]+=G*A,g[Q+i]+=S*A,g[ee+n]-=G*A,g[ee+i]-=S*A):L<0&&(A=100*$*g[Q+a]*g[ee+a],g[Q+n]+=G*A,g[Q+i]+=S*A,g[ee+n]-=G*A,g[ee+i]-=S*A)):(L=Math.sqrt(G*G+S*S),L>0&&(A=$*g[Q+a]*g[ee+a]/L/L,g[Q+n]+=G*A,g[Q+i]+=S*A,g[ee+n]-=G*A,g[ee+i]-=S*A));for(X=z.gravity/z.scalingRatio,$=z.scalingRatio,w=0;w<de;w+=R)A=0,G=g[w+e],S=g[w+t],L=Math.sqrt(Math.pow(G,2)+Math.pow(S,2)),z.strongGravityMode?L>0&&(A=$*g[w+a]*X):L>0&&(A=$*g[w+a]*X/L),g[w+n]-=G*A,g[w+i]-=S*A;for($=1*(z.outboundAttractionDistribution?E:1),he=0;he<ve;he+=B)Q=j[he+c],ee=j[he+h],ue=j[he+d],Y=Math.pow(ue,z.edgeWeightInfluence),G=g[Q+e]-g[ee+e],S=g[Q+t]-g[ee+t],Ce===!0?(L=Math.sqrt(G*G+S*S)-g[Q+u]-g[ee+u],z.linLogMode?z.outboundAttractionDistribution?L>0&&(A=-$*Y*Math.log(1+L)/L/g[Q+a]):L>0&&(A=-$*Y*Math.log(1+L)/L):z.outboundAttractionDistribution?L>0&&(A=-$*Y/g[Q+a]):L>0&&(A=-$*Y)):(L=Math.sqrt(Math.pow(G,2)+Math.pow(S,2)),z.linLogMode?z.outboundAttractionDistribution?L>0&&(A=-$*Y*Math.log(1+L)/L/g[Q+a]):L>0&&(A=-$*Y*Math.log(1+L)/L):z.outboundAttractionDistribution?(L=1,A=-$*Y/g[Q+a]):(L=1,A=-$*Y)),L>0&&(g[Q+n]+=G*A,g[Q+i]+=S*A,g[ee+n]-=G*A,g[ee+i]-=S*A);var ne,ie,ge,ae,pe,be;if(Ce===!0)for(w=0;w<de;w+=R)g[w+l]!==1&&(ne=Math.sqrt(Math.pow(g[w+n],2)+Math.pow(g[w+i],2)),ne>O&&(g[w+n]=g[w+n]*O/ne,g[w+i]=g[w+i]*O/ne),ie=g[w+a]*Math.sqrt((g[w+r]-g[w+n])*(g[w+r]-g[w+n])+(g[w+o]-g[w+i])*(g[w+o]-g[w+i])),ge=Math.sqrt((g[w+r]+g[w+n])*(g[w+r]+g[w+n])+(g[w+o]+g[w+i])*(g[w+o]+g[w+i]))/2,ae=.1*Math.log(1+ge)/(1+Math.sqrt(ie)),pe=g[w+e]+g[w+n]*(ae/z.slowDown),g[w+e]=pe,be=g[w+t]+g[w+i]*(ae/z.slowDown),g[w+t]=be);else for(w=0;w<de;w+=R)g[w+l]!==1&&(ie=g[w+a]*Math.sqrt((g[w+r]-g[w+n])*(g[w+r]-g[w+n])+(g[w+o]-g[w+i])*(g[w+o]-g[w+i])),ge=Math.sqrt((g[w+r]+g[w+n])*(g[w+r]+g[w+n])+(g[w+o]+g[w+i])*(g[w+o]+g[w+i]))/2,ae=g[w+s]*Math.log(1+ge)/(1+Math.sqrt(ie)),g[w+s]=Math.min(1,Math.sqrt(ae*(Math.pow(g[w+n],2)+Math.pow(g[w+i],2))/(1+Math.sqrt(ie)))),pe=g[w+e]+g[w+n]*(ae/z.slowDown),g[w+e]=pe,be=g[w+t]+g[w+i]*(ae/z.slowDown),g[w+t]=be);return{}},Xn}var Ve={},jr;function Lf(){if(jr)return Ve;jr=1;var e=10,t=3;return Ve.assign=function(n){n=n||{};var i=Array.prototype.slice.call(arguments).slice(1),r,o,a;for(r=0,a=i.length;r<a;r++)if(i[r])for(o in i[r])n[o]=i[r][o];return n},Ve.validateSettings=function(n){return"linLogMode"in n&&typeof n.linLogMode!="boolean"?{message:"the `linLogMode` setting should be a boolean."}:"outboundAttractionDistribution"in n&&typeof n.outboundAttractionDistribution!="boolean"?{message:"the `outboundAttractionDistribution` setting should be a boolean."}:"adjustSizes"in n&&typeof n.adjustSizes!="boolean"?{message:"the `adjustSizes` setting should be a boolean."}:"edgeWeightInfluence"in n&&typeof n.edgeWeightInfluence!="number"?{message:"the `edgeWeightInfluence` setting should be a number."}:"scalingRatio"in n&&!(typeof n.scalingRatio=="number"&&n.scalingRatio>=0)?{message:"the `scalingRatio` setting should be a number >= 0."}:"strongGravityMode"in n&&typeof n.strongGravityMode!="boolean"?{message:"the `strongGravityMode` setting should be a boolean."}:"gravity"in n&&!(typeof n.gravity=="number"&&n.gravity>=0)?{message:"the `gravity` setting should be a number >= 0."}:"slowDown"in n&&!(typeof n.slowDown=="number"||n.slowDown>=0)?{message:"the `slowDown` setting should be a number >= 0."}:"barnesHutOptimize"in n&&typeof n.barnesHutOptimize!="boolean"?{message:"the `barnesHutOptimize` setting should be a boolean."}:"barnesHutTheta"in n&&!(typeof n.barnesHutTheta=="number"&&n.barnesHutTheta>=0)?{message:"the `barnesHutTheta` setting should be a number >= 0."}:null},Ve.graphToByteArrays=function(n,i){var r=n.order,o=n.size,a={},s,u=new Float32Array(r*e),l=new Float32Array(o*t);return s=0,n.forEachNode(function(c,h){a[c]=s,u[s]=h.x,u[s+1]=h.y,u[s+2]=0,u[s+3]=0,u[s+4]=0,u[s+5]=0,u[s+6]=1,u[s+7]=1,u[s+8]=h.size||1,u[s+9]=h.fixed?1:0,s+=e}),s=0,n.forEachEdge(function(c,h,d,f,p,m,_){var T=a[d],x=a[f],k=i(c,h,d,f,p,m,_);u[T+6]+=k,u[x+6]+=k,l[s]=T,l[s+1]=x,l[s+2]=k,s+=t}),{nodes:u,edges:l}},Ve.assignLayoutChanges=function(n,i,r){var o=0;n.updateEachNodeAttributes(function(a,s){return s.x=i[o],s.y=i[o+1],o+=e,r?r(a,s):s})},Ve.readGraphPositions=function(n,i){var r=0;n.forEachNode(function(o,a){i[r]=a.x,i[r+1]=a.y,r+=e})},Ve.collectLayoutChanges=function(n,i,r){for(var o=n.nodes(),a={},s=0,u=0,l=i.length;s<l;s+=e){if(r){var c=Object.assign({},n.getNodeAttributes(o[u]));c.x=i[s],c.y=i[s+1],c=r(o[u],c),a[o[u]]={x:c.x,y:c.y}}else a[o[u]]={x:i[s],y:i[s+1]};u++}return a},Ve.createWorker=function(i){var r=window.URL||window.webkitURL,o=i.toString(),a=r.createObjectURL(new Blob(["("+o+").call(this);"],{type:"text/javascript"})),s=new Worker(a);return r.revokeObjectURL(a),s},Ve}var Yn,qr;function Df(){return qr||(qr=1,Yn={linLogMode:!1,outboundAttractionDistribution:!1,adjustSizes:!1,edgeWeightInfluence:1,scalingRatio:1,strongGravityMode:!1,gravity:1,slowDown:1,barnesHutOptimize:!1,barnesHutTheta:.5}),Yn}var Kn,Xr;function $f(){if(Xr)return Kn;Xr=1;var e=da(),t=Cf().createEdgeWeightGetter,n=Rf(),i=Lf(),r=Df();function o(u,l,c){if(!e(l))throw new Error("graphology-layout-forceatlas2: the given graph is not a valid graphology instance.");typeof c=="number"&&(c={iterations:c});var h=c.iterations;if(typeof h!="number")throw new Error("graphology-layout-forceatlas2: invalid number of iterations.");if(h<=0)throw new Error("graphology-layout-forceatlas2: you should provide a positive number of iterations.");var d=t("getEdgeWeight"in c?c.getEdgeWeight:"weight").fromEntry,f=typeof c.outputReducer=="function"?c.outputReducer:null,p=i.assign({},r,c.settings),m=i.validateSettings(p);if(m)throw new Error("graphology-layout-forceatlas2: "+m.message);var _=i.graphToByteArrays(l,d),T;for(T=0;T<h;T++)n(p,_.nodes,_.edges);if(u){i.assignLayoutChanges(l,_.nodes,f);return}return i.collectLayoutChanges(l,_.nodes)}function a(u){var l=typeof u=="number"?u:u.order;return{barnesHutOptimize:l>2e3,strongGravityMode:!0,gravity:.05,scalingRatio:10,slowDown:1+Math.log(l)}}var s=o.bind(null,!1);return s.assign=o.bind(null,!0),s.inferSettings=a,Kn=s,Kn}$f();function Gf(e,t){if(typeof e!="object"||!e)return e;var n=e[Symbol.toPrimitive];if(n!==void 0){var i=n.call(e,t);if(typeof i!="object")return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}function pa(e){var t=Gf(e,"string");return typeof t=="symbol"?t:t+""}function ma(e,t,n){return(t=pa(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function Yr(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable})),n.push.apply(n,i)}return n}function wn(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?Yr(Object(n),!0).forEach(function(i){ma(e,i,n[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Yr(Object(n)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(n,i))})}return e}function Nf(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function Pf(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,pa(i.key),i)}}function Ff(e,t,n){return t&&Pf(e.prototype,t),Object.defineProperty(e,"prototype",{writable:!1}),e}function _n(e){return _n=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},_n(e)}function va(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(va=function(){return!!e})()}function ya(e){if(e===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function If(e,t){if(t&&(typeof t=="object"||typeof t=="function"))return t;if(t!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return ya(e)}function Mf(e,t,n){return t=_n(t),If(e,va()?Reflect.construct(t,n||[],_n(e).constructor):t.apply(e,n))}function pi(e,t){return pi=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(n,i){return n.__proto__=i,n},pi(e,t)}function zf(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&pi(e,t)}function mi(e,t){(t==null||t>e.length)&&(t=e.length);for(var n=0,i=Array(t);n<t;n++)i[n]=e[n];return i}function Of(e){if(Array.isArray(e))return mi(e)}function Uf(e){if(typeof Symbol<"u"&&e[Symbol.iterator]!=null||e["@@iterator"]!=null)return Array.from(e)}function Bf(e,t){if(e){if(typeof e=="string")return mi(e,t);var n={}.toString.call(e).slice(8,-1);return n==="Object"&&e.constructor&&(n=e.constructor.name),n==="Map"||n==="Set"?Array.from(e):n==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?mi(e,t):void 0}}function Hf(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function Zn(e){return Of(e)||Uf(e)||Bf(e)||Hf()}function ba(e,t,n,i){var r=Math.pow(1-e,2)*t.x+2*(1-e)*e*n.x+Math.pow(e,2)*i.x,o=Math.pow(1-e,2)*t.y+2*(1-e)*e*n.y+Math.pow(e,2)*i.y;return{x:r,y:o}}function Wf(e,t,n){for(var i=20,r=0,o=e,a=0;a<i;a++){var s=ba((a+1)/i,e,t,n);r+=Math.sqrt(Math.pow(o.x-s.x,2)+Math.pow(o.y-s.y,2)),o=s}return r}function Vf(e){var t=e.curvatureAttribute,n=e.defaultCurvature,i=e.keepLabelUpright,r=i===void 0?!0:i;return function(o,a,s,u,l){var c=l.edgeLabelSize,h=a[t]||n,d=l.edgeLabelFont,f=l.edgeLabelWeight,p=l.edgeLabelColor.attribute?a[l.edgeLabelColor.attribute]||l.edgeLabelColor.color||"#000":l.edgeLabelColor.color,m=a.label;if(m){o.fillStyle=p,o.font="".concat(f," ").concat(c,"px ").concat(d);var _=!r||s.x<u.x,T=_?s.x:u.x,x=_?s.y:u.y,k=_?u.x:s.x,v=_?u.y:s.y,b=(T+k)/2,C=(x+v)/2,R=k-T,B=v-x,I=Math.sqrt(Math.pow(R,2)+Math.pow(B,2)),O=_?1:-1,M=b+B*h*O,z=C-R*h*O,g=a.size*.7+5,j={x:z-x,y:-(M-T)},re=Math.sqrt(Math.pow(j.x,2)+Math.pow(j.y,2)),D={x:v-z,y:-(k-M)},w=Math.sqrt(Math.pow(D.x,2)+Math.pow(D.y,2));T+=g*j.x/re,x+=g*j.y/re,k+=g*D.x/w,v+=g*D.y/w,M+=g*B/I,z-=g*R/I;var Q={x:M,y:z},ee={x:T,y:x},oe={x:k,y:v},he=Wf(ee,Q,oe);if(!(he<s.size+u.size)){var ue=o.measureText(m).width,X=he-s.size-u.size;if(ue>X){var Te="…";for(m=m+Te,ue=o.measureText(m).width;ue>X&&m.length>1;)m=m.slice(0,-2)+Te,ue=o.measureText(m).width;if(m.length<4)return}for(var de={},ve=0,Ce=m.length;ve<Ce;ve++){var ye=m[ve];de[ye]||(de[ye]=o.measureText(ye).width*(1+h*.35))}for(var E=.5-ue/he/2,$=0,G=m.length;$<G;$++){var S=m[$],Y=ba(E,ee,Q,oe),L=2*(1-E)*(M-T)+2*E*(k-M),A=2*(1-E)*(z-x)+2*E*(v-z),y=Math.atan2(A,L);o.save(),o.translate(Y.x,Y.y),o.rotate(y),o.fillText(S,0,0),o.restore(),E+=de[S]/he}}}}}function jf(e){var t=e.arrowHead,n=(t==null?void 0:t.extremity)==="target"||(t==null?void 0:t.extremity)==="both",i=(t==null?void 0:t.extremity)==="source"||(t==null?void 0:t.extremity)==="both",r=`
precision highp float;

varying vec4 v_color;
varying float v_thickness;
varying float v_feather;
varying vec2 v_cpA;
varying vec2 v_cpB;
varying vec2 v_cpC;
`.concat(n?`
varying float v_targetSize;
varying vec2 v_targetPoint;`:"",`
`).concat(i?`
varying float v_sourceSize;
varying vec2 v_sourcePoint;`:"",`
`).concat(t?`
uniform float u_lengthToThicknessRatio;
uniform float u_widenessToThicknessRatio;`:"",`

float det(vec2 a, vec2 b) {
  return a.x * b.y - b.x * a.y;
}

vec2 getDistanceVector(vec2 b0, vec2 b1, vec2 b2) {
  float a = det(b0, b2), b = 2.0 * det(b1, b0), d = 2.0 * det(b2, b1);
  float f = b * d - a * a;
  vec2 d21 = b2 - b1, d10 = b1 - b0, d20 = b2 - b0;
  vec2 gf = 2.0 * (b * d21 + d * d10 + a * d20);
  gf = vec2(gf.y, -gf.x);
  vec2 pp = -f * gf / dot(gf, gf);
  vec2 d0p = b0 - pp;
  float ap = det(d0p, d20), bp = 2.0 * det(d10, d0p);
  float t = clamp((ap + bp) / (2.0 * a + b + d), 0.0, 1.0);
  return mix(mix(b0, b1, t), mix(b1, b2, t), t);
}

float distToQuadraticBezierCurve(vec2 p, vec2 b0, vec2 b1, vec2 b2) {
  return length(getDistanceVector(b0 - p, b1 - p, b2 - p));
}

const vec4 transparent = vec4(0.0, 0.0, 0.0, 0.0);

void main(void) {
  float dist = distToQuadraticBezierCurve(gl_FragCoord.xy, v_cpA, v_cpB, v_cpC);
  float thickness = v_thickness;
`).concat(n?`
  float distToTarget = length(gl_FragCoord.xy - v_targetPoint);
  float targetArrowLength = v_targetSize + thickness * u_lengthToThicknessRatio;
  if (distToTarget < targetArrowLength) {
    thickness = (distToTarget - v_targetSize) / (targetArrowLength - v_targetSize) * u_widenessToThicknessRatio * thickness;
  }`:"",`
`).concat(i?`
  float distToSource = length(gl_FragCoord.xy - v_sourcePoint);
  float sourceArrowLength = v_sourceSize + thickness * u_lengthToThicknessRatio;
  if (distToSource < sourceArrowLength) {
    thickness = (distToSource - v_sourceSize) / (sourceArrowLength - v_sourceSize) * u_widenessToThicknessRatio * thickness;
  }`:"",`

  float halfThickness = thickness / 2.0;
  if (dist < halfThickness) {
    #ifdef PICKING_MODE
    gl_FragColor = v_color;
    #else
    float t = smoothstep(
      halfThickness - v_feather,
      halfThickness,
      dist
    );

    gl_FragColor = mix(v_color, transparent, t);
    #endif
  } else {
    gl_FragColor = transparent;
  }
}
`);return r}function qf(e){var t=e.arrowHead,n=(t==null?void 0:t.extremity)==="target"||(t==null?void 0:t.extremity)==="both",i=(t==null?void 0:t.extremity)==="source"||(t==null?void 0:t.extremity)==="both",r=`
attribute vec4 a_id;
attribute vec4 a_color;
attribute float a_direction;
attribute float a_thickness;
attribute vec2 a_source;
attribute vec2 a_target;
attribute float a_current;
attribute float a_curvature;
`.concat(n?`attribute float a_targetSize;
`:"",`
`).concat(i?`attribute float a_sourceSize;
`:"",`

uniform mat3 u_matrix;
uniform float u_sizeRatio;
uniform float u_pixelRatio;
uniform vec2 u_dimensions;
uniform float u_minEdgeThickness;
uniform float u_feather;

varying vec4 v_color;
varying float v_thickness;
varying float v_feather;
varying vec2 v_cpA;
varying vec2 v_cpB;
varying vec2 v_cpC;
`).concat(n?`
varying float v_targetSize;
varying vec2 v_targetPoint;`:"",`
`).concat(i?`
varying float v_sourceSize;
varying vec2 v_sourcePoint;`:"",`
`).concat(t?`
uniform float u_widenessToThicknessRatio;`:"",`

const float bias = 255.0 / 254.0;
const float epsilon = 0.7;

vec2 clipspaceToViewport(vec2 pos, vec2 dimensions) {
  return vec2(
    (pos.x + 1.0) * dimensions.x / 2.0,
    (pos.y + 1.0) * dimensions.y / 2.0
  );
}

vec2 viewportToClipspace(vec2 pos, vec2 dimensions) {
  return vec2(
    pos.x / dimensions.x * 2.0 - 1.0,
    pos.y / dimensions.y * 2.0 - 1.0
  );
}

void main() {
  float minThickness = u_minEdgeThickness;

  // Selecting the correct position
  // Branchless "position = a_source if a_current == 1.0 else a_target"
  vec2 position = a_source * max(0.0, a_current) + a_target * max(0.0, 1.0 - a_current);
  position = (u_matrix * vec3(position, 1)).xy;

  vec2 source = (u_matrix * vec3(a_source, 1)).xy;
  vec2 target = (u_matrix * vec3(a_target, 1)).xy;

  vec2 viewportPosition = clipspaceToViewport(position, u_dimensions);
  vec2 viewportSource = clipspaceToViewport(source, u_dimensions);
  vec2 viewportTarget = clipspaceToViewport(target, u_dimensions);

  vec2 delta = viewportTarget.xy - viewportSource.xy;
  float len = length(delta);
  vec2 normal = vec2(-delta.y, delta.x) * a_direction;
  vec2 unitNormal = normal / len;
  float boundingBoxThickness = len * a_curvature;

  float curveThickness = max(minThickness, a_thickness / u_sizeRatio);
  v_thickness = curveThickness * u_pixelRatio;
  v_feather = u_feather;

  v_cpA = viewportSource;
  v_cpB = 0.5 * (viewportSource + viewportTarget) + unitNormal * a_direction * boundingBoxThickness;
  v_cpC = viewportTarget;

  vec2 viewportOffsetPosition = (
    viewportPosition +
    unitNormal * (boundingBoxThickness / 2.0 + sign(boundingBoxThickness) * (`).concat(t?"curveThickness * u_widenessToThicknessRatio":"curveThickness",` + epsilon)) *
    max(0.0, a_direction) // NOTE: cutting the bounding box in half to avoid overdraw
  );

  position = viewportToClipspace(viewportOffsetPosition, u_dimensions);
  gl_Position = vec4(position, 0, 1);
    
`).concat(n?`
  v_targetSize = a_targetSize * u_pixelRatio / u_sizeRatio;
  v_targetPoint = viewportTarget;
`:"",`
`).concat(i?`
  v_sourceSize = a_sourceSize * u_pixelRatio / u_sizeRatio;
  v_sourcePoint = viewportSource;
`:"",`

  #ifdef PICKING_MODE
  // For picking mode, we use the ID as the color:
  v_color = a_id;
  #else
  // For normal mode, we use the color:
  v_color = a_color;
  #endif

  v_color.a *= bias;
}
`);return r}var wa=.25,Xf={arrowHead:null,curvatureAttribute:"curvature",defaultCurvature:wa},_a=WebGLRenderingContext,Kr=_a.UNSIGNED_BYTE,Je=_a.FLOAT;function Fi(e){var t=wn(wn({},Xf),e||{}),n=t,i=n.arrowHead,r=n.curvatureAttribute,o=n.drawLabel,a=(i==null?void 0:i.extremity)==="target"||(i==null?void 0:i.extremity)==="both",s=(i==null?void 0:i.extremity)==="source"||(i==null?void 0:i.extremity)==="both",u=["u_matrix","u_sizeRatio","u_dimensions","u_pixelRatio","u_feather","u_minEdgeThickness"].concat(Zn(i?["u_lengthToThicknessRatio","u_widenessToThicknessRatio"]:[]));return function(l){zf(c,l);function c(){var h;Nf(this,c);for(var d=arguments.length,f=new Array(d),p=0;p<d;p++)f[p]=arguments[p];return h=Mf(this,c,[].concat(f)),ma(ya(h),"drawLabel",o||Vf(t)),h}return Ff(c,[{key:"getDefinition",value:function(){return{VERTICES:6,VERTEX_SHADER_SOURCE:qf(t),FRAGMENT_SHADER_SOURCE:jf(t),METHOD:WebGLRenderingContext.TRIANGLES,UNIFORMS:u,ATTRIBUTES:[{name:"a_source",size:2,type:Je},{name:"a_target",size:2,type:Je}].concat(Zn(a?[{name:"a_targetSize",size:1,type:Je}]:[]),Zn(s?[{name:"a_sourceSize",size:1,type:Je}]:[]),[{name:"a_thickness",size:1,type:Je},{name:"a_curvature",size:1,type:Je},{name:"a_color",size:4,type:Kr,normalized:!0},{name:"a_id",size:4,type:Kr,normalized:!0}]),CONSTANT_ATTRIBUTES:[{name:"a_current",size:1,type:Je},{name:"a_direction",size:1,type:Je}],CONSTANT_DATA:[[0,1],[0,-1],[1,1],[0,-1],[1,1],[1,-1]]}}},{key:"processVisibleItem",value:function(d,f,p,m,_){var T,x=_.size||1,k=p.x,v=p.y,b=m.x,C=m.y,R=_t(_.color),B=(T=_[r])!==null&&T!==void 0?T:wa,I=this.array;I[f++]=k,I[f++]=v,I[f++]=b,I[f++]=C,a&&(I[f++]=m.size),s&&(I[f++]=p.size),I[f++]=x,I[f++]=B,I[f++]=R,I[f++]=d}},{key:"setUniforms",value:function(d,f){var p=f.gl,m=f.uniformLocations,_=m.u_matrix,T=m.u_pixelRatio,x=m.u_feather,k=m.u_sizeRatio,v=m.u_dimensions,b=m.u_minEdgeThickness;if(p.uniformMatrix3fv(_,!1,d.matrix),p.uniform1f(T,d.pixelRatio),p.uniform1f(k,d.sizeRatio),p.uniform1f(x,d.antiAliasingFeather),p.uniform2f(v,d.width*d.pixelRatio,d.height*d.pixelRatio),p.uniform1f(b,d.minEdgeThickness),i){var C=m.u_lengthToThicknessRatio,R=m.u_widenessToThicknessRatio;p.uniform1f(C,i.lengthToThicknessRatio),p.uniform1f(R,i.widenessToThicknessRatio)}}}]),c}(Sn)}var Yf=Fi();Fi({arrowHead:Cn});Fi({arrowHead:wn(wn({},Cn),{},{extremity:"both"})});function Kf(){const e=document.getElementById("yearFrom"),t=document.getElementById("yearTo"),n=document.getElementById("areaFilter"),i=document.getElementById("institutionFilter"),r=document.getElementById("typeFilter"),o=document.getElementById("clearFilters"),a=document.getElementById("selectedAreas"),s=document.getElementById("selectedInstitutions"),u=document.getElementById("selectedTypes"),l=document.getElementById("standardSearch"),c=document.getElementById("standardSearchBtn"),h=document.getElementById("searchSuggestions"),d=document.getElementById("selectedAuthor"),f=document.getElementById("authorLimitMessage");let p=new Set,m=new Set,_=new Set,T=null,x=null;function k(){T?(c.classList.remove("btn-primary","btn-success"),c.classList.add("btn-secondary"),c.disabled=!0):(c.innerHTML='<i class="fas fa-search"></i>',c.classList.remove("btn-success","btn-secondary"),c.classList.add("btn-primary"),c.disabled=!1)}function v(E){if(!E||T){h.style.display="none";return}fetch(`/api/search/authors/?q=${encodeURIComponent(E)}`).then($=>$.json()).then($=>{const G=h.querySelector(".list-group");if(G.innerHTML="",$.suggestions.length===0){h.style.display="none";return}$.suggestions.forEach(S=>{const Y=document.createElement("a");Y.href="#",Y.className="list-group-item list-group-item-action",Y.innerHTML=`
                        ${S.name}
                        <span class="badge bg-secondary float-end">${S.count} pub.</span>
                    `,Y.addEventListener("click",L=>{L.preventDefault(),b(S.name)}),G.appendChild(Y)}),h.style.display="block"}).catch($=>{console.error("Error fetching author suggestions:",$),h.style.display="none"})}function b(E){T=E,l.value="",l.disabled=!0,h.style.display="none",f.style.display="block",k(),d.innerHTML=`
            <span class="badge bg-primary me-2 mb-2">
                ${E}
                <button type="button" class="btn-close btn-close-white ms-1" 
                        style="font-size: 0.5rem; vertical-align: middle;"
                        aria-label="Remove"></button>
            </span>
        `,d.querySelector(".btn-close").addEventListener("click",()=>{T=null,d.innerHTML="",l.disabled=!1,f.style.display="none",k();const se=document.getElementById("authorMetricsCard");se&&se.remove();const Z=document.getElementById("networkCol");Z&&(Z.className="col-12"),ye()});const $=document.getElementById("collaborationRow"),G=document.createElement("div");G.id="authorMetricsCard",G.className="col-md-6 mt-3 mt-md-0 mb-10 h-100";const S=window.location.pathname.split("/")[1],Y=S==="es"?"Resumen de Métricas del Autor":"Author Metrics Summary",L=S==="es"?"Métrica":"Metrics",A=S==="es"?"Valor":"Value";G.innerHTML=`
            <div class="card dashboard-card h-100">
                <div class="card-body d-flex flex-column">
                    <div class="d-flex justify-content-between align-items-center mb-3">
                        <h5 class="card-title mb-0">${Y}</h5>
                    </div>
                    <div id="authorMetricsContent" class="flex-grow-1">
                        <div class="table-responsive">
                            <table class="table table-hover">
                                <thead>
                                    <tr>
                                        <th>${L}</th>
                                        <th>${A}</th>
                                    </tr>
                                </thead>
                                <tbody id="authorMetricsTable">
                                    <!-- Data will be loaded dynamically -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
        `,$.appendChild(G);const y=document.getElementById("networkCol");y&&(y.className="col-12 col-md-6 mb-10");const te=document.getElementById("pubsCol");te&&(te.className="col-12 mt-4"),fetch(`/api/author/metrics/?author_id=${encodeURIComponent(E)}`).then(se=>se.json()).then(se=>{if(se.error){console.error("Error fetching author metrics:",se.error);return}const Z=document.getElementById("authorMetricsTable");if(!Z)return;const W={orcid:"ORCID",total_publications:"Total Publications",total_citations:"Total Citations",citations_wos:"WoS Citations",citations_scopus:"Scopus Citations",h_index:"H-index (WoS/Scopus)",h_index_gb:"H-index (Gesbib)",h_index_h5gb:"H5-index (Gesbib)",international_index:"International Collaboration Index"};Z.innerHTML="",Object.entries(se.metrics).forEach(([H,P])=>{const q=document.createElement("tr");if(H==="orcid"&&typeof P=="string"&&P.trim()!==""){const F=P.replace(/^http:/,"https:");q.innerHTML=`
                            <td>${W[H]}</td>
                            <td><a href="${F}" target="_blank" rel="noopener noreferrer">${F}</a></td>
                        `}else q.innerHTML=`
                            <td>${W[H]||H}</td>
                            <td>${P}</td>
                        `;Z.appendChild(q)})}).catch(se=>{console.error("Error fetching author metrics:",se)}),ye()}function C(){if(!T&&!l.value.trim())return;c.innerHTML='<i class="fas fa-spinner fa-spin"></i>';const E=new URLSearchParams;T?E.append("author",T):E.append("q",l.value.trim()),fetch(`/api/search/?${E.toString()}`).then($=>$.json()).then($=>{c.innerHTML='<i class="fas fa-search"></i>',R($.results)}).catch($=>{console.error("Error performing search:",$),c.innerHTML='<i class="fas fa-search"></i>',alert("Error al realizar la búsqueda. Por favor, inténtelo de nuevo.")})}function R(E){const G=window.location.pathname.split("/")[1]==="es"?"Resultados de la búsqueda":"Search Results";let S=document.getElementById("searchResultsModal");S||(S=document.createElement("div"),S.id="searchResultsModal",S.className="modal fade",S.setAttribute("tabindex","-1"),S.innerHTML=`
                <div class="modal-dialog modal-lg">
                    <div class="modal-content">
                        <div class="modal-header">
                            <h5 class="modal-title">${G}</h5>
                            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                        </div>
                        <div class="modal-body">
                            <div id="searchResultsList"></div>
                        </div>
                    </div>
                </div>
            `,document.body.appendChild(S));const Y=document.getElementById("searchResultsList");E.length===0?Y.innerHTML='<p class="text-center">No se encontraron resultados.</p>':Y.innerHTML=E.map(A=>`
                <div class="card mb-3">
                    <div class="card-body" data-publication-id="${A.id}" style="cursor: pointer;">
                        <h5 class="card-title">${A.title}</h5>
                        <h6 class="card-subtitle mb-2 text-muted">
                            ${A.year} - ${A.publication_type}
                        </h6>
                        <p class="card-text">
                            <strong>Autores:</strong> ${A.authors.join(", ")}<br>
                            <strong>Instituciones:</strong> ${A.institutions.join(", ")}<br>
                            <strong>Áreas:</strong> ${A.areas.join(", ")}
                        </p>
                        ${A.url?`<a href="${A.url}" class="card-link" target="_blank">Ver publicación</a>`:""}
                    </div>
                </div>
            `).join(""),Y.querySelectorAll(".card-body").forEach(A=>{A.addEventListener("click",function(){const y=this.dataset.publicationId;y&&(window.location.href=`/publication/${y}/`)})}),new bootstrap.Modal(S).show()}l.addEventListener("input",function(){T||(clearTimeout(x),x=setTimeout(()=>{v(this.value.trim())},300))}),l.addEventListener("focus",function(){this.value.trim()&&!T&&v(this.value.trim())}),document.addEventListener("click",function(E){!E.target.closest("#standardSearch")&&!E.target.closest("#searchSuggestions")&&(h.style.display="none")}),c.addEventListener("click",C),l.addEventListener("keypress",function(E){E.key==="Enter"&&C()}),k(),B(),g();function B(){fetch("/api/dashboard/filters/").then(E=>E.json()).then(E=>{const $=E.years.map(G=>G.year);e.min=Math.min(...$),e.max=Math.max(...$),t.min=Math.min(...$),t.max=Math.max(...$),E.areas.forEach(G=>{const S=document.createElement("option");S.value=G.name,S.textContent=`${G.name} (${G.count})`,n.appendChild(S)}),E.institutions.forEach(G=>{const S=document.createElement("option");S.value=G.name,S.textContent=`${G.name} (${G.count})`,i.appendChild(S)}),E.publication_types.forEach(G=>{const S=document.createElement("option");S.value=G.publication_type,S.textContent=`${G.publication_type} (${G.count})`,r.appendChild(S)}),j()}).catch(E=>console.error("Error loading filter data:",E))}function I(E,$,G){const S=document.createElement("span");S.className="badge bg-primary me-2 mb-2";const Y=E.length>40?E.substring(0,40)+"...":E;S.innerHTML=`
            ${Y}
            <button type="button" class="btn-close btn-close-white ms-1" 
                    style="font-size: 0.5rem; vertical-align: middle;"
                    aria-label="Remove"></button>
        `,S.querySelector(".btn-close").addEventListener("click",()=>{G.delete(E),S.remove(),j()}),$.appendChild(S)}let O="pie",M=null;function z(E){O==="pie"?Q(E):ee(E)}function g(){const E=document.querySelector('[data-areas-view="pie"]'),$=document.querySelector('[data-areas-view="bar"]');!E||!$||(E.addEventListener("click",function(){E.classList.contains("active")||(E.classList.add("active"),$.classList.remove("active"),O="pie",M&&z(M))}),$.addEventListener("click",function(){$.classList.contains("active")||($.classList.add("active"),E.classList.remove("active"),O="bar",M&&z(M))}))}function j(){const E={year_from:e.value,year_to:t.value,areas:Array.from(p),institutions:Array.from(m),types:Array.from(_)},$=E.year_from&&E.year_to&&E.year_from===E.year_to,G=document.querySelector('[data-view="monthly"]'),S=document.querySelector('[data-view="yearly"]');G.disabled=!$,$?E.view_type=G.classList.contains("active")?"monthly":"yearly":(G.classList.remove("active"),S.classList.add("active"),E.view_type="yearly");const Y=new URLSearchParams;E.year_from&&Y.append("year_from",E.year_from),E.year_to&&Y.append("year_to",E.year_to),E.areas.forEach(L=>Y.append("areas",L)),E.institutions.forEach(L=>Y.append("institutions",L)),E.types.forEach(L=>Y.append("types",L)),Y.append("view_type",E.view_type),T&&Y.append("author",T),fetch(`/api/dashboard/data/?${Y.toString()}`).then(L=>L.json()).then(L=>{const A=new URLSearchParams(Y);A.append("view_type",ve),fetch(`/api/dashboard/collaboration-network/?${A.toString()}`).then(se=>se.json()).then(se=>{Ce(se)}).catch(se=>{console.error("Error fetching collaboration network data:",se)}),w(L.timeline,E.view_type,L.timeline_info),M=L.areas;const y=document.querySelector('[data-areas-view="pie"]'),te=document.querySelector('[data-areas-view="bar"]');y&&te&&!y.classList.contains("active")&&!te.classList.contains("active")?(y.classList.add("active"),te.classList.remove("active"),O="pie"):te&&te.classList.contains("active")?O="bar":y&&y.classList.contains("active")&&(O="pie"),z(L.areas),D(1).then(()=>{})}).catch(L=>console.error("Error updating visualizations:",L))}let re={metric:null,direction:"desc"};function D(E=1){const $=document.getElementById("metricsTable"),G=document.getElementById("publicationsPagination"),S=$.closest("table");if(S){let A=S.querySelector(".loading-overlay");A||(A=document.createElement("div"),A.className="loading-overlay",A.style.cssText=`
                    position: absolute;
                    top: 0;
                    left: 0;
                    width: 100%;
                    height: 100%;
                    background: rgba(255, 255, 255, 0.8);
                    display: flex;
                    justify-content: center;
                    align-items: center;
                    z-index: 1000;
                `,A.innerHTML=`
                    <div class="spinner-border text-primary" role="status">
                        <span class="visually-hidden">Cargando...</span>
                    </div>
                `,S.style.position="relative",S.appendChild(A)),A.style.display="flex",S.style.pointerEvents="none",S.style.opacity="0.7"}const Y={year_from:e.value,year_to:t.value,areas:Array.from(p),institutions:Array.from(m),types:Array.from(_),page:E},L=new URLSearchParams;return Y.year_from&&L.append("year_from",Y.year_from),Y.year_to&&L.append("year_to",Y.year_to),Y.areas.forEach(A=>L.append("areas",A)),Y.institutions.forEach(A=>L.append("institutions",A)),Y.types.forEach(A=>L.append("types",A)),L.append("page",Y.page),T&&L.append("author",T),re.metric&&(L.append("sort_by",re.metric),L.append("sort_order",re.direction)),fetch(`/api/dashboard/publications/?${L.toString()}`).then(A=>{if(!A.ok)throw new Error("Network response was not ok");return A.json()}).then(A=>{if(!$||!G)return Promise.reject("Required elements not found");const{data:y,pagination:te}=A.publications,se=[{key:"Dimensions Citations",label:"Dimensions Citations"},{key:"WoS Citations",label:"WoS Citations"},{key:"Scopus Citations",label:"Scopus Citations"},{key:"FCR",label:"FCR"},{key:"RCR",label:"RCR"},{key:"International Collaboration",label:"International Collaboration"}],Z=document.createElement("thead");if(Z.innerHTML=`
                    <tr>
                        <th style="max-width: 300px;">Título</th>
                        ${se.map(({key:H,label:P})=>`
                            <th class="sortable" data-metric="${H}">
                                ${P}
                                <i class="fas fa-sort${re.metric===H?`-${re.direction==="desc"?"down":"up"}`:""} ms-1"></i>
                            </th>
                        `).join("")}
                    </tr>
                `,S){const H=S.querySelector("thead");H&&H.remove(),S.insertBefore(Z,$)}Z.querySelectorAll(".sortable").forEach(H=>{H.addEventListener("click",function(){const P=this.dataset.metric,q=this.querySelector("i");Z.querySelectorAll(".sortable i").forEach(F=>{F.className="fas fa-sort ms-1"}),re.metric===P?re.direction=re.direction==="desc"?"asc":"desc":(re.metric=P,re.direction="desc"),q.className=`fas fa-sort-${re.direction==="desc"?"down":"up"} ms-1`,D(1)})});function W(H){$.innerHTML=H.map(P=>`
                        <tr class="publication-row" data-publication-id="${P.id}" style="cursor: pointer;">
                            <td style="max-width: 300px; overflow: hidden; text-overflow: ellipsis; white-space: nowrap;">${P.title}</td>
                            ${se.map(({key:q})=>{const F=P.metrics[q];return`<td>${F&&F.value!==null?F.value:""}</td>`}).join("")}
                            <td>${P.international_collab!==null?P.international_collab:"-"}</td>
                        </tr>
                    `).join(""),$.querySelectorAll(".publication-row").forEach(P=>{P.addEventListener("click",function(){const q=this.dataset.publicationId;q&&(window.location.href=`/publication/${q}/`)})})}if(W(y),te.total_pages>1){let H=`
                        <li class="page-item ${te.current_page===1?"disabled":""}">
                            <a class="page-link" href="#" data-page="1">&laquo;</a>
                        </li>
                        <li class="page-item ${te.current_page===1?"disabled":""}">
                            <a class="page-link" href="#" data-page="${te.current_page-1}">&lt;</a>
                        </li>
                    `;const P=Math.max(1,te.current_page-2),q=Math.min(te.total_pages,te.current_page+2);for(let F=P;F<=q;F++)H+=`
                            <li class="page-item ${F===te.current_page?"active":""}">
                                <a class="page-link" href="#" data-page="${F}">${F}</a>
                            </li>
                        `;H+=`
                        <li class="page-item ${te.current_page===te.total_pages?"disabled":""}">
                            <a class="page-link" href="#" data-page="${te.current_page+1}">&gt;</a>
                        </li>
                        <li class="page-item ${te.current_page===te.total_pages?"disabled":""}">
                            <a class="page-link" href="#" data-page="${te.total_pages}">&raquo;</a>
                        </li>
                    `,G.innerHTML=H}else G.innerHTML="";if(G.querySelectorAll(".page-link").forEach(H=>{H.addEventListener("click",function(P){P.preventDefault();const q=parseInt(this.dataset.page);isNaN(q)||D(q)})}),S){const H=S.querySelector(".loading-overlay");H&&(H.style.display="none"),S.style.pointerEvents="auto",S.style.opacity="1"}return Promise.resolve()}).catch(A=>{if(console.error("Error updating publications table:",A),S){const y=S.querySelector(".loading-overlay");y&&(y.style.display="none"),S.style.pointerEvents="auto",S.style.opacity="1"}return Promise.reject(A)})}function w(E,$,G){Re("#timelineChart").html("");const S={top:20,right:20,bottom:70,left:60},Y=document.getElementById("timelineChart").clientWidth-S.left-S.right,L=300-S.top-S.bottom,A=Re("#timelineChart").append("svg").attr("width",Y+S.left+S.right).attr("height",L+S.top+S.bottom).style("display","block").style("margin","0 auto").append("g").attr("transform",`translate(${S.left},${S.top})`);let y;$==="monthly"?y=Gt().domain([1,12]).range([0,Y]):y=Gt().domain(Ca(E,F=>F.year)).range([0,Y]);const te=Gt().domain([0,Ui(E,F=>F.count)]).nice().range([L,0]);let se;$==="monthly"?se=$n(y).ticks(12).tickFormat(F=>["Ene","Feb","Mar","Abr","May","Jun","Jul","Ago","Sep","Oct","Nov","Dic"][F-1]):se=$n(y).ticks(Y/80).tickFormat(Si("d"));const Z=Hi(te).ticks(L/40);A.append("g").attr("transform",`translate(0,${L})`).call(se).selectAll("text").style("text-anchor","middle"),A.append("g").call(Z);const W=No().x(F=>y($==="monthly"?F.month:F.year)).y(F=>te(F.count)).curve(yr),H=Wc().x(F=>y($==="monthly"?F.month:F.year)).y0(L).y1(F=>te(F.count)).curve(yr);A.append("path").datum(E).attr("fill","#e3f2fd").attr("d",H),A.append("path").datum(E).attr("fill","none").attr("stroke","#2196f3").attr("stroke-width",2).attr("d",W);const P=document.createElement("div");P.className="tooltip",P.style.opacity=0,P.style.position="absolute",P.style.backgroundColor="rgba(255,255,255,0.95)",P.style.border="1px solid #2196f3",P.style.borderRadius="4px",P.style.padding="6px 10px",P.style.fontSize="13px",P.style.pointerEvents="none",P.style.zIndex="1000",P.style.boxShadow="0 2px 4px rgba(0,0,0,0.1)",document.body.appendChild(P);const q=document.createElement("div");if(q.className="info-box",q.style.display="none",q.style.position="absolute",q.style.backgroundColor="white",q.style.border="2px solid #2196f3",q.style.borderRadius="6px",q.style.padding="10px 15px",q.style.fontSize="14px",q.style.zIndex="1000",q.style.boxShadow="0 4px 8px rgba(0,0,0,0.1)",q.style.pointerEvents="none",document.body.appendChild(q),A.selectAll(".point").data(E).enter().append("circle").attr("class","point").attr("cx",F=>y($==="monthly"?F.month:F.year)).attr("cy",F=>te(F.count)).attr("r",5).attr("fill","#2196f3").attr("stroke","#fff").attr("stroke-width",2).style("cursor","pointer").on("mouseover",function(F,le){Re(this).attr("r",7).attr("fill","#1976d2"),P.style.opacity=1;let ne;$==="monthly"?ne=`<b>${["Enero","Febrero","Marzo","Abril","Mayo","Junio","Julio","Agosto","Septiembre","Octubre","Noviembre","Diciembre"][le.month-1]}</b><br><b>Publicaciones:</b> ${le.count}`:ne=`<b>Año:</b> ${le.year}<br><b>Publicaciones:</b> ${le.count}`,P.innerHTML=ne,P.style.left=`${F.pageX+10}px`,P.style.top=`${F.pageY+10}px`}).on("mouseout",function(){Re(this).attr("r",5).attr("fill","#2196f3"),P.style.opacity=0}).on("click",function(F,le){F.stopPropagation(),Oe(".info-box").style("display","none");const ne=document.getElementById("timelineChart").getBoundingClientRect(),ie=F.clientX-ne.left,ge=F.clientY-ne.top,ae=120,pe=60;let be=ie,Qe=ge-pe-10;be+ae/2>ne.width?be=ne.width-ae/2:be-ae/2<0&&(be=ae/2),Qe<0&&(Qe=ge+10);let et;$==="monthly"?et=`
                        <div style="font-weight: bold; margin-bottom: 5px;">${["Enero","Febrero","Marzo","Abril","Mayo","Junio","Julio","Agosto","Septiembre","Octubre","Noviembre","Diciembre"][le.month-1]}</div>
                        <div>Publicaciones: ${le.count}</div>
                    `:et=`
                        <div style="font-weight: bold; margin-bottom: 5px;">Año ${le.year}</div>
                        <div>Publicaciones: ${le.count}</div>
                    `,q.innerHTML=et,q.style.display="block",q.style.left=`${be-ae/2}px`,q.style.top=`${Qe}px`}),A.on("click",function(F){F.target.classList.contains("point")||Oe(".info-box").style("display","none")}),document.addEventListener("click",function(F){F.target.closest("#timelineChart")||Oe(".info-box").style("display","none")}),document.getElementById("timelineChart").addEventListener("click",function(F){F.target.closest(".point")||Oe(".info-box").style("display","none")}),A.append("text").attr("transform","rotate(-90)").attr("y",0-S.left+20).attr("x",0-L/2).attr("dy","1em").style("text-anchor","middle").style("font-size","12px").text("Número de publicaciones"),A.append("text").attr("transform",`translate(${Y/2}, ${L+S.bottom-30})`).attr("dy","1em").style("text-anchor","middle").style("font-size","12px").text($==="monthly"?"Mes":"Año"),$==="monthly"&&G&&G.no_month_count>0){const F=Re("#timelineChart").append("div").attr("class","alert alert-info").style("position","absolute").style("top","50px").style("right","10px").style("padding","8px 12px").style("font-size","12px").style("border-radius","4px").style("background-color","#e3f2fd").style("border","1px solid #2196f3").style("color","#0d47a1").style("z-index","1000").style("display","flex").style("align-items","center").style("gap","8px").style("max-width","300px");(G.no_month_count/G.total_count*100).toFixed(1),F.html(`
                <div style="flex-grow: 1;">
                    <i class="fas fa-info-circle"></i>
                    ${G.no_month_count} publicación(es) sin mes asignado 
                    se han contabilizado en enero
                </div>
                <button type="button" class="btn-close" style="font-size: 0.7rem;" aria-label="Close"></button>
            `),F.select(".btn-close").on("click",function(){F.remove()})}}function Q(E){E=E.filter(P=>P.thematic_areas__name!==null);const $=14;if(E.length>$){const P=E.slice().sort((ne,ie)=>ie.count-ne.count),q=P.slice(0,$);E=[{thematic_areas__name:"Otras",count:P.slice($).reduce((ne,ie)=>ne+ie.count,0)},...q]}Re("#areasChart").html("");const G={top:20,right:150,bottom:20,left:20},S=document.getElementById("areasChart").clientWidth-G.left-G.right,Y=320-G.top-G.bottom,L=Math.min(S,Y)/2,A=Re("#areasChart").append("svg").attr("width",S+G.left+G.right).attr("height",Y+G.top+G.bottom).style("display","block").style("margin","0 auto").append("g").attr("transform",`translate(${L+G.left},${Y/2+G.top})`),y=Pt().domain(E.map(P=>P.thematic_areas__name)).range(dr),te=qc().value(P=>P.count).sort(null),se=Hc().innerRadius(0).outerRadius(L),Z=Re("#areasChart").append("div").attr("class","info-box").style("display","none").style("position","absolute").style("background-color","white").style("border","2px solid #2196f3").style("border-radius","6px").style("padding","10px 15px").style("font-size","14px").style("z-index","1000").style("box-shadow","0 4px 8px rgba(0,0,0,0.1)").style("pointer-events","none");A.selectAll("path").data(te(E)).enter().append("path").attr("d",se).attr("fill",P=>y(P.data.thematic_areas__name)).attr("stroke","white").style("stroke-width","2px").style("cursor","pointer").on("click",function(P,q){P.stopPropagation(),Oe(".info-box").style("display","none");const F=document.getElementById("areasChart").getBoundingClientRect(),le=P.clientX-F.left,ne=P.clientY-F.top,ie=180,ge=70;let ae=le,pe=ne-ge-10;ae+ie/2>F.width?ae=F.width-ie/2:ae-ie/2<0&&(ae=ie/2),pe<0&&(pe=ne+10);const be=(q.data.count/Rn(E,Ht=>Ht.count)*100).toFixed(1),Qe=`
                    <div style="font-weight: bold; margin-bottom: 5px;">${q.data.thematic_areas__name}</div>
                    <div>Publicaciones: ${q.data.count}</div>
                    <div>Porcentaje: ${be}%</div>
                `,et=y(q.data.thematic_areas__name);Z.html(Qe).style("display","block").style("left",ae-ie/2+"px").style("top",pe+"px").style("border",`2px solid ${et}`)});const H=A.append("g").attr("transform",`translate(${L+20}, ${-280/2})`).selectAll(".legend-item").data(E).enter().append("g").attr("class","legend-item").attr("transform",(P,q)=>`translate(0, ${q*20})`);H.append("rect").attr("width",15).attr("height",15).attr("fill",P=>y(P.thematic_areas__name)),H.append("text").attr("x",20).attr("y",12).style("font-size","10px").text(P=>{const q=P.thematic_areas__name,F=(P.count/Rn(E,le=>le.count)*100).toFixed(1);return`${q} (${P.count} pubs, ${F}%)`}),document.getElementById("areasChart").addEventListener("click",function(P){P.target.closest("path")||Oe(".info-box").style("display","none")}),document.addEventListener("click",function(P){P.target.closest("#areasChart")||Oe(".info-box").style("display","none")})}function ee(E){E=E.filter(Z=>Z.thematic_areas__name!==null);const $=25;if(E.length>$){const Z=E.slice().sort((q,F)=>F.count-q.count),W=Z.slice(0,$),P=Z.slice($).reduce((q,F)=>q+F.count,0);E=[...W,{thematic_areas__name:"Otras",count:P}]}Re("#areasChart").html("");const G={top:20,right:20,bottom:30,left:60},S=document.getElementById("areasChart").clientWidth-G.left-G.right,Y=300-G.top-G.bottom,L=Re("#areasChart").append("svg").attr("width",S+G.left+G.right).attr("height",Y+G.top+G.bottom).style("display","block").style("margin","0 auto").append("g").attr("transform",`translate(${G.left},${G.top})`),A=Ro().domain(E.map(Z=>Z.thematic_areas__name)).range([0,S]).padding(.2),y=Gt().domain([0,Ui(E,Z=>Z.count)]).nice().range([Y,0]);L.append("g").attr("transform",`translate(0,${Y})`).call($n(A).tickFormat("")),L.append("g").call(Hi(y).ticks(Y/40));const te=Pt().domain(E.map(Z=>Z.thematic_areas__name)).range(dr),se=Re("#areasChart").append("div").attr("class","info-box").style("display","none").style("position","absolute").style("background-color","white").style("border","2px solid #2196f3").style("border-radius","6px").style("padding","10px 15px").style("font-size","14px").style("z-index","1000").style("box-shadow","0 4px 8px rgba(0,0,0,0.1)").style("pointer-events","none");L.selectAll(".bar").data(E).enter().append("rect").attr("class","bar").attr("x",Z=>A(Z.thematic_areas__name)).attr("y",Z=>y(Z.count)).attr("width",A.bandwidth()).attr("height",Z=>Y-y(Z.count)).attr("fill",Z=>te(Z.thematic_areas__name)).style("cursor","pointer").on("click",function(Z,W){Z.stopPropagation(),Oe(".info-box").style("display","none");const H=document.getElementById("areasChart").getBoundingClientRect(),P=Z.clientX-H.left,q=Z.clientY-H.top,F=180,le=70;let ne=P,ie=q-le-10;ne+F/2>H.width?ne=H.width-F/2:ne-F/2<0&&(ne=F/2),ie<0&&(ie=q+10);const ge=(W.count/Rn(E,be=>be.count)*100).toFixed(1),ae=`
                    <div style="font-weight: bold; margin-bottom: 5px;">${W.thematic_areas__name}</div>
                    <div>Publicaciones: ${W.count}</div>
                    <div>Porcentaje: ${ge}%</div>
                `,pe=te(W.thematic_areas__name);se.html(ae).style("display","block").style("left",ne-F/2+"px").style("top",ie+"px").style("border",`2px solid ${pe}`)}),document.getElementById("areasChart").addEventListener("click",function(Z){Z.target.closest("rect")||Oe(".info-box").style("display","none")}),document.addEventListener("click",function(Z){Z.target.closest("#areasChart")||Oe(".info-box").style("display","none")}),L.append("text").attr("transform","rotate(-90)").attr("y",-40).attr("x",-250/2).attr("dy","1em").style("text-anchor","middle").style("font-size","12px").text("Número de publicaciones"),L.append("text").attr("transform",`translate(${S/2}, ${Y+G.bottom-20})`).attr("dy","1em").style("text-anchor","middle").style("font-size","12px").text("Áreas temáticas")}document.querySelectorAll("[data-view]").forEach(E=>{E.addEventListener("click",function(){this.disabled||(document.querySelectorAll("[data-view]").forEach($=>$.classList.remove("active")),this.classList.add("active"),j())})}),e.addEventListener("change",ye),t.addEventListener("change",ye),n.addEventListener("change",()=>{const E=n.value;E&&!p.has(E)&&(p.add(E),I(E,a,p),ye()),n.value=""}),i.addEventListener("change",()=>{const E=i.value;E&&!m.has(E)&&(m.add(E),I(E,s,m),ye()),i.value=""}),r.addEventListener("change",()=>{const E=r.value;E&&!_.has(E)&&(_.add(E),I(E,u,_),ye()),r.value=""}),o.addEventListener("click",()=>{e.value="",t.value="",p.clear(),m.clear(),_.clear(),a.innerHTML="",s.innerHTML="",u.innerHTML="",ye()});let oe=null,he=!1;const ue=document.getElementById("toggleLabelsBtn"),X=window.location.pathname.split("/")[1],Te=X==="es"?"Ocultar etiquetas extra":"Hide Extra Labels",de=X==="es"?"Mostrar etiquetas":"Show All Labels";ue&&ue.addEventListener("click",()=>{oe&&(he=!he,he?(oe.setSettings({labelDensity:1/0,labelGridCellSize:1,labelRenderedSizeThreshold:0}),ue.textContent=`${Te}`):(oe.setSettings({labelDensity:1,labelGridCellSize:200,labelRenderedSizeThreshold:0}),ue.textContent=`${de}`),oe.refresh())});let ve="modularity-7";document.querySelectorAll(".dropdown-item.network-community-view").forEach(E=>{E.addEventListener("click",function($){$.preventDefault();const G=this.dataset.communityView;if(ve===G){document.querySelectorAll(".dropdown-item.network-community-view").forEach(S=>{S.classList.remove("active")}),this.classList.add("active");return}ve=G,document.querySelectorAll(".dropdown-item.network-community-view").forEach(S=>{S.classList.remove("active")}),this.classList.add("active"),j()})});function Ce(E){const $=document.getElementById("collaborationNetwork");if(!$)return;const G=document.querySelector("#collaborationNetwork").closest(".card").querySelector(".card-title");if(E.is_author_view){const W=E.nodes.find(P=>P.is_selected);if(W){const P=window.location.pathname.split("/")[1];G.textContent=P==="es"?`Colaboraciones de ${W.label}`:`Collaborations of ${W.label}`}const H=document.querySelector("#communityViewDropdown").closest(".dropdown");H&&(H.style.display="none")}else{const W=document.querySelector("#communityViewDropdown").closest(".dropdown");W&&(W.style.display="block")}oe&&(oe.kill(),oe=null),$.innerHTML="";const S=new fe,Y=["#e6194b","#3cb44b","#ffe119","#4363d8","#f58231","#911eb4","#42d4f4","#f032e6","#bfef45","#fabed4","#469990","#dcbeff","#9a6324","#fffac8","#800000","#aaffc3","#808000","#ffd8b1","#000075","#a9a9a9","#000000","#6a3d9a","#b15928","#1f78b4"],L=W=>Y[W%Y.length],A=Pt().domain(["Departamento 1","Departamento 2","Departamento 3","Unknown"]).range(["#1f78b4","#ff7f0e","#2ca02c","#999999"]);if(E.is_author_view){const W=$.clientWidth/2,H=$.clientHeight/2,P=250,q=E.nodes.find(ne=>ne.is_selected);if(!q)return;q.x=W,q.y=H;const F=E.nodes.filter(ne=>!ne.is_selected),le=2*Math.PI/Math.max(F.length,1);F.forEach((ne,ie)=>{const ge=ie*le;ne.x=W+P*Math.cos(ge),ne.y=H+P*Math.sin(ge)})}else{let W,H;ve==="department"?(W="department",H=[...new Set(E.nodes.map(ae=>ae.department))]):ve==="modularity-5"?(W="leiden_community",H=[...new Set(E.nodes.map(ae=>parseInt(ae.leiden_community)))]):(W="community",H=[...new Set(E.nodes.map(ae=>parseInt(ae.community)))]);const P=H.indexOf(-1);P>-1&&(H.splice(P,1),H.push(-1));const q={};H.forEach(ae=>{q[ae]=W==="department"?E.nodes.filter(pe=>pe[W]===ae):E.nodes.filter(pe=>parseInt(pe[W])===ae)});const F=$.clientWidth/2,le=$.clientHeight/2,ne=H.length,ie=Math.min(F,le)*.8,ge=ie/Math.sqrt(ne)*.5;H.forEach((ae,pe)=>{const be=q[ae],Qe=2*Math.PI/Math.max(be.length,5),et=F+ie*Math.cos(2*Math.PI*pe/ne),Ht=le+ie*Math.sin(2*Math.PI*pe/ne);be.forEach((Ii,Ea)=>{const Mi=Ea*Qe;Ii.x=et+ge*Math.cos(Mi),Ii.y=Ht+ge*Math.sin(Mi)})})}const y={};E.edges.forEach(W=>{y[W.source]=(y[W.source]||0)+1,y[W.target]=(y[W.target]||0)+1}),E.nodes.forEach(W=>{const H=parseInt(W.community),P=parseInt(W.leiden_community),q=W.department,F=E.is_author_view?W.is_selected?"#e6194b":"#bbbbbb":ve==="department"?A(q):L(ve==="modularity-5"?P:H);S.addNode(W.id,{label:W.label,x:W.x,y:W.y,size:W.is_selected?18:12,color:F,highlighted:W.is_selected,forceLabel:he})}),E.edges.forEach(W=>{if(S.hasNode(W.source)&&S.hasNode(W.target)){const H=W.weight||1,P=Math.pow(H,.7),q=Math.min(4,Math.max(1.5,P)),le=`rgba(3, 138, 255, ${Math.min(.9,.5+.05*H).toFixed(2)})`;S.addEdge(W.source,W.target,{size:q,color:le,type:"curve"})}}),oe=new Af(S,$,{minCameraRatio:.1,maxCameraRatio:10,defaultEdgeType:"curve",edgeProgramClasses:{curve:Yf},renderLabels:!0,labelDensity:1,labelGridCellSize:300,labelRenderedSizeThreshold:0,defaultLabelSize:8,zIndex:!0,enableEdgeHovering:!1,enableNodeHovering:!1,enableCamera:!1});const te=document.createElement("div");Object.assign(te.style,{position:"absolute",backgroundColor:"#fff",border:"1px solid #aaa",padding:"4px 8px",fontSize:"12px",borderRadius:"4px",pointerEvents:"none",display:"none",zIndex:1e3}),document.body.appendChild(te);const se=()=>{const W=Re("#collaborationNetwork").append("div").attr("class","alert alert-info").style("position","absolute").style("top","10px").style("left","10px").style("padding","8px 12px").style("font-size","12px").style("border-radius","4px").style("background-color","#e3f2fd").style("border","1px solid #2196f3").style("color","#0d47a1").style("z-index","1000").style("display","flex").style("align-items","center").style("gap","8px").style("max-width","300px");W.html(`
                <div style="flex-grow: 1;">
                    <i class="fas fa-info-circle"></i>
                    La red contiene ${S.order} autores y ${S.size} colaboraciones
                </div>
                <button type="button" class="btn-close" style="font-size: 0.7rem;" aria-label="Close"></button>
            `),W.select(".btn-close").on("click",()=>W.remove()),oe.setSettings({enableEdgeHovering:!0,enableNodeHovering:!0,enableCamera:!0}),oe.on("enterNode",({node:H,event:P})=>{const q=S.getNodeAttribute(H,"label"),F=S.neighbors(H),le=[];F.forEach(ie=>{const ge=S.edge(H,ie)||S.edge(ie,H),ae=S.getEdgeAttribute(ge,"size")||1,pe=S.getNodeAttribute(ie,"label");le.push(`• ${pe} (${ae})`)}),te.innerText=`${q}
Colabora con:
${le.join(`
`)}`,te.style.left=`${P.clientX+10}px`,te.style.top=`${P.clientY+10}px`,te.style.display="block";const ne=new Set(F);ne.add(H),S.forEachNode(ie=>{S.setNodeAttribute(ie,"hidden",!ne.has(ie)),S.setNodeAttribute(ie,"forceLabel",he||ne.has(ie))}),S.forEachEdge(ie=>{const ge=S.source(ie),ae=S.target(ie),pe=ne.has(ge)&&ne.has(ae);S.setEdgeAttribute(ie,"hidden",!pe)})}),oe.on("leaveNode",()=>{te.style.display="none",S.forEachNode(H=>{S.removeNodeAttribute(H,"hidden"),S.setNodeAttribute(H,"forceLabel",he)}),S.forEachEdge(H=>S.removeEdgeAttribute(H,"hidden"))})};$.style.position="relative";const Z=document.createElement("div");if(Z.innerText="Haz click para activar la red",Object.assign(Z.style,{position:"absolute",top:0,left:0,width:"100%",height:"100%",backgroundColor:"rgba(255,255,255,0.85)",display:"flex",alignItems:"center",justifyContent:"center",fontSize:"24px",fontWeight:"bold",color:"#333",cursor:"pointer",zIndex:1e3,borderRadius:getComputedStyle($).borderRadius}),$.appendChild(Z),Z.addEventListener("click",()=>{Z.remove(),se()}),oe.getCamera().animatedReset({duration:500}),ve==="department"&&!E.is_author_view){const W=document.createElement("div");W.id="departmentLegend",Object.assign(W.style,{position:"absolute",bottom:"10px",left:"10px",backgroundColor:"rgba(255,255,255,0.9)",border:"1px solid #ccc",borderRadius:"4px",padding:"10px",fontSize:"12px",zIndex:1e3});const H=[...new Set(E.nodes.map(F=>F.department))].filter(F=>F!=="Unknown").sort(),P=document.createElement("div");P.style.fontWeight="bold",P.style.marginBottom="5px";const q=window.location.pathname.split("/")[1];P.textContent=q==="es"?"Departamentos":"Departments",W.appendChild(P),H.forEach(F=>{const le=A(F),ne=document.createElement("div");Object.assign(ne.style,{display:"flex",alignItems:"center",marginBottom:"5px"});const ie=document.createElement("div");Object.assign(ie.style,{width:"15px",height:"15px",backgroundColor:le,marginRight:"8px",border:"1px solid #000"});const ge=document.createElement("span");ge.textContent=F,ne.appendChild(ie),ne.appendChild(ge),W.appendChild(ne)}),$.appendChild(W)}}function ye(){const E=new URLSearchParams;e.value&&E.append("year_from",e.value),t.value&&E.append("year_to",t.value),p.forEach(L=>E.append("areas",L)),m.forEach(L=>E.append("institutions",L)),_.forEach(L=>E.append("types",L)),T&&E.append("author",T);const $=window.location.pathname.split("/")[1],G=$==="es"?"Todas las Áreas":"All areas",S=$==="es"?"Todas las Instituciones":"All Institutions",Y=$==="es"?"Todos los tipos":"All types";fetch(`/api/dashboard/filters/?${E.toString()}`).then(L=>{if(!L.ok)throw new Error(`HTTP error! status: ${L.status}`);return L.json()}).then(L=>{n.innerHTML=`<option value="">${G}</option>`,L.areas.forEach(A=>{const y=document.createElement("option");y.value=A.name,y.textContent=`${A.name} (${A.count})`,n.appendChild(y)}),i.innerHTML=`<option value="">${S}</option>`,L.institutions.forEach(A=>{const y=document.createElement("option");y.value=A.name,y.textContent=`${A.name} (${A.count})`,i.appendChild(y)}),r.innerHTML=`<option value="">${Y}</option>`,L.publication_types.forEach(A=>{const y=document.createElement("option");y.value=A.publication_type,y.textContent=`${A.publication_type} (${A.count})`,r.appendChild(y)})}).catch(L=>{console.error("Error updating filters:",L);const A=document.createElement("div");A.className="alert alert-danger",A.style.position="fixed",A.style.top="20px",A.style.right="20px",A.style.zIndex="9999",A.innerHTML=`
                    <strong>Error:</strong> No se pudieron actualizar los filtros.
                    <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
                `,document.body.appendChild(A),setTimeout(()=>{A.remove()},5e3)}),j()}}document.addEventListener("DOMContentLoaded",()=>{Kf()});
