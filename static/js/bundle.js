function bn(e,t){return e==null||t==null?NaN:e<t?-1:e>t?1:e>=t?0:NaN}function qa(e,t){return e==null||t==null?NaN:t<e?-1:t>e?1:t>=e?0:NaN}function fo(e){let t,n,i;e.length!==2?(t=bn,n=(s,u)=>bn(e(s),u),i=(s,u)=>e(s)-u):(t=e===bn||e===qa?e:Va,n=e,i=e);function r(s,u,l=0,c=s.length){if(l<c){if(t(u,u)!==0)return c;do{const d=l+c>>>1;n(s[d],u)<0?l=d+1:c=d}while(l<c)}return l}function o(s,u,l=0,c=s.length){if(l<c){if(t(u,u)!==0)return c;do{const d=l+c>>>1;n(s[d],u)<=0?l=d+1:c=d}while(l<c)}return l}function a(s,u,l=0,c=s.length){const d=r(s,u,l,c-1);return d>l&&i(s[d-1],u)>-i(s[d],u)?d-1:d}return{left:r,center:a,right:o}}function Va(){return 0}function Wa(e){return e===null?NaN:+e}const ja=fo(bn),Ya=ja.right;fo(Wa).center;function Xa(e,t){let n,i;if(t===void 0)for(const r of e)r!=null&&(n===void 0?r>=r&&(n=i=r):(n>r&&(n=r),i<r&&(i=r)));else{let r=-1;for(let o of e)(o=t(o,++r,e))!=null&&(n===void 0?o>=o&&(n=i=o):(n>o&&(n=o),i<o&&(i=o)))}return[n,i]}class or extends Map{constructor(t,n=Ja){if(super(),Object.defineProperties(this,{_intern:{value:new Map},_key:{value:n}}),t!=null)for(const[i,r]of t)this.set(i,r)}get(t){return super.get(ar(this,t))}has(t){return super.has(ar(this,t))}set(t,n){return super.set(Ka(this,t),n)}delete(t){return super.delete(Za(this,t))}}function ar({_intern:e,_key:t},n){const i=t(n);return e.has(i)?e.get(i):n}function Ka({_intern:e,_key:t},n){const i=t(n);return e.has(i)?e.get(i):(e.set(i,n),n)}function Za({_intern:e,_key:t},n){const i=t(n);return e.has(i)&&(n=e.get(i),e.delete(i)),n}function Ja(e){return e!==null&&typeof e=="object"?e.valueOf():e}const Qa=Math.sqrt(50),es=Math.sqrt(10),ts=Math.sqrt(2);function kn(e,t,n){const i=(t-e)/Math.max(0,n),r=Math.floor(Math.log10(i)),o=i/Math.pow(10,r),a=o>=Qa?10:o>=es?5:o>=ts?2:1;let s,u,l;return r<0?(l=Math.pow(10,-r)/a,s=Math.round(e*l),u=Math.round(t*l),s/l<e&&++s,u/l>t&&--u,l=-l):(l=Math.pow(10,r)*a,s=Math.round(e/l),u=Math.round(t/l),s*l<e&&++s,u*l>t&&--u),u<s&&.5<=n&&n<2?kn(e,t,n*2):[s,u,l]}function ns(e,t,n){if(t=+t,e=+e,n=+n,!(n>0))return[];if(e===t)return[e];const i=t<e,[r,o,a]=i?kn(t,e,n):kn(e,t,n);if(!(o>=r))return[];const s=o-r+1,u=new Array(s);if(i)if(a<0)for(let l=0;l<s;++l)u[l]=(o-l)/-a;else for(let l=0;l<s;++l)u[l]=(o-l)*a;else if(a<0)for(let l=0;l<s;++l)u[l]=(r+l)/-a;else for(let l=0;l<s;++l)u[l]=(r+l)*a;return u}function pi(e,t,n){return t=+t,e=+e,n=+n,kn(e,t,n)[2]}function is(e,t,n){t=+t,e=+e,n=+n;const i=t<e,r=i?pi(t,e,n):pi(e,t,n);return(i?-1:1)*(r<0?1/-r:r)}function sr(e,t){let n;if(t===void 0)for(const i of e)i!=null&&(n<i||n===void 0&&i>=i)&&(n=i);else{let i=-1;for(let r of e)(r=t(r,++i,e))!=null&&(n<r||n===void 0&&r>=r)&&(n=r)}return n}function rs(e,t,n){e=+e,t=+t,n=(r=arguments.length)<2?(t=e,e=0,1):r<3?1:+n;for(var i=-1,r=Math.max(0,Math.ceil((t-e)/n))|0,o=new Array(r);++i<r;)o[i]=e+i*n;return o}function Yn(e,t){let n=0;if(t===void 0)for(let i of e)(i=+i)&&(n+=i);else{let i=-1;for(let r of e)(r=+t(r,++i,e))&&(n+=r)}return n}function os(e){return e}var Xn=1,Kn=2,gi=3,Ht=4,ur=1e-6;function as(e){return"translate("+e+",0)"}function ss(e){return"translate(0,"+e+")"}function us(e){return t=>+e(t)}function ls(e,t){return t=Math.max(0,e.bandwidth()-t*2)/2,e.round()&&(t=Math.round(t)),n=>+e(n)+t}function cs(){return!this.__axis}function po(e,t){var n=[],i=null,r=null,o=6,a=6,s=3,u=typeof window<"u"&&window.devicePixelRatio>1?0:.5,l=e===Xn||e===Ht?-1:1,c=e===Ht||e===Kn?"x":"y",d=e===Xn||e===gi?as:ss;function h(f){var g=i??(t.ticks?t.ticks.apply(t,n):t.domain()),v=r??(t.tickFormat?t.tickFormat.apply(t,n):os),x=Math.max(o,0)+s,C=t.range(),b=+C[0]+u,w=+C[C.length-1]+u,m=(t.bandwidth?ls:us)(t.copy(),u),y=f.selection?f.selection():f,_=y.selectAll(".domain").data([null]),A=y.selectAll(".tick").data(g,t).order(),F=A.exit(),B=A.enter().append("g").attr("class","tick"),z=A.select("line"),D=A.select("text");_=_.merge(_.enter().insert("path",".tick").attr("class","domain").attr("stroke","currentColor")),A=A.merge(B),z=z.merge(B.append("line").attr("stroke","currentColor").attr(c+"2",l*o)),D=D.merge(B.append("text").attr("fill","currentColor").attr(c,l*x).attr("dy",e===Xn?"0em":e===gi?"0.71em":"0.32em")),f!==y&&(_=_.transition(f),A=A.transition(f),z=z.transition(f),D=D.transition(f),F=F.transition(f).attr("opacity",ur).attr("transform",function(q){return isFinite(q=m(q))?d(q+u):this.getAttribute("transform")}),B.attr("opacity",ur).attr("transform",function(q){var P=this.parentNode.__axis;return d((P&&isFinite(P=P(q))?P:m(q))+u)})),F.remove(),_.attr("d",e===Ht||e===Kn?a?"M"+l*a+","+b+"H"+u+"V"+w+"H"+l*a:"M"+u+","+b+"V"+w:a?"M"+b+","+l*a+"V"+u+"H"+w+"V"+l*a:"M"+b+","+u+"H"+w),A.attr("opacity",1).attr("transform",function(q){return d(m(q)+u)}),z.attr(c+"2",l*o),D.attr(c,l*x).text(v),y.filter(cs).attr("fill","none").attr("font-size",10).attr("font-family","sans-serif").attr("text-anchor",e===Kn?"start":e===Ht?"end":"middle"),y.each(function(){this.__axis=m})}return h.scale=function(f){return arguments.length?(t=f,h):t},h.ticks=function(){return n=Array.from(arguments),h},h.tickArguments=function(f){return arguments.length?(n=f==null?[]:Array.from(f),h):n.slice()},h.tickValues=function(f){return arguments.length?(i=f==null?null:Array.from(f),h):i&&i.slice()},h.tickFormat=function(f){return arguments.length?(r=f,h):r},h.tickSize=function(f){return arguments.length?(o=a=+f,h):o},h.tickSizeInner=function(f){return arguments.length?(o=+f,h):o},h.tickSizeOuter=function(f){return arguments.length?(a=+f,h):a},h.tickPadding=function(f){return arguments.length?(s=+f,h):s},h.offset=function(f){return arguments.length?(u=+f,h):u},h}function Zn(e){return po(gi,e)}function lr(e){return po(Ht,e)}var ds={value:()=>{}};function go(){for(var e=0,t=arguments.length,n={},i;e<t;++e){if(!(i=arguments[e]+"")||i in n||/[\s.]/.test(i))throw new Error("illegal type: "+i);n[i]=[]}return new wn(n)}function wn(e){this._=e}function hs(e,t){return e.trim().split(/^|\s+/).map(function(n){var i="",r=n.indexOf(".");if(r>=0&&(i=n.slice(r+1),n=n.slice(0,r)),n&&!t.hasOwnProperty(n))throw new Error("unknown type: "+n);return{type:n,name:i}})}wn.prototype=go.prototype={constructor:wn,on:function(e,t){var n=this._,i=hs(e+"",n),r,o=-1,a=i.length;if(arguments.length<2){for(;++o<a;)if((r=(e=i[o]).type)&&(r=fs(n[r],e.name)))return r;return}if(t!=null&&typeof t!="function")throw new Error("invalid callback: "+t);for(;++o<a;)if(r=(e=i[o]).type)n[r]=cr(n[r],e.name,t);else if(t==null)for(r in n)n[r]=cr(n[r],e.name,null);return this},copy:function(){var e={},t=this._;for(var n in t)e[n]=t[n].slice();return new wn(e)},call:function(e,t){if((r=arguments.length-2)>0)for(var n=new Array(r),i=0,r,o;i<r;++i)n[i]=arguments[i+2];if(!this._.hasOwnProperty(e))throw new Error("unknown type: "+e);for(o=this._[e],i=0,r=o.length;i<r;++i)o[i].value.apply(t,n)},apply:function(e,t,n){if(!this._.hasOwnProperty(e))throw new Error("unknown type: "+e);for(var i=this._[e],r=0,o=i.length;r<o;++r)i[r].value.apply(t,n)}};function fs(e,t){for(var n=0,i=e.length,r;n<i;++n)if((r=e[n]).name===t)return r.value}function cr(e,t,n){for(var i=0,r=e.length;i<r;++i)if(e[i].name===t){e[i]=ds,e=e.slice(0,i).concat(e.slice(i+1));break}return n!=null&&e.push({name:t,value:n}),e}var mi="http://www.w3.org/1999/xhtml";const dr={svg:"http://www.w3.org/2000/svg",xhtml:mi,xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/"};function zn(e){var t=e+="",n=t.indexOf(":");return n>=0&&(t=e.slice(0,n))!=="xmlns"&&(e=e.slice(n+1)),dr.hasOwnProperty(t)?{space:dr[t],local:e}:e}function ps(e){return function(){var t=this.ownerDocument,n=this.namespaceURI;return n===mi&&t.documentElement.namespaceURI===mi?t.createElement(e):t.createElementNS(n,e)}}function gs(e){return function(){return this.ownerDocument.createElementNS(e.space,e.local)}}function mo(e){var t=zn(e);return(t.local?gs:ps)(t)}function ms(){}function Di(e){return e==null?ms:function(){return this.querySelector(e)}}function vs(e){typeof e!="function"&&(e=Di(e));for(var t=this._groups,n=t.length,i=new Array(n),r=0;r<n;++r)for(var o=t[r],a=o.length,s=i[r]=new Array(a),u,l,c=0;c<a;++c)(u=o[c])&&(l=e.call(u,u.__data__,c,o))&&("__data__"in u&&(l.__data__=u.__data__),s[c]=l);return new Te(i,this._parents)}function ys(e){return e==null?[]:Array.isArray(e)?e:Array.from(e)}function bs(){return[]}function vo(e){return e==null?bs:function(){return this.querySelectorAll(e)}}function ws(e){return function(){return ys(e.apply(this,arguments))}}function xs(e){typeof e=="function"?e=ws(e):e=vo(e);for(var t=this._groups,n=t.length,i=[],r=[],o=0;o<n;++o)for(var a=t[o],s=a.length,u,l=0;l<s;++l)(u=a[l])&&(i.push(e.call(u,u.__data__,l,a)),r.push(u));return new Te(i,r)}function yo(e){return function(){return this.matches(e)}}function bo(e){return function(t){return t.matches(e)}}var _s=Array.prototype.find;function Es(e){return function(){return _s.call(this.children,e)}}function Cs(){return this.firstElementChild}function ks(e){return this.select(e==null?Cs:Es(typeof e=="function"?e:bo(e)))}var Ts=Array.prototype.filter;function As(){return Array.from(this.children)}function Ss(e){return function(){return Ts.call(this.children,e)}}function Ls(e){return this.selectAll(e==null?As:Ss(typeof e=="function"?e:bo(e)))}function Rs(e){typeof e!="function"&&(e=yo(e));for(var t=this._groups,n=t.length,i=new Array(n),r=0;r<n;++r)for(var o=t[r],a=o.length,s=i[r]=[],u,l=0;l<a;++l)(u=o[l])&&e.call(u,u.__data__,l,o)&&s.push(u);return new Te(i,this._parents)}function wo(e){return new Array(e.length)}function Ns(){return new Te(this._enter||this._groups.map(wo),this._parents)}function Tn(e,t){this.ownerDocument=e.ownerDocument,this.namespaceURI=e.namespaceURI,this._next=null,this._parent=e,this.__data__=t}Tn.prototype={constructor:Tn,appendChild:function(e){return this._parent.insertBefore(e,this._next)},insertBefore:function(e,t){return this._parent.insertBefore(e,t)},querySelector:function(e){return this._parent.querySelector(e)},querySelectorAll:function(e){return this._parent.querySelectorAll(e)}};function Ms(e){return function(){return e}}function Ds(e,t,n,i,r,o){for(var a=0,s,u=t.length,l=o.length;a<l;++a)(s=t[a])?(s.__data__=o[a],i[a]=s):n[a]=new Tn(e,o[a]);for(;a<u;++a)(s=t[a])&&(r[a]=s)}function $s(e,t,n,i,r,o,a){var s,u,l=new Map,c=t.length,d=o.length,h=new Array(c),f;for(s=0;s<c;++s)(u=t[s])&&(h[s]=f=a.call(u,u.__data__,s,t)+"",l.has(f)?r[s]=u:l.set(f,u));for(s=0;s<d;++s)f=a.call(e,o[s],s,o)+"",(u=l.get(f))?(i[s]=u,u.__data__=o[s],l.delete(f)):n[s]=new Tn(e,o[s]);for(s=0;s<c;++s)(u=t[s])&&l.get(h[s])===u&&(r[s]=u)}function Is(e){return e.__data__}function Ps(e,t){if(!arguments.length)return Array.from(this,Is);var n=t?$s:Ds,i=this._parents,r=this._groups;typeof e!="function"&&(e=Ms(e));for(var o=r.length,a=new Array(o),s=new Array(o),u=new Array(o),l=0;l<o;++l){var c=i[l],d=r[l],h=d.length,f=Fs(e.call(c,c&&c.__data__,l,i)),g=f.length,v=s[l]=new Array(g),x=a[l]=new Array(g),C=u[l]=new Array(h);n(c,d,v,x,C,f,t);for(var b=0,w=0,m,y;b<g;++b)if(m=v[b]){for(b>=w&&(w=b+1);!(y=x[w])&&++w<g;);m._next=y||null}}return a=new Te(a,i),a._enter=s,a._exit=u,a}function Fs(e){return typeof e=="object"&&"length"in e?e:Array.from(e)}function Gs(){return new Te(this._exit||this._groups.map(wo),this._parents)}function zs(e,t,n){var i=this.enter(),r=this,o=this.exit();return typeof e=="function"?(i=e(i),i&&(i=i.selection())):i=i.append(e+""),t!=null&&(r=t(r),r&&(r=r.selection())),n==null?o.remove():n(o),i&&r?i.merge(r).order():r}function Bs(e){for(var t=e.selection?e.selection():e,n=this._groups,i=t._groups,r=n.length,o=i.length,a=Math.min(r,o),s=new Array(r),u=0;u<a;++u)for(var l=n[u],c=i[u],d=l.length,h=s[u]=new Array(d),f,g=0;g<d;++g)(f=l[g]||c[g])&&(h[g]=f);for(;u<r;++u)s[u]=n[u];return new Te(s,this._parents)}function Os(){for(var e=this._groups,t=-1,n=e.length;++t<n;)for(var i=e[t],r=i.length-1,o=i[r],a;--r>=0;)(a=i[r])&&(o&&a.compareDocumentPosition(o)^4&&o.parentNode.insertBefore(a,o),o=a);return this}function Us(e){e||(e=Hs);function t(d,h){return d&&h?e(d.__data__,h.__data__):!d-!h}for(var n=this._groups,i=n.length,r=new Array(i),o=0;o<i;++o){for(var a=n[o],s=a.length,u=r[o]=new Array(s),l,c=0;c<s;++c)(l=a[c])&&(u[c]=l);u.sort(t)}return new Te(r,this._parents).order()}function Hs(e,t){return e<t?-1:e>t?1:e>=t?0:NaN}function qs(){var e=arguments[0];return arguments[0]=this,e.apply(null,arguments),this}function Vs(){return Array.from(this)}function Ws(){for(var e=this._groups,t=0,n=e.length;t<n;++t)for(var i=e[t],r=0,o=i.length;r<o;++r){var a=i[r];if(a)return a}return null}function js(){let e=0;for(const t of this)++e;return e}function Ys(){return!this.node()}function Xs(e){for(var t=this._groups,n=0,i=t.length;n<i;++n)for(var r=t[n],o=0,a=r.length,s;o<a;++o)(s=r[o])&&e.call(s,s.__data__,o,r);return this}function Ks(e){return function(){this.removeAttribute(e)}}function Zs(e){return function(){this.removeAttributeNS(e.space,e.local)}}function Js(e,t){return function(){this.setAttribute(e,t)}}function Qs(e,t){return function(){this.setAttributeNS(e.space,e.local,t)}}function eu(e,t){return function(){var n=t.apply(this,arguments);n==null?this.removeAttribute(e):this.setAttribute(e,n)}}function tu(e,t){return function(){var n=t.apply(this,arguments);n==null?this.removeAttributeNS(e.space,e.local):this.setAttributeNS(e.space,e.local,n)}}function nu(e,t){var n=zn(e);if(arguments.length<2){var i=this.node();return n.local?i.getAttributeNS(n.space,n.local):i.getAttribute(n)}return this.each((t==null?n.local?Zs:Ks:typeof t=="function"?n.local?tu:eu:n.local?Qs:Js)(n,t))}function xo(e){return e.ownerDocument&&e.ownerDocument.defaultView||e.document&&e||e.defaultView}function iu(e){return function(){this.style.removeProperty(e)}}function ru(e,t,n){return function(){this.style.setProperty(e,t,n)}}function ou(e,t,n){return function(){var i=t.apply(this,arguments);i==null?this.style.removeProperty(e):this.style.setProperty(e,i,n)}}function au(e,t,n){return arguments.length>1?this.each((t==null?iu:typeof t=="function"?ou:ru)(e,t,n??"")):kt(this.node(),e)}function kt(e,t){return e.style.getPropertyValue(t)||xo(e).getComputedStyle(e,null).getPropertyValue(t)}function su(e){return function(){delete this[e]}}function uu(e,t){return function(){this[e]=t}}function lu(e,t){return function(){var n=t.apply(this,arguments);n==null?delete this[e]:this[e]=n}}function cu(e,t){return arguments.length>1?this.each((t==null?su:typeof t=="function"?lu:uu)(e,t)):this.node()[e]}function _o(e){return e.trim().split(/^|\s+/)}function $i(e){return e.classList||new Eo(e)}function Eo(e){this._node=e,this._names=_o(e.getAttribute("class")||"")}Eo.prototype={add:function(e){var t=this._names.indexOf(e);t<0&&(this._names.push(e),this._node.setAttribute("class",this._names.join(" ")))},remove:function(e){var t=this._names.indexOf(e);t>=0&&(this._names.splice(t,1),this._node.setAttribute("class",this._names.join(" ")))},contains:function(e){return this._names.indexOf(e)>=0}};function Co(e,t){for(var n=$i(e),i=-1,r=t.length;++i<r;)n.add(t[i])}function ko(e,t){for(var n=$i(e),i=-1,r=t.length;++i<r;)n.remove(t[i])}function du(e){return function(){Co(this,e)}}function hu(e){return function(){ko(this,e)}}function fu(e,t){return function(){(t.apply(this,arguments)?Co:ko)(this,e)}}function pu(e,t){var n=_o(e+"");if(arguments.length<2){for(var i=$i(this.node()),r=-1,o=n.length;++r<o;)if(!i.contains(n[r]))return!1;return!0}return this.each((typeof t=="function"?fu:t?du:hu)(n,t))}function gu(){this.textContent=""}function mu(e){return function(){this.textContent=e}}function vu(e){return function(){var t=e.apply(this,arguments);this.textContent=t??""}}function yu(e){return arguments.length?this.each(e==null?gu:(typeof e=="function"?vu:mu)(e)):this.node().textContent}function bu(){this.innerHTML=""}function wu(e){return function(){this.innerHTML=e}}function xu(e){return function(){var t=e.apply(this,arguments);this.innerHTML=t??""}}function _u(e){return arguments.length?this.each(e==null?bu:(typeof e=="function"?xu:wu)(e)):this.node().innerHTML}function Eu(){this.nextSibling&&this.parentNode.appendChild(this)}function Cu(){return this.each(Eu)}function ku(){this.previousSibling&&this.parentNode.insertBefore(this,this.parentNode.firstChild)}function Tu(){return this.each(ku)}function Au(e){var t=typeof e=="function"?e:mo(e);return this.select(function(){return this.appendChild(t.apply(this,arguments))})}function Su(){return null}function Lu(e,t){var n=typeof e=="function"?e:mo(e),i=t==null?Su:typeof t=="function"?t:Di(t);return this.select(function(){return this.insertBefore(n.apply(this,arguments),i.apply(this,arguments)||null)})}function Ru(){var e=this.parentNode;e&&e.removeChild(this)}function Nu(){return this.each(Ru)}function Mu(){var e=this.cloneNode(!1),t=this.parentNode;return t?t.insertBefore(e,this.nextSibling):e}function Du(){var e=this.cloneNode(!0),t=this.parentNode;return t?t.insertBefore(e,this.nextSibling):e}function $u(e){return this.select(e?Du:Mu)}function Iu(e){return arguments.length?this.property("__data__",e):this.node().__data__}function Pu(e){return function(t){e.call(this,t,this.__data__)}}function Fu(e){return e.trim().split(/^|\s+/).map(function(t){var n="",i=t.indexOf(".");return i>=0&&(n=t.slice(i+1),t=t.slice(0,i)),{type:t,name:n}})}function Gu(e){return function(){var t=this.__on;if(t){for(var n=0,i=-1,r=t.length,o;n<r;++n)o=t[n],(!e.type||o.type===e.type)&&o.name===e.name?this.removeEventListener(o.type,o.listener,o.options):t[++i]=o;++i?t.length=i:delete this.__on}}}function zu(e,t,n){return function(){var i=this.__on,r,o=Pu(t);if(i){for(var a=0,s=i.length;a<s;++a)if((r=i[a]).type===e.type&&r.name===e.name){this.removeEventListener(r.type,r.listener,r.options),this.addEventListener(r.type,r.listener=o,r.options=n),r.value=t;return}}this.addEventListener(e.type,o,n),r={type:e.type,name:e.name,value:t,listener:o,options:n},i?i.push(r):this.__on=[r]}}function Bu(e,t,n){var i=Fu(e+""),r,o=i.length,a;if(arguments.length<2){var s=this.node().__on;if(s){for(var u=0,l=s.length,c;u<l;++u)for(r=0,c=s[u];r<o;++r)if((a=i[r]).type===c.type&&a.name===c.name)return c.value}return}for(s=t?zu:Gu,r=0;r<o;++r)this.each(s(i[r],t,n));return this}function To(e,t,n){var i=xo(e),r=i.CustomEvent;typeof r=="function"?r=new r(t,n):(r=i.document.createEvent("Event"),n?(r.initEvent(t,n.bubbles,n.cancelable),r.detail=n.detail):r.initEvent(t,!1,!1)),e.dispatchEvent(r)}function Ou(e,t){return function(){return To(this,e,t)}}function Uu(e,t){return function(){return To(this,e,t.apply(this,arguments))}}function Hu(e,t){return this.each((typeof t=="function"?Uu:Ou)(e,t))}function*qu(){for(var e=this._groups,t=0,n=e.length;t<n;++t)for(var i=e[t],r=0,o=i.length,a;r<o;++r)(a=i[r])&&(yield a)}var Ao=[null];function Te(e,t){this._groups=e,this._parents=t}function en(){return new Te([[document.documentElement]],Ao)}function Vu(){return this}Te.prototype=en.prototype={constructor:Te,select:vs,selectAll:xs,selectChild:ks,selectChildren:Ls,filter:Rs,data:Ps,enter:Ns,exit:Gs,join:zs,merge:Bs,selection:Vu,order:Os,sort:Us,call:qs,nodes:Vs,node:Ws,size:js,empty:Ys,each:Xs,attr:nu,style:au,property:cu,classed:pu,text:yu,html:_u,raise:Cu,lower:Tu,append:Au,insert:Lu,remove:Nu,clone:$u,datum:Iu,on:Bu,dispatch:Hu,[Symbol.iterator]:qu};function Ie(e){return typeof e=="string"?new Te([[document.querySelector(e)]],[document.documentElement]):new Te([[e]],Ao)}function qe(e){return new Te([document.querySelectorAll(e)],[document.documentElement])}function Ii(e,t,n){e.prototype=t.prototype=n,n.constructor=e}function So(e,t){var n=Object.create(e.prototype);for(var i in t)n[i]=t[i];return n}function tn(){}var Kt=.7,An=1/Kt,Et="\\s*([+-]?\\d+)\\s*",Zt="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)\\s*",We="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)%\\s*",Wu=/^#([0-9a-f]{3,8})$/,ju=new RegExp(`^rgb\\(${Et},${Et},${Et}\\)$`),Yu=new RegExp(`^rgb\\(${We},${We},${We}\\)$`),Xu=new RegExp(`^rgba\\(${Et},${Et},${Et},${Zt}\\)$`),Ku=new RegExp(`^rgba\\(${We},${We},${We},${Zt}\\)$`),Zu=new RegExp(`^hsl\\(${Zt},${We},${We}\\)$`),Ju=new RegExp(`^hsla\\(${Zt},${We},${We},${Zt}\\)$`),hr={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074};Ii(tn,mt,{copy(e){return Object.assign(new this.constructor,this,e)},displayable(){return this.rgb().displayable()},hex:fr,formatHex:fr,formatHex8:Qu,formatHsl:el,formatRgb:pr,toString:pr});function fr(){return this.rgb().formatHex()}function Qu(){return this.rgb().formatHex8()}function el(){return Lo(this).formatHsl()}function pr(){return this.rgb().formatRgb()}function mt(e){var t,n;return e=(e+"").trim().toLowerCase(),(t=Wu.exec(e))?(n=t[1].length,t=parseInt(t[1],16),n===6?gr(t):n===3?new ke(t>>8&15|t>>4&240,t>>4&15|t&240,(t&15)<<4|t&15,1):n===8?un(t>>24&255,t>>16&255,t>>8&255,(t&255)/255):n===4?un(t>>12&15|t>>8&240,t>>8&15|t>>4&240,t>>4&15|t&240,((t&15)<<4|t&15)/255):null):(t=ju.exec(e))?new ke(t[1],t[2],t[3],1):(t=Yu.exec(e))?new ke(t[1]*255/100,t[2]*255/100,t[3]*255/100,1):(t=Xu.exec(e))?un(t[1],t[2],t[3],t[4]):(t=Ku.exec(e))?un(t[1]*255/100,t[2]*255/100,t[3]*255/100,t[4]):(t=Zu.exec(e))?yr(t[1],t[2]/100,t[3]/100,1):(t=Ju.exec(e))?yr(t[1],t[2]/100,t[3]/100,t[4]):hr.hasOwnProperty(e)?gr(hr[e]):e==="transparent"?new ke(NaN,NaN,NaN,0):null}function gr(e){return new ke(e>>16&255,e>>8&255,e&255,1)}function un(e,t,n,i){return i<=0&&(e=t=n=NaN),new ke(e,t,n,i)}function tl(e){return e instanceof tn||(e=mt(e)),e?(e=e.rgb(),new ke(e.r,e.g,e.b,e.opacity)):new ke}function vi(e,t,n,i){return arguments.length===1?tl(e):new ke(e,t,n,i??1)}function ke(e,t,n,i){this.r=+e,this.g=+t,this.b=+n,this.opacity=+i}Ii(ke,vi,So(tn,{brighter(e){return e=e==null?An:Math.pow(An,e),new ke(this.r*e,this.g*e,this.b*e,this.opacity)},darker(e){return e=e==null?Kt:Math.pow(Kt,e),new ke(this.r*e,this.g*e,this.b*e,this.opacity)},rgb(){return this},clamp(){return new ke(gt(this.r),gt(this.g),gt(this.b),Sn(this.opacity))},displayable(){return-.5<=this.r&&this.r<255.5&&-.5<=this.g&&this.g<255.5&&-.5<=this.b&&this.b<255.5&&0<=this.opacity&&this.opacity<=1},hex:mr,formatHex:mr,formatHex8:nl,formatRgb:vr,toString:vr}));function mr(){return`#${pt(this.r)}${pt(this.g)}${pt(this.b)}`}function nl(){return`#${pt(this.r)}${pt(this.g)}${pt(this.b)}${pt((isNaN(this.opacity)?1:this.opacity)*255)}`}function vr(){const e=Sn(this.opacity);return`${e===1?"rgb(":"rgba("}${gt(this.r)}, ${gt(this.g)}, ${gt(this.b)}${e===1?")":`, ${e})`}`}function Sn(e){return isNaN(e)?1:Math.max(0,Math.min(1,e))}function gt(e){return Math.max(0,Math.min(255,Math.round(e)||0))}function pt(e){return e=gt(e),(e<16?"0":"")+e.toString(16)}function yr(e,t,n,i){return i<=0?e=t=n=NaN:n<=0||n>=1?e=t=NaN:t<=0&&(e=NaN),new ze(e,t,n,i)}function Lo(e){if(e instanceof ze)return new ze(e.h,e.s,e.l,e.opacity);if(e instanceof tn||(e=mt(e)),!e)return new ze;if(e instanceof ze)return e;e=e.rgb();var t=e.r/255,n=e.g/255,i=e.b/255,r=Math.min(t,n,i),o=Math.max(t,n,i),a=NaN,s=o-r,u=(o+r)/2;return s?(t===o?a=(n-i)/s+(n<i)*6:n===o?a=(i-t)/s+2:a=(t-n)/s+4,s/=u<.5?o+r:2-o-r,a*=60):s=u>0&&u<1?0:a,new ze(a,s,u,e.opacity)}function il(e,t,n,i){return arguments.length===1?Lo(e):new ze(e,t,n,i??1)}function ze(e,t,n,i){this.h=+e,this.s=+t,this.l=+n,this.opacity=+i}Ii(ze,il,So(tn,{brighter(e){return e=e==null?An:Math.pow(An,e),new ze(this.h,this.s,this.l*e,this.opacity)},darker(e){return e=e==null?Kt:Math.pow(Kt,e),new ze(this.h,this.s,this.l*e,this.opacity)},rgb(){var e=this.h%360+(this.h<0)*360,t=isNaN(e)||isNaN(this.s)?0:this.s,n=this.l,i=n+(n<.5?n:1-n)*t,r=2*n-i;return new ke(Jn(e>=240?e-240:e+120,r,i),Jn(e,r,i),Jn(e<120?e+240:e-120,r,i),this.opacity)},clamp(){return new ze(br(this.h),ln(this.s),ln(this.l),Sn(this.opacity))},displayable(){return(0<=this.s&&this.s<=1||isNaN(this.s))&&0<=this.l&&this.l<=1&&0<=this.opacity&&this.opacity<=1},formatHsl(){const e=Sn(this.opacity);return`${e===1?"hsl(":"hsla("}${br(this.h)}, ${ln(this.s)*100}%, ${ln(this.l)*100}%${e===1?")":`, ${e})`}`}}));function br(e){return e=(e||0)%360,e<0?e+360:e}function ln(e){return Math.max(0,Math.min(1,e||0))}function Jn(e,t,n){return(e<60?t+(n-t)*e/60:e<180?n:e<240?t+(n-t)*(240-e)/60:t)*255}const Pi=e=>()=>e;function rl(e,t){return function(n){return e+n*t}}function ol(e,t,n){return e=Math.pow(e,n),t=Math.pow(t,n)-e,n=1/n,function(i){return Math.pow(e+i*t,n)}}function al(e){return(e=+e)==1?Ro:function(t,n){return n-t?ol(t,n,e):Pi(isNaN(t)?n:t)}}function Ro(e,t){var n=t-e;return n?rl(e,n):Pi(isNaN(e)?t:e)}const Ln=function e(t){var n=al(t);function i(r,o){var a=n((r=vi(r)).r,(o=vi(o)).r),s=n(r.g,o.g),u=n(r.b,o.b),l=Ro(r.opacity,o.opacity);return function(c){return r.r=a(c),r.g=s(c),r.b=u(c),r.opacity=l(c),r+""}}return i.gamma=e,i}(1);function sl(e,t){t||(t=[]);var n=e?Math.min(t.length,e.length):0,i=t.slice(),r;return function(o){for(r=0;r<n;++r)i[r]=e[r]*(1-o)+t[r]*o;return i}}function ul(e){return ArrayBuffer.isView(e)&&!(e instanceof DataView)}function ll(e,t){var n=t?t.length:0,i=e?Math.min(n,e.length):0,r=new Array(i),o=new Array(n),a;for(a=0;a<i;++a)r[a]=Fi(e[a],t[a]);for(;a<n;++a)o[a]=t[a];return function(s){for(a=0;a<i;++a)o[a]=r[a](s);return o}}function cl(e,t){var n=new Date;return e=+e,t=+t,function(i){return n.setTime(e*(1-i)+t*i),n}}function Ge(e,t){return e=+e,t=+t,function(n){return e*(1-n)+t*n}}function dl(e,t){var n={},i={},r;(e===null||typeof e!="object")&&(e={}),(t===null||typeof t!="object")&&(t={});for(r in t)r in e?n[r]=Fi(e[r],t[r]):i[r]=t[r];return function(o){for(r in n)i[r]=n[r](o);return i}}var yi=/[-+]?(?:\d+\.?\d*|\.?\d+)(?:[eE][-+]?\d+)?/g,Qn=new RegExp(yi.source,"g");function hl(e){return function(){return e}}function fl(e){return function(t){return e(t)+""}}function No(e,t){var n=yi.lastIndex=Qn.lastIndex=0,i,r,o,a=-1,s=[],u=[];for(e=e+"",t=t+"";(i=yi.exec(e))&&(r=Qn.exec(t));)(o=r.index)>n&&(o=t.slice(n,o),s[a]?s[a]+=o:s[++a]=o),(i=i[0])===(r=r[0])?s[a]?s[a]+=r:s[++a]=r:(s[++a]=null,u.push({i:a,x:Ge(i,r)})),n=Qn.lastIndex;return n<t.length&&(o=t.slice(n),s[a]?s[a]+=o:s[++a]=o),s.length<2?u[0]?fl(u[0].x):hl(t):(t=u.length,function(l){for(var c=0,d;c<t;++c)s[(d=u[c]).i]=d.x(l);return s.join("")})}function Fi(e,t){var n=typeof t,i;return t==null||n==="boolean"?Pi(t):(n==="number"?Ge:n==="string"?(i=mt(t))?(t=i,Ln):No:t instanceof mt?Ln:t instanceof Date?cl:ul(t)?sl:Array.isArray(t)?ll:typeof t.valueOf!="function"&&typeof t.toString!="function"||isNaN(t)?dl:Ge)(e,t)}function pl(e,t){return e=+e,t=+t,function(n){return Math.round(e*(1-n)+t*n)}}var wr=180/Math.PI,bi={translateX:0,translateY:0,rotate:0,skewX:0,scaleX:1,scaleY:1};function Mo(e,t,n,i,r,o){var a,s,u;return(a=Math.sqrt(e*e+t*t))&&(e/=a,t/=a),(u=e*n+t*i)&&(n-=e*u,i-=t*u),(s=Math.sqrt(n*n+i*i))&&(n/=s,i/=s,u/=s),e*i<t*n&&(e=-e,t=-t,u=-u,a=-a),{translateX:r,translateY:o,rotate:Math.atan2(t,e)*wr,skewX:Math.atan(u)*wr,scaleX:a,scaleY:s}}var cn;function gl(e){const t=new(typeof DOMMatrix=="function"?DOMMatrix:WebKitCSSMatrix)(e+"");return t.isIdentity?bi:Mo(t.a,t.b,t.c,t.d,t.e,t.f)}function ml(e){return e==null||(cn||(cn=document.createElementNS("http://www.w3.org/2000/svg","g")),cn.setAttribute("transform",e),!(e=cn.transform.baseVal.consolidate()))?bi:(e=e.matrix,Mo(e.a,e.b,e.c,e.d,e.e,e.f))}function Do(e,t,n,i){function r(l){return l.length?l.pop()+" ":""}function o(l,c,d,h,f,g){if(l!==d||c!==h){var v=f.push("translate(",null,t,null,n);g.push({i:v-4,x:Ge(l,d)},{i:v-2,x:Ge(c,h)})}else(d||h)&&f.push("translate("+d+t+h+n)}function a(l,c,d,h){l!==c?(l-c>180?c+=360:c-l>180&&(l+=360),h.push({i:d.push(r(d)+"rotate(",null,i)-2,x:Ge(l,c)})):c&&d.push(r(d)+"rotate("+c+i)}function s(l,c,d,h){l!==c?h.push({i:d.push(r(d)+"skewX(",null,i)-2,x:Ge(l,c)}):c&&d.push(r(d)+"skewX("+c+i)}function u(l,c,d,h,f,g){if(l!==d||c!==h){var v=f.push(r(f)+"scale(",null,",",null,")");g.push({i:v-4,x:Ge(l,d)},{i:v-2,x:Ge(c,h)})}else(d!==1||h!==1)&&f.push(r(f)+"scale("+d+","+h+")")}return function(l,c){var d=[],h=[];return l=e(l),c=e(c),o(l.translateX,l.translateY,c.translateX,c.translateY,d,h),a(l.rotate,c.rotate,d,h),s(l.skewX,c.skewX,d,h),u(l.scaleX,l.scaleY,c.scaleX,c.scaleY,d,h),l=c=null,function(f){for(var g=-1,v=h.length,x;++g<v;)d[(x=h[g]).i]=x.x(f);return d.join("")}}}var vl=Do(gl,"px, ","px)","deg)"),yl=Do(ml,", ",")",")"),Tt=0,qt=0,Pt=0,$o=1e3,Rn,Vt,Nn=0,vt=0,Bn=0,Jt=typeof performance=="object"&&performance.now?performance:Date,Io=typeof window=="object"&&window.requestAnimationFrame?window.requestAnimationFrame.bind(window):function(e){setTimeout(e,17)};function Gi(){return vt||(Io(bl),vt=Jt.now()+Bn)}function bl(){vt=0}function Mn(){this._call=this._time=this._next=null}Mn.prototype=Po.prototype={constructor:Mn,restart:function(e,t,n){if(typeof e!="function")throw new TypeError("callback is not a function");n=(n==null?Gi():+n)+(t==null?0:+t),!this._next&&Vt!==this&&(Vt?Vt._next=this:Rn=this,Vt=this),this._call=e,this._time=n,wi()},stop:function(){this._call&&(this._call=null,this._time=1/0,wi())}};function Po(e,t,n){var i=new Mn;return i.restart(e,t,n),i}function wl(){Gi(),++Tt;for(var e=Rn,t;e;)(t=vt-e._time)>=0&&e._call.call(void 0,t),e=e._next;--Tt}function xr(){vt=(Nn=Jt.now())+Bn,Tt=qt=0;try{wl()}finally{Tt=0,_l(),vt=0}}function xl(){var e=Jt.now(),t=e-Nn;t>$o&&(Bn-=t,Nn=e)}function _l(){for(var e,t=Rn,n,i=1/0;t;)t._call?(i>t._time&&(i=t._time),e=t,t=t._next):(n=t._next,t._next=null,t=e?e._next=n:Rn=n);Vt=e,wi(i)}function wi(e){if(!Tt){qt&&(qt=clearTimeout(qt));var t=e-vt;t>24?(e<1/0&&(qt=setTimeout(xr,e-Jt.now()-Bn)),Pt&&(Pt=clearInterval(Pt))):(Pt||(Nn=Jt.now(),Pt=setInterval(xl,$o)),Tt=1,Io(xr))}}function _r(e,t,n){var i=new Mn;return t=t==null?0:+t,i.restart(r=>{i.stop(),e(r+t)},t,n),i}var El=go("start","end","cancel","interrupt"),Cl=[],Fo=0,Er=1,xi=2,xn=3,Cr=4,_i=5,_n=6;function On(e,t,n,i,r,o){var a=e.__transition;if(!a)e.__transition={};else if(n in a)return;kl(e,n,{name:t,index:i,group:r,on:El,tween:Cl,time:o.time,delay:o.delay,duration:o.duration,ease:o.ease,timer:null,state:Fo})}function zi(e,t){var n=Oe(e,t);if(n.state>Fo)throw new Error("too late; already scheduled");return n}function je(e,t){var n=Oe(e,t);if(n.state>xn)throw new Error("too late; already running");return n}function Oe(e,t){var n=e.__transition;if(!n||!(n=n[t]))throw new Error("transition not found");return n}function kl(e,t,n){var i=e.__transition,r;i[t]=n,n.timer=Po(o,0,n.time);function o(l){n.state=Er,n.timer.restart(a,n.delay,n.time),n.delay<=l&&a(l-n.delay)}function a(l){var c,d,h,f;if(n.state!==Er)return u();for(c in i)if(f=i[c],f.name===n.name){if(f.state===xn)return _r(a);f.state===Cr?(f.state=_n,f.timer.stop(),f.on.call("interrupt",e,e.__data__,f.index,f.group),delete i[c]):+c<t&&(f.state=_n,f.timer.stop(),f.on.call("cancel",e,e.__data__,f.index,f.group),delete i[c])}if(_r(function(){n.state===xn&&(n.state=Cr,n.timer.restart(s,n.delay,n.time),s(l))}),n.state=xi,n.on.call("start",e,e.__data__,n.index,n.group),n.state===xi){for(n.state=xn,r=new Array(h=n.tween.length),c=0,d=-1;c<h;++c)(f=n.tween[c].value.call(e,e.__data__,n.index,n.group))&&(r[++d]=f);r.length=d+1}}function s(l){for(var c=l<n.duration?n.ease.call(null,l/n.duration):(n.timer.restart(u),n.state=_i,1),d=-1,h=r.length;++d<h;)r[d].call(e,c);n.state===_i&&(n.on.call("end",e,e.__data__,n.index,n.group),u())}function u(){n.state=_n,n.timer.stop(),delete i[t];for(var l in i)return;delete e.__transition}}function Tl(e,t){var n=e.__transition,i,r,o=!0,a;if(n){t=t==null?null:t+"";for(a in n){if((i=n[a]).name!==t){o=!1;continue}r=i.state>xi&&i.state<_i,i.state=_n,i.timer.stop(),i.on.call(r?"interrupt":"cancel",e,e.__data__,i.index,i.group),delete n[a]}o&&delete e.__transition}}function Al(e){return this.each(function(){Tl(this,e)})}function Sl(e,t){var n,i;return function(){var r=je(this,e),o=r.tween;if(o!==n){i=n=o;for(var a=0,s=i.length;a<s;++a)if(i[a].name===t){i=i.slice(),i.splice(a,1);break}}r.tween=i}}function Ll(e,t,n){var i,r;if(typeof n!="function")throw new Error;return function(){var o=je(this,e),a=o.tween;if(a!==i){r=(i=a).slice();for(var s={name:t,value:n},u=0,l=r.length;u<l;++u)if(r[u].name===t){r[u]=s;break}u===l&&r.push(s)}o.tween=r}}function Rl(e,t){var n=this._id;if(e+="",arguments.length<2){for(var i=Oe(this.node(),n).tween,r=0,o=i.length,a;r<o;++r)if((a=i[r]).name===e)return a.value;return null}return this.each((t==null?Sl:Ll)(n,e,t))}function Bi(e,t,n){var i=e._id;return e.each(function(){var r=je(this,i);(r.value||(r.value={}))[t]=n.apply(this,arguments)}),function(r){return Oe(r,i).value[t]}}function Go(e,t){var n;return(typeof t=="number"?Ge:t instanceof mt?Ln:(n=mt(t))?(t=n,Ln):No)(e,t)}function Nl(e){return function(){this.removeAttribute(e)}}function Ml(e){return function(){this.removeAttributeNS(e.space,e.local)}}function Dl(e,t,n){var i,r=n+"",o;return function(){var a=this.getAttribute(e);return a===r?null:a===i?o:o=t(i=a,n)}}function $l(e,t,n){var i,r=n+"",o;return function(){var a=this.getAttributeNS(e.space,e.local);return a===r?null:a===i?o:o=t(i=a,n)}}function Il(e,t,n){var i,r,o;return function(){var a,s=n(this),u;return s==null?void this.removeAttribute(e):(a=this.getAttribute(e),u=s+"",a===u?null:a===i&&u===r?o:(r=u,o=t(i=a,s)))}}function Pl(e,t,n){var i,r,o;return function(){var a,s=n(this),u;return s==null?void this.removeAttributeNS(e.space,e.local):(a=this.getAttributeNS(e.space,e.local),u=s+"",a===u?null:a===i&&u===r?o:(r=u,o=t(i=a,s)))}}function Fl(e,t){var n=zn(e),i=n==="transform"?yl:Go;return this.attrTween(e,typeof t=="function"?(n.local?Pl:Il)(n,i,Bi(this,"attr."+e,t)):t==null?(n.local?Ml:Nl)(n):(n.local?$l:Dl)(n,i,t))}function Gl(e,t){return function(n){this.setAttribute(e,t.call(this,n))}}function zl(e,t){return function(n){this.setAttributeNS(e.space,e.local,t.call(this,n))}}function Bl(e,t){var n,i;function r(){var o=t.apply(this,arguments);return o!==i&&(n=(i=o)&&zl(e,o)),n}return r._value=t,r}function Ol(e,t){var n,i;function r(){var o=t.apply(this,arguments);return o!==i&&(n=(i=o)&&Gl(e,o)),n}return r._value=t,r}function Ul(e,t){var n="attr."+e;if(arguments.length<2)return(n=this.tween(n))&&n._value;if(t==null)return this.tween(n,null);if(typeof t!="function")throw new Error;var i=zn(e);return this.tween(n,(i.local?Bl:Ol)(i,t))}function Hl(e,t){return function(){zi(this,e).delay=+t.apply(this,arguments)}}function ql(e,t){return t=+t,function(){zi(this,e).delay=t}}function Vl(e){var t=this._id;return arguments.length?this.each((typeof e=="function"?Hl:ql)(t,e)):Oe(this.node(),t).delay}function Wl(e,t){return function(){je(this,e).duration=+t.apply(this,arguments)}}function jl(e,t){return t=+t,function(){je(this,e).duration=t}}function Yl(e){var t=this._id;return arguments.length?this.each((typeof e=="function"?Wl:jl)(t,e)):Oe(this.node(),t).duration}function Xl(e,t){if(typeof t!="function")throw new Error;return function(){je(this,e).ease=t}}function Kl(e){var t=this._id;return arguments.length?this.each(Xl(t,e)):Oe(this.node(),t).ease}function Zl(e,t){return function(){var n=t.apply(this,arguments);if(typeof n!="function")throw new Error;je(this,e).ease=n}}function Jl(e){if(typeof e!="function")throw new Error;return this.each(Zl(this._id,e))}function Ql(e){typeof e!="function"&&(e=yo(e));for(var t=this._groups,n=t.length,i=new Array(n),r=0;r<n;++r)for(var o=t[r],a=o.length,s=i[r]=[],u,l=0;l<a;++l)(u=o[l])&&e.call(u,u.__data__,l,o)&&s.push(u);return new et(i,this._parents,this._name,this._id)}function ec(e){if(e._id!==this._id)throw new Error;for(var t=this._groups,n=e._groups,i=t.length,r=n.length,o=Math.min(i,r),a=new Array(i),s=0;s<o;++s)for(var u=t[s],l=n[s],c=u.length,d=a[s]=new Array(c),h,f=0;f<c;++f)(h=u[f]||l[f])&&(d[f]=h);for(;s<i;++s)a[s]=t[s];return new et(a,this._parents,this._name,this._id)}function tc(e){return(e+"").trim().split(/^|\s+/).every(function(t){var n=t.indexOf(".");return n>=0&&(t=t.slice(0,n)),!t||t==="start"})}function nc(e,t,n){var i,r,o=tc(t)?zi:je;return function(){var a=o(this,e),s=a.on;s!==i&&(r=(i=s).copy()).on(t,n),a.on=r}}function ic(e,t){var n=this._id;return arguments.length<2?Oe(this.node(),n).on.on(e):this.each(nc(n,e,t))}function rc(e){return function(){var t=this.parentNode;for(var n in this.__transition)if(+n!==e)return;t&&t.removeChild(this)}}function oc(){return this.on("end.remove",rc(this._id))}function ac(e){var t=this._name,n=this._id;typeof e!="function"&&(e=Di(e));for(var i=this._groups,r=i.length,o=new Array(r),a=0;a<r;++a)for(var s=i[a],u=s.length,l=o[a]=new Array(u),c,d,h=0;h<u;++h)(c=s[h])&&(d=e.call(c,c.__data__,h,s))&&("__data__"in c&&(d.__data__=c.__data__),l[h]=d,On(l[h],t,n,h,l,Oe(c,n)));return new et(o,this._parents,t,n)}function sc(e){var t=this._name,n=this._id;typeof e!="function"&&(e=vo(e));for(var i=this._groups,r=i.length,o=[],a=[],s=0;s<r;++s)for(var u=i[s],l=u.length,c,d=0;d<l;++d)if(c=u[d]){for(var h=e.call(c,c.__data__,d,u),f,g=Oe(c,n),v=0,x=h.length;v<x;++v)(f=h[v])&&On(f,t,n,v,h,g);o.push(h),a.push(c)}return new et(o,a,t,n)}var uc=en.prototype.constructor;function lc(){return new uc(this._groups,this._parents)}function cc(e,t){var n,i,r;return function(){var o=kt(this,e),a=(this.style.removeProperty(e),kt(this,e));return o===a?null:o===n&&a===i?r:r=t(n=o,i=a)}}function zo(e){return function(){this.style.removeProperty(e)}}function dc(e,t,n){var i,r=n+"",o;return function(){var a=kt(this,e);return a===r?null:a===i?o:o=t(i=a,n)}}function hc(e,t,n){var i,r,o;return function(){var a=kt(this,e),s=n(this),u=s+"";return s==null&&(u=s=(this.style.removeProperty(e),kt(this,e))),a===u?null:a===i&&u===r?o:(r=u,o=t(i=a,s))}}function fc(e,t){var n,i,r,o="style."+t,a="end."+o,s;return function(){var u=je(this,e),l=u.on,c=u.value[o]==null?s||(s=zo(t)):void 0;(l!==n||r!==c)&&(i=(n=l).copy()).on(a,r=c),u.on=i}}function pc(e,t,n){var i=(e+="")=="transform"?vl:Go;return t==null?this.styleTween(e,cc(e,i)).on("end.style."+e,zo(e)):typeof t=="function"?this.styleTween(e,hc(e,i,Bi(this,"style."+e,t))).each(fc(this._id,e)):this.styleTween(e,dc(e,i,t),n).on("end.style."+e,null)}function gc(e,t,n){return function(i){this.style.setProperty(e,t.call(this,i),n)}}function mc(e,t,n){var i,r;function o(){var a=t.apply(this,arguments);return a!==r&&(i=(r=a)&&gc(e,a,n)),i}return o._value=t,o}function vc(e,t,n){var i="style."+(e+="");if(arguments.length<2)return(i=this.tween(i))&&i._value;if(t==null)return this.tween(i,null);if(typeof t!="function")throw new Error;return this.tween(i,mc(e,t,n??""))}function yc(e){return function(){this.textContent=e}}function bc(e){return function(){var t=e(this);this.textContent=t??""}}function wc(e){return this.tween("text",typeof e=="function"?bc(Bi(this,"text",e)):yc(e==null?"":e+""))}function xc(e){return function(t){this.textContent=e.call(this,t)}}function _c(e){var t,n;function i(){var r=e.apply(this,arguments);return r!==n&&(t=(n=r)&&xc(r)),t}return i._value=e,i}function Ec(e){var t="text";if(arguments.length<1)return(t=this.tween(t))&&t._value;if(e==null)return this.tween(t,null);if(typeof e!="function")throw new Error;return this.tween(t,_c(e))}function Cc(){for(var e=this._name,t=this._id,n=Bo(),i=this._groups,r=i.length,o=0;o<r;++o)for(var a=i[o],s=a.length,u,l=0;l<s;++l)if(u=a[l]){var c=Oe(u,t);On(u,e,n,l,a,{time:c.time+c.delay+c.duration,delay:0,duration:c.duration,ease:c.ease})}return new et(i,this._parents,e,n)}function kc(){var e,t,n=this,i=n._id,r=n.size();return new Promise(function(o,a){var s={value:a},u={value:function(){--r===0&&o()}};n.each(function(){var l=je(this,i),c=l.on;c!==e&&(t=(e=c).copy(),t._.cancel.push(s),t._.interrupt.push(s),t._.end.push(u)),l.on=t}),r===0&&o()})}var Tc=0;function et(e,t,n,i){this._groups=e,this._parents=t,this._name=n,this._id=i}function Bo(){return++Tc}var Ke=en.prototype;et.prototype={constructor:et,select:ac,selectAll:sc,selectChild:Ke.selectChild,selectChildren:Ke.selectChildren,filter:Ql,merge:ec,selection:lc,transition:Cc,call:Ke.call,nodes:Ke.nodes,node:Ke.node,size:Ke.size,empty:Ke.empty,each:Ke.each,on:ic,attr:Fl,attrTween:Ul,style:pc,styleTween:vc,text:wc,textTween:Ec,remove:oc,tween:Rl,delay:Vl,duration:Yl,ease:Kl,easeVarying:Jl,end:kc,[Symbol.iterator]:Ke[Symbol.iterator]};function Ac(e){return((e*=2)<=1?e*e*e:(e-=2)*e*e+2)/2}var Sc={time:null,delay:0,duration:250,ease:Ac};function Lc(e,t){for(var n;!(n=e.__transition)||!(n=n[t]);)if(!(e=e.parentNode))throw new Error(`transition ${t} not found`);return n}function Rc(e){var t,n;e instanceof et?(t=e._id,e=e._name):(t=Bo(),(n=Sc).time=Gi(),e=e==null?null:e+"");for(var i=this._groups,r=i.length,o=0;o<r;++o)for(var a=i[o],s=a.length,u,l=0;l<s;++l)(u=a[l])&&On(u,e,t,l,a,n||Lc(u,t));return new et(i,this._parents,e,t)}en.prototype.interrupt=Al;en.prototype.transition=Rc;const Ei=Math.PI,Ci=2*Ei,ft=1e-6,Nc=Ci-ft;function Oo(e){this._+=e[0];for(let t=1,n=e.length;t<n;++t)this._+=arguments[t]+e[t]}function Mc(e){let t=Math.floor(e);if(!(t>=0))throw new Error(`invalid digits: ${e}`);if(t>15)return Oo;const n=10**t;return function(i){this._+=i[0];for(let r=1,o=i.length;r<o;++r)this._+=Math.round(arguments[r]*n)/n+i[r]}}class Dc{constructor(t){this._x0=this._y0=this._x1=this._y1=null,this._="",this._append=t==null?Oo:Mc(t)}moveTo(t,n){this._append`M${this._x0=this._x1=+t},${this._y0=this._y1=+n}`}closePath(){this._x1!==null&&(this._x1=this._x0,this._y1=this._y0,this._append`Z`)}lineTo(t,n){this._append`L${this._x1=+t},${this._y1=+n}`}quadraticCurveTo(t,n,i,r){this._append`Q${+t},${+n},${this._x1=+i},${this._y1=+r}`}bezierCurveTo(t,n,i,r,o,a){this._append`C${+t},${+n},${+i},${+r},${this._x1=+o},${this._y1=+a}`}arcTo(t,n,i,r,o){if(t=+t,n=+n,i=+i,r=+r,o=+o,o<0)throw new Error(`negative radius: ${o}`);let a=this._x1,s=this._y1,u=i-t,l=r-n,c=a-t,d=s-n,h=c*c+d*d;if(this._x1===null)this._append`M${this._x1=t},${this._y1=n}`;else if(h>ft)if(!(Math.abs(d*u-l*c)>ft)||!o)this._append`L${this._x1=t},${this._y1=n}`;else{let f=i-a,g=r-s,v=u*u+l*l,x=f*f+g*g,C=Math.sqrt(v),b=Math.sqrt(h),w=o*Math.tan((Ei-Math.acos((v+h-x)/(2*C*b)))/2),m=w/b,y=w/C;Math.abs(m-1)>ft&&this._append`L${t+m*c},${n+m*d}`,this._append`A${o},${o},0,0,${+(d*f>c*g)},${this._x1=t+y*u},${this._y1=n+y*l}`}}arc(t,n,i,r,o,a){if(t=+t,n=+n,i=+i,a=!!a,i<0)throw new Error(`negative radius: ${i}`);let s=i*Math.cos(r),u=i*Math.sin(r),l=t+s,c=n+u,d=1^a,h=a?r-o:o-r;this._x1===null?this._append`M${l},${c}`:(Math.abs(this._x1-l)>ft||Math.abs(this._y1-c)>ft)&&this._append`L${l},${c}`,i&&(h<0&&(h=h%Ci+Ci),h>Nc?this._append`A${i},${i},0,1,${d},${t-s},${n-u}A${i},${i},0,1,${d},${this._x1=l},${this._y1=c}`:h>ft&&this._append`A${i},${i},0,${+(h>=Ei)},${d},${this._x1=t+i*Math.cos(o)},${this._y1=n+i*Math.sin(o)}`)}rect(t,n,i,r){this._append`M${this._x0=this._x1=+t},${this._y0=this._y1=+n}h${i=+i}v${+r}h${-i}Z`}toString(){return this._}}function $c(e){return Math.abs(e=Math.round(e))>=1e21?e.toLocaleString("en").replace(/,/g,""):e.toString(10)}function Dn(e,t){if((n=(e=t?e.toExponential(t-1):e.toExponential()).indexOf("e"))<0)return null;var n,i=e.slice(0,n);return[i.length>1?i[0]+i.slice(2):i,+e.slice(n+1)]}function At(e){return e=Dn(Math.abs(e)),e?e[1]:NaN}function Ic(e,t){return function(n,i){for(var r=n.length,o=[],a=0,s=e[0],u=0;r>0&&s>0&&(u+s+1>i&&(s=Math.max(1,i-u)),o.push(n.substring(r-=s,r+s)),!((u+=s+1)>i));)s=e[a=(a+1)%e.length];return o.reverse().join(t)}}function Pc(e){return function(t){return t.replace(/[0-9]/g,function(n){return e[+n]})}}var Fc=/^(?:(.)?([<>=^]))?([+\-( ])?([$#])?(0)?(\d+)?(,)?(\.\d+)?(~)?([a-z%])?$/i;function $n(e){if(!(t=Fc.exec(e)))throw new Error("invalid format: "+e);var t;return new Oi({fill:t[1],align:t[2],sign:t[3],symbol:t[4],zero:t[5],width:t[6],comma:t[7],precision:t[8]&&t[8].slice(1),trim:t[9],type:t[10]})}$n.prototype=Oi.prototype;function Oi(e){this.fill=e.fill===void 0?" ":e.fill+"",this.align=e.align===void 0?">":e.align+"",this.sign=e.sign===void 0?"-":e.sign+"",this.symbol=e.symbol===void 0?"":e.symbol+"",this.zero=!!e.zero,this.width=e.width===void 0?void 0:+e.width,this.comma=!!e.comma,this.precision=e.precision===void 0?void 0:+e.precision,this.trim=!!e.trim,this.type=e.type===void 0?"":e.type+""}Oi.prototype.toString=function(){return this.fill+this.align+this.sign+this.symbol+(this.zero?"0":"")+(this.width===void 0?"":Math.max(1,this.width|0))+(this.comma?",":"")+(this.precision===void 0?"":"."+Math.max(0,this.precision|0))+(this.trim?"~":"")+this.type};function Gc(e){e:for(var t=e.length,n=1,i=-1,r;n<t;++n)switch(e[n]){case".":i=r=n;break;case"0":i===0&&(i=n),r=n;break;default:if(!+e[n])break e;i>0&&(i=0);break}return i>0?e.slice(0,i)+e.slice(r+1):e}var Uo;function zc(e,t){var n=Dn(e,t);if(!n)return e+"";var i=n[0],r=n[1],o=r-(Uo=Math.max(-8,Math.min(8,Math.floor(r/3)))*3)+1,a=i.length;return o===a?i:o>a?i+new Array(o-a+1).join("0"):o>0?i.slice(0,o)+"."+i.slice(o):"0."+new Array(1-o).join("0")+Dn(e,Math.max(0,t+o-1))[0]}function kr(e,t){var n=Dn(e,t);if(!n)return e+"";var i=n[0],r=n[1];return r<0?"0."+new Array(-r).join("0")+i:i.length>r+1?i.slice(0,r+1)+"."+i.slice(r+1):i+new Array(r-i.length+2).join("0")}const Tr={"%":(e,t)=>(e*100).toFixed(t),b:e=>Math.round(e).toString(2),c:e=>e+"",d:$c,e:(e,t)=>e.toExponential(t),f:(e,t)=>e.toFixed(t),g:(e,t)=>e.toPrecision(t),o:e=>Math.round(e).toString(8),p:(e,t)=>kr(e*100,t),r:kr,s:zc,X:e=>Math.round(e).toString(16).toUpperCase(),x:e=>Math.round(e).toString(16)};function Ar(e){return e}var Sr=Array.prototype.map,Lr=["y","z","a","f","p","n","µ","m","","k","M","G","T","P","E","Z","Y"];function Bc(e){var t=e.grouping===void 0||e.thousands===void 0?Ar:Ic(Sr.call(e.grouping,Number),e.thousands+""),n=e.currency===void 0?"":e.currency[0]+"",i=e.currency===void 0?"":e.currency[1]+"",r=e.decimal===void 0?".":e.decimal+"",o=e.numerals===void 0?Ar:Pc(Sr.call(e.numerals,String)),a=e.percent===void 0?"%":e.percent+"",s=e.minus===void 0?"−":e.minus+"",u=e.nan===void 0?"NaN":e.nan+"";function l(d){d=$n(d);var h=d.fill,f=d.align,g=d.sign,v=d.symbol,x=d.zero,C=d.width,b=d.comma,w=d.precision,m=d.trim,y=d.type;y==="n"?(b=!0,y="g"):Tr[y]||(w===void 0&&(w=12),m=!0,y="g"),(x||h==="0"&&f==="=")&&(x=!0,h="0",f="=");var _=v==="$"?n:v==="#"&&/[boxX]/.test(y)?"0"+y.toLowerCase():"",A=v==="$"?i:/[%p]/.test(y)?a:"",F=Tr[y],B=/[defgprs%]/.test(y);w=w===void 0?6:/[gprs]/.test(y)?Math.max(1,Math.min(21,w)):Math.max(0,Math.min(20,w));function z(D){var q=_,P=A,V,oe,ce;if(y==="c")P=F(D)+P,D="";else{D=+D;var pe=D<0||1/D<0;if(D=isNaN(D)?u:F(Math.abs(D),w),m&&(D=Gc(D)),pe&&+D==0&&g!=="+"&&(pe=!1),q=(pe?g==="("?g:s:g==="-"||g==="("?"":g)+q,P=(y==="s"?Lr[8+Uo/3]:"")+P+(pe&&g==="("?")":""),B){for(V=-1,oe=D.length;++V<oe;)if(ce=D.charCodeAt(V),48>ce||ce>57){P=(ce===46?r+D.slice(V+1):D.slice(V))+P,D=D.slice(0,V);break}}}b&&!x&&(D=t(D,1/0));var fe=q.length+D.length+P.length,ae=fe<C?new Array(C-fe+1).join(h):"";switch(b&&x&&(D=t(ae+D,ae.length?C-P.length:1/0),ae=""),f){case"<":D=q+D+P+ae;break;case"=":D=q+ae+D+P;break;case"^":D=ae.slice(0,fe=ae.length>>1)+q+D+P+ae.slice(fe);break;default:D=ae+q+D+P;break}return o(D)}return z.toString=function(){return d+""},z}function c(d,h){var f=l((d=$n(d),d.type="f",d)),g=Math.max(-8,Math.min(8,Math.floor(At(h)/3)))*3,v=Math.pow(10,-g),x=Lr[8+g/3];return function(C){return f(v*C)+x}}return{format:l,formatPrefix:c}}var dn,Ui,Ho;Oc({thousands:",",grouping:[3],currency:["$",""]});function Oc(e){return dn=Bc(e),Ui=dn.format,Ho=dn.formatPrefix,dn}function Uc(e){return Math.max(0,-At(Math.abs(e)))}function Hc(e,t){return Math.max(0,Math.max(-8,Math.min(8,Math.floor(At(t)/3)))*3-At(Math.abs(e)))}function qc(e,t){return e=Math.abs(e),t=Math.abs(t)-e,Math.max(0,At(t)-At(e))+1}function Hi(e,t){switch(arguments.length){case 0:break;case 1:this.range(e);break;default:this.range(t).domain(e);break}return this}const Rr=Symbol("implicit");function Yt(){var e=new or,t=[],n=[],i=Rr;function r(o){let a=e.get(o);if(a===void 0){if(i!==Rr)return i;e.set(o,a=t.push(o)-1)}return n[a%n.length]}return r.domain=function(o){if(!arguments.length)return t.slice();t=[],e=new or;for(const a of o)e.has(a)||e.set(a,t.push(a)-1);return r},r.range=function(o){return arguments.length?(n=Array.from(o),r):n.slice()},r.unknown=function(o){return arguments.length?(i=o,r):i},r.copy=function(){return Yt(t,n).unknown(i)},Hi.apply(r,arguments),r}function qo(){var e=Yt().unknown(void 0),t=e.domain,n=e.range,i=0,r=1,o,a,s=!1,u=0,l=0,c=.5;delete e.unknown;function d(){var h=t().length,f=r<i,g=f?r:i,v=f?i:r;o=(v-g)/Math.max(1,h-u+l*2),s&&(o=Math.floor(o)),g+=(v-g-o*(h-u))*c,a=o*(1-u),s&&(g=Math.round(g),a=Math.round(a));var x=rs(h).map(function(C){return g+o*C});return n(f?x.reverse():x)}return e.domain=function(h){return arguments.length?(t(h),d()):t()},e.range=function(h){return arguments.length?([i,r]=h,i=+i,r=+r,d()):[i,r]},e.rangeRound=function(h){return[i,r]=h,i=+i,r=+r,s=!0,d()},e.bandwidth=function(){return a},e.step=function(){return o},e.round=function(h){return arguments.length?(s=!!h,d()):s},e.padding=function(h){return arguments.length?(u=Math.min(1,l=+h),d()):u},e.paddingInner=function(h){return arguments.length?(u=Math.min(1,h),d()):u},e.paddingOuter=function(h){return arguments.length?(l=+h,d()):l},e.align=function(h){return arguments.length?(c=Math.max(0,Math.min(1,h)),d()):c},e.copy=function(){return qo(t(),[i,r]).round(s).paddingInner(u).paddingOuter(l).align(c)},Hi.apply(d(),arguments)}function Vc(e){return function(){return e}}function Wc(e){return+e}var Nr=[0,1];function xt(e){return e}function ki(e,t){return(t-=e=+e)?function(n){return(n-e)/t}:Vc(isNaN(t)?NaN:.5)}function jc(e,t){var n;return e>t&&(n=e,e=t,t=n),function(i){return Math.max(e,Math.min(t,i))}}function Yc(e,t,n){var i=e[0],r=e[1],o=t[0],a=t[1];return r<i?(i=ki(r,i),o=n(a,o)):(i=ki(i,r),o=n(o,a)),function(s){return o(i(s))}}function Xc(e,t,n){var i=Math.min(e.length,t.length)-1,r=new Array(i),o=new Array(i),a=-1;for(e[i]<e[0]&&(e=e.slice().reverse(),t=t.slice().reverse());++a<i;)r[a]=ki(e[a],e[a+1]),o[a]=n(t[a],t[a+1]);return function(s){var u=Ya(e,s,1,i)-1;return o[u](r[u](s))}}function Kc(e,t){return t.domain(e.domain()).range(e.range()).interpolate(e.interpolate()).clamp(e.clamp()).unknown(e.unknown())}function Zc(){var e=Nr,t=Nr,n=Fi,i,r,o,a=xt,s,u,l;function c(){var h=Math.min(e.length,t.length);return a!==xt&&(a=jc(e[0],e[h-1])),s=h>2?Xc:Yc,u=l=null,d}function d(h){return h==null||isNaN(h=+h)?o:(u||(u=s(e.map(i),t,n)))(i(a(h)))}return d.invert=function(h){return a(r((l||(l=s(t,e.map(i),Ge)))(h)))},d.domain=function(h){return arguments.length?(e=Array.from(h,Wc),c()):e.slice()},d.range=function(h){return arguments.length?(t=Array.from(h),c()):t.slice()},d.rangeRound=function(h){return t=Array.from(h),n=pl,c()},d.clamp=function(h){return arguments.length?(a=h?!0:xt,c()):a!==xt},d.interpolate=function(h){return arguments.length?(n=h,c()):n},d.unknown=function(h){return arguments.length?(o=h,d):o},function(h,f){return i=h,r=f,c()}}function Jc(){return Zc()(xt,xt)}function Qc(e,t,n,i){var r=is(e,t,n),o;switch(i=$n(i??",f"),i.type){case"s":{var a=Math.max(Math.abs(e),Math.abs(t));return i.precision==null&&!isNaN(o=Hc(r,a))&&(i.precision=o),Ho(i,a)}case"":case"e":case"g":case"p":case"r":{i.precision==null&&!isNaN(o=qc(r,Math.max(Math.abs(e),Math.abs(t))))&&(i.precision=o-(i.type==="e"));break}case"f":case"%":{i.precision==null&&!isNaN(o=Uc(r))&&(i.precision=o-(i.type==="%")*2);break}}return Ui(i)}function ed(e){var t=e.domain;return e.ticks=function(n){var i=t();return ns(i[0],i[i.length-1],n??10)},e.tickFormat=function(n,i){var r=t();return Qc(r[0],r[r.length-1],n??10,i)},e.nice=function(n){n==null&&(n=10);var i=t(),r=0,o=i.length-1,a=i[r],s=i[o],u,l,c=10;for(s<a&&(l=a,a=s,s=l,l=r,r=o,o=l);c-- >0;){if(l=pi(a,s,n),l===u)return i[r]=a,i[o]=s,t(i);if(l>0)a=Math.floor(a/l)*l,s=Math.ceil(s/l)*l;else if(l<0)a=Math.ceil(a*l)/l,s=Math.floor(s*l)/l;else break;u=l}return e},e}function Wt(){var e=Jc();return e.copy=function(){return Kc(e,Wt())},Hi.apply(e,arguments),ed(e)}function td(e){for(var t=e.length/6|0,n=new Array(t),i=0;i<t;)n[i]="#"+e.slice(i*6,++i*6);return n}const Mr=td("1f77b4ff7f0e2ca02cd627289467bd8c564be377c27f7f7fbcbd2217becf");function ne(e){return function(){return e}}const Dr=Math.abs,xe=Math.atan2,dt=Math.cos,nd=Math.max,ei=Math.min,Ve=Math.sin,_t=Math.sqrt,Ce=1e-12,Qt=Math.PI,In=Qt/2,En=2*Qt;function id(e){return e>1?0:e<-1?Qt:Math.acos(e)}function $r(e){return e>=1?In:e<=-1?-In:Math.asin(e)}function qi(e){let t=3;return e.digits=function(n){if(!arguments.length)return t;if(n==null)t=null;else{const i=Math.floor(n);if(!(i>=0))throw new RangeError(`invalid digits: ${n}`);t=i}return e},()=>new Dc(t)}function rd(e){return e.innerRadius}function od(e){return e.outerRadius}function ad(e){return e.startAngle}function sd(e){return e.endAngle}function ud(e){return e&&e.padAngle}function ld(e,t,n,i,r,o,a,s){var u=n-e,l=i-t,c=a-r,d=s-o,h=d*u-c*l;if(!(h*h<Ce))return h=(c*(t-o)-d*(e-r))/h,[e+h*u,t+h*l]}function hn(e,t,n,i,r,o,a){var s=e-n,u=t-i,l=(a?o:-o)/_t(s*s+u*u),c=l*u,d=-l*s,h=e+c,f=t+d,g=n+c,v=i+d,x=(h+g)/2,C=(f+v)/2,b=g-h,w=v-f,m=b*b+w*w,y=r-o,_=h*v-g*f,A=(w<0?-1:1)*_t(nd(0,y*y*m-_*_)),F=(_*w-b*A)/m,B=(-_*b-w*A)/m,z=(_*w+b*A)/m,D=(-_*b+w*A)/m,q=F-x,P=B-C,V=z-x,oe=D-C;return q*q+P*P>V*V+oe*oe&&(F=z,B=D),{cx:F,cy:B,x01:-c,y01:-d,x11:F*(r/y-1),y11:B*(r/y-1)}}function cd(){var e=rd,t=od,n=ne(0),i=null,r=ad,o=sd,a=ud,s=null,u=qi(l);function l(){var c,d,h=+e.apply(this,arguments),f=+t.apply(this,arguments),g=r.apply(this,arguments)-In,v=o.apply(this,arguments)-In,x=Dr(v-g),C=v>g;if(s||(s=c=u()),f<h&&(d=f,f=h,h=d),!(f>Ce))s.moveTo(0,0);else if(x>En-Ce)s.moveTo(f*dt(g),f*Ve(g)),s.arc(0,0,f,g,v,!C),h>Ce&&(s.moveTo(h*dt(v),h*Ve(v)),s.arc(0,0,h,v,g,C));else{var b=g,w=v,m=g,y=v,_=x,A=x,F=a.apply(this,arguments)/2,B=F>Ce&&(i?+i.apply(this,arguments):_t(h*h+f*f)),z=ei(Dr(f-h)/2,+n.apply(this,arguments)),D=z,q=z,P,V;if(B>Ce){var oe=$r(B/h*Ve(F)),ce=$r(B/f*Ve(F));(_-=oe*2)>Ce?(oe*=C?1:-1,m+=oe,y-=oe):(_=0,m=y=(g+v)/2),(A-=ce*2)>Ce?(ce*=C?1:-1,b+=ce,w-=ce):(A=0,b=w=(g+v)/2)}var pe=f*dt(b),fe=f*Ve(b),ae=h*dt(y),re=h*Ve(y);if(z>Ce){var ie=f*dt(w),se=f*Ve(w),ee=h*dt(m),De=h*Ve(m),ge;if(x<Qt)if(ge=ld(pe,fe,ee,De,ie,se,ae,re)){var Ue=pe-ge[0],lt=fe-ge[1],He=ie-ge[0],Ae=se-ge[1],nt=1/Ve(id((Ue*He+lt*Ae)/(_t(Ue*Ue+lt*lt)*_t(He*He+Ae*Ae)))/2),it=_t(ge[0]*ge[0]+ge[1]*ge[1]);D=ei(z,(h-it)/(nt-1)),q=ei(z,(f-it)/(nt+1))}else D=q=0}A>Ce?q>Ce?(P=hn(ee,De,pe,fe,f,q,C),V=hn(ie,se,ae,re,f,q,C),s.moveTo(P.cx+P.x01,P.cy+P.y01),q<z?s.arc(P.cx,P.cy,q,xe(P.y01,P.x01),xe(V.y01,V.x01),!C):(s.arc(P.cx,P.cy,q,xe(P.y01,P.x01),xe(P.y11,P.x11),!C),s.arc(0,0,f,xe(P.cy+P.y11,P.cx+P.x11),xe(V.cy+V.y11,V.cx+V.x11),!C),s.arc(V.cx,V.cy,q,xe(V.y11,V.x11),xe(V.y01,V.x01),!C))):(s.moveTo(pe,fe),s.arc(0,0,f,b,w,!C)):s.moveTo(pe,fe),!(h>Ce)||!(_>Ce)?s.lineTo(ae,re):D>Ce?(P=hn(ae,re,ie,se,h,-D,C),V=hn(pe,fe,ee,De,h,-D,C),s.lineTo(P.cx+P.x01,P.cy+P.y01),D<z?s.arc(P.cx,P.cy,D,xe(P.y01,P.x01),xe(V.y01,V.x01),!C):(s.arc(P.cx,P.cy,D,xe(P.y01,P.x01),xe(P.y11,P.x11),!C),s.arc(0,0,h,xe(P.cy+P.y11,P.cx+P.x11),xe(V.cy+V.y11,V.cx+V.x11),C),s.arc(V.cx,V.cy,D,xe(V.y11,V.x11),xe(V.y01,V.x01),!C))):s.arc(0,0,h,y,m,C)}if(s.closePath(),c)return s=null,c+""||null}return l.centroid=function(){var c=(+e.apply(this,arguments)+ +t.apply(this,arguments))/2,d=(+r.apply(this,arguments)+ +o.apply(this,arguments))/2-Qt/2;return[dt(d)*c,Ve(d)*c]},l.innerRadius=function(c){return arguments.length?(e=typeof c=="function"?c:ne(+c),l):e},l.outerRadius=function(c){return arguments.length?(t=typeof c=="function"?c:ne(+c),l):t},l.cornerRadius=function(c){return arguments.length?(n=typeof c=="function"?c:ne(+c),l):n},l.padRadius=function(c){return arguments.length?(i=c==null?null:typeof c=="function"?c:ne(+c),l):i},l.startAngle=function(c){return arguments.length?(r=typeof c=="function"?c:ne(+c),l):r},l.endAngle=function(c){return arguments.length?(o=typeof c=="function"?c:ne(+c),l):o},l.padAngle=function(c){return arguments.length?(a=typeof c=="function"?c:ne(+c),l):a},l.context=function(c){return arguments.length?(s=c??null,l):s},l}function Vi(e){return typeof e=="object"&&"length"in e?e:Array.from(e)}function Vo(e){this._context=e}Vo.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._point=0},lineEnd:function(){(this._line||this._line!==0&&this._point===1)&&this._context.closePath(),this._line=1-this._line},point:function(e,t){switch(e=+e,t=+t,this._point){case 0:this._point=1,this._line?this._context.lineTo(e,t):this._context.moveTo(e,t);break;case 1:this._point=2;default:this._context.lineTo(e,t);break}}};function Wo(e){return new Vo(e)}function jo(e){return e[0]}function Yo(e){return e[1]}function Xo(e,t){var n=ne(!0),i=null,r=Wo,o=null,a=qi(s);e=typeof e=="function"?e:e===void 0?jo:ne(e),t=typeof t=="function"?t:t===void 0?Yo:ne(t);function s(u){var l,c=(u=Vi(u)).length,d,h=!1,f;for(i==null&&(o=r(f=a())),l=0;l<=c;++l)!(l<c&&n(d=u[l],l,u))===h&&((h=!h)?o.lineStart():o.lineEnd()),h&&o.point(+e(d,l,u),+t(d,l,u));if(f)return o=null,f+""||null}return s.x=function(u){return arguments.length?(e=typeof u=="function"?u:ne(+u),s):e},s.y=function(u){return arguments.length?(t=typeof u=="function"?u:ne(+u),s):t},s.defined=function(u){return arguments.length?(n=typeof u=="function"?u:ne(!!u),s):n},s.curve=function(u){return arguments.length?(r=u,i!=null&&(o=r(i)),s):r},s.context=function(u){return arguments.length?(u==null?i=o=null:o=r(i=u),s):i},s}function dd(e,t,n){var i=null,r=ne(!0),o=null,a=Wo,s=null,u=qi(l);e=typeof e=="function"?e:e===void 0?jo:ne(+e),t=typeof t=="function"?t:ne(t===void 0?0:+t),n=typeof n=="function"?n:n===void 0?Yo:ne(+n);function l(d){var h,f,g,v=(d=Vi(d)).length,x,C=!1,b,w=new Array(v),m=new Array(v);for(o==null&&(s=a(b=u())),h=0;h<=v;++h){if(!(h<v&&r(x=d[h],h,d))===C)if(C=!C)f=h,s.areaStart(),s.lineStart();else{for(s.lineEnd(),s.lineStart(),g=h-1;g>=f;--g)s.point(w[g],m[g]);s.lineEnd(),s.areaEnd()}C&&(w[h]=+e(x,h,d),m[h]=+t(x,h,d),s.point(i?+i(x,h,d):w[h],n?+n(x,h,d):m[h]))}if(b)return s=null,b+""||null}function c(){return Xo().defined(r).curve(a).context(o)}return l.x=function(d){return arguments.length?(e=typeof d=="function"?d:ne(+d),i=null,l):e},l.x0=function(d){return arguments.length?(e=typeof d=="function"?d:ne(+d),l):e},l.x1=function(d){return arguments.length?(i=d==null?null:typeof d=="function"?d:ne(+d),l):i},l.y=function(d){return arguments.length?(t=typeof d=="function"?d:ne(+d),n=null,l):t},l.y0=function(d){return arguments.length?(t=typeof d=="function"?d:ne(+d),l):t},l.y1=function(d){return arguments.length?(n=d==null?null:typeof d=="function"?d:ne(+d),l):n},l.lineX0=l.lineY0=function(){return c().x(e).y(t)},l.lineY1=function(){return c().x(e).y(n)},l.lineX1=function(){return c().x(i).y(t)},l.defined=function(d){return arguments.length?(r=typeof d=="function"?d:ne(!!d),l):r},l.curve=function(d){return arguments.length?(a=d,o!=null&&(s=a(o)),l):a},l.context=function(d){return arguments.length?(d==null?o=s=null:s=a(o=d),l):o},l}function hd(e,t){return t<e?-1:t>e?1:t>=e?0:NaN}function fd(e){return e}function pd(){var e=fd,t=hd,n=null,i=ne(0),r=ne(En),o=ne(0);function a(s){var u,l=(s=Vi(s)).length,c,d,h=0,f=new Array(l),g=new Array(l),v=+i.apply(this,arguments),x=Math.min(En,Math.max(-En,r.apply(this,arguments)-v)),C,b=Math.min(Math.abs(x)/l,o.apply(this,arguments)),w=b*(x<0?-1:1),m;for(u=0;u<l;++u)(m=g[f[u]=u]=+e(s[u],u,s))>0&&(h+=m);for(t!=null?f.sort(function(y,_){return t(g[y],g[_])}):n!=null&&f.sort(function(y,_){return n(s[y],s[_])}),u=0,d=h?(x-l*w)/h:0;u<l;++u,v=C)c=f[u],m=g[c],C=v+(m>0?m*d:0)+w,g[c]={data:s[c],index:u,value:m,startAngle:v,endAngle:C,padAngle:b};return g}return a.value=function(s){return arguments.length?(e=typeof s=="function"?s:ne(+s),a):e},a.sortValues=function(s){return arguments.length?(t=s,n=null,a):t},a.sort=function(s){return arguments.length?(n=s,t=null,a):n},a.startAngle=function(s){return arguments.length?(i=typeof s=="function"?s:ne(+s),a):i},a.endAngle=function(s){return arguments.length?(r=typeof s=="function"?s:ne(+s),a):r},a.padAngle=function(s){return arguments.length?(o=typeof s=="function"?s:ne(+s),a):o},a}function Ir(e){return e<0?-1:1}function Pr(e,t,n){var i=e._x1-e._x0,r=t-e._x1,o=(e._y1-e._y0)/(i||r<0&&-0),a=(n-e._y1)/(r||i<0&&-0),s=(o*r+a*i)/(i+r);return(Ir(o)+Ir(a))*Math.min(Math.abs(o),Math.abs(a),.5*Math.abs(s))||0}function Fr(e,t){var n=e._x1-e._x0;return n?(3*(e._y1-e._y0)/n-t)/2:t}function ti(e,t,n){var i=e._x0,r=e._y0,o=e._x1,a=e._y1,s=(o-i)/3;e._context.bezierCurveTo(i+s,r+s*t,o-s,a-s*n,o,a)}function Pn(e){this._context=e}Pn.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._y0=this._y1=this._t0=NaN,this._point=0},lineEnd:function(){switch(this._point){case 2:this._context.lineTo(this._x1,this._y1);break;case 3:ti(this,this._t0,Fr(this,this._t0));break}(this._line||this._line!==0&&this._point===1)&&this._context.closePath(),this._line=1-this._line},point:function(e,t){var n=NaN;if(e=+e,t=+t,!(e===this._x1&&t===this._y1)){switch(this._point){case 0:this._point=1,this._line?this._context.lineTo(e,t):this._context.moveTo(e,t);break;case 1:this._point=2;break;case 2:this._point=3,ti(this,Fr(this,n=Pr(this,e,t)),n);break;default:ti(this,this._t0,n=Pr(this,e,t));break}this._x0=this._x1,this._x1=e,this._y0=this._y1,this._y1=t,this._t0=n}}};Object.create(Pn.prototype).point=function(e,t){Pn.prototype.point.call(this,t,e)};function Gr(e){return new Pn(e)}function jt(e,t,n){this.k=e,this.x=t,this.y=n}jt.prototype={constructor:jt,scale:function(e){return e===1?this:new jt(this.k*e,this.x,this.y)},translate:function(e,t){return e===0&t===0?this:new jt(this.k,this.x+this.k*e,this.y+this.k*t)},apply:function(e){return[e[0]*this.k+this.x,e[1]*this.k+this.y]},applyX:function(e){return e*this.k+this.x},applyY:function(e){return e*this.k+this.y},invert:function(e){return[(e[0]-this.x)/this.k,(e[1]-this.y)/this.k]},invertX:function(e){return(e-this.x)/this.k},invertY:function(e){return(e-this.y)/this.k},rescaleX:function(e){return e.copy().domain(e.range().map(this.invertX,this).map(e.invert,e))},rescaleY:function(e){return e.copy().domain(e.range().map(this.invertY,this).map(e.invert,e))},toString:function(){return"translate("+this.x+","+this.y+") scale("+this.k+")"}};jt.prototype;function gd(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}var fn={exports:{}},zr;function md(){if(zr)return fn.exports;zr=1;var e=typeof Reflect=="object"?Reflect:null,t=e&&typeof e.apply=="function"?e.apply:function(y,_,A){return Function.prototype.apply.call(y,_,A)},n;e&&typeof e.ownKeys=="function"?n=e.ownKeys:Object.getOwnPropertySymbols?n=function(y){return Object.getOwnPropertyNames(y).concat(Object.getOwnPropertySymbols(y))}:n=function(y){return Object.getOwnPropertyNames(y)};function i(m){console&&console.warn&&console.warn(m)}var r=Number.isNaN||function(y){return y!==y};function o(){o.init.call(this)}fn.exports=o,fn.exports.once=C,o.EventEmitter=o,o.prototype._events=void 0,o.prototype._eventsCount=0,o.prototype._maxListeners=void 0;var a=10;function s(m){if(typeof m!="function")throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof m)}Object.defineProperty(o,"defaultMaxListeners",{enumerable:!0,get:function(){return a},set:function(m){if(typeof m!="number"||m<0||r(m))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+m+".");a=m}}),o.init=function(){(this._events===void 0||this._events===Object.getPrototypeOf(this)._events)&&(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},o.prototype.setMaxListeners=function(y){if(typeof y!="number"||y<0||r(y))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+y+".");return this._maxListeners=y,this};function u(m){return m._maxListeners===void 0?o.defaultMaxListeners:m._maxListeners}o.prototype.getMaxListeners=function(){return u(this)},o.prototype.emit=function(y){for(var _=[],A=1;A<arguments.length;A++)_.push(arguments[A]);var F=y==="error",B=this._events;if(B!==void 0)F=F&&B.error===void 0;else if(!F)return!1;if(F){var z;if(_.length>0&&(z=_[0]),z instanceof Error)throw z;var D=new Error("Unhandled error."+(z?" ("+z.message+")":""));throw D.context=z,D}var q=B[y];if(q===void 0)return!1;if(typeof q=="function")t(q,this,_);else for(var P=q.length,V=g(q,P),A=0;A<P;++A)t(V[A],this,_);return!0};function l(m,y,_,A){var F,B,z;if(s(_),B=m._events,B===void 0?(B=m._events=Object.create(null),m._eventsCount=0):(B.newListener!==void 0&&(m.emit("newListener",y,_.listener?_.listener:_),B=m._events),z=B[y]),z===void 0)z=B[y]=_,++m._eventsCount;else if(typeof z=="function"?z=B[y]=A?[_,z]:[z,_]:A?z.unshift(_):z.push(_),F=u(m),F>0&&z.length>F&&!z.warned){z.warned=!0;var D=new Error("Possible EventEmitter memory leak detected. "+z.length+" "+String(y)+" listeners added. Use emitter.setMaxListeners() to increase limit");D.name="MaxListenersExceededWarning",D.emitter=m,D.type=y,D.count=z.length,i(D)}return m}o.prototype.addListener=function(y,_){return l(this,y,_,!1)},o.prototype.on=o.prototype.addListener,o.prototype.prependListener=function(y,_){return l(this,y,_,!0)};function c(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,arguments.length===0?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function d(m,y,_){var A={fired:!1,wrapFn:void 0,target:m,type:y,listener:_},F=c.bind(A);return F.listener=_,A.wrapFn=F,F}o.prototype.once=function(y,_){return s(_),this.on(y,d(this,y,_)),this},o.prototype.prependOnceListener=function(y,_){return s(_),this.prependListener(y,d(this,y,_)),this},o.prototype.removeListener=function(y,_){var A,F,B,z,D;if(s(_),F=this._events,F===void 0)return this;if(A=F[y],A===void 0)return this;if(A===_||A.listener===_)--this._eventsCount===0?this._events=Object.create(null):(delete F[y],F.removeListener&&this.emit("removeListener",y,A.listener||_));else if(typeof A!="function"){for(B=-1,z=A.length-1;z>=0;z--)if(A[z]===_||A[z].listener===_){D=A[z].listener,B=z;break}if(B<0)return this;B===0?A.shift():v(A,B),A.length===1&&(F[y]=A[0]),F.removeListener!==void 0&&this.emit("removeListener",y,D||_)}return this},o.prototype.off=o.prototype.removeListener,o.prototype.removeAllListeners=function(y){var _,A,F;if(A=this._events,A===void 0)return this;if(A.removeListener===void 0)return arguments.length===0?(this._events=Object.create(null),this._eventsCount=0):A[y]!==void 0&&(--this._eventsCount===0?this._events=Object.create(null):delete A[y]),this;if(arguments.length===0){var B=Object.keys(A),z;for(F=0;F<B.length;++F)z=B[F],z!=="removeListener"&&this.removeAllListeners(z);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if(_=A[y],typeof _=="function")this.removeListener(y,_);else if(_!==void 0)for(F=_.length-1;F>=0;F--)this.removeListener(y,_[F]);return this};function h(m,y,_){var A=m._events;if(A===void 0)return[];var F=A[y];return F===void 0?[]:typeof F=="function"?_?[F.listener||F]:[F]:_?x(F):g(F,F.length)}o.prototype.listeners=function(y){return h(this,y,!0)},o.prototype.rawListeners=function(y){return h(this,y,!1)},o.listenerCount=function(m,y){return typeof m.listenerCount=="function"?m.listenerCount(y):f.call(m,y)},o.prototype.listenerCount=f;function f(m){var y=this._events;if(y!==void 0){var _=y[m];if(typeof _=="function")return 1;if(_!==void 0)return _.length}return 0}o.prototype.eventNames=function(){return this._eventsCount>0?n(this._events):[]};function g(m,y){for(var _=new Array(y),A=0;A<y;++A)_[A]=m[A];return _}function v(m,y){for(;y+1<m.length;y++)m[y]=m[y+1];m.pop()}function x(m){for(var y=new Array(m.length),_=0;_<y.length;++_)y[_]=m[_].listener||m[_];return y}function C(m,y){return new Promise(function(_,A){function F(z){m.removeListener(y,B),A(z)}function B(){typeof m.removeListener=="function"&&m.removeListener("error",F),_([].slice.call(arguments))}w(m,y,B,{once:!0}),y!=="error"&&b(m,F,{once:!0})})}function b(m,y,_){typeof m.on=="function"&&w(m,"error",y,_)}function w(m,y,_,A){if(typeof m.on=="function")A.once?m.once(y,_):m.on(y,_);else if(typeof m.addEventListener=="function")m.addEventListener(y,function F(B){A.once&&m.removeEventListener(y,F),_(B)});else throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof m)}return fn.exports}var Ko=md();function vd(){const e=arguments[0];for(let t=1,n=arguments.length;t<n;t++)if(arguments[t])for(const i in arguments[t])e[i]=arguments[t][i];return e}let ve=vd;typeof Object.assign=="function"&&(ve=Object.assign);function Re(e,t,n,i){const r=e._nodes.get(t);let o=null;return r&&(i==="mixed"?o=r.out&&r.out[n]||r.undirected&&r.undirected[n]:i==="directed"?o=r.out&&r.out[n]:o=r.undirected&&r.undirected[n]),o}function be(e){return typeof e=="object"&&e!==null}function Zo(e){let t;for(t in e)return!1;return!0}function Le(e,t,n){Object.defineProperty(e,t,{enumerable:!1,configurable:!1,writable:!0,value:n})}function Pe(e,t,n){const i={enumerable:!0,configurable:!0};typeof n=="function"?i.get=n:(i.value=n,i.writable=!1),Object.defineProperty(e,t,i)}function Br(e){return!(!be(e)||e.attributes&&!Array.isArray(e.attributes))}function yd(){let e=Math.floor(Math.random()*256)&255;return()=>e++}function Qe(){const e=arguments;let t=null,n=-1;return{[Symbol.iterator](){return this},next(){let i=null;do{if(t===null){if(n++,n>=e.length)return{done:!0};t=e[n][Symbol.iterator]()}if(i=t.next(),i.done){t=null;continue}break}while(!0);return i}}}function Rt(){return{[Symbol.iterator](){return this},next(){return{done:!0}}}}class Wi extends Error{constructor(t){super(),this.name="GraphError",this.message=t}}class O extends Wi{constructor(t){super(t),this.name="InvalidArgumentsGraphError",typeof Error.captureStackTrace=="function"&&Error.captureStackTrace(this,O.prototype.constructor)}}class I extends Wi{constructor(t){super(t),this.name="NotFoundGraphError",typeof Error.captureStackTrace=="function"&&Error.captureStackTrace(this,I.prototype.constructor)}}class Y extends Wi{constructor(t){super(t),this.name="UsageGraphError",typeof Error.captureStackTrace=="function"&&Error.captureStackTrace(this,Y.prototype.constructor)}}function Jo(e,t){this.key=e,this.attributes=t,this.clear()}Jo.prototype.clear=function(){this.inDegree=0,this.outDegree=0,this.undirectedDegree=0,this.undirectedLoops=0,this.directedLoops=0,this.in={},this.out={},this.undirected={}};function Qo(e,t){this.key=e,this.attributes=t,this.clear()}Qo.prototype.clear=function(){this.inDegree=0,this.outDegree=0,this.directedLoops=0,this.in={},this.out={}};function ea(e,t){this.key=e,this.attributes=t,this.clear()}ea.prototype.clear=function(){this.undirectedDegree=0,this.undirectedLoops=0,this.undirected={}};function Nt(e,t,n,i,r){this.key=t,this.attributes=r,this.undirected=e,this.source=n,this.target=i}Nt.prototype.attach=function(){let e="out",t="in";this.undirected&&(e=t="undirected");const n=this.source.key,i=this.target.key;this.source[e][i]=this,!(this.undirected&&n===i)&&(this.target[t][n]=this)};Nt.prototype.attachMulti=function(){let e="out",t="in";const n=this.source.key,i=this.target.key;this.undirected&&(e=t="undirected");const r=this.source[e],o=r[i];if(typeof o>"u"){r[i]=this,this.undirected&&n===i||(this.target[t][n]=this);return}o.previous=this,this.next=o,r[i]=this,this.target[t][n]=this};Nt.prototype.detach=function(){const e=this.source.key,t=this.target.key;let n="out",i="in";this.undirected&&(n=i="undirected"),delete this.source[n][t],delete this.target[i][e]};Nt.prototype.detachMulti=function(){const e=this.source.key,t=this.target.key;let n="out",i="in";this.undirected&&(n=i="undirected"),this.previous===void 0?this.next===void 0?(delete this.source[n][t],delete this.target[i][e]):(this.next.previous=void 0,this.source[n][t]=this.next,this.target[i][e]=this.next):(this.previous.next=this.next,this.next!==void 0&&(this.next.previous=this.previous))};const ta=0,na=1,bd=2,ia=3;function tt(e,t,n,i,r,o,a){let s,u,l,c;if(i=""+i,n===ta){if(s=e._nodes.get(i),!s)throw new I(`Graph.${t}: could not find the "${i}" node in the graph.`);l=r,c=o}else if(n===ia){if(r=""+r,u=e._edges.get(r),!u)throw new I(`Graph.${t}: could not find the "${r}" edge in the graph.`);const d=u.source.key,h=u.target.key;if(i===d)s=u.target;else if(i===h)s=u.source;else throw new I(`Graph.${t}: the "${i}" node is not attached to the "${r}" edge (${d}, ${h}).`);l=o,c=a}else{if(u=e._edges.get(i),!u)throw new I(`Graph.${t}: could not find the "${i}" edge in the graph.`);n===na?s=u.source:s=u.target,l=r,c=o}return[s,l,c]}function wd(e,t,n){e.prototype[t]=function(i,r,o){const[a,s]=tt(this,t,n,i,r,o);return a.attributes[s]}}function xd(e,t,n){e.prototype[t]=function(i,r){const[o]=tt(this,t,n,i,r);return o.attributes}}function _d(e,t,n){e.prototype[t]=function(i,r,o){const[a,s]=tt(this,t,n,i,r,o);return a.attributes.hasOwnProperty(s)}}function Ed(e,t,n){e.prototype[t]=function(i,r,o,a){const[s,u,l]=tt(this,t,n,i,r,o,a);return s.attributes[u]=l,this.emit("nodeAttributesUpdated",{key:s.key,type:"set",attributes:s.attributes,name:u}),this}}function Cd(e,t,n){e.prototype[t]=function(i,r,o,a){const[s,u,l]=tt(this,t,n,i,r,o,a);if(typeof l!="function")throw new O(`Graph.${t}: updater should be a function.`);const c=s.attributes,d=l(c[u]);return c[u]=d,this.emit("nodeAttributesUpdated",{key:s.key,type:"set",attributes:s.attributes,name:u}),this}}function kd(e,t,n){e.prototype[t]=function(i,r,o){const[a,s]=tt(this,t,n,i,r,o);return delete a.attributes[s],this.emit("nodeAttributesUpdated",{key:a.key,type:"remove",attributes:a.attributes,name:s}),this}}function Td(e,t,n){e.prototype[t]=function(i,r,o){const[a,s]=tt(this,t,n,i,r,o);if(!be(s))throw new O(`Graph.${t}: provided attributes are not a plain object.`);return a.attributes=s,this.emit("nodeAttributesUpdated",{key:a.key,type:"replace",attributes:a.attributes}),this}}function Ad(e,t,n){e.prototype[t]=function(i,r,o){const[a,s]=tt(this,t,n,i,r,o);if(!be(s))throw new O(`Graph.${t}: provided attributes are not a plain object.`);return ve(a.attributes,s),this.emit("nodeAttributesUpdated",{key:a.key,type:"merge",attributes:a.attributes,data:s}),this}}function Sd(e,t,n){e.prototype[t]=function(i,r,o){const[a,s]=tt(this,t,n,i,r,o);if(typeof s!="function")throw new O(`Graph.${t}: provided updater is not a function.`);return a.attributes=s(a.attributes),this.emit("nodeAttributesUpdated",{key:a.key,type:"update",attributes:a.attributes}),this}}const Ld=[{name:e=>`get${e}Attribute`,attacher:wd},{name:e=>`get${e}Attributes`,attacher:xd},{name:e=>`has${e}Attribute`,attacher:_d},{name:e=>`set${e}Attribute`,attacher:Ed},{name:e=>`update${e}Attribute`,attacher:Cd},{name:e=>`remove${e}Attribute`,attacher:kd},{name:e=>`replace${e}Attributes`,attacher:Td},{name:e=>`merge${e}Attributes`,attacher:Ad},{name:e=>`update${e}Attributes`,attacher:Sd}];function Rd(e){Ld.forEach(function({name:t,attacher:n}){n(e,t("Node"),ta),n(e,t("Source"),na),n(e,t("Target"),bd),n(e,t("Opposite"),ia)})}function Nd(e,t,n){e.prototype[t]=function(i,r){let o;if(this.type!=="mixed"&&n!=="mixed"&&n!==this.type)throw new Y(`Graph.${t}: cannot find this type of edges in your ${this.type} graph.`);if(arguments.length>2){if(this.multi)throw new Y(`Graph.${t}: cannot use a {source,target} combo when asking about an edge's attributes in a MultiGraph since we cannot infer the one you want information about.`);const a=""+i,s=""+r;if(r=arguments[2],o=Re(this,a,s,n),!o)throw new I(`Graph.${t}: could not find an edge for the given path ("${a}" - "${s}").`)}else{if(n!=="mixed")throw new Y(`Graph.${t}: calling this method with only a key (vs. a source and target) does not make sense since an edge with this key could have the other type.`);if(i=""+i,o=this._edges.get(i),!o)throw new I(`Graph.${t}: could not find the "${i}" edge in the graph.`)}return o.attributes[r]}}function Md(e,t,n){e.prototype[t]=function(i){let r;if(this.type!=="mixed"&&n!=="mixed"&&n!==this.type)throw new Y(`Graph.${t}: cannot find this type of edges in your ${this.type} graph.`);if(arguments.length>1){if(this.multi)throw new Y(`Graph.${t}: cannot use a {source,target} combo when asking about an edge's attributes in a MultiGraph since we cannot infer the one you want information about.`);const o=""+i,a=""+arguments[1];if(r=Re(this,o,a,n),!r)throw new I(`Graph.${t}: could not find an edge for the given path ("${o}" - "${a}").`)}else{if(n!=="mixed")throw new Y(`Graph.${t}: calling this method with only a key (vs. a source and target) does not make sense since an edge with this key could have the other type.`);if(i=""+i,r=this._edges.get(i),!r)throw new I(`Graph.${t}: could not find the "${i}" edge in the graph.`)}return r.attributes}}function Dd(e,t,n){e.prototype[t]=function(i,r){let o;if(this.type!=="mixed"&&n!=="mixed"&&n!==this.type)throw new Y(`Graph.${t}: cannot find this type of edges in your ${this.type} graph.`);if(arguments.length>2){if(this.multi)throw new Y(`Graph.${t}: cannot use a {source,target} combo when asking about an edge's attributes in a MultiGraph since we cannot infer the one you want information about.`);const a=""+i,s=""+r;if(r=arguments[2],o=Re(this,a,s,n),!o)throw new I(`Graph.${t}: could not find an edge for the given path ("${a}" - "${s}").`)}else{if(n!=="mixed")throw new Y(`Graph.${t}: calling this method with only a key (vs. a source and target) does not make sense since an edge with this key could have the other type.`);if(i=""+i,o=this._edges.get(i),!o)throw new I(`Graph.${t}: could not find the "${i}" edge in the graph.`)}return o.attributes.hasOwnProperty(r)}}function $d(e,t,n){e.prototype[t]=function(i,r,o){let a;if(this.type!=="mixed"&&n!=="mixed"&&n!==this.type)throw new Y(`Graph.${t}: cannot find this type of edges in your ${this.type} graph.`);if(arguments.length>3){if(this.multi)throw new Y(`Graph.${t}: cannot use a {source,target} combo when asking about an edge's attributes in a MultiGraph since we cannot infer the one you want information about.`);const s=""+i,u=""+r;if(r=arguments[2],o=arguments[3],a=Re(this,s,u,n),!a)throw new I(`Graph.${t}: could not find an edge for the given path ("${s}" - "${u}").`)}else{if(n!=="mixed")throw new Y(`Graph.${t}: calling this method with only a key (vs. a source and target) does not make sense since an edge with this key could have the other type.`);if(i=""+i,a=this._edges.get(i),!a)throw new I(`Graph.${t}: could not find the "${i}" edge in the graph.`)}return a.attributes[r]=o,this.emit("edgeAttributesUpdated",{key:a.key,type:"set",attributes:a.attributes,name:r}),this}}function Id(e,t,n){e.prototype[t]=function(i,r,o){let a;if(this.type!=="mixed"&&n!=="mixed"&&n!==this.type)throw new Y(`Graph.${t}: cannot find this type of edges in your ${this.type} graph.`);if(arguments.length>3){if(this.multi)throw new Y(`Graph.${t}: cannot use a {source,target} combo when asking about an edge's attributes in a MultiGraph since we cannot infer the one you want information about.`);const s=""+i,u=""+r;if(r=arguments[2],o=arguments[3],a=Re(this,s,u,n),!a)throw new I(`Graph.${t}: could not find an edge for the given path ("${s}" - "${u}").`)}else{if(n!=="mixed")throw new Y(`Graph.${t}: calling this method with only a key (vs. a source and target) does not make sense since an edge with this key could have the other type.`);if(i=""+i,a=this._edges.get(i),!a)throw new I(`Graph.${t}: could not find the "${i}" edge in the graph.`)}if(typeof o!="function")throw new O(`Graph.${t}: updater should be a function.`);return a.attributes[r]=o(a.attributes[r]),this.emit("edgeAttributesUpdated",{key:a.key,type:"set",attributes:a.attributes,name:r}),this}}function Pd(e,t,n){e.prototype[t]=function(i,r){let o;if(this.type!=="mixed"&&n!=="mixed"&&n!==this.type)throw new Y(`Graph.${t}: cannot find this type of edges in your ${this.type} graph.`);if(arguments.length>2){if(this.multi)throw new Y(`Graph.${t}: cannot use a {source,target} combo when asking about an edge's attributes in a MultiGraph since we cannot infer the one you want information about.`);const a=""+i,s=""+r;if(r=arguments[2],o=Re(this,a,s,n),!o)throw new I(`Graph.${t}: could not find an edge for the given path ("${a}" - "${s}").`)}else{if(n!=="mixed")throw new Y(`Graph.${t}: calling this method with only a key (vs. a source and target) does not make sense since an edge with this key could have the other type.`);if(i=""+i,o=this._edges.get(i),!o)throw new I(`Graph.${t}: could not find the "${i}" edge in the graph.`)}return delete o.attributes[r],this.emit("edgeAttributesUpdated",{key:o.key,type:"remove",attributes:o.attributes,name:r}),this}}function Fd(e,t,n){e.prototype[t]=function(i,r){let o;if(this.type!=="mixed"&&n!=="mixed"&&n!==this.type)throw new Y(`Graph.${t}: cannot find this type of edges in your ${this.type} graph.`);if(arguments.length>2){if(this.multi)throw new Y(`Graph.${t}: cannot use a {source,target} combo when asking about an edge's attributes in a MultiGraph since we cannot infer the one you want information about.`);const a=""+i,s=""+r;if(r=arguments[2],o=Re(this,a,s,n),!o)throw new I(`Graph.${t}: could not find an edge for the given path ("${a}" - "${s}").`)}else{if(n!=="mixed")throw new Y(`Graph.${t}: calling this method with only a key (vs. a source and target) does not make sense since an edge with this key could have the other type.`);if(i=""+i,o=this._edges.get(i),!o)throw new I(`Graph.${t}: could not find the "${i}" edge in the graph.`)}if(!be(r))throw new O(`Graph.${t}: provided attributes are not a plain object.`);return o.attributes=r,this.emit("edgeAttributesUpdated",{key:o.key,type:"replace",attributes:o.attributes}),this}}function Gd(e,t,n){e.prototype[t]=function(i,r){let o;if(this.type!=="mixed"&&n!=="mixed"&&n!==this.type)throw new Y(`Graph.${t}: cannot find this type of edges in your ${this.type} graph.`);if(arguments.length>2){if(this.multi)throw new Y(`Graph.${t}: cannot use a {source,target} combo when asking about an edge's attributes in a MultiGraph since we cannot infer the one you want information about.`);const a=""+i,s=""+r;if(r=arguments[2],o=Re(this,a,s,n),!o)throw new I(`Graph.${t}: could not find an edge for the given path ("${a}" - "${s}").`)}else{if(n!=="mixed")throw new Y(`Graph.${t}: calling this method with only a key (vs. a source and target) does not make sense since an edge with this key could have the other type.`);if(i=""+i,o=this._edges.get(i),!o)throw new I(`Graph.${t}: could not find the "${i}" edge in the graph.`)}if(!be(r))throw new O(`Graph.${t}: provided attributes are not a plain object.`);return ve(o.attributes,r),this.emit("edgeAttributesUpdated",{key:o.key,type:"merge",attributes:o.attributes,data:r}),this}}function zd(e,t,n){e.prototype[t]=function(i,r){let o;if(this.type!=="mixed"&&n!=="mixed"&&n!==this.type)throw new Y(`Graph.${t}: cannot find this type of edges in your ${this.type} graph.`);if(arguments.length>2){if(this.multi)throw new Y(`Graph.${t}: cannot use a {source,target} combo when asking about an edge's attributes in a MultiGraph since we cannot infer the one you want information about.`);const a=""+i,s=""+r;if(r=arguments[2],o=Re(this,a,s,n),!o)throw new I(`Graph.${t}: could not find an edge for the given path ("${a}" - "${s}").`)}else{if(n!=="mixed")throw new Y(`Graph.${t}: calling this method with only a key (vs. a source and target) does not make sense since an edge with this key could have the other type.`);if(i=""+i,o=this._edges.get(i),!o)throw new I(`Graph.${t}: could not find the "${i}" edge in the graph.`)}if(typeof r!="function")throw new O(`Graph.${t}: provided updater is not a function.`);return o.attributes=r(o.attributes),this.emit("edgeAttributesUpdated",{key:o.key,type:"update",attributes:o.attributes}),this}}const Bd=[{name:e=>`get${e}Attribute`,attacher:Nd},{name:e=>`get${e}Attributes`,attacher:Md},{name:e=>`has${e}Attribute`,attacher:Dd},{name:e=>`set${e}Attribute`,attacher:$d},{name:e=>`update${e}Attribute`,attacher:Id},{name:e=>`remove${e}Attribute`,attacher:Pd},{name:e=>`replace${e}Attributes`,attacher:Fd},{name:e=>`merge${e}Attributes`,attacher:Gd},{name:e=>`update${e}Attributes`,attacher:zd}];function Od(e){Bd.forEach(function({name:t,attacher:n}){n(e,t("Edge"),"mixed"),n(e,t("DirectedEdge"),"directed"),n(e,t("UndirectedEdge"),"undirected")})}const Ud=[{name:"edges",type:"mixed"},{name:"inEdges",type:"directed",direction:"in"},{name:"outEdges",type:"directed",direction:"out"},{name:"inboundEdges",type:"mixed",direction:"in"},{name:"outboundEdges",type:"mixed",direction:"out"},{name:"directedEdges",type:"directed"},{name:"undirectedEdges",type:"undirected"}];function Hd(e,t,n,i){let r=!1;for(const o in t){if(o===i)continue;const a=t[o];if(r=n(a.key,a.attributes,a.source.key,a.target.key,a.source.attributes,a.target.attributes,a.undirected),e&&r)return a.key}}function qd(e,t,n,i){let r,o,a,s=!1;for(const u in t)if(u!==i){r=t[u];do{if(o=r.source,a=r.target,s=n(r.key,r.attributes,o.key,a.key,o.attributes,a.attributes,r.undirected),e&&s)return r.key;r=r.next}while(r!==void 0)}}function ni(e,t){const n=Object.keys(e),i=n.length;let r,o=0;return{[Symbol.iterator](){return this},next(){do if(r)r=r.next;else{if(o>=i)return{done:!0};const a=n[o++];if(a===t){r=void 0;continue}r=e[a]}while(!r);return{done:!1,value:{edge:r.key,attributes:r.attributes,source:r.source.key,target:r.target.key,sourceAttributes:r.source.attributes,targetAttributes:r.target.attributes,undirected:r.undirected}}}}}function Vd(e,t,n,i){const r=t[n];if(!r)return;const o=r.source,a=r.target;if(i(r.key,r.attributes,o.key,a.key,o.attributes,a.attributes,r.undirected)&&e)return r.key}function Wd(e,t,n,i){let r=t[n];if(!r)return;let o=!1;do{if(o=i(r.key,r.attributes,r.source.key,r.target.key,r.source.attributes,r.target.attributes,r.undirected),e&&o)return r.key;r=r.next}while(r!==void 0)}function ii(e,t){let n=e[t];if(n.next!==void 0)return{[Symbol.iterator](){return this},next(){if(!n)return{done:!0};const r={edge:n.key,attributes:n.attributes,source:n.source.key,target:n.target.key,sourceAttributes:n.source.attributes,targetAttributes:n.target.attributes,undirected:n.undirected};return n=n.next,{done:!1,value:r}}};let i=!1;return{[Symbol.iterator](){return this},next(){return i===!0?{done:!0}:(i=!0,{done:!1,value:{edge:n.key,attributes:n.attributes,source:n.source.key,target:n.target.key,sourceAttributes:n.source.attributes,targetAttributes:n.target.attributes,undirected:n.undirected}})}}}function jd(e,t){if(e.size===0)return[];if(t==="mixed"||t===e.type)return Array.from(e._edges.keys());const n=t==="undirected"?e.undirectedSize:e.directedSize,i=new Array(n),r=t==="undirected",o=e._edges.values();let a=0,s,u;for(;s=o.next(),s.done!==!0;)u=s.value,u.undirected===r&&(i[a++]=u.key);return i}function ra(e,t,n,i){if(t.size===0)return;const r=n!=="mixed"&&n!==t.type,o=n==="undirected";let a,s,u=!1;const l=t._edges.values();for(;a=l.next(),a.done!==!0;){if(s=a.value,r&&s.undirected!==o)continue;const{key:c,attributes:d,source:h,target:f}=s;if(u=i(c,d,h.key,f.key,h.attributes,f.attributes,s.undirected),e&&u)return c}}function Yd(e,t){if(e.size===0)return Rt();const n=t!=="mixed"&&t!==e.type,i=t==="undirected",r=e._edges.values();return{[Symbol.iterator](){return this},next(){let o,a;for(;;){if(o=r.next(),o.done)return o;if(a=o.value,!(n&&a.undirected!==i))break}return{value:{edge:a.key,attributes:a.attributes,source:a.source.key,target:a.target.key,sourceAttributes:a.source.attributes,targetAttributes:a.target.attributes,undirected:a.undirected},done:!1}}}}function ji(e,t,n,i,r,o){const a=t?qd:Hd;let s;if(n!=="undirected"&&(i!=="out"&&(s=a(e,r.in,o),e&&s)||i!=="in"&&(s=a(e,r.out,o,i?void 0:r.key),e&&s))||n!=="directed"&&(s=a(e,r.undirected,o),e&&s))return s}function Xd(e,t,n,i){const r=[];return ji(!1,e,t,n,i,function(o){r.push(o)}),r}function Kd(e,t,n){let i=Rt();return e!=="undirected"&&(t!=="out"&&typeof n.in<"u"&&(i=Qe(i,ni(n.in))),t!=="in"&&typeof n.out<"u"&&(i=Qe(i,ni(n.out,t?void 0:n.key)))),e!=="directed"&&typeof n.undirected<"u"&&(i=Qe(i,ni(n.undirected))),i}function Yi(e,t,n,i,r,o,a){const s=n?Wd:Vd;let u;if(t!=="undirected"&&(typeof r.in<"u"&&i!=="out"&&(u=s(e,r.in,o,a),e&&u)||typeof r.out<"u"&&i!=="in"&&(i||r.key!==o)&&(u=s(e,r.out,o,a),e&&u))||t!=="directed"&&typeof r.undirected<"u"&&(u=s(e,r.undirected,o,a),e&&u))return u}function Zd(e,t,n,i,r){const o=[];return Yi(!1,e,t,n,i,r,function(a){o.push(a)}),o}function Jd(e,t,n,i){let r=Rt();return e!=="undirected"&&(typeof n.in<"u"&&t!=="out"&&i in n.in&&(r=Qe(r,ii(n.in,i))),typeof n.out<"u"&&t!=="in"&&i in n.out&&(t||n.key!==i)&&(r=Qe(r,ii(n.out,i)))),e!=="directed"&&typeof n.undirected<"u"&&i in n.undirected&&(r=Qe(r,ii(n.undirected,i))),r}function Qd(e,t){const{name:n,type:i,direction:r}=t;e.prototype[n]=function(o,a){if(i!=="mixed"&&this.type!=="mixed"&&i!==this.type)return[];if(!arguments.length)return jd(this,i);if(arguments.length===1){o=""+o;const s=this._nodes.get(o);if(typeof s>"u")throw new I(`Graph.${n}: could not find the "${o}" node in the graph.`);return Xd(this.multi,i==="mixed"?this.type:i,r,s)}if(arguments.length===2){o=""+o,a=""+a;const s=this._nodes.get(o);if(!s)throw new I(`Graph.${n}:  could not find the "${o}" source node in the graph.`);if(!this._nodes.has(a))throw new I(`Graph.${n}:  could not find the "${a}" target node in the graph.`);return Zd(i,this.multi,r,s,a)}throw new O(`Graph.${n}: too many arguments (expecting 0, 1 or 2 and got ${arguments.length}).`)}}function eh(e,t){const{name:n,type:i,direction:r}=t,o="forEach"+n[0].toUpperCase()+n.slice(1,-1);e.prototype[o]=function(l,c,d){if(!(i!=="mixed"&&this.type!=="mixed"&&i!==this.type)){if(arguments.length===1)return d=l,ra(!1,this,i,d);if(arguments.length===2){l=""+l,d=c;const h=this._nodes.get(l);if(typeof h>"u")throw new I(`Graph.${o}: could not find the "${l}" node in the graph.`);return ji(!1,this.multi,i==="mixed"?this.type:i,r,h,d)}if(arguments.length===3){l=""+l,c=""+c;const h=this._nodes.get(l);if(!h)throw new I(`Graph.${o}:  could not find the "${l}" source node in the graph.`);if(!this._nodes.has(c))throw new I(`Graph.${o}:  could not find the "${c}" target node in the graph.`);return Yi(!1,i,this.multi,r,h,c,d)}throw new O(`Graph.${o}: too many arguments (expecting 1, 2 or 3 and got ${arguments.length}).`)}};const a="map"+n[0].toUpperCase()+n.slice(1);e.prototype[a]=function(){const l=Array.prototype.slice.call(arguments),c=l.pop();let d;if(l.length===0){let h=0;i!=="directed"&&(h+=this.undirectedSize),i!=="undirected"&&(h+=this.directedSize),d=new Array(h);let f=0;l.push((g,v,x,C,b,w,m)=>{d[f++]=c(g,v,x,C,b,w,m)})}else d=[],l.push((h,f,g,v,x,C,b)=>{d.push(c(h,f,g,v,x,C,b))});return this[o].apply(this,l),d};const s="filter"+n[0].toUpperCase()+n.slice(1);e.prototype[s]=function(){const l=Array.prototype.slice.call(arguments),c=l.pop(),d=[];return l.push((h,f,g,v,x,C,b)=>{c(h,f,g,v,x,C,b)&&d.push(h)}),this[o].apply(this,l),d};const u="reduce"+n[0].toUpperCase()+n.slice(1);e.prototype[u]=function(){let l=Array.prototype.slice.call(arguments);if(l.length<2||l.length>4)throw new O(`Graph.${u}: invalid number of arguments (expecting 2, 3 or 4 and got ${l.length}).`);if(typeof l[l.length-1]=="function"&&typeof l[l.length-2]!="function")throw new O(`Graph.${u}: missing initial value. You must provide it because the callback takes more than one argument and we cannot infer the initial value from the first iteration, as you could with a simple array.`);let c,d;l.length===2?(c=l[0],d=l[1],l=[]):l.length===3?(c=l[1],d=l[2],l=[l[0]]):l.length===4&&(c=l[2],d=l[3],l=[l[0],l[1]]);let h=d;return l.push((f,g,v,x,C,b,w)=>{h=c(h,f,g,v,x,C,b,w)}),this[o].apply(this,l),h}}function th(e,t){const{name:n,type:i,direction:r}=t,o="find"+n[0].toUpperCase()+n.slice(1,-1);e.prototype[o]=function(u,l,c){if(i!=="mixed"&&this.type!=="mixed"&&i!==this.type)return!1;if(arguments.length===1)return c=u,ra(!0,this,i,c);if(arguments.length===2){u=""+u,c=l;const d=this._nodes.get(u);if(typeof d>"u")throw new I(`Graph.${o}: could not find the "${u}" node in the graph.`);return ji(!0,this.multi,i==="mixed"?this.type:i,r,d,c)}if(arguments.length===3){u=""+u,l=""+l;const d=this._nodes.get(u);if(!d)throw new I(`Graph.${o}:  could not find the "${u}" source node in the graph.`);if(!this._nodes.has(l))throw new I(`Graph.${o}:  could not find the "${l}" target node in the graph.`);return Yi(!0,i,this.multi,r,d,l,c)}throw new O(`Graph.${o}: too many arguments (expecting 1, 2 or 3 and got ${arguments.length}).`)};const a="some"+n[0].toUpperCase()+n.slice(1,-1);e.prototype[a]=function(){const u=Array.prototype.slice.call(arguments),l=u.pop();return u.push((d,h,f,g,v,x,C)=>l(d,h,f,g,v,x,C)),!!this[o].apply(this,u)};const s="every"+n[0].toUpperCase()+n.slice(1,-1);e.prototype[s]=function(){const u=Array.prototype.slice.call(arguments),l=u.pop();return u.push((d,h,f,g,v,x,C)=>!l(d,h,f,g,v,x,C)),!this[o].apply(this,u)}}function nh(e,t){const{name:n,type:i,direction:r}=t,o=n.slice(0,-1)+"Entries";e.prototype[o]=function(a,s){if(i!=="mixed"&&this.type!=="mixed"&&i!==this.type)return Rt();if(!arguments.length)return Yd(this,i);if(arguments.length===1){a=""+a;const u=this._nodes.get(a);if(!u)throw new I(`Graph.${o}: could not find the "${a}" node in the graph.`);return Kd(i,r,u)}if(arguments.length===2){a=""+a,s=""+s;const u=this._nodes.get(a);if(!u)throw new I(`Graph.${o}:  could not find the "${a}" source node in the graph.`);if(!this._nodes.has(s))throw new I(`Graph.${o}:  could not find the "${s}" target node in the graph.`);return Jd(i,r,u,s)}throw new O(`Graph.${o}: too many arguments (expecting 0, 1 or 2 and got ${arguments.length}).`)}}function ih(e){Ud.forEach(t=>{Qd(e,t),eh(e,t),th(e,t),nh(e,t)})}const rh=[{name:"neighbors",type:"mixed"},{name:"inNeighbors",type:"directed",direction:"in"},{name:"outNeighbors",type:"directed",direction:"out"},{name:"inboundNeighbors",type:"mixed",direction:"in"},{name:"outboundNeighbors",type:"mixed",direction:"out"},{name:"directedNeighbors",type:"directed"},{name:"undirectedNeighbors",type:"undirected"}];function Un(){this.A=null,this.B=null}Un.prototype.wrap=function(e){this.A===null?this.A=e:this.B===null&&(this.B=e)};Un.prototype.has=function(e){return this.A!==null&&e in this.A||this.B!==null&&e in this.B};function Ft(e,t,n,i,r){for(const o in i){const a=i[o],s=a.source,u=a.target,l=s===n?u:s;if(t&&t.has(l.key))continue;const c=r(l.key,l.attributes);if(e&&c)return l.key}}function Xi(e,t,n,i,r){if(t!=="mixed"){if(t==="undirected")return Ft(e,null,i,i.undirected,r);if(typeof n=="string")return Ft(e,null,i,i[n],r)}const o=new Un;let a;if(t!=="undirected"){if(n!=="out"){if(a=Ft(e,null,i,i.in,r),e&&a)return a;o.wrap(i.in)}if(n!=="in"){if(a=Ft(e,o,i,i.out,r),e&&a)return a;o.wrap(i.out)}}if(t!=="directed"&&(a=Ft(e,o,i,i.undirected,r),e&&a))return a}function oh(e,t,n){if(e!=="mixed"){if(e==="undirected")return Object.keys(n.undirected);if(typeof t=="string")return Object.keys(n[t])}const i=[];return Xi(!1,e,t,n,function(r){i.push(r)}),i}function Gt(e,t,n){const i=Object.keys(n),r=i.length;let o=0;return{[Symbol.iterator](){return this},next(){let a=null;do{if(o>=r)return e&&e.wrap(n),{done:!0};const s=n[i[o++]],u=s.source,l=s.target;if(a=u===t?l:u,e&&e.has(a.key)){a=null;continue}}while(a===null);return{done:!1,value:{neighbor:a.key,attributes:a.attributes}}}}}function ah(e,t,n){if(e!=="mixed"){if(e==="undirected")return Gt(null,n,n.undirected);if(typeof t=="string")return Gt(null,n,n[t])}let i=Rt();const r=new Un;return e!=="undirected"&&(t!=="out"&&(i=Qe(i,Gt(r,n,n.in))),t!=="in"&&(i=Qe(i,Gt(r,n,n.out)))),e!=="directed"&&(i=Qe(i,Gt(r,n,n.undirected))),i}function sh(e,t){const{name:n,type:i,direction:r}=t;e.prototype[n]=function(o){if(i!=="mixed"&&this.type!=="mixed"&&i!==this.type)return[];o=""+o;const a=this._nodes.get(o);if(typeof a>"u")throw new I(`Graph.${n}: could not find the "${o}" node in the graph.`);return oh(i==="mixed"?this.type:i,r,a)}}function uh(e,t){const{name:n,type:i,direction:r}=t,o="forEach"+n[0].toUpperCase()+n.slice(1,-1);e.prototype[o]=function(l,c){if(i!=="mixed"&&this.type!=="mixed"&&i!==this.type)return;l=""+l;const d=this._nodes.get(l);if(typeof d>"u")throw new I(`Graph.${o}: could not find the "${l}" node in the graph.`);Xi(!1,i==="mixed"?this.type:i,r,d,c)};const a="map"+n[0].toUpperCase()+n.slice(1);e.prototype[a]=function(l,c){const d=[];return this[o](l,(h,f)=>{d.push(c(h,f))}),d};const s="filter"+n[0].toUpperCase()+n.slice(1);e.prototype[s]=function(l,c){const d=[];return this[o](l,(h,f)=>{c(h,f)&&d.push(h)}),d};const u="reduce"+n[0].toUpperCase()+n.slice(1);e.prototype[u]=function(l,c,d){if(arguments.length<3)throw new O(`Graph.${u}: missing initial value. You must provide it because the callback takes more than one argument and we cannot infer the initial value from the first iteration, as you could with a simple array.`);let h=d;return this[o](l,(f,g)=>{h=c(h,f,g)}),h}}function lh(e,t){const{name:n,type:i,direction:r}=t,o=n[0].toUpperCase()+n.slice(1,-1),a="find"+o;e.prototype[a]=function(l,c){if(i!=="mixed"&&this.type!=="mixed"&&i!==this.type)return;l=""+l;const d=this._nodes.get(l);if(typeof d>"u")throw new I(`Graph.${a}: could not find the "${l}" node in the graph.`);return Xi(!0,i==="mixed"?this.type:i,r,d,c)};const s="some"+o;e.prototype[s]=function(l,c){return!!this[a](l,c)};const u="every"+o;e.prototype[u]=function(l,c){return!this[a](l,(h,f)=>!c(h,f))}}function ch(e,t){const{name:n,type:i,direction:r}=t,o=n.slice(0,-1)+"Entries";e.prototype[o]=function(a){if(i!=="mixed"&&this.type!=="mixed"&&i!==this.type)return Rt();a=""+a;const s=this._nodes.get(a);if(typeof s>"u")throw new I(`Graph.${o}: could not find the "${a}" node in the graph.`);return ah(i==="mixed"?this.type:i,r,s)}}function dh(e){rh.forEach(t=>{sh(e,t),uh(e,t),lh(e,t),ch(e,t)})}function pn(e,t,n,i,r){const o=i._nodes.values(),a=i.type;let s,u,l,c,d,h;for(;s=o.next(),s.done!==!0;){let f=!1;if(u=s.value,a!=="undirected"){c=u.out;for(l in c){d=c[l];do h=d.target,f=!0,r(u.key,h.key,u.attributes,h.attributes,d.key,d.attributes,d.undirected),d=d.next;while(d)}}if(a!=="directed"){c=u.undirected;for(l in c)if(!(t&&u.key>l)){d=c[l];do h=d.target,h.key!==l&&(h=d.source),f=!0,r(u.key,h.key,u.attributes,h.attributes,d.key,d.attributes,d.undirected),d=d.next;while(d)}}n&&!f&&r(u.key,null,u.attributes,null,null,null,null)}}function hh(e,t){const n={key:e};return Zo(t.attributes)||(n.attributes=ve({},t.attributes)),n}function fh(e,t,n){const i={key:t,source:n.source.key,target:n.target.key};return Zo(n.attributes)||(i.attributes=ve({},n.attributes)),e==="mixed"&&n.undirected&&(i.undirected=!0),i}function ph(e){if(!be(e))throw new O('Graph.import: invalid serialized node. A serialized node should be a plain object with at least a "key" property.');if(!("key"in e))throw new O("Graph.import: serialized node is missing its key.");if("attributes"in e&&(!be(e.attributes)||e.attributes===null))throw new O("Graph.import: invalid attributes. Attributes should be a plain object, null or omitted.")}function gh(e){if(!be(e))throw new O('Graph.import: invalid serialized edge. A serialized edge should be a plain object with at least a "source" & "target" property.');if(!("source"in e))throw new O("Graph.import: serialized edge is missing its source.");if(!("target"in e))throw new O("Graph.import: serialized edge is missing its target.");if("attributes"in e&&(!be(e.attributes)||e.attributes===null))throw new O("Graph.import: invalid attributes. Attributes should be a plain object, null or omitted.");if("undirected"in e&&typeof e.undirected!="boolean")throw new O("Graph.import: invalid undirectedness information. Undirected should be boolean or omitted.")}const mh=yd(),vh=new Set(["directed","undirected","mixed"]),Or=new Set(["domain","_events","_eventsCount","_maxListeners"]),yh=[{name:e=>`${e}Edge`,generateKey:!0},{name:e=>`${e}DirectedEdge`,generateKey:!0,type:"directed"},{name:e=>`${e}UndirectedEdge`,generateKey:!0,type:"undirected"},{name:e=>`${e}EdgeWithKey`},{name:e=>`${e}DirectedEdgeWithKey`,type:"directed"},{name:e=>`${e}UndirectedEdgeWithKey`,type:"undirected"}],bh={allowSelfLoops:!0,multi:!1,type:"mixed"};function wh(e,t,n){if(n&&!be(n))throw new O(`Graph.addNode: invalid attributes. Expecting an object but got "${n}"`);if(t=""+t,n=n||{},e._nodes.has(t))throw new Y(`Graph.addNode: the "${t}" node already exist in the graph.`);const i=new e.NodeDataClass(t,n);return e._nodes.set(t,i),e.emit("nodeAdded",{key:t,attributes:n}),i}function Ur(e,t,n){const i=new e.NodeDataClass(t,n);return e._nodes.set(t,i),e.emit("nodeAdded",{key:t,attributes:n}),i}function oa(e,t,n,i,r,o,a,s){if(!i&&e.type==="undirected")throw new Y(`Graph.${t}: you cannot add a directed edge to an undirected graph. Use the #.addEdge or #.addUndirectedEdge instead.`);if(i&&e.type==="directed")throw new Y(`Graph.${t}: you cannot add an undirected edge to a directed graph. Use the #.addEdge or #.addDirectedEdge instead.`);if(s&&!be(s))throw new O(`Graph.${t}: invalid attributes. Expecting an object but got "${s}"`);if(o=""+o,a=""+a,s=s||{},!e.allowSelfLoops&&o===a)throw new Y(`Graph.${t}: source & target are the same ("${o}"), thus creating a loop explicitly forbidden by this graph 'allowSelfLoops' option set to false.`);const u=e._nodes.get(o),l=e._nodes.get(a);if(!u)throw new I(`Graph.${t}: source node "${o}" not found.`);if(!l)throw new I(`Graph.${t}: target node "${a}" not found.`);const c={key:null,undirected:i,source:o,target:a,attributes:s};if(n)r=e._edgeKeyGenerator();else if(r=""+r,e._edges.has(r))throw new Y(`Graph.${t}: the "${r}" edge already exists in the graph.`);if(!e.multi&&(i?typeof u.undirected[a]<"u":typeof u.out[a]<"u"))throw new Y(`Graph.${t}: an edge linking "${o}" to "${a}" already exists. If you really want to add multiple edges linking those nodes, you should create a multi graph by using the 'multi' option.`);const d=new Nt(i,r,u,l,s);e._edges.set(r,d);const h=o===a;return i?(u.undirectedDegree++,l.undirectedDegree++,h&&(u.undirectedLoops++,e._undirectedSelfLoopCount++)):(u.outDegree++,l.inDegree++,h&&(u.directedLoops++,e._directedSelfLoopCount++)),e.multi?d.attachMulti():d.attach(),i?e._undirectedSize++:e._directedSize++,c.key=r,e.emit("edgeAdded",c),r}function xh(e,t,n,i,r,o,a,s,u){if(!i&&e.type==="undirected")throw new Y(`Graph.${t}: you cannot merge/update a directed edge to an undirected graph. Use the #.mergeEdge/#.updateEdge or #.addUndirectedEdge instead.`);if(i&&e.type==="directed")throw new Y(`Graph.${t}: you cannot merge/update an undirected edge to a directed graph. Use the #.mergeEdge/#.updateEdge or #.addDirectedEdge instead.`);if(s){if(u){if(typeof s!="function")throw new O(`Graph.${t}: invalid updater function. Expecting a function but got "${s}"`)}else if(!be(s))throw new O(`Graph.${t}: invalid attributes. Expecting an object but got "${s}"`)}o=""+o,a=""+a;let l;if(u&&(l=s,s=void 0),!e.allowSelfLoops&&o===a)throw new Y(`Graph.${t}: source & target are the same ("${o}"), thus creating a loop explicitly forbidden by this graph 'allowSelfLoops' option set to false.`);let c=e._nodes.get(o),d=e._nodes.get(a),h,f;if(!n&&(h=e._edges.get(r),h)){if((h.source.key!==o||h.target.key!==a)&&(!i||h.source.key!==a||h.target.key!==o))throw new Y(`Graph.${t}: inconsistency detected when attempting to merge the "${r}" edge with "${o}" source & "${a}" target vs. ("${h.source.key}", "${h.target.key}").`);f=h}if(!f&&!e.multi&&c&&(f=i?c.undirected[a]:c.out[a]),f){const b=[f.key,!1,!1,!1];if(u?!l:!s)return b;if(u){const w=f.attributes;f.attributes=l(w),e.emit("edgeAttributesUpdated",{type:"replace",key:f.key,attributes:f.attributes})}else ve(f.attributes,s),e.emit("edgeAttributesUpdated",{type:"merge",key:f.key,attributes:f.attributes,data:s});return b}s=s||{},u&&l&&(s=l(s));const g={key:null,undirected:i,source:o,target:a,attributes:s};if(n)r=e._edgeKeyGenerator();else if(r=""+r,e._edges.has(r))throw new Y(`Graph.${t}: the "${r}" edge already exists in the graph.`);let v=!1,x=!1;c||(c=Ur(e,o,{}),v=!0,o===a&&(d=c,x=!0)),d||(d=Ur(e,a,{}),x=!0),h=new Nt(i,r,c,d,s),e._edges.set(r,h);const C=o===a;return i?(c.undirectedDegree++,d.undirectedDegree++,C&&(c.undirectedLoops++,e._undirectedSelfLoopCount++)):(c.outDegree++,d.inDegree++,C&&(c.directedLoops++,e._directedSelfLoopCount++)),e.multi?h.attachMulti():h.attach(),i?e._undirectedSize++:e._directedSize++,g.key=r,e.emit("edgeAdded",g),[r,!0,v,x]}function wt(e,t){e._edges.delete(t.key);const{source:n,target:i,attributes:r}=t,o=t.undirected,a=n===i;o?(n.undirectedDegree--,i.undirectedDegree--,a&&(n.undirectedLoops--,e._undirectedSelfLoopCount--)):(n.outDegree--,i.inDegree--,a&&(n.directedLoops--,e._directedSelfLoopCount--)),e.multi?t.detachMulti():t.detach(),o?e._undirectedSize--:e._directedSize--,e.emit("edgeDropped",{key:t.key,attributes:r,source:n.key,target:i.key,undirected:o})}class ue extends Ko.EventEmitter{constructor(t){if(super(),t=ve({},bh,t),typeof t.multi!="boolean")throw new O(`Graph.constructor: invalid 'multi' option. Expecting a boolean but got "${t.multi}".`);if(!vh.has(t.type))throw new O(`Graph.constructor: invalid 'type' option. Should be one of "mixed", "directed" or "undirected" but got "${t.type}".`);if(typeof t.allowSelfLoops!="boolean")throw new O(`Graph.constructor: invalid 'allowSelfLoops' option. Expecting a boolean but got "${t.allowSelfLoops}".`);const n=t.type==="mixed"?Jo:t.type==="directed"?Qo:ea;Le(this,"NodeDataClass",n);const i="geid_"+mh()+"_";let r=0;const o=()=>{let a;do a=i+r++;while(this._edges.has(a));return a};Le(this,"_attributes",{}),Le(this,"_nodes",new Map),Le(this,"_edges",new Map),Le(this,"_directedSize",0),Le(this,"_undirectedSize",0),Le(this,"_directedSelfLoopCount",0),Le(this,"_undirectedSelfLoopCount",0),Le(this,"_edgeKeyGenerator",o),Le(this,"_options",t),Or.forEach(a=>Le(this,a,this[a])),Pe(this,"order",()=>this._nodes.size),Pe(this,"size",()=>this._edges.size),Pe(this,"directedSize",()=>this._directedSize),Pe(this,"undirectedSize",()=>this._undirectedSize),Pe(this,"selfLoopCount",()=>this._directedSelfLoopCount+this._undirectedSelfLoopCount),Pe(this,"directedSelfLoopCount",()=>this._directedSelfLoopCount),Pe(this,"undirectedSelfLoopCount",()=>this._undirectedSelfLoopCount),Pe(this,"multi",this._options.multi),Pe(this,"type",this._options.type),Pe(this,"allowSelfLoops",this._options.allowSelfLoops),Pe(this,"implementation",()=>"graphology")}_resetInstanceCounters(){this._directedSize=0,this._undirectedSize=0,this._directedSelfLoopCount=0,this._undirectedSelfLoopCount=0}hasNode(t){return this._nodes.has(""+t)}hasDirectedEdge(t,n){if(this.type==="undirected")return!1;if(arguments.length===1){const i=""+t,r=this._edges.get(i);return!!r&&!r.undirected}else if(arguments.length===2){t=""+t,n=""+n;const i=this._nodes.get(t);return i?i.out.hasOwnProperty(n):!1}throw new O(`Graph.hasDirectedEdge: invalid arity (${arguments.length}, instead of 1 or 2). You can either ask for an edge id or for the existence of an edge between a source & a target.`)}hasUndirectedEdge(t,n){if(this.type==="directed")return!1;if(arguments.length===1){const i=""+t,r=this._edges.get(i);return!!r&&r.undirected}else if(arguments.length===2){t=""+t,n=""+n;const i=this._nodes.get(t);return i?i.undirected.hasOwnProperty(n):!1}throw new O(`Graph.hasDirectedEdge: invalid arity (${arguments.length}, instead of 1 or 2). You can either ask for an edge id or for the existence of an edge between a source & a target.`)}hasEdge(t,n){if(arguments.length===1){const i=""+t;return this._edges.has(i)}else if(arguments.length===2){t=""+t,n=""+n;const i=this._nodes.get(t);return i?typeof i.out<"u"&&i.out.hasOwnProperty(n)||typeof i.undirected<"u"&&i.undirected.hasOwnProperty(n):!1}throw new O(`Graph.hasEdge: invalid arity (${arguments.length}, instead of 1 or 2). You can either ask for an edge id or for the existence of an edge between a source & a target.`)}directedEdge(t,n){if(this.type==="undirected")return;if(t=""+t,n=""+n,this.multi)throw new Y("Graph.directedEdge: this method is irrelevant with multigraphs since there might be multiple edges between source & target. See #.directedEdges instead.");const i=this._nodes.get(t);if(!i)throw new I(`Graph.directedEdge: could not find the "${t}" source node in the graph.`);if(!this._nodes.has(n))throw new I(`Graph.directedEdge: could not find the "${n}" target node in the graph.`);const r=i.out&&i.out[n]||void 0;if(r)return r.key}undirectedEdge(t,n){if(this.type==="directed")return;if(t=""+t,n=""+n,this.multi)throw new Y("Graph.undirectedEdge: this method is irrelevant with multigraphs since there might be multiple edges between source & target. See #.undirectedEdges instead.");const i=this._nodes.get(t);if(!i)throw new I(`Graph.undirectedEdge: could not find the "${t}" source node in the graph.`);if(!this._nodes.has(n))throw new I(`Graph.undirectedEdge: could not find the "${n}" target node in the graph.`);const r=i.undirected&&i.undirected[n]||void 0;if(r)return r.key}edge(t,n){if(this.multi)throw new Y("Graph.edge: this method is irrelevant with multigraphs since there might be multiple edges between source & target. See #.edges instead.");t=""+t,n=""+n;const i=this._nodes.get(t);if(!i)throw new I(`Graph.edge: could not find the "${t}" source node in the graph.`);if(!this._nodes.has(n))throw new I(`Graph.edge: could not find the "${n}" target node in the graph.`);const r=i.out&&i.out[n]||i.undirected&&i.undirected[n]||void 0;if(r)return r.key}areDirectedNeighbors(t,n){t=""+t,n=""+n;const i=this._nodes.get(t);if(!i)throw new I(`Graph.areDirectedNeighbors: could not find the "${t}" node in the graph.`);return this.type==="undirected"?!1:n in i.in||n in i.out}areOutNeighbors(t,n){t=""+t,n=""+n;const i=this._nodes.get(t);if(!i)throw new I(`Graph.areOutNeighbors: could not find the "${t}" node in the graph.`);return this.type==="undirected"?!1:n in i.out}areInNeighbors(t,n){t=""+t,n=""+n;const i=this._nodes.get(t);if(!i)throw new I(`Graph.areInNeighbors: could not find the "${t}" node in the graph.`);return this.type==="undirected"?!1:n in i.in}areUndirectedNeighbors(t,n){t=""+t,n=""+n;const i=this._nodes.get(t);if(!i)throw new I(`Graph.areUndirectedNeighbors: could not find the "${t}" node in the graph.`);return this.type==="directed"?!1:n in i.undirected}areNeighbors(t,n){t=""+t,n=""+n;const i=this._nodes.get(t);if(!i)throw new I(`Graph.areNeighbors: could not find the "${t}" node in the graph.`);return this.type!=="undirected"&&(n in i.in||n in i.out)||this.type!=="directed"&&n in i.undirected}areInboundNeighbors(t,n){t=""+t,n=""+n;const i=this._nodes.get(t);if(!i)throw new I(`Graph.areInboundNeighbors: could not find the "${t}" node in the graph.`);return this.type!=="undirected"&&n in i.in||this.type!=="directed"&&n in i.undirected}areOutboundNeighbors(t,n){t=""+t,n=""+n;const i=this._nodes.get(t);if(!i)throw new I(`Graph.areOutboundNeighbors: could not find the "${t}" node in the graph.`);return this.type!=="undirected"&&n in i.out||this.type!=="directed"&&n in i.undirected}inDegree(t){t=""+t;const n=this._nodes.get(t);if(!n)throw new I(`Graph.inDegree: could not find the "${t}" node in the graph.`);return this.type==="undirected"?0:n.inDegree}outDegree(t){t=""+t;const n=this._nodes.get(t);if(!n)throw new I(`Graph.outDegree: could not find the "${t}" node in the graph.`);return this.type==="undirected"?0:n.outDegree}directedDegree(t){t=""+t;const n=this._nodes.get(t);if(!n)throw new I(`Graph.directedDegree: could not find the "${t}" node in the graph.`);return this.type==="undirected"?0:n.inDegree+n.outDegree}undirectedDegree(t){t=""+t;const n=this._nodes.get(t);if(!n)throw new I(`Graph.undirectedDegree: could not find the "${t}" node in the graph.`);return this.type==="directed"?0:n.undirectedDegree}inboundDegree(t){t=""+t;const n=this._nodes.get(t);if(!n)throw new I(`Graph.inboundDegree: could not find the "${t}" node in the graph.`);let i=0;return this.type!=="directed"&&(i+=n.undirectedDegree),this.type!=="undirected"&&(i+=n.inDegree),i}outboundDegree(t){t=""+t;const n=this._nodes.get(t);if(!n)throw new I(`Graph.outboundDegree: could not find the "${t}" node in the graph.`);let i=0;return this.type!=="directed"&&(i+=n.undirectedDegree),this.type!=="undirected"&&(i+=n.outDegree),i}degree(t){t=""+t;const n=this._nodes.get(t);if(!n)throw new I(`Graph.degree: could not find the "${t}" node in the graph.`);let i=0;return this.type!=="directed"&&(i+=n.undirectedDegree),this.type!=="undirected"&&(i+=n.inDegree+n.outDegree),i}inDegreeWithoutSelfLoops(t){t=""+t;const n=this._nodes.get(t);if(!n)throw new I(`Graph.inDegreeWithoutSelfLoops: could not find the "${t}" node in the graph.`);return this.type==="undirected"?0:n.inDegree-n.directedLoops}outDegreeWithoutSelfLoops(t){t=""+t;const n=this._nodes.get(t);if(!n)throw new I(`Graph.outDegreeWithoutSelfLoops: could not find the "${t}" node in the graph.`);return this.type==="undirected"?0:n.outDegree-n.directedLoops}directedDegreeWithoutSelfLoops(t){t=""+t;const n=this._nodes.get(t);if(!n)throw new I(`Graph.directedDegreeWithoutSelfLoops: could not find the "${t}" node in the graph.`);return this.type==="undirected"?0:n.inDegree+n.outDegree-n.directedLoops*2}undirectedDegreeWithoutSelfLoops(t){t=""+t;const n=this._nodes.get(t);if(!n)throw new I(`Graph.undirectedDegreeWithoutSelfLoops: could not find the "${t}" node in the graph.`);return this.type==="directed"?0:n.undirectedDegree-n.undirectedLoops*2}inboundDegreeWithoutSelfLoops(t){t=""+t;const n=this._nodes.get(t);if(!n)throw new I(`Graph.inboundDegreeWithoutSelfLoops: could not find the "${t}" node in the graph.`);let i=0,r=0;return this.type!=="directed"&&(i+=n.undirectedDegree,r+=n.undirectedLoops*2),this.type!=="undirected"&&(i+=n.inDegree,r+=n.directedLoops),i-r}outboundDegreeWithoutSelfLoops(t){t=""+t;const n=this._nodes.get(t);if(!n)throw new I(`Graph.outboundDegreeWithoutSelfLoops: could not find the "${t}" node in the graph.`);let i=0,r=0;return this.type!=="directed"&&(i+=n.undirectedDegree,r+=n.undirectedLoops*2),this.type!=="undirected"&&(i+=n.outDegree,r+=n.directedLoops),i-r}degreeWithoutSelfLoops(t){t=""+t;const n=this._nodes.get(t);if(!n)throw new I(`Graph.degreeWithoutSelfLoops: could not find the "${t}" node in the graph.`);let i=0,r=0;return this.type!=="directed"&&(i+=n.undirectedDegree,r+=n.undirectedLoops*2),this.type!=="undirected"&&(i+=n.inDegree+n.outDegree,r+=n.directedLoops*2),i-r}source(t){t=""+t;const n=this._edges.get(t);if(!n)throw new I(`Graph.source: could not find the "${t}" edge in the graph.`);return n.source.key}target(t){t=""+t;const n=this._edges.get(t);if(!n)throw new I(`Graph.target: could not find the "${t}" edge in the graph.`);return n.target.key}extremities(t){t=""+t;const n=this._edges.get(t);if(!n)throw new I(`Graph.extremities: could not find the "${t}" edge in the graph.`);return[n.source.key,n.target.key]}opposite(t,n){t=""+t,n=""+n;const i=this._edges.get(n);if(!i)throw new I(`Graph.opposite: could not find the "${n}" edge in the graph.`);const r=i.source.key,o=i.target.key;if(t===r)return o;if(t===o)return r;throw new I(`Graph.opposite: the "${t}" node is not attached to the "${n}" edge (${r}, ${o}).`)}hasExtremity(t,n){t=""+t,n=""+n;const i=this._edges.get(t);if(!i)throw new I(`Graph.hasExtremity: could not find the "${t}" edge in the graph.`);return i.source.key===n||i.target.key===n}isUndirected(t){t=""+t;const n=this._edges.get(t);if(!n)throw new I(`Graph.isUndirected: could not find the "${t}" edge in the graph.`);return n.undirected}isDirected(t){t=""+t;const n=this._edges.get(t);if(!n)throw new I(`Graph.isDirected: could not find the "${t}" edge in the graph.`);return!n.undirected}isSelfLoop(t){t=""+t;const n=this._edges.get(t);if(!n)throw new I(`Graph.isSelfLoop: could not find the "${t}" edge in the graph.`);return n.source===n.target}addNode(t,n){return wh(this,t,n).key}mergeNode(t,n){if(n&&!be(n))throw new O(`Graph.mergeNode: invalid attributes. Expecting an object but got "${n}"`);t=""+t,n=n||{};let i=this._nodes.get(t);return i?(n&&(ve(i.attributes,n),this.emit("nodeAttributesUpdated",{type:"merge",key:t,attributes:i.attributes,data:n})),[t,!1]):(i=new this.NodeDataClass(t,n),this._nodes.set(t,i),this.emit("nodeAdded",{key:t,attributes:n}),[t,!0])}updateNode(t,n){if(n&&typeof n!="function")throw new O(`Graph.updateNode: invalid updater function. Expecting a function but got "${n}"`);t=""+t;let i=this._nodes.get(t);if(i){if(n){const o=i.attributes;i.attributes=n(o),this.emit("nodeAttributesUpdated",{type:"replace",key:t,attributes:i.attributes})}return[t,!1]}const r=n?n({}):{};return i=new this.NodeDataClass(t,r),this._nodes.set(t,i),this.emit("nodeAdded",{key:t,attributes:r}),[t,!0]}dropNode(t){t=""+t;const n=this._nodes.get(t);if(!n)throw new I(`Graph.dropNode: could not find the "${t}" node in the graph.`);let i;if(this.type!=="undirected"){for(const r in n.out){i=n.out[r];do wt(this,i),i=i.next;while(i)}for(const r in n.in){i=n.in[r];do wt(this,i),i=i.next;while(i)}}if(this.type!=="directed")for(const r in n.undirected){i=n.undirected[r];do wt(this,i),i=i.next;while(i)}this._nodes.delete(t),this.emit("nodeDropped",{key:t,attributes:n.attributes})}dropEdge(t){let n;if(arguments.length>1){const i=""+arguments[0],r=""+arguments[1];if(n=Re(this,i,r,this.type),!n)throw new I(`Graph.dropEdge: could not find the "${i}" -> "${r}" edge in the graph.`)}else if(t=""+t,n=this._edges.get(t),!n)throw new I(`Graph.dropEdge: could not find the "${t}" edge in the graph.`);return wt(this,n),this}dropDirectedEdge(t,n){if(arguments.length<2)throw new Y("Graph.dropDirectedEdge: it does not make sense to try and drop a directed edge by key. What if the edge with this key is undirected? Use #.dropEdge for this purpose instead.");if(this.multi)throw new Y("Graph.dropDirectedEdge: cannot use a {source,target} combo when dropping an edge in a MultiGraph since we cannot infer the one you want to delete as there could be multiple ones.");t=""+t,n=""+n;const i=Re(this,t,n,"directed");if(!i)throw new I(`Graph.dropDirectedEdge: could not find a "${t}" -> "${n}" edge in the graph.`);return wt(this,i),this}dropUndirectedEdge(t,n){if(arguments.length<2)throw new Y("Graph.dropUndirectedEdge: it does not make sense to drop a directed edge by key. What if the edge with this key is undirected? Use #.dropEdge for this purpose instead.");if(this.multi)throw new Y("Graph.dropUndirectedEdge: cannot use a {source,target} combo when dropping an edge in a MultiGraph since we cannot infer the one you want to delete as there could be multiple ones.");const i=Re(this,t,n,"undirected");if(!i)throw new I(`Graph.dropUndirectedEdge: could not find a "${t}" -> "${n}" edge in the graph.`);return wt(this,i),this}clear(){this._edges.clear(),this._nodes.clear(),this._resetInstanceCounters(),this.emit("cleared")}clearEdges(){const t=this._nodes.values();let n;for(;n=t.next(),n.done!==!0;)n.value.clear();this._edges.clear(),this._resetInstanceCounters(),this.emit("edgesCleared")}getAttribute(t){return this._attributes[t]}getAttributes(){return this._attributes}hasAttribute(t){return this._attributes.hasOwnProperty(t)}setAttribute(t,n){return this._attributes[t]=n,this.emit("attributesUpdated",{type:"set",attributes:this._attributes,name:t}),this}updateAttribute(t,n){if(typeof n!="function")throw new O("Graph.updateAttribute: updater should be a function.");const i=this._attributes[t];return this._attributes[t]=n(i),this.emit("attributesUpdated",{type:"set",attributes:this._attributes,name:t}),this}removeAttribute(t){return delete this._attributes[t],this.emit("attributesUpdated",{type:"remove",attributes:this._attributes,name:t}),this}replaceAttributes(t){if(!be(t))throw new O("Graph.replaceAttributes: provided attributes are not a plain object.");return this._attributes=t,this.emit("attributesUpdated",{type:"replace",attributes:this._attributes}),this}mergeAttributes(t){if(!be(t))throw new O("Graph.mergeAttributes: provided attributes are not a plain object.");return ve(this._attributes,t),this.emit("attributesUpdated",{type:"merge",attributes:this._attributes,data:t}),this}updateAttributes(t){if(typeof t!="function")throw new O("Graph.updateAttributes: provided updater is not a function.");return this._attributes=t(this._attributes),this.emit("attributesUpdated",{type:"update",attributes:this._attributes}),this}updateEachNodeAttributes(t,n){if(typeof t!="function")throw new O("Graph.updateEachNodeAttributes: expecting an updater function.");if(n&&!Br(n))throw new O("Graph.updateEachNodeAttributes: invalid hints. Expecting an object having the following shape: {attributes?: [string]}");const i=this._nodes.values();let r,o;for(;r=i.next(),r.done!==!0;)o=r.value,o.attributes=t(o.key,o.attributes);this.emit("eachNodeAttributesUpdated",{hints:n||null})}updateEachEdgeAttributes(t,n){if(typeof t!="function")throw new O("Graph.updateEachEdgeAttributes: expecting an updater function.");if(n&&!Br(n))throw new O("Graph.updateEachEdgeAttributes: invalid hints. Expecting an object having the following shape: {attributes?: [string]}");const i=this._edges.values();let r,o,a,s;for(;r=i.next(),r.done!==!0;)o=r.value,a=o.source,s=o.target,o.attributes=t(o.key,o.attributes,a.key,s.key,a.attributes,s.attributes,o.undirected);this.emit("eachEdgeAttributesUpdated",{hints:n||null})}forEachAdjacencyEntry(t){if(typeof t!="function")throw new O("Graph.forEachAdjacencyEntry: expecting a callback.");pn(!1,!1,!1,this,t)}forEachAdjacencyEntryWithOrphans(t){if(typeof t!="function")throw new O("Graph.forEachAdjacencyEntryWithOrphans: expecting a callback.");pn(!1,!1,!0,this,t)}forEachAssymetricAdjacencyEntry(t){if(typeof t!="function")throw new O("Graph.forEachAssymetricAdjacencyEntry: expecting a callback.");pn(!1,!0,!1,this,t)}forEachAssymetricAdjacencyEntryWithOrphans(t){if(typeof t!="function")throw new O("Graph.forEachAssymetricAdjacencyEntryWithOrphans: expecting a callback.");pn(!1,!0,!0,this,t)}nodes(){return Array.from(this._nodes.keys())}forEachNode(t){if(typeof t!="function")throw new O("Graph.forEachNode: expecting a callback.");const n=this._nodes.values();let i,r;for(;i=n.next(),i.done!==!0;)r=i.value,t(r.key,r.attributes)}findNode(t){if(typeof t!="function")throw new O("Graph.findNode: expecting a callback.");const n=this._nodes.values();let i,r;for(;i=n.next(),i.done!==!0;)if(r=i.value,t(r.key,r.attributes))return r.key}mapNodes(t){if(typeof t!="function")throw new O("Graph.mapNode: expecting a callback.");const n=this._nodes.values();let i,r;const o=new Array(this.order);let a=0;for(;i=n.next(),i.done!==!0;)r=i.value,o[a++]=t(r.key,r.attributes);return o}someNode(t){if(typeof t!="function")throw new O("Graph.someNode: expecting a callback.");const n=this._nodes.values();let i,r;for(;i=n.next(),i.done!==!0;)if(r=i.value,t(r.key,r.attributes))return!0;return!1}everyNode(t){if(typeof t!="function")throw new O("Graph.everyNode: expecting a callback.");const n=this._nodes.values();let i,r;for(;i=n.next(),i.done!==!0;)if(r=i.value,!t(r.key,r.attributes))return!1;return!0}filterNodes(t){if(typeof t!="function")throw new O("Graph.filterNodes: expecting a callback.");const n=this._nodes.values();let i,r;const o=[];for(;i=n.next(),i.done!==!0;)r=i.value,t(r.key,r.attributes)&&o.push(r.key);return o}reduceNodes(t,n){if(typeof t!="function")throw new O("Graph.reduceNodes: expecting a callback.");if(arguments.length<2)throw new O("Graph.reduceNodes: missing initial value. You must provide it because the callback takes more than one argument and we cannot infer the initial value from the first iteration, as you could with a simple array.");let i=n;const r=this._nodes.values();let o,a;for(;o=r.next(),o.done!==!0;)a=o.value,i=t(i,a.key,a.attributes);return i}nodeEntries(){const t=this._nodes.values();return{[Symbol.iterator](){return this},next(){const n=t.next();if(n.done)return n;const i=n.value;return{value:{node:i.key,attributes:i.attributes},done:!1}}}}export(){const t=new Array(this._nodes.size);let n=0;this._nodes.forEach((r,o)=>{t[n++]=hh(o,r)});const i=new Array(this._edges.size);return n=0,this._edges.forEach((r,o)=>{i[n++]=fh(this.type,o,r)}),{options:{type:this.type,multi:this.multi,allowSelfLoops:this.allowSelfLoops},attributes:this.getAttributes(),nodes:t,edges:i}}import(t,n=!1){if(t instanceof ue)return t.forEachNode((u,l)=>{n?this.mergeNode(u,l):this.addNode(u,l)}),t.forEachEdge((u,l,c,d,h,f,g)=>{n?g?this.mergeUndirectedEdgeWithKey(u,c,d,l):this.mergeDirectedEdgeWithKey(u,c,d,l):g?this.addUndirectedEdgeWithKey(u,c,d,l):this.addDirectedEdgeWithKey(u,c,d,l)}),this;if(!be(t))throw new O("Graph.import: invalid argument. Expecting a serialized graph or, alternatively, a Graph instance.");if(t.attributes){if(!be(t.attributes))throw new O("Graph.import: invalid attributes. Expecting a plain object.");n?this.mergeAttributes(t.attributes):this.replaceAttributes(t.attributes)}let i,r,o,a,s;if(t.nodes){if(o=t.nodes,!Array.isArray(o))throw new O("Graph.import: invalid nodes. Expecting an array.");for(i=0,r=o.length;i<r;i++){a=o[i],ph(a);const{key:u,attributes:l}=a;n?this.mergeNode(u,l):this.addNode(u,l)}}if(t.edges){let u=!1;if(this.type==="undirected"&&(u=!0),o=t.edges,!Array.isArray(o))throw new O("Graph.import: invalid edges. Expecting an array.");for(i=0,r=o.length;i<r;i++){s=o[i],gh(s);const{source:l,target:c,attributes:d,undirected:h=u}=s;let f;"key"in s?(f=n?h?this.mergeUndirectedEdgeWithKey:this.mergeDirectedEdgeWithKey:h?this.addUndirectedEdgeWithKey:this.addDirectedEdgeWithKey,f.call(this,s.key,l,c,d)):(f=n?h?this.mergeUndirectedEdge:this.mergeDirectedEdge:h?this.addUndirectedEdge:this.addDirectedEdge,f.call(this,l,c,d))}}return this}nullCopy(t){const n=new ue(ve({},this._options,t));return n.replaceAttributes(ve({},this.getAttributes())),n}emptyCopy(t){const n=this.nullCopy(t);return this._nodes.forEach((i,r)=>{const o=ve({},i.attributes);i=new n.NodeDataClass(r,o),n._nodes.set(r,i)}),n}copy(t){if(t=t||{},typeof t.type=="string"&&t.type!==this.type&&t.type!=="mixed")throw new Y(`Graph.copy: cannot create an incompatible copy from "${this.type}" type to "${t.type}" because this would mean losing information about the current graph.`);if(typeof t.multi=="boolean"&&t.multi!==this.multi&&t.multi!==!0)throw new Y("Graph.copy: cannot create an incompatible copy by downgrading a multi graph to a simple one because this would mean losing information about the current graph.");if(typeof t.allowSelfLoops=="boolean"&&t.allowSelfLoops!==this.allowSelfLoops&&t.allowSelfLoops!==!0)throw new Y("Graph.copy: cannot create an incompatible copy from a graph allowing self loops to one that does not because this would mean losing information about the current graph.");const n=this.emptyCopy(t),i=this._edges.values();let r,o;for(;r=i.next(),r.done!==!0;)o=r.value,oa(n,"copy",!1,o.undirected,o.key,o.source.key,o.target.key,ve({},o.attributes));return n}toJSON(){return this.export()}toString(){return"[object Graph]"}inspect(){const t={};this._nodes.forEach((o,a)=>{t[a]=o.attributes});const n={},i={};this._edges.forEach((o,a)=>{const s=o.undirected?"--":"->";let u="",l=o.source.key,c=o.target.key,d;o.undirected&&l>c&&(d=l,l=c,c=d);const h=`(${l})${s}(${c})`;a.startsWith("geid_")?this.multi&&(typeof i[h]>"u"?i[h]=0:i[h]++,u+=`${i[h]}. `):u+=`[${a}]: `,u+=h,n[u]=o.attributes});const r={};for(const o in this)this.hasOwnProperty(o)&&!Or.has(o)&&typeof this[o]!="function"&&typeof o!="symbol"&&(r[o]=this[o]);return r.attributes=this._attributes,r.nodes=t,r.edges=n,Le(r,"constructor",this.constructor),r}}typeof Symbol<"u"&&(ue.prototype[Symbol.for("nodejs.util.inspect.custom")]=ue.prototype.inspect);yh.forEach(e=>{["add","merge","update"].forEach(t=>{const n=e.name(t),i=t==="add"?oa:xh;e.generateKey?ue.prototype[n]=function(r,o,a){return i(this,n,!0,(e.type||this.type)==="undirected",null,r,o,a,t==="update")}:ue.prototype[n]=function(r,o,a,s){return i(this,n,!1,(e.type||this.type)==="undirected",r,o,a,s,t==="update")}})});Rd(ue);Od(ue);ih(ue);dh(ue);class aa extends ue{constructor(t){const n=ve({type:"directed"},t);if("multi"in n&&n.multi!==!1)throw new O("DirectedGraph.from: inconsistent indication that the graph should be multi in given options!");if(n.type!=="directed")throw new O('DirectedGraph.from: inconsistent "'+n.type+'" type in given options!');super(n)}}class sa extends ue{constructor(t){const n=ve({type:"undirected"},t);if("multi"in n&&n.multi!==!1)throw new O("UndirectedGraph.from: inconsistent indication that the graph should be multi in given options!");if(n.type!=="undirected")throw new O('UndirectedGraph.from: inconsistent "'+n.type+'" type in given options!');super(n)}}class ua extends ue{constructor(t){const n=ve({multi:!0},t);if("multi"in n&&n.multi!==!0)throw new O("MultiGraph.from: inconsistent indication that the graph should be simple in given options!");super(n)}}class la extends ue{constructor(t){const n=ve({type:"directed",multi:!0},t);if("multi"in n&&n.multi!==!0)throw new O("MultiDirectedGraph.from: inconsistent indication that the graph should be simple in given options!");if(n.type!=="directed")throw new O('MultiDirectedGraph.from: inconsistent "'+n.type+'" type in given options!');super(n)}}class ca extends ue{constructor(t){const n=ve({type:"undirected",multi:!0},t);if("multi"in n&&n.multi!==!0)throw new O("MultiUndirectedGraph.from: inconsistent indication that the graph should be simple in given options!");if(n.type!=="undirected")throw new O('MultiUndirectedGraph.from: inconsistent "'+n.type+'" type in given options!');super(n)}}function Mt(e){e.from=function(t,n){const i=ve({},t.options,n),r=new e(i);return r.import(t),r}}Mt(ue);Mt(aa);Mt(sa);Mt(ua);Mt(la);Mt(ca);ue.Graph=ue;ue.DirectedGraph=aa;ue.UndirectedGraph=sa;ue.MultiGraph=ua;ue.MultiDirectedGraph=la;ue.MultiUndirectedGraph=ca;ue.InvalidArgumentsGraphError=O;ue.NotFoundGraphError=I;ue.UsageGraphError=Y;function _h(e,t){if(typeof e!="object"||!e)return e;var n=e[Symbol.toPrimitive];if(n!==void 0){var i=n.call(e,t);if(typeof i!="object")return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}function Xt(e){var t=_h(e,"string");return typeof t=="symbol"?t:t+""}function _e(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function Hr(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,Xt(i.key),i)}}function Ee(e,t,n){return t&&Hr(e.prototype,t),n&&Hr(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e}function St(e){return St=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},St(e)}function da(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(da=function(){return!!e})()}function Eh(e){if(e===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function Ch(e,t){if(t&&(typeof t=="object"||typeof t=="function"))return t;if(t!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return Eh(e)}function Ne(e,t,n){return t=St(t),Ch(e,da()?Reflect.construct(t,n||[],St(e).constructor):t.apply(e,n))}function Ti(e,t){return Ti=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(n,i){return n.__proto__=i,n},Ti(e,t)}function Me(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&Ti(e,t)}function kh(e){if(Array.isArray(e))return e}function Th(e,t){var n=e==null?null:typeof Symbol<"u"&&e[Symbol.iterator]||e["@@iterator"];if(n!=null){var i,r,o,a,s=[],u=!0,l=!1;try{if(o=(n=n.call(e)).next,t===0){if(Object(n)!==n)return;u=!1}else for(;!(u=(i=o.call(n)).done)&&(s.push(i.value),s.length!==t);u=!0);}catch(c){l=!0,r=c}finally{try{if(!u&&n.return!=null&&(a=n.return(),Object(a)!==a))return}finally{if(l)throw r}}return s}}function Ai(e,t){(t==null||t>e.length)&&(t=e.length);for(var n=0,i=Array(t);n<t;n++)i[n]=e[n];return i}function ha(e,t){if(e){if(typeof e=="string")return Ai(e,t);var n={}.toString.call(e).slice(8,-1);return n==="Object"&&e.constructor&&(n=e.constructor.name),n==="Map"||n==="Set"?Array.from(e):n==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?Ai(e,t):void 0}}function Ah(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function Lt(e,t){return kh(e)||Th(e,t)||ha(e,t)||Ah()}var ri={black:"#000000",silver:"#C0C0C0",gray:"#808080",grey:"#808080",white:"#FFFFFF",maroon:"#800000",red:"#FF0000",purple:"#800080",fuchsia:"#FF00FF",green:"#008000",lime:"#00FF00",olive:"#808000",yellow:"#FFFF00",navy:"#000080",blue:"#0000FF",teal:"#008080",aqua:"#00FFFF",darkblue:"#00008B",mediumblue:"#0000CD",darkgreen:"#006400",darkcyan:"#008B8B",deepskyblue:"#00BFFF",darkturquoise:"#00CED1",mediumspringgreen:"#00FA9A",springgreen:"#00FF7F",cyan:"#00FFFF",midnightblue:"#191970",dodgerblue:"#1E90FF",lightseagreen:"#20B2AA",forestgreen:"#228B22",seagreen:"#2E8B57",darkslategray:"#2F4F4F",darkslategrey:"#2F4F4F",limegreen:"#32CD32",mediumseagreen:"#3CB371",turquoise:"#40E0D0",royalblue:"#4169E1",steelblue:"#4682B4",darkslateblue:"#483D8B",mediumturquoise:"#48D1CC",indigo:"#4B0082",darkolivegreen:"#556B2F",cadetblue:"#5F9EA0",cornflowerblue:"#6495ED",rebeccapurple:"#663399",mediumaquamarine:"#66CDAA",dimgray:"#696969",dimgrey:"#696969",slateblue:"#6A5ACD",olivedrab:"#6B8E23",slategray:"#708090",slategrey:"#708090",lightslategray:"#778899",lightslategrey:"#778899",mediumslateblue:"#7B68EE",lawngreen:"#7CFC00",chartreuse:"#7FFF00",aquamarine:"#7FFFD4",skyblue:"#87CEEB",lightskyblue:"#87CEFA",blueviolet:"#8A2BE2",darkred:"#8B0000",darkmagenta:"#8B008B",saddlebrown:"#8B4513",darkseagreen:"#8FBC8F",lightgreen:"#90EE90",mediumpurple:"#9370DB",darkviolet:"#9400D3",palegreen:"#98FB98",darkorchid:"#9932CC",yellowgreen:"#9ACD32",sienna:"#A0522D",brown:"#A52A2A",darkgray:"#A9A9A9",darkgrey:"#A9A9A9",lightblue:"#ADD8E6",greenyellow:"#ADFF2F",paleturquoise:"#AFEEEE",lightsteelblue:"#B0C4DE",powderblue:"#B0E0E6",firebrick:"#B22222",darkgoldenrod:"#B8860B",mediumorchid:"#BA55D3",rosybrown:"#BC8F8F",darkkhaki:"#BDB76B",mediumvioletred:"#C71585",indianred:"#CD5C5C",peru:"#CD853F",chocolate:"#D2691E",tan:"#D2B48C",lightgray:"#D3D3D3",lightgrey:"#D3D3D3",thistle:"#D8BFD8",orchid:"#DA70D6",goldenrod:"#DAA520",palevioletred:"#DB7093",crimson:"#DC143C",gainsboro:"#DCDCDC",plum:"#DDA0DD",burlywood:"#DEB887",lightcyan:"#E0FFFF",lavender:"#E6E6FA",darksalmon:"#E9967A",violet:"#EE82EE",palegoldenrod:"#EEE8AA",lightcoral:"#F08080",khaki:"#F0E68C",aliceblue:"#F0F8FF",honeydew:"#F0FFF0",azure:"#F0FFFF",sandybrown:"#F4A460",wheat:"#F5DEB3",beige:"#F5F5DC",whitesmoke:"#F5F5F5",mintcream:"#F5FFFA",ghostwhite:"#F8F8FF",salmon:"#FA8072",antiquewhite:"#FAEBD7",linen:"#FAF0E6",lightgoldenrodyellow:"#FAFAD2",oldlace:"#FDF5E6",magenta:"#FF00FF",deeppink:"#FF1493",orangered:"#FF4500",tomato:"#FF6347",hotpink:"#FF69B4",coral:"#FF7F50",darkorange:"#FF8C00",lightsalmon:"#FFA07A",orange:"#FFA500",lightpink:"#FFB6C1",pink:"#FFC0CB",gold:"#FFD700",peachpuff:"#FFDAB9",navajowhite:"#FFDEAD",moccasin:"#FFE4B5",bisque:"#FFE4C4",mistyrose:"#FFE4E1",blanchedalmond:"#FFEBCD",papayawhip:"#FFEFD5",lavenderblush:"#FFF0F5",seashell:"#FFF5EE",cornsilk:"#FFF8DC",lemonchiffon:"#FFFACD",floralwhite:"#FFFAF0",snow:"#FFFAFA",lightyellow:"#FFFFE0",ivory:"#FFFFF0"},fa=new Int8Array(4),oi=new Int32Array(fa.buffer,0,1),Sh=new Float32Array(fa.buffer,0,1),Lh=/^\s*rgba?\s*\(/,Rh=/^\s*rgba?\s*\(\s*([0-9]*)\s*,\s*([0-9]*)\s*,\s*([0-9]*)(?:\s*,\s*(.*)?)?\)\s*$/;function Nh(e){var t=0,n=0,i=0,r=1;if(e[0]==="#")e.length===4?(t=parseInt(e.charAt(1)+e.charAt(1),16),n=parseInt(e.charAt(2)+e.charAt(2),16),i=parseInt(e.charAt(3)+e.charAt(3),16)):(t=parseInt(e.charAt(1)+e.charAt(2),16),n=parseInt(e.charAt(3)+e.charAt(4),16),i=parseInt(e.charAt(5)+e.charAt(6),16)),e.length===9&&(r=parseInt(e.charAt(7)+e.charAt(8),16)/255);else if(Lh.test(e)){var o=e.match(Rh);o&&(t=+o[1],n=+o[2],i=+o[3],o[4]&&(r=+o[4]))}return{r:t,g:n,b:i,a:r}}var Ct={};for(var gn in ri)Ct[gn]=Dt(ri[gn]),Ct[ri[gn]]=Ct[gn];function pa(e,t,n,i,r){return oi[0]=i<<24|n<<16|t<<8|e,oi[0]=oi[0]&4278190079,Sh[0]}function Dt(e){if(e=e.toLowerCase(),typeof Ct[e]<"u")return Ct[e];var t=Nh(e),n=t.r,i=t.g,r=t.b,o=t.a;o=o*255|0;var a=pa(n,i,r,o);return Ct[e]=a,a}var ai={};function ga(e){if(typeof ai[e]<"u")return ai[e];var t=(e&16711680)>>>16,n=(e&65280)>>>8,i=e&255,r=255,o=pa(t,n,i,r);return ai[e]=o,o}function qr(e,t,n,i){return n+(t<<8)+(e<<16)}function Vr(e,t,n,i,r,o){var a=Math.floor(n/o*r),s=Math.floor(e.drawingBufferHeight/o-i/o*r),u=new Uint8Array(4);e.bindFramebuffer(e.FRAMEBUFFER,t),e.readPixels(a,s,1,1,e.RGBA,e.UNSIGNED_BYTE,u);var l=Lt(u,4),c=l[0],d=l[1],h=l[2],f=l[3];return[c,d,h,f]}function R(e,t,n){return(t=Xt(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function Wr(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable})),n.push.apply(n,i)}return n}function W(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?Wr(Object(n),!0).forEach(function(i){R(e,i,n[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Wr(Object(n)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(n,i))})}return e}function Mh(e,t){for(;!{}.hasOwnProperty.call(e,t)&&(e=St(e))!==null;);return e}function Si(){return Si=typeof Reflect<"u"&&Reflect.get?Reflect.get.bind():function(e,t,n){var i=Mh(e,t);if(i){var r=Object.getOwnPropertyDescriptor(i,t);return r.get?r.get.call(arguments.length<3?e:n):r.value}},Si.apply(null,arguments)}function ma(e,t,n,i){var r=Si(St(e.prototype),t,n);return typeof r=="function"?function(o){return r.apply(n,o)}:r}function Dh(e){return e.normalized?1:e.size}function si(e){var t=0;return e.forEach(function(n){return t+=Dh(n)}),t}function va(e,t,n){var i=e==="VERTEX"?t.VERTEX_SHADER:t.FRAGMENT_SHADER,r=t.createShader(i);if(r===null)throw new Error("loadShader: error while creating the shader");t.shaderSource(r,n),t.compileShader(r);var o=t.getShaderParameter(r,t.COMPILE_STATUS);if(!o){var a=t.getShaderInfoLog(r);throw t.deleteShader(r),new Error(`loadShader: error while compiling the shader:
`.concat(a,`
`).concat(n))}return r}function $h(e,t){return va("VERTEX",e,t)}function Ih(e,t){return va("FRAGMENT",e,t)}function Ph(e,t){var n=e.createProgram();if(n===null)throw new Error("loadProgram: error while creating the program.");var i,r;for(i=0,r=t.length;i<r;i++)e.attachShader(n,t[i]);e.linkProgram(n);var o=e.getProgramParameter(n,e.LINK_STATUS);if(!o)throw e.deleteProgram(n),new Error("loadProgram: error while linking the program.");return n}function jr(e){var t=e.gl,n=e.buffer,i=e.program,r=e.vertexShader,o=e.fragmentShader;t.deleteShader(r),t.deleteShader(o),t.deleteProgram(i),t.deleteBuffer(n)}var Yr=`#define PICKING_MODE
`,Fh=R(R(R(R(R(R(R(R({},WebGL2RenderingContext.BOOL,1),WebGL2RenderingContext.BYTE,1),WebGL2RenderingContext.UNSIGNED_BYTE,1),WebGL2RenderingContext.SHORT,2),WebGL2RenderingContext.UNSIGNED_SHORT,2),WebGL2RenderingContext.INT,4),WebGL2RenderingContext.UNSIGNED_INT,4),WebGL2RenderingContext.FLOAT,4),ya=function(){function e(t,n,i){_e(this,e),R(this,"array",new Float32Array),R(this,"constantArray",new Float32Array),R(this,"capacity",0),R(this,"verticesCount",0);var r=this.getDefinition();if(this.VERTICES=r.VERTICES,this.VERTEX_SHADER_SOURCE=r.VERTEX_SHADER_SOURCE,this.FRAGMENT_SHADER_SOURCE=r.FRAGMENT_SHADER_SOURCE,this.UNIFORMS=r.UNIFORMS,this.ATTRIBUTES=r.ATTRIBUTES,this.METHOD=r.METHOD,this.CONSTANT_ATTRIBUTES="CONSTANT_ATTRIBUTES"in r?r.CONSTANT_ATTRIBUTES:[],this.CONSTANT_DATA="CONSTANT_DATA"in r?r.CONSTANT_DATA:[],this.isInstanced="CONSTANT_ATTRIBUTES"in r,this.ATTRIBUTES_ITEMS_COUNT=si(this.ATTRIBUTES),this.STRIDE=this.VERTICES*this.ATTRIBUTES_ITEMS_COUNT,this.renderer=i,this.normalProgram=this.getProgramInfo("normal",t,r.VERTEX_SHADER_SOURCE,r.FRAGMENT_SHADER_SOURCE,null),this.pickProgram=n?this.getProgramInfo("pick",t,Yr+r.VERTEX_SHADER_SOURCE,Yr+r.FRAGMENT_SHADER_SOURCE,n):null,this.isInstanced){var o=si(this.CONSTANT_ATTRIBUTES);if(this.CONSTANT_DATA.length!==this.VERTICES)throw new Error("Program: error while getting constant data (expected ".concat(this.VERTICES," items, received ").concat(this.CONSTANT_DATA.length," instead)"));this.constantArray=new Float32Array(this.CONSTANT_DATA.length*o);for(var a=0;a<this.CONSTANT_DATA.length;a++){var s=this.CONSTANT_DATA[a];if(s.length!==o)throw new Error("Program: error while getting constant data (one vector has ".concat(s.length," items instead of ").concat(o,")"));for(var u=0;u<s.length;u++)this.constantArray[a*o+u]=s[u]}this.STRIDE=this.ATTRIBUTES_ITEMS_COUNT}}return Ee(e,[{key:"kill",value:function(){jr(this.normalProgram),this.pickProgram&&(jr(this.pickProgram),this.pickProgram=null)}},{key:"getProgramInfo",value:function(n,i,r,o,a){var s=this.getDefinition(),u=i.createBuffer();if(u===null)throw new Error("Program: error while creating the WebGL buffer.");var l=$h(i,r),c=Ih(i,o),d=Ph(i,[l,c]),h={};s.UNIFORMS.forEach(function(v){var x=i.getUniformLocation(d,v);x&&(h[v]=x)});var f={};s.ATTRIBUTES.forEach(function(v){f[v.name]=i.getAttribLocation(d,v.name)});var g;if("CONSTANT_ATTRIBUTES"in s&&(s.CONSTANT_ATTRIBUTES.forEach(function(v){f[v.name]=i.getAttribLocation(d,v.name)}),g=i.createBuffer(),g===null))throw new Error("Program: error while creating the WebGL constant buffer.");return{name:n,program:d,gl:i,frameBuffer:a,buffer:u,constantBuffer:g||{},uniformLocations:h,attributeLocations:f,isPicking:n==="pick",vertexShader:l,fragmentShader:c}}},{key:"bindProgram",value:function(n){var i=this,r=0,o=n.gl,a=n.buffer;this.isInstanced?(o.bindBuffer(o.ARRAY_BUFFER,n.constantBuffer),r=0,this.CONSTANT_ATTRIBUTES.forEach(function(s){return r+=i.bindAttribute(s,n,r,!1)}),o.bufferData(o.ARRAY_BUFFER,this.constantArray,o.STATIC_DRAW),o.bindBuffer(o.ARRAY_BUFFER,n.buffer),r=0,this.ATTRIBUTES.forEach(function(s){return r+=i.bindAttribute(s,n,r,!0)}),o.bufferData(o.ARRAY_BUFFER,this.array,o.DYNAMIC_DRAW)):(o.bindBuffer(o.ARRAY_BUFFER,a),r=0,this.ATTRIBUTES.forEach(function(s){return r+=i.bindAttribute(s,n,r)}),o.bufferData(o.ARRAY_BUFFER,this.array,o.DYNAMIC_DRAW)),o.bindBuffer(o.ARRAY_BUFFER,null)}},{key:"unbindProgram",value:function(n){var i=this;this.isInstanced?(this.CONSTANT_ATTRIBUTES.forEach(function(r){return i.unbindAttribute(r,n,!1)}),this.ATTRIBUTES.forEach(function(r){return i.unbindAttribute(r,n,!0)})):this.ATTRIBUTES.forEach(function(r){return i.unbindAttribute(r,n)})}},{key:"bindAttribute",value:function(n,i,r,o){var a=Fh[n.type];if(typeof a!="number")throw new Error('Program.bind: yet unsupported attribute type "'.concat(n.type,'"'));var s=i.attributeLocations[n.name],u=i.gl;if(s!==-1){u.enableVertexAttribArray(s);var l=this.isInstanced?(o?this.ATTRIBUTES_ITEMS_COUNT:si(this.CONSTANT_ATTRIBUTES))*Float32Array.BYTES_PER_ELEMENT:this.ATTRIBUTES_ITEMS_COUNT*Float32Array.BYTES_PER_ELEMENT;if(u.vertexAttribPointer(s,n.size,n.type,n.normalized||!1,l,r),this.isInstanced&&o)if(u instanceof WebGL2RenderingContext)u.vertexAttribDivisor(s,1);else{var c=u.getExtension("ANGLE_instanced_arrays");c&&c.vertexAttribDivisorANGLE(s,1)}}return n.size*a}},{key:"unbindAttribute",value:function(n,i,r){var o=i.attributeLocations[n.name],a=i.gl;if(o!==-1&&(a.disableVertexAttribArray(o),this.isInstanced&&r))if(a instanceof WebGL2RenderingContext)a.vertexAttribDivisor(o,0);else{var s=a.getExtension("ANGLE_instanced_arrays");s&&s.vertexAttribDivisorANGLE(o,0)}}},{key:"reallocate",value:function(n){n!==this.capacity&&(this.capacity=n,this.verticesCount=this.VERTICES*n,this.array=new Float32Array(this.isInstanced?this.capacity*this.ATTRIBUTES_ITEMS_COUNT:this.verticesCount*this.ATTRIBUTES_ITEMS_COUNT))}},{key:"hasNothingToRender",value:function(){return this.verticesCount===0}},{key:"renderProgram",value:function(n,i){var r=i.gl,o=i.program;r.enable(r.BLEND),r.useProgram(o),this.setUniforms(n,i),this.drawWebGL(this.METHOD,i)}},{key:"render",value:function(n){this.hasNothingToRender()||(this.pickProgram&&(this.pickProgram.gl.viewport(0,0,n.width*n.pixelRatio/n.downSizingRatio,n.height*n.pixelRatio/n.downSizingRatio),this.bindProgram(this.pickProgram),this.renderProgram(W(W({},n),{},{pixelRatio:n.pixelRatio/n.downSizingRatio}),this.pickProgram),this.unbindProgram(this.pickProgram)),this.normalProgram.gl.viewport(0,0,n.width*n.pixelRatio,n.height*n.pixelRatio),this.bindProgram(this.normalProgram),this.renderProgram(n,this.normalProgram),this.unbindProgram(this.normalProgram))}},{key:"drawWebGL",value:function(n,i){var r=i.gl,o=i.frameBuffer;if(r.bindFramebuffer(r.FRAMEBUFFER,o),!this.isInstanced)r.drawArrays(n,0,this.verticesCount);else if(r instanceof WebGL2RenderingContext)r.drawArraysInstanced(n,0,this.VERTICES,this.capacity);else{var a=r.getExtension("ANGLE_instanced_arrays");a&&a.drawArraysInstancedANGLE(n,0,this.VERTICES,this.capacity)}}}])}(),Gh=function(e){function t(){return _e(this,t),Ne(this,t,arguments)}return Me(t,e),Ee(t,[{key:"kill",value:function(){ma(t,"kill",this)([])}},{key:"process",value:function(i,r,o){var a=r*this.STRIDE;if(o.hidden){for(var s=a+this.STRIDE;a<s;a++)this.array[a]=0;return}return this.processVisibleItem(ga(i),a,o)}}])}(ya),Hn=function(e){function t(){var n;_e(this,t);for(var i=arguments.length,r=new Array(i),o=0;o<i;o++)r[o]=arguments[o];return n=Ne(this,t,[].concat(r)),R(n,"drawLabel",void 0),n}return Me(t,e),Ee(t,[{key:"kill",value:function(){ma(t,"kill",this)([])}},{key:"process",value:function(i,r,o,a,s){var u=r*this.STRIDE;if(s.hidden||o.hidden||a.hidden){for(var l=u+this.STRIDE;u<l;u++)this.array[u]=0;return}return this.processVisibleItem(ga(i),u,o,a,s)}}])}(ya);function zh(e,t){return function(){function n(i,r,o){_e(this,n),R(this,"drawLabel",t),this.programs=e.map(function(a){return new a(i,r,o)})}return Ee(n,[{key:"reallocate",value:function(r){this.programs.forEach(function(o){return o.reallocate(r)})}},{key:"process",value:function(r,o,a,s,u){this.programs.forEach(function(l){return l.process(r,o,a,s,u)})}},{key:"render",value:function(r){this.programs.forEach(function(o){return o.render(r)})}},{key:"kill",value:function(){this.programs.forEach(function(r){return r.kill()})}}])}()}function Bh(e,t,n,i,r){var o=r.edgeLabelSize,a=r.edgeLabelFont,s=r.edgeLabelWeight,u=r.edgeLabelColor.attribute?t[r.edgeLabelColor.attribute]||r.edgeLabelColor.color||"#000":r.edgeLabelColor.color,l=t.label;if(l){e.fillStyle=u,e.font="".concat(s," ").concat(o,"px ").concat(a);var c=n.size,d=i.size,h=n.x,f=n.y,g=i.x,v=i.y,x=(h+g)/2,C=(f+v)/2,b=g-h,w=v-f,m=Math.sqrt(b*b+w*w);if(!(m<c+d)){h+=b*c/m,f+=w*c/m,g-=b*d/m,v-=w*d/m,x=(h+g)/2,C=(f+v)/2,b=g-h,w=v-f,m=Math.sqrt(b*b+w*w);var y=e.measureText(l).width;if(y>m){var _="…";for(l=l+_,y=e.measureText(l).width;y>m&&l.length>1;)l=l.slice(0,-2)+_,y=e.measureText(l).width;if(l.length<4)return}var A;b>0?w>0?A=Math.acos(b/m):A=Math.asin(w/m):w>0?A=Math.acos(b/m)+Math.PI:A=Math.asin(b/m)+Math.PI/2,e.save(),e.translate(x,C),e.rotate(A),e.fillText(l,-y/2,t.size/2+o),e.restore()}}}function ba(e,t,n){if(t.label){var i=n.labelSize,r=n.labelFont,o=n.labelWeight,a=n.labelColor.attribute?t[n.labelColor.attribute]||n.labelColor.color||"#000":n.labelColor.color;e.fillStyle=a,e.font="".concat(o," ").concat(i,"px ").concat(r),e.fillText(t.label,t.x+t.size+3,t.y+i/3)}}function Oh(e,t,n){var i=n.labelSize,r=n.labelFont,o=n.labelWeight;e.font="".concat(o," ").concat(i,"px ").concat(r),e.fillStyle="#FFF",e.shadowOffsetX=0,e.shadowOffsetY=0,e.shadowBlur=8,e.shadowColor="#000";var a=2;if(typeof t.label=="string"){var s=e.measureText(t.label).width,u=Math.round(s+5),l=Math.round(i+2*a),c=Math.max(t.size,i/2)+a,d=Math.asin(l/2/c),h=Math.sqrt(Math.abs(Math.pow(c,2)-Math.pow(l/2,2)));e.beginPath(),e.moveTo(t.x+h,t.y+l/2),e.lineTo(t.x+c+u,t.y+l/2),e.lineTo(t.x+c+u,t.y-l/2),e.lineTo(t.x+h,t.y-l/2),e.arc(t.x,t.y,c,d,-d),e.closePath(),e.fill()}else e.beginPath(),e.arc(t.x,t.y,t.size+a,0,Math.PI*2),e.closePath(),e.fill();e.shadowOffsetX=0,e.shadowOffsetY=0,e.shadowBlur=0,ba(e,t,n)}var Uh=`
precision highp float;

varying vec4 v_color;
varying vec2 v_diffVector;
varying float v_radius;

uniform float u_correctionRatio;

const vec4 transparent = vec4(0.0, 0.0, 0.0, 0.0);

void main(void) {
  float border = u_correctionRatio * 2.0;
  float dist = length(v_diffVector) - v_radius + border;

  // No antialiasing for picking mode:
  #ifdef PICKING_MODE
  if (dist > border)
    gl_FragColor = transparent;
  else
    gl_FragColor = v_color;

  #else
  float t = 0.0;
  if (dist > border)
    t = 1.0;
  else if (dist > 0.0)
    t = dist / border;

  gl_FragColor = mix(v_color, transparent, t);
  #endif
}
`,Hh=Uh,qh=`
attribute vec4 a_id;
attribute vec4 a_color;
attribute vec2 a_position;
attribute float a_size;
attribute float a_angle;

uniform mat3 u_matrix;
uniform float u_sizeRatio;
uniform float u_correctionRatio;

varying vec4 v_color;
varying vec2 v_diffVector;
varying float v_radius;
varying float v_border;

const float bias = 255.0 / 254.0;

void main() {
  float size = a_size * u_correctionRatio / u_sizeRatio * 4.0;
  vec2 diffVector = size * vec2(cos(a_angle), sin(a_angle));
  vec2 position = a_position + diffVector;
  gl_Position = vec4(
    (u_matrix * vec3(position, 1)).xy,
    0,
    1
  );

  v_diffVector = diffVector;
  v_radius = size / 2.0;

  #ifdef PICKING_MODE
  // For picking mode, we use the ID as the color:
  v_color = a_id;
  #else
  // For normal mode, we use the color:
  v_color = a_color;
  #endif

  v_color.a *= bias;
}
`,Vh=qh,wa=WebGLRenderingContext,Xr=wa.UNSIGNED_BYTE,ui=wa.FLOAT,Wh=["u_sizeRatio","u_correctionRatio","u_matrix"],qn=function(e){function t(){return _e(this,t),Ne(this,t,arguments)}return Me(t,e),Ee(t,[{key:"getDefinition",value:function(){return{VERTICES:3,VERTEX_SHADER_SOURCE:Vh,FRAGMENT_SHADER_SOURCE:Hh,METHOD:WebGLRenderingContext.TRIANGLES,UNIFORMS:Wh,ATTRIBUTES:[{name:"a_position",size:2,type:ui},{name:"a_size",size:1,type:ui},{name:"a_color",size:4,type:Xr,normalized:!0},{name:"a_id",size:4,type:Xr,normalized:!0}],CONSTANT_ATTRIBUTES:[{name:"a_angle",size:1,type:ui}],CONSTANT_DATA:[[t.ANGLE_1],[t.ANGLE_2],[t.ANGLE_3]]}}},{key:"processVisibleItem",value:function(i,r,o){var a=this.array,s=Dt(o.color);a[r++]=o.x,a[r++]=o.y,a[r++]=o.size,a[r++]=s,a[r++]=i}},{key:"setUniforms",value:function(i,r){var o=r.gl,a=r.uniformLocations,s=a.u_sizeRatio,u=a.u_correctionRatio,l=a.u_matrix;o.uniform1f(u,i.correctionRatio),o.uniform1f(s,i.sizeRatio),o.uniformMatrix3fv(l,!1,i.matrix)}}])}(Gh);R(qn,"ANGLE_1",0);R(qn,"ANGLE_2",2*Math.PI/3);R(qn,"ANGLE_3",4*Math.PI/3);var jh=`
precision mediump float;

varying vec4 v_color;

void main(void) {
  gl_FragColor = v_color;
}
`,Yh=jh,Xh=`
attribute vec2 a_position;
attribute vec2 a_normal;
attribute float a_radius;
attribute vec3 a_barycentric;

#ifdef PICKING_MODE
attribute vec4 a_id;
#else
attribute vec4 a_color;
#endif

uniform mat3 u_matrix;
uniform float u_sizeRatio;
uniform float u_correctionRatio;
uniform float u_minEdgeThickness;
uniform float u_lengthToThicknessRatio;
uniform float u_widenessToThicknessRatio;

varying vec4 v_color;

const float bias = 255.0 / 254.0;

void main() {
  float minThickness = u_minEdgeThickness;

  float normalLength = length(a_normal);
  vec2 unitNormal = a_normal / normalLength;

  // These first computations are taken from edge.vert.glsl and
  // edge.clamped.vert.glsl. Please read it to get better comments on what's
  // happening:
  float pixelsThickness = max(normalLength / u_sizeRatio, minThickness);
  float webGLThickness = pixelsThickness * u_correctionRatio;
  float webGLNodeRadius = a_radius * 2.0 * u_correctionRatio / u_sizeRatio;
  float webGLArrowHeadLength = webGLThickness * u_lengthToThicknessRatio * 2.0;
  float webGLArrowHeadThickness = webGLThickness * u_widenessToThicknessRatio;

  float da = a_barycentric.x;
  float db = a_barycentric.y;
  float dc = a_barycentric.z;

  vec2 delta = vec2(
      da * (webGLNodeRadius * unitNormal.y)
    + db * ((webGLNodeRadius + webGLArrowHeadLength) * unitNormal.y + webGLArrowHeadThickness * unitNormal.x)
    + dc * ((webGLNodeRadius + webGLArrowHeadLength) * unitNormal.y - webGLArrowHeadThickness * unitNormal.x),

      da * (-webGLNodeRadius * unitNormal.x)
    + db * (-(webGLNodeRadius + webGLArrowHeadLength) * unitNormal.x + webGLArrowHeadThickness * unitNormal.y)
    + dc * (-(webGLNodeRadius + webGLArrowHeadLength) * unitNormal.x - webGLArrowHeadThickness * unitNormal.y)
  );

  vec2 position = (u_matrix * vec3(a_position + delta, 1)).xy;

  gl_Position = vec4(position, 0, 1);

  #ifdef PICKING_MODE
  // For picking mode, we use the ID as the color:
  v_color = a_id;
  #else
  // For normal mode, we use the color:
  v_color = a_color;
  #endif

  v_color.a *= bias;
}
`,Kh=Xh,xa=WebGLRenderingContext,Kr=xa.UNSIGNED_BYTE,mn=xa.FLOAT,Zh=["u_matrix","u_sizeRatio","u_correctionRatio","u_minEdgeThickness","u_lengthToThicknessRatio","u_widenessToThicknessRatio"],Vn={extremity:"target",lengthToThicknessRatio:2.5,widenessToThicknessRatio:2};function _a(e){var t=W(W({},Vn),{});return function(n){function i(){return _e(this,i),Ne(this,i,arguments)}return Me(i,n),Ee(i,[{key:"getDefinition",value:function(){return{VERTICES:3,VERTEX_SHADER_SOURCE:Kh,FRAGMENT_SHADER_SOURCE:Yh,METHOD:WebGLRenderingContext.TRIANGLES,UNIFORMS:Zh,ATTRIBUTES:[{name:"a_position",size:2,type:mn},{name:"a_normal",size:2,type:mn},{name:"a_radius",size:1,type:mn},{name:"a_color",size:4,type:Kr,normalized:!0},{name:"a_id",size:4,type:Kr,normalized:!0}],CONSTANT_ATTRIBUTES:[{name:"a_barycentric",size:3,type:mn}],CONSTANT_DATA:[[1,0,0],[0,1,0],[0,0,1]]}}},{key:"processVisibleItem",value:function(o,a,s,u,l){if(t.extremity==="source"){var c=[u,s];s=c[0],u=c[1]}var d=l.size||1,h=u.size||1,f=s.x,g=s.y,v=u.x,x=u.y,C=Dt(l.color),b=v-f,w=x-g,m=b*b+w*w,y=0,_=0;m&&(m=1/Math.sqrt(m),y=-w*m*d,_=b*m*d);var A=this.array;A[a++]=v,A[a++]=x,A[a++]=-y,A[a++]=-_,A[a++]=h,A[a++]=C,A[a++]=o}},{key:"setUniforms",value:function(o,a){var s=a.gl,u=a.uniformLocations,l=u.u_matrix,c=u.u_sizeRatio,d=u.u_correctionRatio,h=u.u_minEdgeThickness,f=u.u_lengthToThicknessRatio,g=u.u_widenessToThicknessRatio;s.uniformMatrix3fv(l,!1,o.matrix),s.uniform1f(c,o.sizeRatio),s.uniform1f(d,o.correctionRatio),s.uniform1f(h,o.minEdgeThickness),s.uniform1f(f,t.lengthToThicknessRatio),s.uniform1f(g,t.widenessToThicknessRatio)}}])}(Hn)}_a();var Jh=`
precision mediump float;

varying vec4 v_color;
varying vec2 v_normal;
varying float v_thickness;
varying float v_feather;

const vec4 transparent = vec4(0.0, 0.0, 0.0, 0.0);

void main(void) {
  // We only handle antialiasing for normal mode:
  #ifdef PICKING_MODE
  gl_FragColor = v_color;
  #else
  float dist = length(v_normal) * v_thickness;

  float t = smoothstep(
    v_thickness - v_feather,
    v_thickness,
    dist
  );

  gl_FragColor = mix(v_color, transparent, t);
  #endif
}
`,Ea=Jh,Qh=`
attribute vec4 a_id;
attribute vec4 a_color;
attribute vec2 a_normal;
attribute float a_normalCoef;
attribute vec2 a_positionStart;
attribute vec2 a_positionEnd;
attribute float a_positionCoef;
attribute float a_radius;
attribute float a_radiusCoef;

uniform mat3 u_matrix;
uniform float u_zoomRatio;
uniform float u_sizeRatio;
uniform float u_pixelRatio;
uniform float u_correctionRatio;
uniform float u_minEdgeThickness;
uniform float u_lengthToThicknessRatio;
uniform float u_feather;

varying vec4 v_color;
varying vec2 v_normal;
varying float v_thickness;
varying float v_feather;

const float bias = 255.0 / 254.0;

void main() {
  float minThickness = u_minEdgeThickness;

  float radius = a_radius * a_radiusCoef;
  vec2 normal = a_normal * a_normalCoef;
  vec2 position = a_positionStart * (1.0 - a_positionCoef) + a_positionEnd * a_positionCoef;

  float normalLength = length(normal);
  vec2 unitNormal = normal / normalLength;

  // These first computations are taken from edge.vert.glsl. Please read it to
  // get better comments on what's happening:
  float pixelsThickness = max(normalLength, minThickness * u_sizeRatio);
  float webGLThickness = pixelsThickness * u_correctionRatio / u_sizeRatio;

  // Here, we move the point to leave space for the arrow head:
  float direction = sign(radius);
  float webGLNodeRadius = direction * radius * 2.0 * u_correctionRatio / u_sizeRatio;
  float webGLArrowHeadLength = webGLThickness * u_lengthToThicknessRatio * 2.0;

  vec2 compensationVector = vec2(-direction * unitNormal.y, direction * unitNormal.x) * (webGLNodeRadius + webGLArrowHeadLength);

  // Here is the proper position of the vertex
  gl_Position = vec4((u_matrix * vec3(position + unitNormal * webGLThickness + compensationVector, 1)).xy, 0, 1);

  v_thickness = webGLThickness / u_zoomRatio;

  v_normal = unitNormal;

  v_feather = u_feather * u_correctionRatio / u_zoomRatio / u_pixelRatio * 2.0;

  #ifdef PICKING_MODE
  // For picking mode, we use the ID as the color:
  v_color = a_id;
  #else
  // For normal mode, we use the color:
  v_color = a_color;
  #endif

  v_color.a *= bias;
}
`,ef=Qh,Ca=WebGLRenderingContext,Zr=Ca.UNSIGNED_BYTE,ht=Ca.FLOAT,tf=["u_matrix","u_zoomRatio","u_sizeRatio","u_correctionRatio","u_pixelRatio","u_feather","u_minEdgeThickness","u_lengthToThicknessRatio"],nf={lengthToThicknessRatio:Vn.lengthToThicknessRatio};function ka(e){var t=W(W({},nf),{});return function(n){function i(){return _e(this,i),Ne(this,i,arguments)}return Me(i,n),Ee(i,[{key:"getDefinition",value:function(){return{VERTICES:6,VERTEX_SHADER_SOURCE:ef,FRAGMENT_SHADER_SOURCE:Ea,METHOD:WebGLRenderingContext.TRIANGLES,UNIFORMS:tf,ATTRIBUTES:[{name:"a_positionStart",size:2,type:ht},{name:"a_positionEnd",size:2,type:ht},{name:"a_normal",size:2,type:ht},{name:"a_color",size:4,type:Zr,normalized:!0},{name:"a_id",size:4,type:Zr,normalized:!0},{name:"a_radius",size:1,type:ht}],CONSTANT_ATTRIBUTES:[{name:"a_positionCoef",size:1,type:ht},{name:"a_normalCoef",size:1,type:ht},{name:"a_radiusCoef",size:1,type:ht}],CONSTANT_DATA:[[0,1,0],[0,-1,0],[1,1,1],[1,1,1],[0,-1,0],[1,-1,-1]]}}},{key:"processVisibleItem",value:function(o,a,s,u,l){var c=l.size||1,d=s.x,h=s.y,f=u.x,g=u.y,v=Dt(l.color),x=f-d,C=g-h,b=u.size||1,w=x*x+C*C,m=0,y=0;w&&(w=1/Math.sqrt(w),m=-C*w*c,y=x*w*c);var _=this.array;_[a++]=d,_[a++]=h,_[a++]=f,_[a++]=g,_[a++]=m,_[a++]=y,_[a++]=v,_[a++]=o,_[a++]=b}},{key:"setUniforms",value:function(o,a){var s=a.gl,u=a.uniformLocations,l=u.u_matrix,c=u.u_zoomRatio,d=u.u_feather,h=u.u_pixelRatio,f=u.u_correctionRatio,g=u.u_sizeRatio,v=u.u_minEdgeThickness,x=u.u_lengthToThicknessRatio;s.uniformMatrix3fv(l,!1,o.matrix),s.uniform1f(c,o.zoomRatio),s.uniform1f(g,o.sizeRatio),s.uniform1f(f,o.correctionRatio),s.uniform1f(h,o.pixelRatio),s.uniform1f(d,o.antiAliasingFeather),s.uniform1f(v,o.minEdgeThickness),s.uniform1f(x,t.lengthToThicknessRatio)}}])}(Hn)}ka();function rf(e){return zh([ka(),_a()])}var of=rf(),af=of,sf=`
attribute vec4 a_id;
attribute vec4 a_color;
attribute vec2 a_normal;
attribute float a_normalCoef;
attribute vec2 a_positionStart;
attribute vec2 a_positionEnd;
attribute float a_positionCoef;

uniform mat3 u_matrix;
uniform float u_sizeRatio;
uniform float u_zoomRatio;
uniform float u_pixelRatio;
uniform float u_correctionRatio;
uniform float u_minEdgeThickness;
uniform float u_feather;

varying vec4 v_color;
varying vec2 v_normal;
varying float v_thickness;
varying float v_feather;

const float bias = 255.0 / 254.0;

void main() {
  float minThickness = u_minEdgeThickness;

  vec2 normal = a_normal * a_normalCoef;
  vec2 position = a_positionStart * (1.0 - a_positionCoef) + a_positionEnd * a_positionCoef;

  float normalLength = length(normal);
  vec2 unitNormal = normal / normalLength;

  // We require edges to be at least "minThickness" pixels thick *on screen*
  // (so we need to compensate the size ratio):
  float pixelsThickness = max(normalLength, minThickness * u_sizeRatio);

  // Then, we need to retrieve the normalized thickness of the edge in the WebGL
  // referential (in a ([0, 1], [0, 1]) space), using our "magic" correction
  // ratio:
  float webGLThickness = pixelsThickness * u_correctionRatio / u_sizeRatio;

  // Here is the proper position of the vertex
  gl_Position = vec4((u_matrix * vec3(position + unitNormal * webGLThickness, 1)).xy, 0, 1);

  // For the fragment shader though, we need a thickness that takes the "magic"
  // correction ratio into account (as in webGLThickness), but so that the
  // antialiasing effect does not depend on the zoom level. So here's yet
  // another thickness version:
  v_thickness = webGLThickness / u_zoomRatio;

  v_normal = unitNormal;

  v_feather = u_feather * u_correctionRatio / u_zoomRatio / u_pixelRatio * 2.0;

  #ifdef PICKING_MODE
  // For picking mode, we use the ID as the color:
  v_color = a_id;
  #else
  // For normal mode, we use the color:
  v_color = a_color;
  #endif

  v_color.a *= bias;
}
`,uf=sf,Ta=WebGLRenderingContext,Jr=Ta.UNSIGNED_BYTE,zt=Ta.FLOAT,lf=["u_matrix","u_zoomRatio","u_sizeRatio","u_correctionRatio","u_pixelRatio","u_feather","u_minEdgeThickness"],cf=function(e){function t(){return _e(this,t),Ne(this,t,arguments)}return Me(t,e),Ee(t,[{key:"getDefinition",value:function(){return{VERTICES:6,VERTEX_SHADER_SOURCE:uf,FRAGMENT_SHADER_SOURCE:Ea,METHOD:WebGLRenderingContext.TRIANGLES,UNIFORMS:lf,ATTRIBUTES:[{name:"a_positionStart",size:2,type:zt},{name:"a_positionEnd",size:2,type:zt},{name:"a_normal",size:2,type:zt},{name:"a_color",size:4,type:Jr,normalized:!0},{name:"a_id",size:4,type:Jr,normalized:!0}],CONSTANT_ATTRIBUTES:[{name:"a_positionCoef",size:1,type:zt},{name:"a_normalCoef",size:1,type:zt}],CONSTANT_DATA:[[0,1],[0,-1],[1,1],[1,1],[0,-1],[1,-1]]}}},{key:"processVisibleItem",value:function(i,r,o,a,s){var u=s.size||1,l=o.x,c=o.y,d=a.x,h=a.y,f=Dt(s.color),g=d-l,v=h-c,x=g*g+v*v,C=0,b=0;x&&(x=1/Math.sqrt(x),C=-v*x*u,b=g*x*u);var w=this.array;w[r++]=l,w[r++]=c,w[r++]=d,w[r++]=h,w[r++]=C,w[r++]=b,w[r++]=f,w[r++]=i}},{key:"setUniforms",value:function(i,r){var o=r.gl,a=r.uniformLocations,s=a.u_matrix,u=a.u_zoomRatio,l=a.u_feather,c=a.u_pixelRatio,d=a.u_correctionRatio,h=a.u_sizeRatio,f=a.u_minEdgeThickness;o.uniformMatrix3fv(s,!1,i.matrix),o.uniform1f(u,i.zoomRatio),o.uniform1f(h,i.sizeRatio),o.uniform1f(d,i.correctionRatio),o.uniform1f(c,i.pixelRatio),o.uniform1f(l,i.antiAliasingFeather),o.uniform1f(f,i.minEdgeThickness)}}])}(Hn),Ki=function(e){function t(){var n;return _e(this,t),n=Ne(this,t),n.rawEmitter=n,n}return Me(t,e),Ee(t)}(Ko.EventEmitter),li,Qr;function df(){return Qr||(Qr=1,li=function(t){return t!==null&&typeof t=="object"&&typeof t.addUndirectedEdgeWithKey=="function"&&typeof t.dropNode=="function"&&typeof t.multi=="boolean"}),li}var hf=df();const ff=gd(hf);var pf=function(t){return t},gf=function(t){return t*t},mf=function(t){return t*(2-t)},vf=function(t){return(t*=2)<1?.5*t*t:-.5*(--t*(t-2)-1)},yf=function(t){return t*t*t},bf=function(t){return--t*t*t+1},wf=function(t){return(t*=2)<1?.5*t*t*t:.5*((t-=2)*t*t+2)},xf={linear:pf,quadraticIn:gf,quadraticOut:mf,quadraticInOut:vf,cubicIn:yf,cubicOut:bf,cubicInOut:wf},_f={easing:"quadraticInOut",duration:150};function Fe(){return Float32Array.of(1,0,0,0,1,0,0,0,1)}function vn(e,t,n){return e[0]=t,e[4]=typeof n=="number"?n:t,e}function eo(e,t){var n=Math.sin(t),i=Math.cos(t);return e[0]=i,e[1]=n,e[3]=-n,e[4]=i,e}function to(e,t,n){return e[6]=t,e[7]=n,e}function st(e,t){var n=e[0],i=e[1],r=e[2],o=e[3],a=e[4],s=e[5],u=e[6],l=e[7],c=e[8],d=t[0],h=t[1],f=t[2],g=t[3],v=t[4],x=t[5],C=t[6],b=t[7],w=t[8];return e[0]=d*n+h*o+f*u,e[1]=d*i+h*a+f*l,e[2]=d*r+h*s+f*c,e[3]=g*n+v*o+x*u,e[4]=g*i+v*a+x*l,e[5]=g*r+v*s+x*c,e[6]=C*n+b*o+w*u,e[7]=C*i+b*a+w*l,e[8]=C*r+b*s+w*c,e}function Li(e,t){var n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:1,i=e[0],r=e[1],o=e[3],a=e[4],s=e[6],u=e[7],l=t.x,c=t.y;return{x:l*i+c*o+s*n,y:l*r+c*a+u*n}}function Ef(e,t){var n=e.height/e.width,i=t.height/t.width;return n<1&&i>1||n>1&&i<1?1:Math.min(Math.max(i,1/i),Math.max(1/n,n))}function Bt(e,t,n,i,r){var o=e.angle,a=e.ratio,s=e.x,u=e.y,l=t.width,c=t.height,d=Fe(),h=Math.min(l,c)-2*i,f=Ef(t,n);return r?(st(d,to(Fe(),s,u)),st(d,vn(Fe(),a)),st(d,eo(Fe(),o)),st(d,vn(Fe(),l/h/2/f,c/h/2/f))):(st(d,vn(Fe(),2*(h/l)*f,2*(h/c)*f)),st(d,eo(Fe(),-o)),st(d,vn(Fe(),1/a)),st(d,to(Fe(),-s,-u))),d}function Cf(e,t,n){var i=Li(e,{x:Math.cos(t.angle),y:Math.sin(t.angle)},0),r=i.x,o=i.y;return 1/Math.sqrt(Math.pow(r,2)+Math.pow(o,2))/n.width}function kf(e){if(!e.order)return{x:[0,1],y:[0,1]};var t=1/0,n=-1/0,i=1/0,r=-1/0;return e.forEachNode(function(o,a){var s=a.x,u=a.y;s<t&&(t=s),s>n&&(n=s),u<i&&(i=u),u>r&&(r=u)}),{x:[t,n],y:[i,r]}}function Tf(e){if(!ff(e))throw new Error("Sigma: invalid graph instance.");e.forEachNode(function(t,n){if(!Number.isFinite(n.x)||!Number.isFinite(n.y))throw new Error("Sigma: Coordinates of node ".concat(t," are invalid. A node must have a numeric 'x' and 'y' attribute."))})}function Af(e,t,n){var i=document.createElement(e);if(t)for(var r in t)i.style[r]=t[r];if(n)for(var o in n)i.setAttribute(o,n[o]);return i}function no(){return typeof window.devicePixelRatio<"u"?window.devicePixelRatio:1}function io(e,t,n){return n.sort(function(i,r){var o=t(i)||0,a=t(r)||0;return o<a?-1:o>a?1:0})}function ro(e){var t=Lt(e.x,2),n=t[0],i=t[1],r=Lt(e.y,2),o=r[0],a=r[1],s=Math.max(i-n,a-o),u=(i+n)/2,l=(a+o)/2;(s===0||Math.abs(s)===1/0||isNaN(s))&&(s=1),isNaN(u)&&(u=0),isNaN(l)&&(l=0);var c=function(h){return{x:.5+(h.x-u)/s,y:.5+(h.y-l)/s}};return c.applyTo=function(d){d.x=.5+(d.x-u)/s,d.y=.5+(d.y-l)/s},c.inverse=function(d){return{x:u+s*(d.x-.5),y:l+s*(d.y-.5)}},c.ratio=s,c}function Ri(e){"@babel/helpers - typeof";return Ri=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Ri(e)}function oo(e,t){var n=t.size;if(n!==0){var i=e.length;e.length+=n;var r=0;t.forEach(function(o){e[i+r]=o,r++})}}function ci(e){e=e||{};for(var t=0,n=arguments.length<=1?0:arguments.length-1;t<n;t++){var i=t+1<1||arguments.length<=t+1?void 0:arguments[t+1];i&&Object.assign(e,i)}return e}var Zi={hideEdgesOnMove:!1,hideLabelsOnMove:!1,renderLabels:!0,renderEdgeLabels:!1,enableEdgeEvents:!1,defaultNodeColor:"#999",defaultNodeType:"circle",defaultEdgeColor:"#ccc",defaultEdgeType:"line",labelFont:"Arial",labelSize:14,labelWeight:"normal",labelColor:{color:"#000"},edgeLabelFont:"Arial",edgeLabelSize:14,edgeLabelWeight:"normal",edgeLabelColor:{attribute:"color"},stagePadding:30,defaultDrawEdgeLabel:Bh,defaultDrawNodeLabel:ba,defaultDrawNodeHover:Oh,minEdgeThickness:1.7,antiAliasingFeather:1,dragTimeout:100,draggedEventsTolerance:3,inertiaDuration:200,inertiaRatio:3,zoomDuration:250,zoomingRatio:1.7,doubleClickTimeout:300,doubleClickZoomingRatio:2.2,doubleClickZoomingDuration:200,tapMoveTolerance:10,zoomToSizeRatioFunction:Math.sqrt,itemSizesReference:"screen",autoRescale:!0,autoCenter:!0,labelDensity:1,labelGridCellSize:100,labelRenderedSizeThreshold:6,nodeReducer:null,edgeReducer:null,zIndex:!1,minCameraRatio:null,maxCameraRatio:null,enableCameraZooming:!0,enableCameraPanning:!0,enableCameraRotation:!0,cameraPanBoundaries:null,allowInvalidContainer:!1,nodeProgramClasses:{},nodeHoverProgramClasses:{},edgeProgramClasses:{}},Sf={circle:qn},Lf={arrow:af,line:cf};function di(e){if(typeof e.labelDensity!="number"||e.labelDensity<0)throw new Error("Settings: invalid `labelDensity`. Expecting a positive number.");var t=e.minCameraRatio,n=e.maxCameraRatio;if(typeof t=="number"&&typeof n=="number"&&n<t)throw new Error("Settings: invalid camera ratio boundaries. Expecting `maxCameraRatio` to be greater than `minCameraRatio`.")}function Rf(e){var t=ci({},Zi,e);return t.nodeProgramClasses=ci({},Sf,t.nodeProgramClasses),t.edgeProgramClasses=ci({},Lf,t.edgeProgramClasses),t}var yn=1.5,ao=function(e){function t(){var n;return _e(this,t),n=Ne(this,t),R(n,"x",.5),R(n,"y",.5),R(n,"angle",0),R(n,"ratio",1),R(n,"minRatio",null),R(n,"maxRatio",null),R(n,"enabledZooming",!0),R(n,"enabledPanning",!0),R(n,"enabledRotation",!0),R(n,"clean",null),R(n,"nextFrame",null),R(n,"previousState",null),R(n,"enabled",!0),n.previousState=n.getState(),n}return Me(t,e),Ee(t,[{key:"enable",value:function(){return this.enabled=!0,this}},{key:"disable",value:function(){return this.enabled=!1,this}},{key:"getState",value:function(){return{x:this.x,y:this.y,angle:this.angle,ratio:this.ratio}}},{key:"hasState",value:function(i){return this.x===i.x&&this.y===i.y&&this.ratio===i.ratio&&this.angle===i.angle}},{key:"getPreviousState",value:function(){var i=this.previousState;return i?{x:i.x,y:i.y,angle:i.angle,ratio:i.ratio}:null}},{key:"getBoundedRatio",value:function(i){var r=i;return typeof this.minRatio=="number"&&(r=Math.max(r,this.minRatio)),typeof this.maxRatio=="number"&&(r=Math.min(r,this.maxRatio)),r}},{key:"validateState",value:function(i){var r={};return this.enabledPanning&&typeof i.x=="number"&&(r.x=i.x),this.enabledPanning&&typeof i.y=="number"&&(r.y=i.y),this.enabledZooming&&typeof i.ratio=="number"&&(r.ratio=this.getBoundedRatio(i.ratio)),this.enabledRotation&&typeof i.angle=="number"&&(r.angle=i.angle),this.clean?this.clean(W(W({},this.getState()),r)):r}},{key:"isAnimated",value:function(){return!!this.nextFrame}},{key:"setState",value:function(i){if(!this.enabled)return this;this.previousState=this.getState();var r=this.validateState(i);return typeof r.x=="number"&&(this.x=r.x),typeof r.y=="number"&&(this.y=r.y),typeof r.ratio=="number"&&(this.ratio=r.ratio),typeof r.angle=="number"&&(this.angle=r.angle),this.hasState(this.previousState)||this.emit("updated",this.getState()),this}},{key:"updateState",value:function(i){return this.setState(i(this.getState())),this}},{key:"animate",value:function(i){var r=this,o=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},a=arguments.length>2?arguments[2]:void 0;if(!a)return new Promise(function(f){return r.animate(i,o,f)});if(this.enabled){var s=W(W({},_f),o),u=this.validateState(i),l=typeof s.easing=="function"?s.easing:xf[s.easing],c=Date.now(),d=this.getState(),h=function(){var g=(Date.now()-c)/s.duration;if(g>=1){r.nextFrame=null,r.setState(u),r.animationCallback&&(r.animationCallback.call(null),r.animationCallback=void 0);return}var v=l(g),x={};typeof u.x=="number"&&(x.x=d.x+(u.x-d.x)*v),typeof u.y=="number"&&(x.y=d.y+(u.y-d.y)*v),r.enabledRotation&&typeof u.angle=="number"&&(x.angle=d.angle+(u.angle-d.angle)*v),typeof u.ratio=="number"&&(x.ratio=d.ratio+(u.ratio-d.ratio)*v),r.setState(x),r.nextFrame=requestAnimationFrame(h)};this.nextFrame?(cancelAnimationFrame(this.nextFrame),this.animationCallback&&this.animationCallback.call(null),this.nextFrame=requestAnimationFrame(h)):h(),this.animationCallback=a}}},{key:"animatedZoom",value:function(i){return i?typeof i=="number"?this.animate({ratio:this.ratio/i}):this.animate({ratio:this.ratio/(i.factor||yn)},i):this.animate({ratio:this.ratio/yn})}},{key:"animatedUnzoom",value:function(i){return i?typeof i=="number"?this.animate({ratio:this.ratio*i}):this.animate({ratio:this.ratio*(i.factor||yn)},i):this.animate({ratio:this.ratio*yn})}},{key:"animatedReset",value:function(i){return this.animate({x:.5,y:.5,ratio:1,angle:0},i)}},{key:"copy",value:function(){return t.from(this.getState())}}],[{key:"from",value:function(i){var r=new t;return r.setState(i)}}])}(Ki);function Be(e,t){var n=t.getBoundingClientRect();return{x:e.clientX-n.left,y:e.clientY-n.top}}function Ze(e,t){var n=W(W({},Be(e,t)),{},{sigmaDefaultPrevented:!1,preventSigmaDefault:function(){n.sigmaDefaultPrevented=!0},original:e});return n}function Ot(e){var t="x"in e?e:W(W({},e.touches[0]||e.previousTouches[0]),{},{original:e.original,sigmaDefaultPrevented:e.sigmaDefaultPrevented,preventSigmaDefault:function(){e.sigmaDefaultPrevented=!0,t.sigmaDefaultPrevented=!0}});return t}function Nf(e,t){return W(W({},Ze(e,t)),{},{delta:Aa(e)})}var Mf=2;function Cn(e){for(var t=[],n=0,i=Math.min(e.length,Mf);n<i;n++)t.push(e[n]);return t}function Ut(e,t,n){var i={touches:Cn(e.touches).map(function(r){return Be(r,n)}),previousTouches:t.map(function(r){return Be(r,n)}),sigmaDefaultPrevented:!1,preventSigmaDefault:function(){i.sigmaDefaultPrevented=!0},original:e};return i}function Aa(e){if(typeof e.deltaY<"u")return e.deltaY*-3/360;if(typeof e.detail<"u")return e.detail/-9;throw new Error("Captor: could not extract delta from event.")}var Sa=function(e){function t(n,i){var r;return _e(this,t),r=Ne(this,t),r.container=n,r.renderer=i,r}return Me(t,e),Ee(t)}(Ki),Df=["doubleClickTimeout","doubleClickZoomingDuration","doubleClickZoomingRatio","dragTimeout","draggedEventsTolerance","inertiaDuration","inertiaRatio","zoomDuration","zoomingRatio"],$f=Df.reduce(function(e,t){return W(W({},e),{},R({},t,Zi[t]))},{}),If=function(e){function t(n,i){var r;return _e(this,t),r=Ne(this,t,[n,i]),R(r,"enabled",!0),R(r,"draggedEvents",0),R(r,"downStartTime",null),R(r,"lastMouseX",null),R(r,"lastMouseY",null),R(r,"isMouseDown",!1),R(r,"isMoving",!1),R(r,"movingTimeout",null),R(r,"startCameraState",null),R(r,"clicks",0),R(r,"doubleClickTimeout",null),R(r,"currentWheelDirection",0),R(r,"settings",$f),r.handleClick=r.handleClick.bind(r),r.handleRightClick=r.handleRightClick.bind(r),r.handleDown=r.handleDown.bind(r),r.handleUp=r.handleUp.bind(r),r.handleMove=r.handleMove.bind(r),r.handleWheel=r.handleWheel.bind(r),r.handleLeave=r.handleLeave.bind(r),r.handleEnter=r.handleEnter.bind(r),n.addEventListener("click",r.handleClick,{capture:!1}),n.addEventListener("contextmenu",r.handleRightClick,{capture:!1}),n.addEventListener("mousedown",r.handleDown,{capture:!1}),n.addEventListener("wheel",r.handleWheel,{capture:!1}),n.addEventListener("mouseleave",r.handleLeave,{capture:!1}),n.addEventListener("mouseenter",r.handleEnter,{capture:!1}),document.addEventListener("mousemove",r.handleMove,{capture:!1}),document.addEventListener("mouseup",r.handleUp,{capture:!1}),r}return Me(t,e),Ee(t,[{key:"kill",value:function(){var i=this.container;i.removeEventListener("click",this.handleClick),i.removeEventListener("contextmenu",this.handleRightClick),i.removeEventListener("mousedown",this.handleDown),i.removeEventListener("wheel",this.handleWheel),i.removeEventListener("mouseleave",this.handleLeave),i.removeEventListener("mouseenter",this.handleEnter),document.removeEventListener("mousemove",this.handleMove),document.removeEventListener("mouseup",this.handleUp)}},{key:"handleClick",value:function(i){var r=this;if(this.enabled){if(this.clicks++,this.clicks===2)return this.clicks=0,typeof this.doubleClickTimeout=="number"&&(clearTimeout(this.doubleClickTimeout),this.doubleClickTimeout=null),this.handleDoubleClick(i);setTimeout(function(){r.clicks=0,r.doubleClickTimeout=null},this.settings.doubleClickTimeout),this.draggedEvents<this.settings.draggedEventsTolerance&&this.emit("click",Ze(i,this.container))}}},{key:"handleRightClick",value:function(i){this.enabled&&this.emit("rightClick",Ze(i,this.container))}},{key:"handleDoubleClick",value:function(i){if(this.enabled){i.preventDefault(),i.stopPropagation();var r=Ze(i,this.container);if(this.emit("doubleClick",r),!r.sigmaDefaultPrevented){var o=this.renderer.getCamera(),a=o.getBoundedRatio(o.getState().ratio/this.settings.doubleClickZoomingRatio);o.animate(this.renderer.getViewportZoomedState(Be(i,this.container),a),{easing:"quadraticInOut",duration:this.settings.doubleClickZoomingDuration})}}}},{key:"handleDown",value:function(i){if(this.enabled){if(i.button===0){this.startCameraState=this.renderer.getCamera().getState();var r=Be(i,this.container),o=r.x,a=r.y;this.lastMouseX=o,this.lastMouseY=a,this.draggedEvents=0,this.downStartTime=Date.now(),this.isMouseDown=!0}this.emit("mousedown",Ze(i,this.container))}}},{key:"handleUp",value:function(i){var r=this;if(!(!this.enabled||!this.isMouseDown)){var o=this.renderer.getCamera();this.isMouseDown=!1,typeof this.movingTimeout=="number"&&(clearTimeout(this.movingTimeout),this.movingTimeout=null);var a=Be(i,this.container),s=a.x,u=a.y,l=o.getState(),c=o.getPreviousState()||{x:0,y:0};this.isMoving?o.animate({x:l.x+this.settings.inertiaRatio*(l.x-c.x),y:l.y+this.settings.inertiaRatio*(l.y-c.y)},{duration:this.settings.inertiaDuration,easing:"quadraticOut"}):(this.lastMouseX!==s||this.lastMouseY!==u)&&o.setState({x:l.x,y:l.y}),this.isMoving=!1,setTimeout(function(){var d=r.draggedEvents>0;r.draggedEvents=0,d&&r.renderer.getSetting("hideEdgesOnMove")&&r.renderer.refresh()},0),this.emit("mouseup",Ze(i,this.container))}}},{key:"handleMove",value:function(i){var r=this;if(this.enabled){var o=Ze(i,this.container);if(this.emit("mousemovebody",o),(i.target===this.container||i.composedPath()[0]===this.container)&&this.emit("mousemove",o),!o.sigmaDefaultPrevented&&this.isMouseDown){this.isMoving=!0,this.draggedEvents++,typeof this.movingTimeout=="number"&&clearTimeout(this.movingTimeout),this.movingTimeout=window.setTimeout(function(){r.movingTimeout=null,r.isMoving=!1},this.settings.dragTimeout);var a=this.renderer.getCamera(),s=Be(i,this.container),u=s.x,l=s.y,c=this.renderer.viewportToFramedGraph({x:this.lastMouseX,y:this.lastMouseY}),d=this.renderer.viewportToFramedGraph({x:u,y:l}),h=c.x-d.x,f=c.y-d.y,g=a.getState(),v=g.x+h,x=g.y+f;a.setState({x:v,y:x}),this.lastMouseX=u,this.lastMouseY=l,i.preventDefault(),i.stopPropagation()}}}},{key:"handleLeave",value:function(i){this.emit("mouseleave",Ze(i,this.container))}},{key:"handleEnter",value:function(i){this.emit("mouseenter",Ze(i,this.container))}},{key:"handleWheel",value:function(i){var r=this,o=this.renderer.getCamera();if(!(!this.enabled||!o.enabledZooming)){var a=Aa(i);if(a){var s=Nf(i,this.container);if(this.emit("wheel",s),s.sigmaDefaultPrevented){i.preventDefault(),i.stopPropagation();return}var u=o.getState().ratio,l=a>0?1/this.settings.zoomingRatio:this.settings.zoomingRatio,c=o.getBoundedRatio(u*l),d=a>0?1:-1,h=Date.now();u!==c&&(i.preventDefault(),i.stopPropagation(),!(this.currentWheelDirection===d&&this.lastWheelTriggerTime&&h-this.lastWheelTriggerTime<this.settings.zoomDuration/5)&&(o.animate(this.renderer.getViewportZoomedState(Be(i,this.container),c),{easing:"quadraticOut",duration:this.settings.zoomDuration},function(){r.currentWheelDirection=0}),this.currentWheelDirection=d,this.lastWheelTriggerTime=h))}}}},{key:"setSettings",value:function(i){this.settings=i}}])}(Sa),Pf=["dragTimeout","inertiaDuration","inertiaRatio","doubleClickTimeout","doubleClickZoomingRatio","doubleClickZoomingDuration","tapMoveTolerance"],Ff=Pf.reduce(function(e,t){return W(W({},e),{},R({},t,Zi[t]))},{}),Gf=function(e){function t(n,i){var r;return _e(this,t),r=Ne(this,t,[n,i]),R(r,"enabled",!0),R(r,"isMoving",!1),R(r,"hasMoved",!1),R(r,"touchMode",0),R(r,"startTouchesPositions",[]),R(r,"lastTouches",[]),R(r,"lastTap",null),R(r,"settings",Ff),r.handleStart=r.handleStart.bind(r),r.handleLeave=r.handleLeave.bind(r),r.handleMove=r.handleMove.bind(r),n.addEventListener("touchstart",r.handleStart,{capture:!1}),n.addEventListener("touchcancel",r.handleLeave,{capture:!1}),document.addEventListener("touchend",r.handleLeave,{capture:!1,passive:!1}),document.addEventListener("touchmove",r.handleMove,{capture:!1,passive:!1}),r}return Me(t,e),Ee(t,[{key:"kill",value:function(){var i=this.container;i.removeEventListener("touchstart",this.handleStart),i.removeEventListener("touchcancel",this.handleLeave),document.removeEventListener("touchend",this.handleLeave),document.removeEventListener("touchmove",this.handleMove)}},{key:"getDimensions",value:function(){return{width:this.container.offsetWidth,height:this.container.offsetHeight}}},{key:"handleStart",value:function(i){var r=this;if(this.enabled){i.preventDefault();var o=Cn(i.touches);if(this.touchMode=o.length,this.startCameraState=this.renderer.getCamera().getState(),this.startTouchesPositions=o.map(function(f){return Be(f,r.container)}),this.touchMode===2){var a=Lt(this.startTouchesPositions,2),s=a[0],u=s.x,l=s.y,c=a[1],d=c.x,h=c.y;this.startTouchesAngle=Math.atan2(h-l,d-u),this.startTouchesDistance=Math.sqrt(Math.pow(d-u,2)+Math.pow(h-l,2))}this.emit("touchdown",Ut(i,this.lastTouches,this.container)),this.lastTouches=o,this.lastTouchesPositions=this.startTouchesPositions}}},{key:"handleLeave",value:function(i){if(!(!this.enabled||!this.startTouchesPositions.length)){switch(i.cancelable&&i.preventDefault(),this.movingTimeout&&(this.isMoving=!1,clearTimeout(this.movingTimeout)),this.touchMode){case 2:if(i.touches.length===1){this.handleStart(i),i.preventDefault();break}case 1:if(this.isMoving){var r=this.renderer.getCamera(),o=r.getState(),a=r.getPreviousState()||{x:0,y:0};r.animate({x:o.x+this.settings.inertiaRatio*(o.x-a.x),y:o.y+this.settings.inertiaRatio*(o.y-a.y)},{duration:this.settings.inertiaDuration,easing:"quadraticOut"})}this.hasMoved=!1,this.isMoving=!1,this.touchMode=0;break}if(this.emit("touchup",Ut(i,this.lastTouches,this.container)),!i.touches.length){var s=Be(this.lastTouches[0],this.container),u=this.startTouchesPositions[0],l=Math.pow(s.x-u.x,2)+Math.pow(s.y-u.y,2);if(!i.touches.length&&l<Math.pow(this.settings.tapMoveTolerance,2))if(this.lastTap&&Date.now()-this.lastTap.time<this.settings.doubleClickTimeout){var c=Ut(i,this.lastTouches,this.container);if(this.emit("doubletap",c),this.lastTap=null,!c.sigmaDefaultPrevented){var d=this.renderer.getCamera(),h=d.getBoundedRatio(d.getState().ratio/this.settings.doubleClickZoomingRatio);d.animate(this.renderer.getViewportZoomedState(s,h),{easing:"quadraticInOut",duration:this.settings.doubleClickZoomingDuration})}}else{var f=Ut(i,this.lastTouches,this.container);this.emit("tap",f),this.lastTap={time:Date.now(),position:f.touches[0]||f.previousTouches[0]}}}this.lastTouches=Cn(i.touches),this.startTouchesPositions=[]}}},{key:"handleMove",value:function(i){var r=this;if(!(!this.enabled||!this.startTouchesPositions.length)){i.preventDefault();var o=Cn(i.touches),a=o.map(function(ie){return Be(ie,r.container)}),s=this.lastTouches;this.lastTouches=o,this.lastTouchesPositions=a;var u=Ut(i,s,this.container);if(this.emit("touchmove",u),!u.sigmaDefaultPrevented&&(this.hasMoved||(this.hasMoved=a.some(function(ie,se){var ee=r.startTouchesPositions[se];return ee&&(ie.x!==ee.x||ie.y!==ee.y)})),!!this.hasMoved)){this.isMoving=!0,this.movingTimeout&&clearTimeout(this.movingTimeout),this.movingTimeout=window.setTimeout(function(){r.isMoving=!1},this.settings.dragTimeout);var l=this.renderer.getCamera(),c=this.startCameraState,d=this.renderer.getSetting("stagePadding");switch(this.touchMode){case 1:{var h=this.renderer.viewportToFramedGraph((this.startTouchesPositions||[])[0]),f=h.x,g=h.y,v=this.renderer.viewportToFramedGraph(a[0]),x=v.x,C=v.y;l.setState({x:c.x+f-x,y:c.y+g-C});break}case 2:{var b={x:.5,y:.5,angle:0,ratio:1},w=a[0],m=w.x,y=w.y,_=a[1],A=_.x,F=_.y,B=Math.atan2(F-y,A-m)-this.startTouchesAngle,z=Math.hypot(F-y,A-m)/this.startTouchesDistance,D=l.getBoundedRatio(c.ratio/z);b.ratio=D,b.angle=c.angle+B;var q=this.getDimensions(),P=this.renderer.viewportToFramedGraph((this.startTouchesPositions||[])[0],{cameraState:c}),V=Math.min(q.width,q.height)-2*d,oe=V/q.width,ce=V/q.height,pe=D/V,fe=m-V/2/oe,ae=y-V/2/ce,re=[fe*Math.cos(-b.angle)-ae*Math.sin(-b.angle),ae*Math.cos(-b.angle)+fe*Math.sin(-b.angle)];fe=re[0],ae=re[1],b.x=P.x-fe*pe,b.y=P.y+ae*pe,l.setState(b);break}}}}}},{key:"setSettings",value:function(i){this.settings=i}}])}(Sa);function zf(e){if(Array.isArray(e))return Ai(e)}function Bf(e){if(typeof Symbol<"u"&&e[Symbol.iterator]!=null||e["@@iterator"]!=null)return Array.from(e)}function Of(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function so(e){return zf(e)||Bf(e)||ha(e)||Of()}function Uf(e,t){if(e==null)return{};var n={};for(var i in e)if({}.hasOwnProperty.call(e,i)){if(t.indexOf(i)!==-1)continue;n[i]=e[i]}return n}function hi(e,t){if(e==null)return{};var n,i,r=Uf(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(i=0;i<o.length;i++)n=o[i],t.indexOf(n)===-1&&{}.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}var uo=function(){function e(t,n){_e(this,e),this.key=t,this.size=n}return Ee(e,null,[{key:"compare",value:function(n,i){return n.size>i.size?-1:n.size<i.size||n.key>i.key?1:-1}}])}(),lo=function(){function e(){_e(this,e),R(this,"width",0),R(this,"height",0),R(this,"cellSize",0),R(this,"columns",0),R(this,"rows",0),R(this,"cells",{})}return Ee(e,[{key:"resizeAndClear",value:function(n,i){this.width=n.width,this.height=n.height,this.cellSize=i,this.columns=Math.ceil(n.width/i),this.rows=Math.ceil(n.height/i),this.cells={}}},{key:"getIndex",value:function(n){var i=Math.floor(n.x/this.cellSize),r=Math.floor(n.y/this.cellSize);return r*this.columns+i}},{key:"add",value:function(n,i,r){var o=new uo(n,i),a=this.getIndex(r),s=this.cells[a];s||(s=[],this.cells[a]=s),s.push(o)}},{key:"organize",value:function(){for(var n in this.cells){var i=this.cells[n];i.sort(uo.compare)}}},{key:"getLabelsToDisplay",value:function(n,i){var r=this.cellSize*this.cellSize,o=r/n/n,a=o*i/r,s=Math.ceil(a),u=[];for(var l in this.cells)for(var c=this.cells[l],d=0;d<Math.min(s,c.length);d++)u.push(c[d].key);return u}}])}();function Hf(e){var t=e.graph,n=e.hoveredNode,i=e.highlightedNodes,r=e.displayedNodeLabels,o=[];return t.forEachEdge(function(a,s,u,l){(u===n||l===n||i.has(u)||i.has(l)||r.has(u)&&r.has(l))&&o.push(a)}),o}var qf=150,Vf=50,Je=Object.prototype.hasOwnProperty;function Wf(e,t,n){if(!Je.call(n,"x")||!Je.call(n,"y"))throw new Error('Sigma: could not find a valid position (x, y) for node "'.concat(t,'". All your nodes must have a number "x" and "y". Maybe your forgot to apply a layout or your "nodeReducer" is not returning the correct data?'));return n.color||(n.color=e.defaultNodeColor),!n.label&&n.label!==""&&(n.label=null),n.label!==void 0&&n.label!==null?n.label=""+n.label:n.label=null,n.size||(n.size=2),Je.call(n,"hidden")||(n.hidden=!1),Je.call(n,"highlighted")||(n.highlighted=!1),Je.call(n,"forceLabel")||(n.forceLabel=!1),(!n.type||n.type==="")&&(n.type=e.defaultNodeType),n.zIndex||(n.zIndex=0),n}function jf(e,t,n){return n.color||(n.color=e.defaultEdgeColor),n.label||(n.label=""),n.size||(n.size=.5),Je.call(n,"hidden")||(n.hidden=!1),Je.call(n,"forceLabel")||(n.forceLabel=!1),(!n.type||n.type==="")&&(n.type=e.defaultEdgeType),n.zIndex||(n.zIndex=0),n}var Yf=function(e){function t(n,i){var r,o=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};if(_e(this,t),r=Ne(this,t),R(r,"elements",{}),R(r,"canvasContexts",{}),R(r,"webGLContexts",{}),R(r,"pickingLayers",new Set),R(r,"textures",{}),R(r,"frameBuffers",{}),R(r,"activeListeners",{}),R(r,"labelGrid",new lo),R(r,"nodeDataCache",{}),R(r,"edgeDataCache",{}),R(r,"nodeProgramIndex",{}),R(r,"edgeProgramIndex",{}),R(r,"nodesWithForcedLabels",new Set),R(r,"edgesWithForcedLabels",new Set),R(r,"nodeExtent",{x:[0,1],y:[0,1]}),R(r,"nodeZExtent",[1/0,-1/0]),R(r,"edgeZExtent",[1/0,-1/0]),R(r,"matrix",Fe()),R(r,"invMatrix",Fe()),R(r,"correctionRatio",1),R(r,"customBBox",null),R(r,"normalizationFunction",ro({x:[0,1],y:[0,1]})),R(r,"graphToViewportRatio",1),R(r,"itemIDsIndex",{}),R(r,"nodeIndices",{}),R(r,"edgeIndices",{}),R(r,"width",0),R(r,"height",0),R(r,"pixelRatio",no()),R(r,"pickingDownSizingRatio",2*r.pixelRatio),R(r,"displayedNodeLabels",new Set),R(r,"displayedEdgeLabels",new Set),R(r,"highlightedNodes",new Set),R(r,"hoveredNode",null),R(r,"hoveredEdge",null),R(r,"renderFrame",null),R(r,"renderHighlightedNodesFrame",null),R(r,"needToProcess",!1),R(r,"checkEdgesEventsFrame",null),R(r,"nodePrograms",{}),R(r,"nodeHoverPrograms",{}),R(r,"edgePrograms",{}),r.settings=Rf(o),di(r.settings),Tf(n),!(i instanceof HTMLElement))throw new Error("Sigma: container should be an html element.");r.graph=n,r.container=i,r.createWebGLContext("edges",{picking:o.enableEdgeEvents}),r.createCanvasContext("edgeLabels"),r.createWebGLContext("nodes",{picking:!0}),r.createCanvasContext("labels"),r.createCanvasContext("hovers"),r.createWebGLContext("hoverNodes"),r.createCanvasContext("mouse",{style:{touchAction:"none",userSelect:"none"}}),r.resize();for(var a in r.settings.nodeProgramClasses)r.registerNodeProgram(a,r.settings.nodeProgramClasses[a],r.settings.nodeHoverProgramClasses[a]);for(var s in r.settings.edgeProgramClasses)r.registerEdgeProgram(s,r.settings.edgeProgramClasses[s]);return r.camera=new ao,r.bindCameraHandlers(),r.mouseCaptor=new If(r.elements.mouse,r),r.mouseCaptor.setSettings(r.settings),r.touchCaptor=new Gf(r.elements.mouse,r),r.touchCaptor.setSettings(r.settings),r.bindEventHandlers(),r.bindGraphHandlers(),r.handleSettingsUpdate(),r.refresh(),r}return Me(t,e),Ee(t,[{key:"registerNodeProgram",value:function(i,r,o){return this.nodePrograms[i]&&this.nodePrograms[i].kill(),this.nodeHoverPrograms[i]&&this.nodeHoverPrograms[i].kill(),this.nodePrograms[i]=new r(this.webGLContexts.nodes,this.frameBuffers.nodes,this),this.nodeHoverPrograms[i]=new(o||r)(this.webGLContexts.hoverNodes,null,this),this}},{key:"registerEdgeProgram",value:function(i,r){return this.edgePrograms[i]&&this.edgePrograms[i].kill(),this.edgePrograms[i]=new r(this.webGLContexts.edges,this.frameBuffers.edges,this),this}},{key:"unregisterNodeProgram",value:function(i){if(this.nodePrograms[i]){var r=this.nodePrograms,o=r[i],a=hi(r,[i].map(Xt));o.kill(),this.nodePrograms=a}if(this.nodeHoverPrograms[i]){var s=this.nodeHoverPrograms,u=s[i],l=hi(s,[i].map(Xt));u.kill(),this.nodePrograms=l}return this}},{key:"unregisterEdgeProgram",value:function(i){if(this.edgePrograms[i]){var r=this.edgePrograms,o=r[i],a=hi(r,[i].map(Xt));o.kill(),this.edgePrograms=a}return this}},{key:"resetWebGLTexture",value:function(i){var r=this.webGLContexts[i],o=this.frameBuffers[i],a=this.textures[i];a&&r.deleteTexture(a);var s=r.createTexture();return r.bindFramebuffer(r.FRAMEBUFFER,o),r.bindTexture(r.TEXTURE_2D,s),r.texImage2D(r.TEXTURE_2D,0,r.RGBA,this.width,this.height,0,r.RGBA,r.UNSIGNED_BYTE,null),r.framebufferTexture2D(r.FRAMEBUFFER,r.COLOR_ATTACHMENT0,r.TEXTURE_2D,s,0),this.textures[i]=s,this}},{key:"bindCameraHandlers",value:function(){var i=this;return this.activeListeners.camera=function(){i.scheduleRender()},this.camera.on("updated",this.activeListeners.camera),this}},{key:"unbindCameraHandlers",value:function(){return this.camera.removeListener("updated",this.activeListeners.camera),this}},{key:"getNodeAtPosition",value:function(i){var r=i.x,o=i.y,a=Vr(this.webGLContexts.nodes,this.frameBuffers.nodes,r,o,this.pixelRatio,this.pickingDownSizingRatio),s=qr.apply(void 0,so(a)),u=this.itemIDsIndex[s];return u&&u.type==="node"?u.id:null}},{key:"bindEventHandlers",value:function(){var i=this;this.activeListeners.handleResize=function(){i.scheduleRefresh()},window.addEventListener("resize",this.activeListeners.handleResize),this.activeListeners.handleMove=function(o){var a=Ot(o),s={event:a,preventSigmaDefault:function(){a.preventSigmaDefault()}},u=i.getNodeAtPosition(a);if(u&&i.hoveredNode!==u&&!i.nodeDataCache[u].hidden){i.hoveredNode&&i.emit("leaveNode",W(W({},s),{},{node:i.hoveredNode})),i.hoveredNode=u,i.emit("enterNode",W(W({},s),{},{node:u})),i.scheduleHighlightedNodesRender();return}if(i.hoveredNode&&i.getNodeAtPosition(a)!==i.hoveredNode){var l=i.hoveredNode;i.hoveredNode=null,i.emit("leaveNode",W(W({},s),{},{node:l})),i.scheduleHighlightedNodesRender();return}if(i.settings.enableEdgeEvents){var c=i.hoveredNode?null:i.getEdgeAtPoint(s.event.x,s.event.y);c!==i.hoveredEdge&&(i.hoveredEdge&&i.emit("leaveEdge",W(W({},s),{},{edge:i.hoveredEdge})),c&&i.emit("enterEdge",W(W({},s),{},{edge:c})),i.hoveredEdge=c)}},this.activeListeners.handleMoveBody=function(o){var a=Ot(o);i.emit("moveBody",{event:a,preventSigmaDefault:function(){a.preventSigmaDefault()}})},this.activeListeners.handleLeave=function(o){var a=Ot(o),s={event:a,preventSigmaDefault:function(){a.preventSigmaDefault()}};i.hoveredNode&&(i.emit("leaveNode",W(W({},s),{},{node:i.hoveredNode})),i.scheduleHighlightedNodesRender()),i.settings.enableEdgeEvents&&i.hoveredEdge&&(i.emit("leaveEdge",W(W({},s),{},{edge:i.hoveredEdge})),i.scheduleHighlightedNodesRender()),i.emit("leaveStage",W({},s))},this.activeListeners.handleEnter=function(o){var a=Ot(o),s={event:a,preventSigmaDefault:function(){a.preventSigmaDefault()}};i.emit("enterStage",W({},s))};var r=function(a){return function(s){var u=Ot(s),l={event:u,preventSigmaDefault:function(){u.preventSigmaDefault()}},c=i.getNodeAtPosition(u);if(c)return i.emit("".concat(a,"Node"),W(W({},l),{},{node:c}));if(i.settings.enableEdgeEvents){var d=i.getEdgeAtPoint(u.x,u.y);if(d)return i.emit("".concat(a,"Edge"),W(W({},l),{},{edge:d}))}return i.emit("".concat(a,"Stage"),l)}};return this.activeListeners.handleClick=r("click"),this.activeListeners.handleRightClick=r("rightClick"),this.activeListeners.handleDoubleClick=r("doubleClick"),this.activeListeners.handleWheel=r("wheel"),this.activeListeners.handleDown=r("down"),this.activeListeners.handleUp=r("up"),this.mouseCaptor.on("mousemove",this.activeListeners.handleMove),this.mouseCaptor.on("mousemovebody",this.activeListeners.handleMoveBody),this.mouseCaptor.on("click",this.activeListeners.handleClick),this.mouseCaptor.on("rightClick",this.activeListeners.handleRightClick),this.mouseCaptor.on("doubleClick",this.activeListeners.handleDoubleClick),this.mouseCaptor.on("wheel",this.activeListeners.handleWheel),this.mouseCaptor.on("mousedown",this.activeListeners.handleDown),this.mouseCaptor.on("mouseup",this.activeListeners.handleUp),this.mouseCaptor.on("mouseleave",this.activeListeners.handleLeave),this.mouseCaptor.on("mouseenter",this.activeListeners.handleEnter),this.touchCaptor.on("touchdown",this.activeListeners.handleDown),this.touchCaptor.on("touchdown",this.activeListeners.handleMove),this.touchCaptor.on("touchup",this.activeListeners.handleUp),this.touchCaptor.on("touchmove",this.activeListeners.handleMove),this.touchCaptor.on("tap",this.activeListeners.handleClick),this.touchCaptor.on("doubletap",this.activeListeners.handleDoubleClick),this.touchCaptor.on("touchmove",this.activeListeners.handleMoveBody),this}},{key:"bindGraphHandlers",value:function(){var i=this,r=this.graph,o=new Set(["x","y","zIndex","type"]);return this.activeListeners.eachNodeAttributesUpdatedGraphUpdate=function(a){var s,u=(s=a.hints)===null||s===void 0?void 0:s.attributes;i.graph.forEachNode(function(c){return i.updateNode(c)});var l=!u||u.some(function(c){return o.has(c)});i.refresh({partialGraph:{nodes:r.nodes()},skipIndexation:!l,schedule:!0})},this.activeListeners.eachEdgeAttributesUpdatedGraphUpdate=function(a){var s,u=(s=a.hints)===null||s===void 0?void 0:s.attributes;i.graph.forEachEdge(function(c){return i.updateEdge(c)});var l=u&&["zIndex","type"].some(function(c){return u==null?void 0:u.includes(c)});i.refresh({partialGraph:{edges:r.edges()},skipIndexation:!l,schedule:!0})},this.activeListeners.addNodeGraphUpdate=function(a){var s=a.key;i.addNode(s),i.refresh({partialGraph:{nodes:[s]},skipIndexation:!1,schedule:!0})},this.activeListeners.updateNodeGraphUpdate=function(a){var s=a.key;i.refresh({partialGraph:{nodes:[s]},skipIndexation:!1,schedule:!0})},this.activeListeners.dropNodeGraphUpdate=function(a){var s=a.key;i.removeNode(s),i.refresh({schedule:!0})},this.activeListeners.addEdgeGraphUpdate=function(a){var s=a.key;i.addEdge(s),i.refresh({partialGraph:{edges:[s]},schedule:!0})},this.activeListeners.updateEdgeGraphUpdate=function(a){var s=a.key;i.refresh({partialGraph:{edges:[s]},skipIndexation:!1,schedule:!0})},this.activeListeners.dropEdgeGraphUpdate=function(a){var s=a.key;i.removeEdge(s),i.refresh({schedule:!0})},this.activeListeners.clearEdgesGraphUpdate=function(){i.clearEdgeState(),i.clearEdgeIndices(),i.refresh({schedule:!0})},this.activeListeners.clearGraphUpdate=function(){i.clearEdgeState(),i.clearNodeState(),i.clearEdgeIndices(),i.clearNodeIndices(),i.refresh({schedule:!0})},r.on("nodeAdded",this.activeListeners.addNodeGraphUpdate),r.on("nodeDropped",this.activeListeners.dropNodeGraphUpdate),r.on("nodeAttributesUpdated",this.activeListeners.updateNodeGraphUpdate),r.on("eachNodeAttributesUpdated",this.activeListeners.eachNodeAttributesUpdatedGraphUpdate),r.on("edgeAdded",this.activeListeners.addEdgeGraphUpdate),r.on("edgeDropped",this.activeListeners.dropEdgeGraphUpdate),r.on("edgeAttributesUpdated",this.activeListeners.updateEdgeGraphUpdate),r.on("eachEdgeAttributesUpdated",this.activeListeners.eachEdgeAttributesUpdatedGraphUpdate),r.on("edgesCleared",this.activeListeners.clearEdgesGraphUpdate),r.on("cleared",this.activeListeners.clearGraphUpdate),this}},{key:"unbindGraphHandlers",value:function(){var i=this.graph;i.removeListener("nodeAdded",this.activeListeners.addNodeGraphUpdate),i.removeListener("nodeDropped",this.activeListeners.dropNodeGraphUpdate),i.removeListener("nodeAttributesUpdated",this.activeListeners.updateNodeGraphUpdate),i.removeListener("eachNodeAttributesUpdated",this.activeListeners.eachNodeAttributesUpdatedGraphUpdate),i.removeListener("edgeAdded",this.activeListeners.addEdgeGraphUpdate),i.removeListener("edgeDropped",this.activeListeners.dropEdgeGraphUpdate),i.removeListener("edgeAttributesUpdated",this.activeListeners.updateEdgeGraphUpdate),i.removeListener("eachEdgeAttributesUpdated",this.activeListeners.eachEdgeAttributesUpdatedGraphUpdate),i.removeListener("edgesCleared",this.activeListeners.clearEdgesGraphUpdate),i.removeListener("cleared",this.activeListeners.clearGraphUpdate)}},{key:"getEdgeAtPoint",value:function(i,r){var o=Vr(this.webGLContexts.edges,this.frameBuffers.edges,i,r,this.pixelRatio,this.pickingDownSizingRatio),a=qr.apply(void 0,so(o)),s=this.itemIDsIndex[a];return s&&s.type==="edge"?s.id:null}},{key:"process",value:function(){var i=this;this.emit("beforeProcess");var r=this.graph,o=this.settings,a=this.getDimensions();if(this.nodeExtent=kf(this.graph),!this.settings.autoRescale){var s=a.width,u=a.height,l=this.nodeExtent,c=l.x,d=l.y;this.nodeExtent={x:[(c[0]+c[1])/2-s/2,(c[0]+c[1])/2+s/2],y:[(d[0]+d[1])/2-u/2,(d[0]+d[1])/2+u/2]}}this.normalizationFunction=ro(this.customBBox||this.nodeExtent);var h=new ao,f=Bt(h.getState(),a,this.getGraphDimensions(),this.getStagePadding());this.labelGrid.resizeAndClear(a,o.labelGridCellSize);for(var g={},v={},x={},C={},b=1,w=r.nodes(),m=0,y=w.length;m<y;m++){var _=w[m],A=this.nodeDataCache[_],F=r.getNodeAttributes(_);A.x=F.x,A.y=F.y,this.normalizationFunction.applyTo(A),typeof A.label=="string"&&!A.hidden&&this.labelGrid.add(_,A.size,this.framedGraphToViewport(A,{matrix:f})),g[A.type]=(g[A.type]||0)+1}this.labelGrid.organize();for(var B in this.nodePrograms){if(!Je.call(this.nodePrograms,B))throw new Error('Sigma: could not find a suitable program for node type "'.concat(B,'"!'));this.nodePrograms[B].reallocate(g[B]||0),g[B]=0}this.settings.zIndex&&this.nodeZExtent[0]!==this.nodeZExtent[1]&&(w=io(this.nodeZExtent,function(ge){return i.nodeDataCache[ge].zIndex},w));for(var z=0,D=w.length;z<D;z++){var q=w[z];v[q]=b,C[v[q]]={type:"node",id:q},b++;var P=this.nodeDataCache[q];this.addNodeToProgram(q,v[q],g[P.type]++)}for(var V={},oe=r.edges(),ce=0,pe=oe.length;ce<pe;ce++){var fe=oe[ce],ae=this.edgeDataCache[fe];V[ae.type]=(V[ae.type]||0)+1}this.settings.zIndex&&this.edgeZExtent[0]!==this.edgeZExtent[1]&&(oe=io(this.edgeZExtent,function(ge){return i.edgeDataCache[ge].zIndex},oe));for(var re in this.edgePrograms){if(!Je.call(this.edgePrograms,re))throw new Error('Sigma: could not find a suitable program for edge type "'.concat(re,'"!'));this.edgePrograms[re].reallocate(V[re]||0),V[re]=0}for(var ie=0,se=oe.length;ie<se;ie++){var ee=oe[ie];x[ee]=b,C[x[ee]]={type:"edge",id:ee},b++;var De=this.edgeDataCache[ee];this.addEdgeToProgram(ee,x[ee],V[De.type]++)}return this.itemIDsIndex=C,this.nodeIndices=v,this.edgeIndices=x,this.emit("afterProcess"),this}},{key:"handleSettingsUpdate",value:function(i){var r=this,o=this.settings;if(this.camera.minRatio=o.minCameraRatio,this.camera.maxRatio=o.maxCameraRatio,this.camera.enabledZooming=o.enableCameraZooming,this.camera.enabledPanning=o.enableCameraPanning,this.camera.enabledRotation=o.enableCameraRotation,o.cameraPanBoundaries?this.camera.clean=function(c){return r.cleanCameraState(c,o.cameraPanBoundaries&&Ri(o.cameraPanBoundaries)==="object"?o.cameraPanBoundaries:{})}:this.camera.clean=null,this.camera.setState(this.camera.validateState(this.camera.getState())),i){if(i.edgeProgramClasses!==o.edgeProgramClasses){for(var a in o.edgeProgramClasses)o.edgeProgramClasses[a]!==i.edgeProgramClasses[a]&&this.registerEdgeProgram(a,o.edgeProgramClasses[a]);for(var s in i.edgeProgramClasses)o.edgeProgramClasses[s]||this.unregisterEdgeProgram(s)}if(i.nodeProgramClasses!==o.nodeProgramClasses||i.nodeHoverProgramClasses!==o.nodeHoverProgramClasses){for(var u in o.nodeProgramClasses)(o.nodeProgramClasses[u]!==i.nodeProgramClasses[u]||o.nodeHoverProgramClasses[u]!==i.nodeHoverProgramClasses[u])&&this.registerNodeProgram(u,o.nodeProgramClasses[u],o.nodeHoverProgramClasses[u]);for(var l in i.nodeProgramClasses)o.nodeProgramClasses[l]||this.unregisterNodeProgram(l)}}return this.mouseCaptor.setSettings(this.settings),this.touchCaptor.setSettings(this.settings),this}},{key:"cleanCameraState",value:function(i){var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},o=r.tolerance,a=o===void 0?0:o,s=r.boundaries,u=W({},i),l=s||this.nodeExtent,c=Lt(l.x,2),d=c[0],h=c[1],f=Lt(l.y,2),g=f[0],v=f[1],x=[this.graphToViewport({x:d,y:g},{cameraState:i}),this.graphToViewport({x:h,y:g},{cameraState:i}),this.graphToViewport({x:d,y:v},{cameraState:i}),this.graphToViewport({x:h,y:v},{cameraState:i})],C=1/0,b=-1/0,w=1/0,m=-1/0;x.forEach(function(V){var oe=V.x,ce=V.y;C=Math.min(C,oe),b=Math.max(b,oe),w=Math.min(w,ce),m=Math.max(m,ce)});var y=b-C,_=m-w,A=this.getDimensions(),F=A.width,B=A.height,z=0,D=0;if(y>=F?b<F-a?z=b-(F-a):C>a&&(z=C-a):b>F+a?z=b-(F+a):C<-a&&(z=C+a),_>=B?m<B-a?D=m-(B-a):w>a&&(D=w-a):m>B+a?D=m-(B+a):w<-a&&(D=w+a),z||D){var q=this.viewportToFramedGraph({x:0,y:0},{cameraState:i}),P=this.viewportToFramedGraph({x:z,y:D},{cameraState:i});z=P.x-q.x,D=P.y-q.y,u.x+=z,u.y+=D}return u}},{key:"renderLabels",value:function(){if(!this.settings.renderLabels)return this;var i=this.camera.getState(),r=this.labelGrid.getLabelsToDisplay(i.ratio,this.settings.labelDensity);oo(r,this.nodesWithForcedLabels),this.displayedNodeLabels=new Set;for(var o=this.canvasContexts.labels,a=0,s=r.length;a<s;a++){var u=r[a],l=this.nodeDataCache[u];if(!this.displayedNodeLabels.has(u)&&!l.hidden){var c=this.framedGraphToViewport(l),d=c.x,h=c.y,f=this.scaleSize(l.size);if(!(!l.forceLabel&&f<this.settings.labelRenderedSizeThreshold)&&!(d<-150||d>this.width+qf||h<-50||h>this.height+Vf)){this.displayedNodeLabels.add(u);var g=this.settings.defaultDrawNodeLabel,v=this.nodePrograms[l.type],x=(v==null?void 0:v.drawLabel)||g;x(o,W(W({key:u},l),{},{size:f,x:d,y:h}),this.settings)}}}return this}},{key:"renderEdgeLabels",value:function(){if(!this.settings.renderEdgeLabels)return this;var i=this.canvasContexts.edgeLabels;i.clearRect(0,0,this.width,this.height);var r=Hf({graph:this.graph,hoveredNode:this.hoveredNode,displayedNodeLabels:this.displayedNodeLabels,highlightedNodes:this.highlightedNodes});oo(r,this.edgesWithForcedLabels);for(var o=new Set,a=0,s=r.length;a<s;a++){var u=r[a],l=this.graph.extremities(u),c=this.nodeDataCache[l[0]],d=this.nodeDataCache[l[1]],h=this.edgeDataCache[u];if(!o.has(u)&&!(h.hidden||c.hidden||d.hidden)){var f=this.settings.defaultDrawEdgeLabel,g=this.edgePrograms[h.type],v=(g==null?void 0:g.drawLabel)||f;v(i,W(W({key:u},h),{},{size:this.scaleSize(h.size)}),W(W(W({key:l[0]},c),this.framedGraphToViewport(c)),{},{size:this.scaleSize(c.size)}),W(W(W({key:l[1]},d),this.framedGraphToViewport(d)),{},{size:this.scaleSize(d.size)}),this.settings),o.add(u)}}return this.displayedEdgeLabels=o,this}},{key:"renderHighlightedNodes",value:function(){var i=this,r=this.canvasContexts.hovers;r.clearRect(0,0,this.width,this.height);var o=function(f){var g=i.nodeDataCache[f],v=i.framedGraphToViewport(g),x=v.x,C=v.y,b=i.scaleSize(g.size),w=i.settings.defaultDrawNodeHover,m=i.nodePrograms[g.type],y=(m==null?void 0:m.drawHover)||w;y(r,W(W({key:f},g),{},{size:b,x,y:C}),i.settings)},a=[];this.hoveredNode&&!this.nodeDataCache[this.hoveredNode].hidden&&a.push(this.hoveredNode),this.highlightedNodes.forEach(function(h){h!==i.hoveredNode&&a.push(h)}),a.forEach(function(h){return o(h)});var s={};a.forEach(function(h){var f=i.nodeDataCache[h].type;s[f]=(s[f]||0)+1});for(var u in this.nodeHoverPrograms)this.nodeHoverPrograms[u].reallocate(s[u]||0),s[u]=0;a.forEach(function(h){var f=i.nodeDataCache[h];i.nodeHoverPrograms[f.type].process(0,s[f.type]++,f)}),this.webGLContexts.hoverNodes.clear(this.webGLContexts.hoverNodes.COLOR_BUFFER_BIT);var l=this.getRenderParams();for(var c in this.nodeHoverPrograms){var d=this.nodeHoverPrograms[c];d.render(l)}}},{key:"scheduleHighlightedNodesRender",value:function(){var i=this;this.renderHighlightedNodesFrame||this.renderFrame||(this.renderHighlightedNodesFrame=requestAnimationFrame(function(){i.renderHighlightedNodesFrame=null,i.renderHighlightedNodes(),i.renderEdgeLabels()}))}},{key:"render",value:function(){var i=this;this.emit("beforeRender");var r=function(){return i.emit("afterRender"),i};if(this.renderFrame&&(cancelAnimationFrame(this.renderFrame),this.renderFrame=null),this.resize(),this.needToProcess&&this.process(),this.needToProcess=!1,this.clear(),this.pickingLayers.forEach(function(x){return i.resetWebGLTexture(x)}),!this.graph.order)return r();var o=this.mouseCaptor,a=this.camera.isAnimated()||o.isMoving||o.draggedEvents||o.currentWheelDirection,s=this.camera.getState(),u=this.getDimensions(),l=this.getGraphDimensions(),c=this.getStagePadding();this.matrix=Bt(s,u,l,c),this.invMatrix=Bt(s,u,l,c,!0),this.correctionRatio=Cf(this.matrix,s,u),this.graphToViewportRatio=this.getGraphToViewportRatio();var d=this.getRenderParams();for(var h in this.nodePrograms){var f=this.nodePrograms[h];f.render(d)}if(!this.settings.hideEdgesOnMove||!a)for(var g in this.edgePrograms){var v=this.edgePrograms[g];v.render(d)}return this.settings.hideLabelsOnMove&&a||(this.renderLabels(),this.renderEdgeLabels(),this.renderHighlightedNodes()),r()}},{key:"addNode",value:function(i){var r=Object.assign({},this.graph.getNodeAttributes(i));this.settings.nodeReducer&&(r=this.settings.nodeReducer(i,r));var o=Wf(this.settings,i,r);this.nodeDataCache[i]=o,this.nodesWithForcedLabels.delete(i),o.forceLabel&&!o.hidden&&this.nodesWithForcedLabels.add(i),this.highlightedNodes.delete(i),o.highlighted&&!o.hidden&&this.highlightedNodes.add(i),this.settings.zIndex&&(o.zIndex<this.nodeZExtent[0]&&(this.nodeZExtent[0]=o.zIndex),o.zIndex>this.nodeZExtent[1]&&(this.nodeZExtent[1]=o.zIndex))}},{key:"updateNode",value:function(i){this.addNode(i);var r=this.nodeDataCache[i];this.normalizationFunction.applyTo(r)}},{key:"removeNode",value:function(i){delete this.nodeDataCache[i],delete this.nodeProgramIndex[i],this.highlightedNodes.delete(i),this.hoveredNode===i&&(this.hoveredNode=null),this.nodesWithForcedLabels.delete(i)}},{key:"addEdge",value:function(i){var r=Object.assign({},this.graph.getEdgeAttributes(i));this.settings.edgeReducer&&(r=this.settings.edgeReducer(i,r));var o=jf(this.settings,i,r);this.edgeDataCache[i]=o,this.edgesWithForcedLabels.delete(i),o.forceLabel&&!o.hidden&&this.edgesWithForcedLabels.add(i),this.settings.zIndex&&(o.zIndex<this.edgeZExtent[0]&&(this.edgeZExtent[0]=o.zIndex),o.zIndex>this.edgeZExtent[1]&&(this.edgeZExtent[1]=o.zIndex))}},{key:"updateEdge",value:function(i){this.addEdge(i)}},{key:"removeEdge",value:function(i){delete this.edgeDataCache[i],delete this.edgeProgramIndex[i],this.hoveredEdge===i&&(this.hoveredEdge=null),this.edgesWithForcedLabels.delete(i)}},{key:"clearNodeIndices",value:function(){this.labelGrid=new lo,this.nodeExtent={x:[0,1],y:[0,1]},this.nodeDataCache={},this.edgeProgramIndex={},this.nodesWithForcedLabels=new Set,this.nodeZExtent=[1/0,-1/0],this.highlightedNodes=new Set}},{key:"clearEdgeIndices",value:function(){this.edgeDataCache={},this.edgeProgramIndex={},this.edgesWithForcedLabels=new Set,this.edgeZExtent=[1/0,-1/0]}},{key:"clearIndices",value:function(){this.clearEdgeIndices(),this.clearNodeIndices()}},{key:"clearNodeState",value:function(){this.displayedNodeLabels=new Set,this.highlightedNodes=new Set,this.hoveredNode=null}},{key:"clearEdgeState",value:function(){this.displayedEdgeLabels=new Set,this.highlightedNodes=new Set,this.hoveredEdge=null}},{key:"clearState",value:function(){this.clearEdgeState(),this.clearNodeState()}},{key:"addNodeToProgram",value:function(i,r,o){var a=this.nodeDataCache[i],s=this.nodePrograms[a.type];if(!s)throw new Error('Sigma: could not find a suitable program for node type "'.concat(a.type,'"!'));s.process(r,o,a),this.nodeProgramIndex[i]=o}},{key:"addEdgeToProgram",value:function(i,r,o){var a=this.edgeDataCache[i],s=this.edgePrograms[a.type];if(!s)throw new Error('Sigma: could not find a suitable program for edge type "'.concat(a.type,'"!'));var u=this.graph.extremities(i),l=this.nodeDataCache[u[0]],c=this.nodeDataCache[u[1]];s.process(r,o,l,c,a),this.edgeProgramIndex[i]=o}},{key:"getRenderParams",value:function(){return{matrix:this.matrix,invMatrix:this.invMatrix,width:this.width,height:this.height,pixelRatio:this.pixelRatio,zoomRatio:this.camera.ratio,cameraAngle:this.camera.angle,sizeRatio:1/this.scaleSize(),correctionRatio:this.correctionRatio,downSizingRatio:this.pickingDownSizingRatio,minEdgeThickness:this.settings.minEdgeThickness,antiAliasingFeather:this.settings.antiAliasingFeather}}},{key:"getStagePadding",value:function(){var i=this.settings,r=i.stagePadding,o=i.autoRescale;return o&&r||0}},{key:"createLayer",value:function(i,r){var o=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};if(this.elements[i])throw new Error('Sigma: a layer named "'.concat(i,'" already exists'));var a=Af(r,{position:"absolute"},{class:"sigma-".concat(i)});return o.style&&Object.assign(a.style,o.style),this.elements[i]=a,"beforeLayer"in o&&o.beforeLayer?this.elements[o.beforeLayer].before(a):"afterLayer"in o&&o.afterLayer?this.elements[o.afterLayer].after(a):this.container.appendChild(a),a}},{key:"createCanvas",value:function(i){var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return this.createLayer(i,"canvas",r)}},{key:"createCanvasContext",value:function(i){var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},o=this.createCanvas(i,r),a={preserveDrawingBuffer:!1,antialias:!1};return this.canvasContexts[i]=o.getContext("2d",a),this}},{key:"createWebGLContext",value:function(i){var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},o=(r==null?void 0:r.canvas)||this.createCanvas(i,r);r.hidden&&o.remove();var a=W({preserveDrawingBuffer:!1,antialias:!1},r),s;s=o.getContext("webgl2",a),s||(s=o.getContext("webgl",a)),s||(s=o.getContext("experimental-webgl",a));var u=s;if(this.webGLContexts[i]=u,u.blendFunc(u.ONE,u.ONE_MINUS_SRC_ALPHA),r.picking){this.pickingLayers.add(i);var l=u.createFramebuffer();if(!l)throw new Error("Sigma: cannot create a new frame buffer for layer ".concat(i));this.frameBuffers[i]=l}return u}},{key:"killLayer",value:function(i){var r=this.elements[i];if(!r)throw new Error("Sigma: cannot kill layer ".concat(i,", which does not exist"));if(this.webGLContexts[i]){var o,a=this.webGLContexts[i];(o=a.getExtension("WEBGL_lose_context"))===null||o===void 0||o.loseContext(),delete this.webGLContexts[i]}else this.canvasContexts[i]&&delete this.canvasContexts[i];return r.remove(),delete this.elements[i],this}},{key:"getCamera",value:function(){return this.camera}},{key:"setCamera",value:function(i){this.unbindCameraHandlers(),this.camera=i,this.bindCameraHandlers()}},{key:"getContainer",value:function(){return this.container}},{key:"getGraph",value:function(){return this.graph}},{key:"setGraph",value:function(i){i!==this.graph&&(this.hoveredNode&&!i.hasNode(this.hoveredNode)&&(this.hoveredNode=null),this.hoveredEdge&&!i.hasEdge(this.hoveredEdge)&&(this.hoveredEdge=null),this.unbindGraphHandlers(),this.checkEdgesEventsFrame!==null&&(cancelAnimationFrame(this.checkEdgesEventsFrame),this.checkEdgesEventsFrame=null),this.graph=i,this.bindGraphHandlers(),this.refresh())}},{key:"getMouseCaptor",value:function(){return this.mouseCaptor}},{key:"getTouchCaptor",value:function(){return this.touchCaptor}},{key:"getDimensions",value:function(){return{width:this.width,height:this.height}}},{key:"getGraphDimensions",value:function(){var i=this.customBBox||this.nodeExtent;return{width:i.x[1]-i.x[0]||1,height:i.y[1]-i.y[0]||1}}},{key:"getNodeDisplayData",value:function(i){var r=this.nodeDataCache[i];return r?Object.assign({},r):void 0}},{key:"getEdgeDisplayData",value:function(i){var r=this.edgeDataCache[i];return r?Object.assign({},r):void 0}},{key:"getNodeDisplayedLabels",value:function(){return new Set(this.displayedNodeLabels)}},{key:"getEdgeDisplayedLabels",value:function(){return new Set(this.displayedEdgeLabels)}},{key:"getSettings",value:function(){return W({},this.settings)}},{key:"getSetting",value:function(i){return this.settings[i]}},{key:"setSetting",value:function(i,r){var o=W({},this.settings);return this.settings[i]=r,di(this.settings),this.handleSettingsUpdate(o),this.scheduleRefresh(),this}},{key:"updateSetting",value:function(i,r){return this.setSetting(i,r(this.settings[i])),this}},{key:"setSettings",value:function(i){var r=W({},this.settings);return this.settings=W(W({},this.settings),i),di(this.settings),this.handleSettingsUpdate(r),this.scheduleRefresh(),this}},{key:"resize",value:function(i){var r=this.width,o=this.height;if(this.width=this.container.offsetWidth,this.height=this.container.offsetHeight,this.pixelRatio=no(),this.width===0)if(this.settings.allowInvalidContainer)this.width=1;else throw new Error("Sigma: Container has no width. You can set the allowInvalidContainer setting to true to stop seeing this error.");if(this.height===0)if(this.settings.allowInvalidContainer)this.height=1;else throw new Error("Sigma: Container has no height. You can set the allowInvalidContainer setting to true to stop seeing this error.");if(!i&&r===this.width&&o===this.height)return this;for(var a in this.elements){var s=this.elements[a];s.style.width=this.width+"px",s.style.height=this.height+"px"}for(var u in this.canvasContexts)this.elements[u].setAttribute("width",this.width*this.pixelRatio+"px"),this.elements[u].setAttribute("height",this.height*this.pixelRatio+"px"),this.pixelRatio!==1&&this.canvasContexts[u].scale(this.pixelRatio,this.pixelRatio);for(var l in this.webGLContexts){this.elements[l].setAttribute("width",this.width*this.pixelRatio+"px"),this.elements[l].setAttribute("height",this.height*this.pixelRatio+"px");var c=this.webGLContexts[l];if(c.viewport(0,0,this.width*this.pixelRatio,this.height*this.pixelRatio),this.pickingLayers.has(l)){var d=this.textures[l];d&&c.deleteTexture(d)}}return this.emit("resize"),this}},{key:"clear",value:function(){return this.emit("beforeClear"),this.webGLContexts.nodes.bindFramebuffer(WebGLRenderingContext.FRAMEBUFFER,null),this.webGLContexts.nodes.clear(WebGLRenderingContext.COLOR_BUFFER_BIT),this.webGLContexts.edges.bindFramebuffer(WebGLRenderingContext.FRAMEBUFFER,null),this.webGLContexts.edges.clear(WebGLRenderingContext.COLOR_BUFFER_BIT),this.webGLContexts.hoverNodes.clear(WebGLRenderingContext.COLOR_BUFFER_BIT),this.canvasContexts.labels.clearRect(0,0,this.width,this.height),this.canvasContexts.hovers.clearRect(0,0,this.width,this.height),this.canvasContexts.edgeLabels.clearRect(0,0,this.width,this.height),this.emit("afterClear"),this}},{key:"refresh",value:function(i){var r=this,o=(i==null?void 0:i.skipIndexation)!==void 0?i==null?void 0:i.skipIndexation:!1,a=(i==null?void 0:i.schedule)!==void 0?i.schedule:!1,s=!i||!i.partialGraph;if(s)this.clearEdgeIndices(),this.clearNodeIndices(),this.graph.forEachNode(function(m){return r.addNode(m)}),this.graph.forEachEdge(function(m){return r.addEdge(m)});else{for(var u,l,c=((u=i.partialGraph)===null||u===void 0?void 0:u.nodes)||[],d=0,h=(c==null?void 0:c.length)||0;d<h;d++){var f=c[d];if(this.updateNode(f),o){var g=this.nodeProgramIndex[f];if(g===void 0)throw new Error('Sigma: node "'.concat(f,`" can't be repaint`));this.addNodeToProgram(f,this.nodeIndices[f],g)}}for(var v=(i==null||(l=i.partialGraph)===null||l===void 0?void 0:l.edges)||[],x=0,C=v.length;x<C;x++){var b=v[x];if(this.updateEdge(b),o){var w=this.edgeProgramIndex[b];if(w===void 0)throw new Error('Sigma: edge "'.concat(b,`" can't be repaint`));this.addEdgeToProgram(b,this.edgeIndices[b],w)}}}return(s||!o)&&(this.needToProcess=!0),a?this.scheduleRender():this.render(),this}},{key:"scheduleRender",value:function(){var i=this;return this.renderFrame||(this.renderFrame=requestAnimationFrame(function(){i.render()})),this}},{key:"scheduleRefresh",value:function(i){return this.refresh(W(W({},i),{},{schedule:!0}))}},{key:"getViewportZoomedState",value:function(i,r){var o=this.camera.getState(),a=o.ratio,s=o.angle,u=o.x,l=o.y,c=this.settings,d=c.minCameraRatio,h=c.maxCameraRatio;typeof h=="number"&&(r=Math.min(r,h)),typeof d=="number"&&(r=Math.max(r,d));var f=r/a,g={x:this.width/2,y:this.height/2},v=this.viewportToFramedGraph(i),x=this.viewportToFramedGraph(g);return{angle:s,x:(v.x-x.x)*(1-f)+u,y:(v.y-x.y)*(1-f)+l,ratio:r}}},{key:"viewRectangle",value:function(){var i=this.viewportToFramedGraph({x:0,y:0}),r=this.viewportToFramedGraph({x:this.width,y:0}),o=this.viewportToFramedGraph({x:0,y:this.height});return{x1:i.x,y1:i.y,x2:r.x,y2:r.y,height:r.y-o.y}}},{key:"framedGraphToViewport",value:function(i){var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},o=!!r.cameraState||!!r.viewportDimensions||!!r.graphDimensions,a=r.matrix?r.matrix:o?Bt(r.cameraState||this.camera.getState(),r.viewportDimensions||this.getDimensions(),r.graphDimensions||this.getGraphDimensions(),r.padding||this.getStagePadding()):this.matrix,s=Li(a,i);return{x:(1+s.x)*this.width/2,y:(1-s.y)*this.height/2}}},{key:"viewportToFramedGraph",value:function(i){var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},o=!!r.cameraState||!!r.viewportDimensions||!r.graphDimensions,a=r.matrix?r.matrix:o?Bt(r.cameraState||this.camera.getState(),r.viewportDimensions||this.getDimensions(),r.graphDimensions||this.getGraphDimensions(),r.padding||this.getStagePadding(),!0):this.invMatrix,s=Li(a,{x:i.x/this.width*2-1,y:1-i.y/this.height*2});return isNaN(s.x)&&(s.x=0),isNaN(s.y)&&(s.y=0),s}},{key:"viewportToGraph",value:function(i){var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return this.normalizationFunction.inverse(this.viewportToFramedGraph(i,r))}},{key:"graphToViewport",value:function(i){var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return this.framedGraphToViewport(this.normalizationFunction(i),r)}},{key:"getGraphToViewportRatio",value:function(){var i={x:0,y:0},r={x:1,y:1},o=Math.sqrt(Math.pow(i.x-r.x,2)+Math.pow(i.y-r.y,2)),a=this.graphToViewport(i),s=this.graphToViewport(r),u=Math.sqrt(Math.pow(a.x-s.x,2)+Math.pow(a.y-s.y,2));return u/o}},{key:"getBBox",value:function(){return this.nodeExtent}},{key:"getCustomBBox",value:function(){return this.customBBox}},{key:"setCustomBBox",value:function(i){return this.customBBox=i,this.scheduleRender(),this}},{key:"kill",value:function(){this.emit("kill"),this.removeAllListeners(),this.unbindCameraHandlers(),window.removeEventListener("resize",this.activeListeners.handleResize),this.mouseCaptor.kill(),this.touchCaptor.kill(),this.unbindGraphHandlers(),this.clearIndices(),this.clearState(),this.nodeDataCache={},this.edgeDataCache={},this.highlightedNodes.clear(),this.renderFrame&&(cancelAnimationFrame(this.renderFrame),this.renderFrame=null),this.renderHighlightedNodesFrame&&(cancelAnimationFrame(this.renderHighlightedNodesFrame),this.renderHighlightedNodesFrame=null);for(var i=this.container;i.firstChild;)i.removeChild(i.firstChild);for(var r in this.nodePrograms)this.nodePrograms[r].kill();for(var o in this.nodeHoverPrograms)this.nodeHoverPrograms[o].kill();for(var a in this.edgePrograms)this.edgePrograms[a].kill();this.nodePrograms={},this.nodeHoverPrograms={},this.edgePrograms={};for(var s in this.elements)this.killLayer(s);this.canvasContexts={},this.webGLContexts={},this.elements={}}},{key:"scaleSize",value:function(){var i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:1,r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:this.camera.ratio;return i/this.settings.zoomToSizeRatioFunction(r)*(this.getSetting("itemSizesReference")==="positions"?r*this.graphToViewportRatio:1)}},{key:"getCanvases",value:function(){var i={};for(var r in this.elements)this.elements[r]instanceof HTMLCanvasElement&&(i[r]=this.elements[r]);return i}}])}(Ki),Xf=Yf;function Kf(e,t){if(typeof e!="object"||!e)return e;var n=e[Symbol.toPrimitive];if(n!==void 0){var i=n.call(e,t);if(typeof i!="object")return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}function La(e){var t=Kf(e,"string");return typeof t=="symbol"?t:t+""}function Ra(e,t,n){return(t=La(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function co(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable})),n.push.apply(n,i)}return n}function Fn(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?co(Object(n),!0).forEach(function(i){Ra(e,i,n[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):co(Object(n)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(n,i))})}return e}function Zf(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function Jf(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,La(i.key),i)}}function Qf(e,t,n){return t&&Jf(e.prototype,t),Object.defineProperty(e,"prototype",{writable:!1}),e}function Gn(e){return Gn=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},Gn(e)}function Na(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(Na=function(){return!!e})()}function Ma(e){if(e===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function ep(e,t){if(t&&(typeof t=="object"||typeof t=="function"))return t;if(t!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return Ma(e)}function tp(e,t,n){return t=Gn(t),ep(e,Na()?Reflect.construct(t,n||[],Gn(e).constructor):t.apply(e,n))}function Ni(e,t){return Ni=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(n,i){return n.__proto__=i,n},Ni(e,t)}function np(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&Ni(e,t)}function Mi(e,t){(t==null||t>e.length)&&(t=e.length);for(var n=0,i=Array(t);n<t;n++)i[n]=e[n];return i}function ip(e){if(Array.isArray(e))return Mi(e)}function rp(e){if(typeof Symbol<"u"&&e[Symbol.iterator]!=null||e["@@iterator"]!=null)return Array.from(e)}function op(e,t){if(e){if(typeof e=="string")return Mi(e,t);var n={}.toString.call(e).slice(8,-1);return n==="Object"&&e.constructor&&(n=e.constructor.name),n==="Map"||n==="Set"?Array.from(e):n==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?Mi(e,t):void 0}}function ap(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function fi(e){return ip(e)||rp(e)||op(e)||ap()}function Da(e,t,n,i){var r=Math.pow(1-e,2)*t.x+2*(1-e)*e*n.x+Math.pow(e,2)*i.x,o=Math.pow(1-e,2)*t.y+2*(1-e)*e*n.y+Math.pow(e,2)*i.y;return{x:r,y:o}}function sp(e,t,n){for(var i=20,r=0,o=e,a=0;a<i;a++){var s=Da((a+1)/i,e,t,n);r+=Math.sqrt(Math.pow(o.x-s.x,2)+Math.pow(o.y-s.y,2)),o=s}return r}function up(e){var t=e.curvatureAttribute,n=e.defaultCurvature,i=e.keepLabelUpright,r=i===void 0?!0:i;return function(o,a,s,u,l){var c=l.edgeLabelSize,d=a[t]||n,h=l.edgeLabelFont,f=l.edgeLabelWeight,g=l.edgeLabelColor.attribute?a[l.edgeLabelColor.attribute]||l.edgeLabelColor.color||"#000":l.edgeLabelColor.color,v=a.label;if(v){o.fillStyle=g,o.font="".concat(f," ").concat(c,"px ").concat(h);var x=!r||s.x<u.x,C=x?s.x:u.x,b=x?s.y:u.y,w=x?u.x:s.x,m=x?u.y:s.y,y=(C+w)/2,_=(b+m)/2,A=w-C,F=m-b,B=Math.sqrt(Math.pow(A,2)+Math.pow(F,2)),z=x?1:-1,D=y+F*d*z,q=_-A*d*z,P=a.size*.7+5,V={x:q-b,y:-(D-C)},oe=Math.sqrt(Math.pow(V.x,2)+Math.pow(V.y,2)),ce={x:m-q,y:-(w-D)},pe=Math.sqrt(Math.pow(ce.x,2)+Math.pow(ce.y,2));C+=P*V.x/oe,b+=P*V.y/oe,w+=P*ce.x/pe,m+=P*ce.y/pe,D+=P*F/B,q-=P*A/B;var fe={x:D,y:q},ae={x:C,y:b},re={x:w,y:m},ie=sp(ae,fe,re);if(!(ie<s.size+u.size)){var se=o.measureText(v).width,ee=ie-s.size-u.size;if(se>ee){var De="…";for(v=v+De,se=o.measureText(v).width;se>ee&&v.length>1;)v=v.slice(0,-2)+De,se=o.measureText(v).width;if(v.length<4)return}for(var ge={},Ue=0,lt=v.length;Ue<lt;Ue++){var He=v[Ue];ge[He]||(ge[He]=o.measureText(He).width*(1+d*.35))}for(var Ae=.5-se/ie/2,nt=0,it=v.length;nt<it;nt++){var Ye=v[nt],rt=Da(Ae,ae,fe,re),$t=2*(1-Ae)*(D-C)+2*Ae*(w-D),Wn=2*(1-Ae)*(q-b)+2*Ae*(m-q),Xe=Math.atan2(Wn,$t);o.save(),o.translate(rt.x,rt.y),o.rotate(Xe),o.fillText(Ye,0,0),o.restore(),Ae+=ge[Ye]/ie}}}}}function lp(e){var t=e.arrowHead,n=(t==null?void 0:t.extremity)==="target"||(t==null?void 0:t.extremity)==="both",i=(t==null?void 0:t.extremity)==="source"||(t==null?void 0:t.extremity)==="both",r=`
precision highp float;

varying vec4 v_color;
varying float v_thickness;
varying float v_feather;
varying vec2 v_cpA;
varying vec2 v_cpB;
varying vec2 v_cpC;
`.concat(n?`
varying float v_targetSize;
varying vec2 v_targetPoint;`:"",`
`).concat(i?`
varying float v_sourceSize;
varying vec2 v_sourcePoint;`:"",`
`).concat(t?`
uniform float u_lengthToThicknessRatio;
uniform float u_widenessToThicknessRatio;`:"",`

float det(vec2 a, vec2 b) {
  return a.x * b.y - b.x * a.y;
}

vec2 getDistanceVector(vec2 b0, vec2 b1, vec2 b2) {
  float a = det(b0, b2), b = 2.0 * det(b1, b0), d = 2.0 * det(b2, b1);
  float f = b * d - a * a;
  vec2 d21 = b2 - b1, d10 = b1 - b0, d20 = b2 - b0;
  vec2 gf = 2.0 * (b * d21 + d * d10 + a * d20);
  gf = vec2(gf.y, -gf.x);
  vec2 pp = -f * gf / dot(gf, gf);
  vec2 d0p = b0 - pp;
  float ap = det(d0p, d20), bp = 2.0 * det(d10, d0p);
  float t = clamp((ap + bp) / (2.0 * a + b + d), 0.0, 1.0);
  return mix(mix(b0, b1, t), mix(b1, b2, t), t);
}

float distToQuadraticBezierCurve(vec2 p, vec2 b0, vec2 b1, vec2 b2) {
  return length(getDistanceVector(b0 - p, b1 - p, b2 - p));
}

const vec4 transparent = vec4(0.0, 0.0, 0.0, 0.0);

void main(void) {
  float dist = distToQuadraticBezierCurve(gl_FragCoord.xy, v_cpA, v_cpB, v_cpC);
  float thickness = v_thickness;
`).concat(n?`
  float distToTarget = length(gl_FragCoord.xy - v_targetPoint);
  float targetArrowLength = v_targetSize + thickness * u_lengthToThicknessRatio;
  if (distToTarget < targetArrowLength) {
    thickness = (distToTarget - v_targetSize) / (targetArrowLength - v_targetSize) * u_widenessToThicknessRatio * thickness;
  }`:"",`
`).concat(i?`
  float distToSource = length(gl_FragCoord.xy - v_sourcePoint);
  float sourceArrowLength = v_sourceSize + thickness * u_lengthToThicknessRatio;
  if (distToSource < sourceArrowLength) {
    thickness = (distToSource - v_sourceSize) / (sourceArrowLength - v_sourceSize) * u_widenessToThicknessRatio * thickness;
  }`:"",`

  float halfThickness = thickness / 2.0;
  if (dist < halfThickness) {
    #ifdef PICKING_MODE
    gl_FragColor = v_color;
    #else
    float t = smoothstep(
      halfThickness - v_feather,
      halfThickness,
      dist
    );

    gl_FragColor = mix(v_color, transparent, t);
    #endif
  } else {
    gl_FragColor = transparent;
  }
}
`);return r}function cp(e){var t=e.arrowHead,n=(t==null?void 0:t.extremity)==="target"||(t==null?void 0:t.extremity)==="both",i=(t==null?void 0:t.extremity)==="source"||(t==null?void 0:t.extremity)==="both",r=`
attribute vec4 a_id;
attribute vec4 a_color;
attribute float a_direction;
attribute float a_thickness;
attribute vec2 a_source;
attribute vec2 a_target;
attribute float a_current;
attribute float a_curvature;
`.concat(n?`attribute float a_targetSize;
`:"",`
`).concat(i?`attribute float a_sourceSize;
`:"",`

uniform mat3 u_matrix;
uniform float u_sizeRatio;
uniform float u_pixelRatio;
uniform vec2 u_dimensions;
uniform float u_minEdgeThickness;
uniform float u_feather;

varying vec4 v_color;
varying float v_thickness;
varying float v_feather;
varying vec2 v_cpA;
varying vec2 v_cpB;
varying vec2 v_cpC;
`).concat(n?`
varying float v_targetSize;
varying vec2 v_targetPoint;`:"",`
`).concat(i?`
varying float v_sourceSize;
varying vec2 v_sourcePoint;`:"",`
`).concat(t?`
uniform float u_widenessToThicknessRatio;`:"",`

const float bias = 255.0 / 254.0;
const float epsilon = 0.7;

vec2 clipspaceToViewport(vec2 pos, vec2 dimensions) {
  return vec2(
    (pos.x + 1.0) * dimensions.x / 2.0,
    (pos.y + 1.0) * dimensions.y / 2.0
  );
}

vec2 viewportToClipspace(vec2 pos, vec2 dimensions) {
  return vec2(
    pos.x / dimensions.x * 2.0 - 1.0,
    pos.y / dimensions.y * 2.0 - 1.0
  );
}

void main() {
  float minThickness = u_minEdgeThickness;

  // Selecting the correct position
  // Branchless "position = a_source if a_current == 1.0 else a_target"
  vec2 position = a_source * max(0.0, a_current) + a_target * max(0.0, 1.0 - a_current);
  position = (u_matrix * vec3(position, 1)).xy;

  vec2 source = (u_matrix * vec3(a_source, 1)).xy;
  vec2 target = (u_matrix * vec3(a_target, 1)).xy;

  vec2 viewportPosition = clipspaceToViewport(position, u_dimensions);
  vec2 viewportSource = clipspaceToViewport(source, u_dimensions);
  vec2 viewportTarget = clipspaceToViewport(target, u_dimensions);

  vec2 delta = viewportTarget.xy - viewportSource.xy;
  float len = length(delta);
  vec2 normal = vec2(-delta.y, delta.x) * a_direction;
  vec2 unitNormal = normal / len;
  float boundingBoxThickness = len * a_curvature;

  float curveThickness = max(minThickness, a_thickness / u_sizeRatio);
  v_thickness = curveThickness * u_pixelRatio;
  v_feather = u_feather;

  v_cpA = viewportSource;
  v_cpB = 0.5 * (viewportSource + viewportTarget) + unitNormal * a_direction * boundingBoxThickness;
  v_cpC = viewportTarget;

  vec2 viewportOffsetPosition = (
    viewportPosition +
    unitNormal * (boundingBoxThickness / 2.0 + sign(boundingBoxThickness) * (`).concat(t?"curveThickness * u_widenessToThicknessRatio":"curveThickness",` + epsilon)) *
    max(0.0, a_direction) // NOTE: cutting the bounding box in half to avoid overdraw
  );

  position = viewportToClipspace(viewportOffsetPosition, u_dimensions);
  gl_Position = vec4(position, 0, 1);
    
`).concat(n?`
  v_targetSize = a_targetSize * u_pixelRatio / u_sizeRatio;
  v_targetPoint = viewportTarget;
`:"",`
`).concat(i?`
  v_sourceSize = a_sourceSize * u_pixelRatio / u_sizeRatio;
  v_sourcePoint = viewportSource;
`:"",`

  #ifdef PICKING_MODE
  // For picking mode, we use the ID as the color:
  v_color = a_id;
  #else
  // For normal mode, we use the color:
  v_color = a_color;
  #endif

  v_color.a *= bias;
}
`);return r}var $a=.25,dp={arrowHead:null,curvatureAttribute:"curvature",defaultCurvature:$a},Ia=WebGLRenderingContext,ho=Ia.UNSIGNED_BYTE,ut=Ia.FLOAT;function Ji(e){var t=Fn(Fn({},dp),e||{}),n=t,i=n.arrowHead,r=n.curvatureAttribute,o=n.drawLabel,a=(i==null?void 0:i.extremity)==="target"||(i==null?void 0:i.extremity)==="both",s=(i==null?void 0:i.extremity)==="source"||(i==null?void 0:i.extremity)==="both",u=["u_matrix","u_sizeRatio","u_dimensions","u_pixelRatio","u_feather","u_minEdgeThickness"].concat(fi(i?["u_lengthToThicknessRatio","u_widenessToThicknessRatio"]:[]));return function(l){np(c,l);function c(){var d;Zf(this,c);for(var h=arguments.length,f=new Array(h),g=0;g<h;g++)f[g]=arguments[g];return d=tp(this,c,[].concat(f)),Ra(Ma(d),"drawLabel",o||up(t)),d}return Qf(c,[{key:"getDefinition",value:function(){return{VERTICES:6,VERTEX_SHADER_SOURCE:cp(t),FRAGMENT_SHADER_SOURCE:lp(t),METHOD:WebGLRenderingContext.TRIANGLES,UNIFORMS:u,ATTRIBUTES:[{name:"a_source",size:2,type:ut},{name:"a_target",size:2,type:ut}].concat(fi(a?[{name:"a_targetSize",size:1,type:ut}]:[]),fi(s?[{name:"a_sourceSize",size:1,type:ut}]:[]),[{name:"a_thickness",size:1,type:ut},{name:"a_curvature",size:1,type:ut},{name:"a_color",size:4,type:ho,normalized:!0},{name:"a_id",size:4,type:ho,normalized:!0}]),CONSTANT_ATTRIBUTES:[{name:"a_current",size:1,type:ut},{name:"a_direction",size:1,type:ut}],CONSTANT_DATA:[[0,1],[0,-1],[1,1],[0,-1],[1,1],[1,-1]]}}},{key:"processVisibleItem",value:function(h,f,g,v,x){var C,b=x.size||1,w=g.x,m=g.y,y=v.x,_=v.y,A=Dt(x.color),F=(C=x[r])!==null&&C!==void 0?C:$a,B=this.array;B[f++]=w,B[f++]=m,B[f++]=y,B[f++]=_,a&&(B[f++]=v.size),s&&(B[f++]=g.size),B[f++]=b,B[f++]=F,B[f++]=A,B[f++]=h}},{key:"setUniforms",value:function(h,f){var g=f.gl,v=f.uniformLocations,x=v.u_matrix,C=v.u_pixelRatio,b=v.u_feather,w=v.u_sizeRatio,m=v.u_dimensions,y=v.u_minEdgeThickness;if(g.uniformMatrix3fv(x,!1,h.matrix),g.uniform1f(C,h.pixelRatio),g.uniform1f(w,h.sizeRatio),g.uniform1f(b,h.antiAliasingFeather),g.uniform2f(m,h.width*h.pixelRatio,h.height*h.pixelRatio),g.uniform1f(y,h.minEdgeThickness),i){var _=v.u_lengthToThicknessRatio,A=v.u_widenessToThicknessRatio;g.uniform1f(_,i.lengthToThicknessRatio),g.uniform1f(A,i.widenessToThicknessRatio)}}}]),c}(Hn)}var hp=Ji();Ji({arrowHead:Vn});Ji({arrowHead:Fn(Fn({},Vn),{},{extremity:"both"})});function fp(){const e=document.getElementById("exportMetrics");if(!e)return;const t=window.location.pathname.split("/")[1]==="es"?"es":"en",i={es:{title:"Exportar informe",message:"Seleccione el formato de exportación:",continue:"Continuar",cancel:"Cancelar",prompt:"Pulse para continuar.",loading:"Generando informe...",pdf:"PDF",html:"HTML (próximamente...)",csv:"CSV (próximamente...)",soon:"Próximamente..."},en:{title:"Export report",message:"Select export format:",continue:"Continue",cancel:"Cancel",prompt:"Click to continue.",loading:"Generating report...",pdf:"PDF",html:"HTML (coming soon...)",csv:"CSV (coming soon...)",soon:"Coming soon..."}}[t];let r=document.getElementById("exportReportModal");r?(r.querySelector(".modal-title").textContent=i.title,r.querySelector(".modal-body").innerHTML=`
            <p>${i.message}</p>
            <div class="btn-group w-100 mb-3" role="group" aria-label="Export format">
                <input type="radio" class="btn-check" name="exportFormat" id="exportFormatPDF" value="pdf" autocomplete="off" checked>
                <label class="btn btn-outline-primary" for="exportFormatPDF">${i.pdf}</label>
                <input type="radio" class="btn-check" name="exportFormat" id="exportFormatHTML" value="html" autocomplete="off" disabled>
                <label class="btn btn-outline-secondary disabled" for="exportFormatHTML">${i.html}</label>
                <input type="radio" class="btn-check" name="exportFormat" id="exportFormatCSV" value="csv" autocomplete="off" disabled>
                <label class="btn btn-outline-secondary disabled" for="exportFormatCSV">${i.csv}</label>
            </div>
            <p>${i.prompt}</p>
        `,r.querySelector("#confirmExportReport").textContent=i.continue,r.querySelector(".btn-secondary").textContent=i.cancel):(r=document.createElement("div"),r.id="exportReportModal",r.className="modal fade",r.setAttribute("tabindex","-1"),r.innerHTML=`
            <div class="modal-dialog">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title">${i.title}</h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                    </div>
                    <div class="modal-body">
                        <p>${i.message}</p>
                        <div class="btn-group w-100 mb-3" role="group" aria-label="Export format">
                            <input type="radio" class="btn-check" name="exportFormat" id="exportFormatPDF" value="pdf" autocomplete="off" checked>
                            <label class="btn btn-outline-primary" for="exportFormatPDF">${i.pdf}</label>
                            <input type="radio" class="btn-check" name="exportFormat" id="exportFormatHTML" value="html" autocomplete="off" disabled>
                            <label class="btn btn-outline-secondary disabled" for="exportFormatHTML">${i.html}</label>
                            <input type="radio" class="btn-check" name="exportFormat" id="exportFormatCSV" value="csv" autocomplete="off" disabled>
                            <label class="btn btn-outline-secondary disabled" for="exportFormatCSV">${i.csv}</label>
                        </div>
                        <p>${i.prompt}</p>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-primary" id="confirmExportReport">${i.continue}</button>
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">${i.cancel}</button>
                    </div>
                </div>
            </div>
        `,document.body.appendChild(r)),e.addEventListener("click",function(){new bootstrap.Modal(r).show()});let o=document.getElementById("exportReportLoading");o||(o=document.createElement("div"),o.id="exportReportLoading",o.style.position="fixed",o.style.top=0,o.style.left=0,o.style.width="100vw",o.style.height="100vh",o.style.background="rgba(255,255,255,0.7)",o.style.display="none",o.style.justifyContent="center",o.style.alignItems="center",o.style.zIndex=2e3,o.innerHTML=`<div class="spinner-border text-primary" role="status"><span class="visually-hidden">${i.loading}</span></div><div style="margin-left: 1rem; font-size: 1.2rem;">${i.loading}</div>`,document.body.appendChild(o)),r.addEventListener("click",function(a){var s,u;if(a.target&&a.target.id==="confirmExportReport"){if(document.querySelector('input[name="exportFormat"]:checked').value!=="pdf")return;bootstrap.Modal.getInstance(r).hide(),o.style.display="flex";const d=(s=document.getElementById("yearFrom"))==null?void 0:s.value,h=(u=document.getElementById("yearTo"))==null?void 0:u.value;let f=[];if(window.selectedAreasList)f=Array.from(window.selectedAreasList);else{const b=document.getElementById("areaFilter");b&&(f=Array.from(b.selectedOptions).map(w=>w.value).filter(w=>w))}let g=[];if(window.selectedInstitutionsList)g=Array.from(window.selectedInstitutionsList);else{const b=document.getElementById("institutionFilter");b&&(g=Array.from(b.selectedOptions).map(w=>w.value).filter(w=>w))}let v=[];if(window.selectedTypesList)v=Array.from(window.selectedTypesList);else{const b=document.getElementById("typeFilter");b&&(v=Array.from(b.selectedOptions).map(w=>w.value).filter(w=>w))}let x=null;window.selectedAuthorName&&(x=window.selectedAuthorName);const C=new URLSearchParams;d&&C.append("year_from",d),h&&C.append("year_to",h),f.forEach(b=>C.append("areas",b)),g.forEach(b=>C.append("institutions",b)),v.forEach(b=>C.append("types",b)),x&&C.append("author",x),C.append("format","pdf"),fetch(`/api/export/report/?${C.toString()}`,{method:"GET"}).then(b=>{if(!b.ok)throw new Error("Error al generar el informe");return b.blob()}).then(b=>{const w=window.URL.createObjectURL(b),m=document.createElement("a");m.href=w,m.download="informe.pdf",document.body.appendChild(m),m.click(),m.remove(),window.URL.revokeObjectURL(w)}).catch(b=>{alert(t==="es"?"Error al generar el informe":"Error generating report")}).finally(()=>{o.style.display="none"})}})}function pp(){const e=document.getElementById("yearFrom"),t=document.getElementById("yearTo"),n=document.getElementById("areaFilter"),i=document.getElementById("institutionFilter"),r=document.getElementById("typeFilter"),o=document.getElementById("clearFilters"),a=document.getElementById("selectedAreas"),s=document.getElementById("selectedInstitutions"),u=document.getElementById("selectedTypes"),l=document.getElementById("standardSearch"),c=document.getElementById("standardSearchBtn"),d=document.getElementById("searchSuggestions"),h=document.getElementById("selectedAuthor"),f=document.getElementById("authorLimitMessage"),g=document.getElementById("clusteringModel"),v=document.getElementById("nClusters"),x=document.getElementById("nClustersValue"),C=document.getElementById("nClustersContainer"),b=document.getElementById("modelDescription");document.getElementById("applyClustering");const w=document.getElementById("rangeContainer"),m=document.getElementById("dbscanOptions"),y=document.getElementById("hdbscanOptions"),_=document.getElementById("dbscanClusters"),A=document.getElementById("hdbscanClusters"),F=document.getElementById("manualMode"),B=document.getElementById("globalBestMode"),z=document.getElementById("modelManualMode"),D=document.getElementById("modelAutoMode"),q=document.getElementById("manualConfigContainer"),P=document.getElementById("lovainaOptions"),V={kmeans:'Agrupa los datos en un número fijo de categorías (clusters) tratando de minimizar la distancia entre los puntos de cada grupo y su centroide, es decir, su "centro". Este método busca particiones compactas y bien separadas, y es especialmente útil cuando los grupos tienen forma redonda o esférica. Es rápido y eficiente, aunque sensible a la elección inicial del número de grupos (k) y a los valores extremos.',agglomerative:"Construye agrupaciones de forma jerárquica: comienza considerando cada autor como un grupo separado y va fusionando los más similares en pasos sucesivos. El resultado es una estructura en forma de árbol (dendrograma), que permite explorar diferentes niveles de agrupación según la profundidad del corte. Es útil cuando no se conoce el número exacto de grupos y se desea analizar la relación progresiva entre autores.",spectral:"Transforma la relación entre autores en una red (o grafo) de similitudes y la descompone matemáticamente para encontrar estructuras ocultas. Posteriormente, agrupa los autores en ese nuevo espacio. Es muy útil cuando las agrupaciones no tienen una forma clara o son no convexas, como anillos o cadenas, y aprovecha la conectividad global de los datos.",gmm:"Parte de la idea de que los datos provienen de una combinación de distribuciones estadísticas llamadas Gaussianas (curvas en forma de campana). En lugar de asignar cada punto a un único cluster, estima la probabilidad de que pertenezca a cada uno. Esto le permite detectar clusters superpuestos o de formas más complejas que los que detecta KMeans, siendo ideal cuando se sospecha que los datos tienen estructuras suaves o ambiguas.",dbscan:"Identifica grupos basándose en la densidad de los puntos: busca regiones donde los puntos están muy juntos y los separa de las regiones más dispersas. Es especialmente útil cuando los clusters tienen formas arbitrarias y no se conoce el número de grupos a priori. Puede identificar puntos de ruido (outliers) y no requiere especificar el número de clusters.",hdbscan:"Es una versión jerárquica de DBSCAN que puede encontrar clusters de diferentes densidades. En lugar de usar un único umbral de densidad, construye una jerarquía de clusters y luego selecciona los más significativos. Es robusto a los parámetros y puede encontrar clusters de formas arbitrarias.",lovaina:"Algoritmo de detección de comunidades que optimiza la modularidad de la red. Funciona de manera iterativa, moviendo nodos entre comunidades para maximizar la modularidad. Es especialmente efectivo para detectar comunidades en redes grandes y puede encontrar comunidades de diferentes tamaños."},oe={kmeans:'It groups the data into a fixed number of categories (clusters) trying to minimize the distance between the points of each group and its centroid, that is, its "center". This method looks for compact and well-separated partitions, and is especially useful when the clusters are round or spherical in shape. It is fast and efficient, although sensitive to the initial choice of the number of groups (k) and to extreme values.',agglomerative:"It builds groupings in a hierarchical way: it starts by considering each author as a separate group and merges the most similar ones in successive steps. The result is a tree-like structure (dendrogram), which allows exploring different levels of grouping according to the depth of the cut. It is useful when the exact number of groups is not known and it is desired to analyze the progressive relationship between authors.",spectral:"It transforms the relationship between authors into a network (or graph) of similarities and decomposes it mathematically to find hidden structures. It then clusters the authors in this new space. It is very useful when the groupings do not have a clear shape or are non-convex, such as rings or chains, and takes advantage of the global connectivity of the data.",gmm:"It starts from the idea that the data come from a combination of statistical distributions called Gaussian (bell-shaped curves). Instead of assigning each point to a single cluster, it estimates the probability that it belongs to each cluster. This allows it to detect overlapping or more complex-shaped clusters than KMeans detects, making it ideal when data are suspected of having soft or ambiguous structures.",dbscan:"Identifies groups based on the density of points: it looks for regions where points are very close together and separates them from more scattered regions. It is especially useful when clusters have arbitrary shapes and the number of groups is not known a priori. It can identify noise points (outliers) and does not require specifying the number of clusters.",hdbscan:"It is a hierarchical version of DBSCAN that can find clusters of different densities. Instead of using a single density threshold, it builds a hierarchy of clusters and then selects the most significant ones. It is robust to parameters and can find clusters of arbitrary shapes.",lovaina:"A community detection algorithm that optimizes network modularity. It works iteratively, moving nodes between communities to maximize modularity. It is especially effective for detecting communities in large networks and can find communities of different sizes."},ce={clusters:"clusters",bestConfig:"Mejor Configuración",globalBestConfig:"Mejor Configuración Global",manualConfig:"Configuración Manual",numberOfClusters:"Número de Clusters",clusteringModel:"Modelo de Clustering",apply:"Aplicar",cancel:"Cancelar",globalBestDescription:"Usa la mejor configuración de clustering encontrada entre todos los modelos y parámetros."},pe={clusters:"clusters",bestConfig:"Best Configuration",globalBestConfig:"Global Best Configuration",manualConfig:"Manual Configuration",numberOfClusters:"Number of Clusters",clusteringModel:"Clustering Model",apply:"Apply",cancel:"Cancel",globalBestDescription:"Uses the best clustering configuration found across all models and parameters."};function fe(){const p=It==="es"?ce:pe,L=It==="es"?V:oe,S={clusteringModelLabel:document.querySelector('label[for="clusteringModel"]'),nClustersLabel:document.querySelector('label[for="nClusters"]'),manualModeLabel:document.querySelector('label[for="manualMode"]'),globalBestModeLabel:document.querySelector('label[for="globalBestMode"]'),modelManualModeLabel:document.querySelector('label[for="modelManualMode"]'),modelAutoModeLabel:document.querySelector('label[for="modelAutoMode"]'),globalBestDescription:document.querySelector("#globalBestMode + .form-text"),applyButton:document.getElementById("applyClustering"),cancelButton:document.querySelector(".btn-secondary")};S.clusteringModelLabel&&(S.clusteringModelLabel.textContent=p.clusteringModel),S.nClustersLabel&&(S.nClustersLabel.textContent=p.numberOfClusters),S.manualModeLabel&&(S.manualModeLabel.textContent=p.manualConfig),S.globalBestModeLabel&&(S.globalBestModeLabel.textContent=p.globalBestConfig),S.modelManualModeLabel&&(S.modelManualModeLabel.textContent=p.manualConfig),S.modelAutoModeLabel&&(S.modelAutoModeLabel.textContent=p.bestConfig),S.globalBestDescription&&(S.globalBestDescription.textContent=p.globalBestDescription),S.applyButton&&(S.applyButton.textContent=p.apply),S.cancelButton&&(S.cancelButton.textContent=p.cancel),_&&Array.from(_.options).forEach(E=>{E.text=`${E.value} ${p.clusters}`}),A&&Array.from(A.options).forEach(E=>{E.text=`${E.value} ${p.clusters}`}),g&&b&&(b.textContent=L[g.value]||"")}g&&b&&g.addEventListener("change",function(){const p=this.value,L=It==="es"?V:oe;b.textContent=L[p]||"",p==="dbscan"?(w.classList.add("d-none"),m.classList.remove("d-none"),y.classList.add("d-none"),P.classList.add("d-none")):p==="hdbscan"?(w.classList.add("d-none"),m.classList.add("d-none"),y.classList.remove("d-none"),P.classList.add("d-none")):p==="lovaina"?(w.classList.add("d-none"),m.classList.add("d-none"),y.classList.add("d-none"),P.classList.remove("d-none")):(w.classList.remove("d-none"),m.classList.add("d-none"),y.classList.add("d-none"),P.classList.add("d-none"))}),F&&B&&q&&(F.addEventListener("change",function(){this.checked&&q.classList.remove("d-none")}),B.addEventListener("change",function(){this.checked&&q.classList.add("d-none")})),z&&D&&C&&(z.addEventListener("change",function(){this.checked&&C.classList.remove("d-none")}),D.addEventListener("change",function(){this.checked&&C.classList.add("d-none")})),v&&x&&v.addEventListener("input",function(){x.textContent=this.value});const ae=document.getElementById("clusteringModal");ae&&ae.addEventListener("show.bs.modal",function(){fe()}),document.querySelectorAll(".dropdown-item.network-community-view").forEach(p=>{p.addEventListener("click",function(L){L.preventDefault();const S=this.dataset.communityView;if(S==="keywords"){new bootstrap.Modal(document.getElementById("clusteringModal")).show();return}if(Q===S){document.querySelectorAll(".dropdown-item.network-community-view").forEach(E=>{E.classList.remove("active")}),this.classList.add("active");return}Q=S,document.querySelectorAll(".dropdown-item.network-community-view").forEach(E=>{E.classList.remove("active")}),this.classList.add("active"),an(),Xe()})});let re=new Set,ie=new Set,se=new Set,ee=null;window.selectedAreasList=re,window.selectedInstitutionsList=ie,window.selectedTypesList=se,window.selectedAuthorName=ee;let De=null;function ge(){ee?(c.classList.remove("btn-primary","btn-success"),c.classList.add("btn-secondary"),c.disabled=!0):(c.innerHTML='<i class="fas fa-search"></i>',c.classList.remove("btn-success","btn-secondary"),c.classList.add("btn-primary"),c.disabled=!1)}function Ue(p){if(!p||ee){d.style.display="none";return}fetch(`/api/search/authors/?q=${encodeURIComponent(p)}`).then(L=>L.json()).then(L=>{const S=d.querySelector(".list-group");if(S.innerHTML="",L.suggestions.length===0){d.style.display="none";return}L.suggestions.forEach(E=>{const U=document.createElement("a");U.href="#",U.className="list-group-item list-group-item-action",U.innerHTML=`
                        ${E.name}
                        <span class="badge bg-secondary float-end">${E.count} pub.</span>
                    `,U.addEventListener("click",k=>{k.preventDefault(),lt(E.name)}),S.appendChild(U)}),d.style.display="block"}).catch(L=>{console.error("Error fetching author suggestions:",L),d.style.display="none"})}function lt(p){ee=p,window.selectedAuthorName=p,l.value="",l.disabled=!0,d.style.display="none",f.style.display="block",ge(),h.innerHTML=`
            <span class="badge bg-primary me-2 mb-2">
                ${p}
                <button type="button" class="btn-close btn-close-white ms-1" 
                        style="font-size: 0.5rem; vertical-align: middle;"
                        aria-label="Remove"></button>
            </span>
        `,h.querySelector(".btn-close").addEventListener("click",()=>{ee=null,window.selectedAuthorName=null,h.innerHTML="",l.disabled=!1,f.style.display="none",ge();const te=document.getElementById("authorMetricsCard");te&&te.remove();const X=document.getElementById("networkCol");X&&(X.className="col-12"),ot()});const L=document.getElementById("collaborationRow"),S=document.createElement("div");S.id="authorMetricsCard",S.className="col-md-6 mt-3 mt-md-0 mb-10 h-100";const E=window.location.pathname.split("/")[1],U=E==="es"?"Resumen de Métricas del Autor":"Author Metrics Summary",k=E==="es"?"Métrica":"Metrics",M=E==="es"?"Valor":"Value";S.innerHTML=`
            <div class="card dashboard-card h-100">
                <div class="card-body d-flex flex-column">
                    <div class="d-flex justify-content-between align-items-center mb-3">
                        <h5 class="card-title mb-0">${U}</h5>
                    </div>
                    <div id="authorMetricsContent" class="flex-grow-1">
                        <div class="table-responsive">
                            <table class="table table-hover">
                                <thead>
                                    <tr>
                                        <th>${k}</th>
                                        <th>${M}</th>
                                    </tr>
                                </thead>
                                <tbody id="authorMetricsTable">
                                    <!-- Data will be loaded dynamically -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
        `,L.appendChild(S);const G=document.getElementById("networkCol");G&&(G.className="col-12 col-md-6 mb-10");const J=document.getElementById("pubsCol");J&&(J.className="col-12 mt-4"),fetch(`/api/author/metrics/?author_id=${encodeURIComponent(p)}`).then(te=>te.json()).then(te=>{if(te.error){console.error("Error fetching author metrics:",te.error);return}const X=document.getElementById("authorMetricsTable");if(!X)return;const ye={orcid:"ORCID",total_publications:"Total Publications",total_citations:"Total Citations",citations_wos:"WoS Citations",citations_scopus:"Scopus Citations",h_index:"H-index (WoS/Scopus)",h_index_gb:"H-index (Gesbib)",h_index_h5gb:"H5-index (Gesbib)",international_index:"International Collaboration Index"};X.innerHTML="",Object.entries(te.metrics).forEach(([T,$])=>{const H=document.createElement("tr");if(T==="orcid"&&typeof $=="string"&&$.trim()!==""){const N=$.replace(/^http:/,"https:");H.innerHTML=`
                            <td>${ye[T]}</td>
                            <td><a href="${N}" target="_blank" rel="noopener noreferrer">${N}</a></td>
                        `}else H.innerHTML=`
                            <td>${ye[T]||T}</td>
                            <td>${$}</td>
                        `;X.appendChild(H)})}).catch(te=>{console.error("Error fetching author metrics:",te)}),ot()}function He(){if(!ee&&!l.value.trim())return;c.innerHTML='<i class="fas fa-spinner fa-spin"></i>';const p=new URLSearchParams;ee?p.append("author",ee):p.append("q",l.value.trim()),fetch(`/api/search/?${p.toString()}`).then(L=>L.json()).then(L=>{c.innerHTML='<i class="fas fa-search"></i>',Ae(L.results)}).catch(L=>{console.error("Error performing search:",L),c.innerHTML='<i class="fas fa-search"></i>',alert("Error al realizar la búsqueda. Por favor, inténtelo de nuevo.")})}function Ae(p){const S=window.location.pathname.split("/")[1]==="es"?"Resultados de la búsqueda":"Search Results";let E=document.getElementById("searchResultsModal");E||(E=document.createElement("div"),E.id="searchResultsModal",E.className="modal fade",E.setAttribute("tabindex","-1"),E.innerHTML=`
                <div class="modal-dialog modal-lg">
                    <div class="modal-content">
                        <div class="modal-header">
                            <h5 class="modal-title">${S}</h5>
                            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                        </div>
                        <div class="modal-body">
                            <div id="searchResultsList"></div>
                        </div>
                    </div>
                </div>
            `,document.body.appendChild(E));const U=document.getElementById("searchResultsList");p.length===0?U.innerHTML='<p class="text-center">No se encontraron resultados.</p>':U.innerHTML=p.map(M=>`
                <div class="card mb-3">
                    <div class="card-body" data-publication-id="${M.id}" style="cursor: pointer;">
                        <h5 class="card-title">${M.title}</h5>
                        <h6 class="card-subtitle mb-2 text-muted">
                            ${M.year} - ${M.publication_type}
                        </h6>
                        <p class="card-text">
                            <strong>Autores:</strong> ${M.authors.join(", ")}<br>
                            <strong>Instituciones:</strong> ${M.institutions.join(", ")}<br>
                            <strong>Áreas:</strong> ${M.areas.join(", ")}
                        </p>
                        ${M.url?`<a href="${M.url}" class="card-link" target="_blank">Ver publicación</a>`:""}
                    </div>
                </div>
            `).join(""),U.querySelectorAll(".card-body").forEach(M=>{M.addEventListener("click",function(){const G=this.dataset.publicationId;G&&(window.location.href=`/publication/${G}/`)})}),new bootstrap.Modal(E).show()}l.addEventListener("input",function(){ee||(clearTimeout(De),De=setTimeout(()=>{Ue(this.value.trim())},300))}),l.addEventListener("focus",function(){this.value.trim()&&!ee&&Ue(this.value.trim())}),document.addEventListener("click",function(p){!p.target.closest("#standardSearch")&&!p.target.closest("#searchSuggestions")&&(d.style.display="none")}),c.addEventListener("click",He),l.addEventListener("keypress",function(p){p.key==="Enter"&&He()}),ge(),nt(),Wn();function nt(){fetch("/api/dashboard/filters/").then(p=>p.json()).then(p=>{const L=p.years.map(S=>S.year);e.min=Math.min(...L),e.max=Math.max(...L),t.min=Math.min(...L),t.max=Math.max(...L),p.areas.forEach(S=>{const E=document.createElement("option");E.value=S.name,E.textContent=`${S.name} (${S.count})`,n.appendChild(E)}),p.institutions.forEach(S=>{const E=document.createElement("option");E.value=S.name,E.textContent=`${S.name} (${S.count})`,i.appendChild(E)}),p.publication_types.forEach(S=>{const E=document.createElement("option");E.value=S.publication_type,E.textContent=`${S.publication_type} (${S.count})`,r.appendChild(E)}),Xe()}).catch(p=>console.error("Error loading filter data:",p))}function it(p,L,S){const E=document.createElement("span");E.className="badge bg-primary me-2 mb-2";const U=p.length>40?p.substring(0,40)+"...":p;E.innerHTML=`
            ${U}
            <button type="button" class="btn-close btn-close-white ms-1" 
                    style="font-size: 0.5rem; vertical-align: middle;"
                    aria-label="Remove"></button>
        `,E.querySelector(".btn-close").addEventListener("click",()=>{S.delete(p),E.remove(),S===re&&(window.selectedAreasList=re),S===ie&&(window.selectedInstitutionsList=ie),S===se&&(window.selectedTypesList=se),Xe()}),L.appendChild(E),S===re&&(window.selectedAreasList=re),S===ie&&(window.selectedInstitutionsList=ie),S===se&&(window.selectedTypesList=se)}let Ye="pie",rt=null;function $t(p){Ye==="pie"?Fa(p):Ga(p),tr()}function Wn(){const p=document.querySelector('[data-areas-view="pie"]'),L=document.querySelector('[data-areas-view="bar"]');!p||!L||(p.addEventListener("click",function(){p.classList.contains("active")||(p.classList.add("active"),L.classList.remove("active"),Ye="pie",rt&&$t(rt))}),L.addEventListener("click",function(){L.classList.contains("active")||(L.classList.add("active"),p.classList.remove("active"),Ye="bar",rt&&$t(rt))}))}function Xe(){const p={year_from:e.value,year_to:t.value,areas:Array.from(re),institutions:Array.from(ie),types:Array.from(se)},L=p.year_from&&p.year_to&&p.year_from===p.year_to,S=document.querySelector('[data-view="monthly"]'),E=document.querySelector('[data-view="yearly"]');S.disabled=!L,L?p.view_type=S.classList.contains("active")?"monthly":"yearly":(S.classList.remove("active"),E.classList.add("active"),p.view_type="yearly");const U=new URLSearchParams;p.year_from&&U.append("year_from",p.year_from),p.year_to&&U.append("year_to",p.year_to),p.areas.forEach(k=>U.append("areas",k)),p.institutions.forEach(k=>U.append("institutions",k)),p.types.forEach(k=>U.append("types",k)),U.append("view_type",p.view_type),sn&&U.append("include_predicted_areas","true"),ee&&U.append("author",ee),fetch(`/api/dashboard/data/?${U.toString()}`).then(k=>k.json()).then(k=>{const M=new URLSearchParams(U);M.append("view_type",Q),fetch(`/api/dashboard/collaboration-network/?${M.toString()}`).then(te=>te.json()).then(te=>{on(te)}).catch(te=>{console.error("Error fetching collaboration network data:",te)}),Pa(k.timeline,p.view_type,k.timeline_info),rt=k.areas;const G=document.querySelector('[data-areas-view="pie"]'),J=document.querySelector('[data-areas-view="bar"]');G&&J&&!G.classList.contains("active")&&!J.classList.contains("active")?(G.classList.add("active"),J.classList.remove("active"),Ye="pie"):J&&J.classList.contains("active")?Ye="bar":G&&G.classList.contains("active")&&(Ye="pie"),$t(k.areas),jn(1).then(()=>{})}).catch(k=>console.error("Error updating visualizations:",k))}let $e={metric:null,direction:"desc"};function jn(p=1){const L=document.getElementById("metricsTable"),S=document.getElementById("publicationsPagination"),E=L.closest("table");if(E){let M=E.querySelector(".loading-overlay");M||(M=document.createElement("div"),M.className="loading-overlay",M.style.cssText=`
                    position: absolute;
                    top: 0;
                    left: 0;
                    width: 100%;
                    height: 100%;
                    background: rgba(255, 255, 255, 0.8);
                    display: flex;
                    justify-content: center;
                    align-items: center;
                    z-index: 1000;
                `,M.innerHTML=`
                    <div class="spinner-border text-primary" role="status">
                        <span class="visually-hidden">Cargando...</span>
                    </div>
                `,E.style.position="relative",E.appendChild(M)),M.style.display="flex",E.style.pointerEvents="none",E.style.opacity="0.7"}const U={year_from:e.value,year_to:t.value,areas:Array.from(re),institutions:Array.from(ie),types:Array.from(se),page:p},k=new URLSearchParams;return U.year_from&&k.append("year_from",U.year_from),U.year_to&&k.append("year_to",U.year_to),U.areas.forEach(M=>k.append("areas",M)),U.institutions.forEach(M=>k.append("institutions",M)),U.types.forEach(M=>k.append("types",M)),k.append("page",U.page),ee&&k.append("author",ee),$e.metric&&(k.append("sort_by",$e.metric),k.append("sort_order",$e.direction)),fetch(`/api/dashboard/publications/?${k.toString()}`).then(M=>{if(!M.ok)throw new Error("Network response was not ok");return M.json()}).then(M=>{if(!L||!S)return Promise.reject("Required elements not found");const{data:G,pagination:J}=M.publications,te=[{key:"Dimensions Citations",label:"Dimensions Citations"},{key:"WoS Citations",label:"WoS Citations"},{key:"Scopus Citations",label:"Scopus Citations"},{key:"FCR",label:"FCR"},{key:"RCR",label:"RCR"},{key:"International Collaboration",label:"International Collaboration"}],X=document.createElement("thead");if(X.innerHTML=`
                    <tr>
                        <th style="max-width: 300px;">Título</th>
                        ${te.map(({key:T,label:$})=>`
                            <th class="sortable" data-metric="${T}">
                                ${$}
                                <i class="fas fa-sort${$e.metric===T?`-${$e.direction==="desc"?"down":"up"}`:""} ms-1"></i>
                            </th>
                        `).join("")}
                    </tr>
                `,E){const T=E.querySelector("thead");T&&T.remove(),E.insertBefore(X,L)}X.querySelectorAll(".sortable").forEach(T=>{T.addEventListener("click",function(){const $=this.dataset.metric,H=this.querySelector("i");X.querySelectorAll(".sortable i").forEach(N=>{N.className="fas fa-sort ms-1"}),$e.metric===$?$e.direction=$e.direction==="desc"?"asc":"desc":($e.metric=$,$e.direction="desc"),H.className=`fas fa-sort-${$e.direction==="desc"?"down":"up"} ms-1`,jn(1)})});function ye(T){L.innerHTML=T.map($=>`
                        <tr class="publication-row" data-publication-id="${$.id}" style="cursor: pointer;">
                            <td style="max-width: 300px; overflow: hidden; text-overflow: ellipsis; white-space: nowrap;">${$.title}</td>
                            ${te.map(({key:H})=>{const N=$.metrics[H];return`<td>${N&&N.value!==null?N.value:""}</td>`}).join("")}
                            <td>${$.international_collab!==null?$.international_collab:"-"}</td>
                        </tr>
                    `).join(""),L.querySelectorAll(".publication-row").forEach($=>{$.addEventListener("click",function(){const H=this.dataset.publicationId;H&&(window.location.href=`/publication/${H}/`)})})}if(ye(G),J.total_pages>1){let T=`
                        <li class="page-item ${J.current_page===1?"disabled":""}">
                            <a class="page-link" href="#" data-page="1">&laquo;</a>
                        </li>
                        <li class="page-item ${J.current_page===1?"disabled":""}">
                            <a class="page-link" href="#" data-page="${J.current_page-1}">&lt;</a>
                        </li>
                    `;const $=Math.max(1,J.current_page-2),H=Math.min(J.total_pages,J.current_page+2);for(let N=$;N<=H;N++)T+=`
                            <li class="page-item ${N===J.current_page?"active":""}">
                                <a class="page-link" href="#" data-page="${N}">${N}</a>
                            </li>
                        `;T+=`
                        <li class="page-item ${J.current_page===J.total_pages?"disabled":""}">
                            <a class="page-link" href="#" data-page="${J.current_page+1}">&gt;</a>
                        </li>
                        <li class="page-item ${J.current_page===J.total_pages?"disabled":""}">
                            <a class="page-link" href="#" data-page="${J.total_pages}">&raquo;</a>
                        </li>
                    `,S.innerHTML=T}else S.innerHTML="";if(S.querySelectorAll(".page-link").forEach(T=>{T.addEventListener("click",function($){$.preventDefault();const H=parseInt(this.dataset.page);isNaN(H)||jn(H)})}),E){const T=E.querySelector(".loading-overlay");T&&(T.style.display="none"),E.style.pointerEvents="auto",E.style.opacity="1"}return Promise.resolve()}).catch(M=>{if(console.error("Error updating publications table:",M),E){const G=E.querySelector(".loading-overlay");G&&(G.style.display="none"),E.style.pointerEvents="auto",E.style.opacity="1"}return Promise.reject(M)})}function Pa(p,L,S){Ie("#timelineChart").html("");const E={top:20,right:20,bottom:70,left:60},U=document.getElementById("timelineChart").clientWidth-E.left-E.right,k=300-E.top-E.bottom,M=Ie("#timelineChart").append("svg").attr("width",U+E.left+E.right).attr("height",k+E.top+E.bottom).style("display","block").style("margin","0 auto").append("g").attr("transform",`translate(${E.left},${E.top})`);let G;L==="monthly"?G=Wt().domain([1,12]).range([0,U]):G=Wt().domain(Xa(p,N=>N.year)).range([0,U]);const J=Wt().domain([0,sr(p,N=>N.count)]).nice().range([k,0]);let te;L==="monthly"?te=Zn(G).ticks(12).tickFormat(N=>["Ene","Feb","Mar","Abr","May","Jun","Jul","Ago","Sep","Oct","Nov","Dic"][N-1]):te=Zn(G).ticks(U/80).tickFormat(Ui("d"));const X=lr(J).ticks(k/40);M.append("g").attr("transform",`translate(0,${k})`).call(te).selectAll("text").style("text-anchor","middle"),M.append("g").call(X);const ye=Xo().x(N=>G(L==="monthly"?N.month:N.year)).y(N=>J(N.count)).curve(Gr),T=dd().x(N=>G(L==="monthly"?N.month:N.year)).y0(k).y1(N=>J(N.count)).curve(Gr);M.append("path").datum(p).attr("fill","#e3f2fd").attr("d",T),M.append("path").datum(p).attr("fill","none").attr("stroke","#2196f3").attr("stroke-width",2).attr("d",ye);const $=document.createElement("div");$.className="tooltip",$.style.opacity=0,$.style.position="absolute",$.style.backgroundColor="rgba(255,255,255,0.95)",$.style.border="1px solid #2196f3",$.style.borderRadius="4px",$.style.padding="6px 10px",$.style.fontSize="13px",$.style.pointerEvents="none",$.style.zIndex="1000",$.style.boxShadow="0 2px 4px rgba(0,0,0,0.1)",document.body.appendChild($);const H=document.createElement("div");if(H.className="info-box",H.style.display="none",H.style.position="absolute",H.style.backgroundColor="white",H.style.border="2px solid #2196f3",H.style.borderRadius="6px",H.style.padding="10px 15px",H.style.fontSize="14px",H.style.zIndex="1000",H.style.boxShadow="0 4px 8px rgba(0,0,0,0.1)",H.style.pointerEvents="none",document.body.appendChild(H),M.selectAll(".point").data(p).enter().append("circle").attr("class","point").attr("cx",N=>G(L==="monthly"?N.month:N.year)).attr("cy",N=>J(N.count)).attr("r",5).attr("fill","#2196f3").attr("stroke","#fff").attr("stroke-width",2).style("cursor","pointer").on("mouseover",function(N,j){Ie(this).attr("r",7).attr("fill","#1976d2"),$.style.opacity=1;let K;L==="monthly"?K=`<b>${["Enero","Febrero","Marzo","Abril","Mayo","Junio","Julio","Agosto","Septiembre","Octubre","Noviembre","Diciembre"][j.month-1]}</b><br><b>Publicaciones:</b> ${j.count}`:K=`<b>Año:</b> ${j.year}<br><b>Publicaciones:</b> ${j.count}`,$.innerHTML=K,$.style.left=`${N.pageX+10}px`,$.style.top=`${N.pageY+10}px`}).on("mouseout",function(){Ie(this).attr("r",5).attr("fill","#2196f3"),$.style.opacity=0}).on("click",function(N,j){N.stopPropagation(),qe(".info-box").style("display","none");const K=document.getElementById("timelineChart").getBoundingClientRect(),Z=N.clientX-K.left,le=N.clientY-K.top,he=120,me=60;let we=Z,at=le-me-10;we+he/2>K.width?we=K.width-he/2:we-he/2<0&&(we=he/2),at<0&&(at=le+10);let ct;L==="monthly"?ct=`
                        <div style="font-weight: bold; margin-bottom: 5px;">${["Enero","Febrero","Marzo","Abril","Mayo","Junio","Julio","Agosto","Septiembre","Octubre","Noviembre","Diciembre"][j.month-1]}</div>
                        <div>Publicaciones: ${j.count}</div>
                    `:ct=`
                        <div style="font-weight: bold; margin-bottom: 5px;">Año ${j.year}</div>
                        <div>Publicaciones: ${j.count}</div>
                    `,H.innerHTML=ct,H.style.display="block",H.style.left=`${we-he/2}px`,H.style.top=`${at}px`}),M.on("click",function(N){N.target.classList.contains("point")||qe(".info-box").style("display","none")}),document.addEventListener("click",function(N){N.target.closest("#timelineChart")||qe(".info-box").style("display","none")}),document.getElementById("timelineChart").addEventListener("click",function(N){N.target.closest(".point")||qe(".info-box").style("display","none")}),M.append("text").attr("transform","rotate(-90)").attr("y",0-E.left+20).attr("x",0-k/2).attr("dy","1em").style("text-anchor","middle").style("font-size","12px").text("Número de publicaciones"),M.append("text").attr("transform",`translate(${U/2}, ${k+E.bottom-30})`).attr("dy","1em").style("text-anchor","middle").style("font-size","12px").text(L==="monthly"?"Mes":"Año"),L==="monthly"&&S&&S.no_month_count>0){const N=Ie("#timelineChart").append("div").attr("class","alert alert-info").style("position","absolute").style("top","50px").style("right","10px").style("padding","8px 12px").style("font-size","12px").style("border-radius","4px").style("background-color","#e3f2fd").style("border","1px solid #2196f3").style("color","#0d47a1").style("z-index","1000").style("display","flex").style("align-items","center").style("gap","8px").style("max-width","300px");(S.no_month_count/S.total_count*100).toFixed(1),N.html(`
                <div style="flex-grow: 1;">
                    <i class="fas fa-info-circle"></i>
                    ${S.no_month_count} publicación(es) sin mes asignado 
                    se han contabilizado en enero
                </div>
                <button type="button" class="btn-close" style="font-size: 0.7rem;" aria-label="Close"></button>
            `),N.select(".btn-close").on("click",function(){N.remove()})}}function Fa(p){p=p.filter(T=>T.thematic_areas__name!==null),Ie("#areasChart").html("");const L={top:20,right:150,bottom:20,left:20},S=document.getElementById("areasChart").clientWidth-L.left-L.right,E=320-L.top-L.bottom,U=Math.min(S,E)/2,k=Ie("#areasChart").append("svg").attr("width",S+L.left+L.right).attr("height",E+L.top+L.bottom).style("display","block").style("margin","0 auto").style("min-width","550px").append("g").attr("transform",`translate(${U+L.left},${E/2+L.top})`),M=Yt().domain(p.map(T=>T.thematic_areas__name)).range(Mr),G=pd().value(T=>T.count).sort(null),J=cd().innerRadius(0).outerRadius(U),te=Ie("#areasChart").append("div").attr("class","info-box").style("display","none").style("position","absolute").style("background-color","white").style("border","2px solid #2196f3").style("border-radius","6px").style("padding","10px 15px").style("font-size","14px").style("z-index","1000").style("box-shadow","0 4px 8px rgba(0,0,0,0.1)").style("pointer-events","none");k.selectAll("path").data(G(p)).enter().append("path").attr("d",J).attr("fill",T=>M(T.data.thematic_areas__name)).attr("stroke","white").style("stroke-width","2px").style("cursor","pointer").on("click",function(T,$){T.stopPropagation(),qe(".info-box").style("display","none");const H=document.getElementById("areasChart").getBoundingClientRect(),N=T.clientX-H.left,j=T.clientY-H.top,K=180,Z=70;let le=N,he=j-Z-10;le+K/2>H.width?le=H.width-K/2:le-K/2<0&&(le=K/2),he<0&&(he=j+10);const me=($.data.count/Yn(p,ct=>ct.count)*100).toFixed(1),we=`
                    <div style="font-weight: bold; margin-bottom: 5px;">${$.data.thematic_areas__name}</div>
                    <div>Publicaciones: ${$.data.count}</div>
                    <div>Porcentaje: ${me}%</div>
                `,at=M($.data.thematic_areas__name);te.html(we).style("display","block").style("left",le-K/2+"px").style("top",he+"px").style("border",`2px solid ${at}`)});const ye=k.append("g").attr("transform",`translate(${U+20}, ${-280/2})`).selectAll(".legend-item").data(p).enter().append("g").attr("class","legend-item").attr("transform",(T,$)=>`translate(0, ${$*20})`);ye.append("rect").attr("width",15).attr("height",15).attr("fill",T=>M(T.thematic_areas__name)),ye.append("text").attr("x",20).attr("y",12).style("font-size","10px").text(T=>{const $=T.thematic_areas__name,H=(T.count/Yn(p,N=>N.count)*100).toFixed(1);return`${$} (${T.count} pubs, ${H}%)`}),document.getElementById("areasChart").addEventListener("click",function(T){T.target.closest("path")||qe(".info-box").style("display","none")}),document.addEventListener("click",function(T){T.target.closest("#areasChart")||qe(".info-box").style("display","none")}),tr()}function Ga(p){p=p.filter(X=>X.thematic_areas__name!==null);const L=25;if(p.length>L){const X=p.slice().sort((H,N)=>N.count-H.count),ye=X.slice(0,L),$=X.slice(L).reduce((H,N)=>H+N.count,0);p=[...ye,{thematic_areas__name:"Otras",count:$}]}Ie("#areasChart").html("");const S={top:20,right:20,bottom:30,left:60},E=document.getElementById("areasChart").clientWidth-S.left-S.right,U=300-S.top-S.bottom,k=Ie("#areasChart").append("svg").attr("width",E+S.left+S.right).attr("height",U+S.top+S.bottom).style("display","block").style("margin","0 auto").append("g").attr("transform",`translate(${S.left},${S.top})`),M=qo().domain(p.map(X=>X.thematic_areas__name)).range([0,E]).padding(.2),G=Wt().domain([0,sr(p,X=>X.count)]).nice().range([U,0]);k.append("g").attr("transform",`translate(0,${U})`).call(Zn(M).tickFormat("")),k.append("g").call(lr(G).ticks(U/40));const J=Yt().domain(p.map(X=>X.thematic_areas__name)).range(Mr),te=Ie("#areasChart").append("div").attr("class","info-box").style("display","none").style("position","absolute").style("background-color","white").style("border","2px solid #2196f3").style("border-radius","6px").style("padding","10px 15px").style("font-size","14px").style("z-index","1000").style("box-shadow","0 4px 8px rgba(0,0,0,0.1)").style("pointer-events","none");k.selectAll(".bar").data(p).enter().append("rect").attr("class","bar").attr("x",X=>M(X.thematic_areas__name)).attr("y",X=>G(X.count)).attr("width",M.bandwidth()).attr("height",X=>U-G(X.count)).attr("fill",X=>J(X.thematic_areas__name)).style("cursor","pointer").on("click",function(X,ye){X.stopPropagation(),qe(".info-box").style("display","none");const T=document.getElementById("areasChart").getBoundingClientRect(),$=X.clientX-T.left,H=X.clientY-T.top,N=180,j=70;let K=$,Z=H-j-10;K+N/2>T.width?K=T.width-N/2:K-N/2<0&&(K=N/2),Z<0&&(Z=H+10);const le=(ye.count/Yn(p,we=>we.count)*100).toFixed(1),he=`
                    <div style="font-weight: bold; margin-bottom: 5px;">${ye.thematic_areas__name}</div>
                    <div>Publicaciones: ${ye.count}</div>
                    <div>Porcentaje: ${le}%</div>
                `,me=J(ye.thematic_areas__name);te.html(he).style("display","block").style("left",K-N/2+"px").style("top",Z+"px").style("border",`2px solid ${me}`)}),document.getElementById("areasChart").addEventListener("click",function(X){X.target.closest("rect")||qe(".info-box").style("display","none")}),document.addEventListener("click",function(X){X.target.closest("#areasChart")||qe(".info-box").style("display","none")}),k.append("text").attr("transform","rotate(-90)").attr("y",-40).attr("x",-250/2).attr("dy","1em").style("text-anchor","middle").style("font-size","12px").text("Número de publicaciones"),k.append("text").attr("transform",`translate(${E/2}, ${U+S.bottom-20})`).attr("dy","1em").style("text-anchor","middle").style("font-size","12px").text("Áreas temáticas")}document.querySelectorAll("[data-view]").forEach(p=>{p.addEventListener("click",function(){this.disabled||(document.querySelectorAll("[data-view]").forEach(L=>L.classList.remove("active")),this.classList.add("active"),Xe())})}),e.addEventListener("change",ot),t.addEventListener("change",ot),n.addEventListener("change",()=>{const p=n.value;p&&!re.has(p)&&(re.add(p),window.selectedAreasList=re,it(p,a,re),ot()),n.value=""}),i.addEventListener("change",()=>{const p=i.value;p&&!ie.has(p)&&(ie.add(p),window.selectedInstitutionsList=ie,it(p,s,ie),ot()),i.value=""}),r.addEventListener("change",()=>{const p=r.value;p&&!se.has(p)&&(se.add(p),window.selectedTypesList=se,it(p,u,se),ot()),r.value=""}),o.addEventListener("click",()=>{e.value="",t.value="",re.clear(),ie.clear(),se.clear(),a.innerHTML="",s.innerHTML="",u.innerHTML="",ot()});let Se=null,yt=!1;const nn=document.getElementById("toggleLabelsBtn"),It=window.location.pathname.split("/")[1],za=It==="es"?"Ocultar etiquetas extra":"Hide Extra Labels",Ba=It==="es"?"Mostrar etiquetas":"Show All Labels";nn&&nn.addEventListener("click",()=>{Se&&(yt=!yt,yt?(Se.setSettings({labelDensity:1/0,labelGridCellSize:1,labelRenderedSizeThreshold:0}),nn.textContent=`${za}`):(Se.setSettings({labelDensity:1,labelGridCellSize:200,labelRenderedSizeThreshold:0}),nn.textContent=`${Ba}`),Se.refresh())});let Q="modularity-7",bt=null,rn=null,de=!1;document.querySelectorAll(".dropdown-item.network-community-view").forEach(p=>{p.addEventListener("click",function(L){L.preventDefault();const S=this.dataset.communityView;if(Q===S){document.querySelectorAll(".dropdown-item.network-community-view").forEach(E=>{E.classList.remove("active")}),this.classList.add("active");return}Q=S,document.querySelectorAll(".dropdown-item.network-community-view").forEach(E=>{E.classList.remove("active")}),this.classList.add("active"),an(),Xe()})});function on(p){const L=document.getElementById("collaborationNetwork");if(!L)return;const S=document.querySelector("#collaborationNetwork").closest(".card").querySelector(".card-title"),E=window.location.pathname.split("/")[1],U=document.getElementById("toggleFullNetworkBtn");if(p.is_author_view){const T=p.nodes.find($=>$.is_selected);T&&(S.textContent=E==="es"?`Colaboraciones de ${T.label}`:`Collaborations of ${T.label}`),document.querySelector("#communityViewDropdown").closest(".dropdown").style.display="none",U.style.display="none"}else{if(document.querySelector("#communityViewDropdown").closest(".dropdown").style.display="block",an(p.model||null,p.n_clusters||null),Q==="keywords"?U.style.display="none":U.style.display="block",de){const T=document.getElementById("networkInfoMessage");T&&T.remove();let $="";if(Q==="department"?$=E==="es"?"Los investigadores han sido clasificados en departamentos utilizando un Node2VecTransformer y un MLPClassifier. Esta clasificación no es 100% precisa. No aparecen investigadores sin colaboraciones.":"Researchers have been classified into departments using a Node2VecTransformer and MLPClassifier. This classification is not 100% accurate. There are no researchers without collaborations.":Q==="modularity-7"?$=E==="es"?"Se ha utilizado el algoritmo de detección de comunidades Lovaina sobre la red de coautorías completa para agrupar a los investigadores en distintas comunidades. No aparecen investigadores sin colaboraciones.":"The Louvain community detection algorithm has been used on the complete co-authorship network to group researchers into different communities. There are no researchers without collaborations.":Q==="modularity-5"&&($=E==="es"?"Se ha utilizado el algoritmo de detección de comunidades Leiden sobre la red de coautorías completa para agrupar a los investigadores en distintas comunidades. No aparecen investigadores sin colaboraciones.":"The Leiden community detection algorithm has been used on the complete co-authorship network to group researchers into different communities. There are no researchers without collaborations."),$){const H=L.closest(".card-body"),N=document.createElement("div");N.id="networkInfoMessage",N.style.cssText=`
                        background-color: #f8f9fa;
                        border-left: 4px solid #0d6efd;
                        padding: 10px 15px;
                        margin: 10px 0;
                        border-radius: 4px;
                        font-size: 0.9rem;
                        color: #666;
                        position: relative;
                    `;const j=document.createElement("button");j.className="btn-close",j.style.cssText=`
                        position: absolute;
                        right: 10px;
                        top: 10px;
                        padding: 0.25rem;
                    `,j.onclick=function(){N.remove()};const K=document.createElement("div");K.textContent=$,N.appendChild(j),N.appendChild(K),H.insertBefore(N,L)}}else{const T=document.getElementById("networkInfoMessage");T&&T.remove()}Q==="keywords"?S.textContent=E==="es"?"Red de coincidencia de palabras clave (entre IPs)":"Keyword Coincidence Network (between IPs)":S.textContent=E==="es"?de?"Red de Coautorías Interactiva Completa":"Red de Coautorías Interactiva entre IPs":de?"Complete Interactive Co-authorship Network":"Interactive Co-authorship Network between IPs"}Se&&(Se.kill(),Se=null),L.innerHTML="";const k=new ue,M=["#e6194b","#3cb44b","#ffe119","#4363d8","#f58231","#911eb4","#42d4f4","#f032e6","#bfef45","#fabed4","#469990","#dcbeff","#9a6324","#fffac8","#800000","#aaffc3","#808000","#ffd8b1","#000075","#a9a9a9","#000000","#6a3d9a","#b15928","#1f78b4"],G=T=>T===-1||isNaN(T)?"#A9A9A9":M[T%M.length],J=Yt().domain(["Departamento 1","Departamento 2","Departamento 3","Unknown"]).range(["#1f78b4","#ff7f0e","#2ca02c","#999999"]);if(p.is_author_view){const T=L.clientWidth/2,$=L.clientHeight/2,H=250,N=p.nodes.find(Z=>Z.is_selected);if(!N)return;N.x=T,N.y=$;const j=p.nodes.filter(Z=>!Z.is_selected),K=2*Math.PI/Math.max(j.length,1);j.forEach((Z,le)=>{const he=le*K;Z.x=T+H*Math.cos(he),Z.y=$+H*Math.sin(he)})}else{let T;Q==="department"?T="department":Q==="modularity-5"?T="leiden_community":T="community";const $=[...new Set(p.nodes.map(me=>me[T]))].filter(me=>me!==void 0),H=$.indexOf(-1);H>-1&&($.splice(H,1),$.push(-1));const N={};$.forEach(me=>{N[me]=p.nodes.filter(we=>we[T]===me)});const j=L.clientWidth/2,K=L.clientHeight/2,Z=$.length,le=Math.min(j,K)*.8,he=le/Math.sqrt(Z)*.5;$.forEach((me,we)=>{const at=N[me],ct=2*Math.PI/Math.max(at.length,5),nr=j+le*Math.cos(2*Math.PI*we/Z),Ua=K+le*Math.sin(2*Math.PI*we/Z);at.forEach((ir,Ha)=>{const rr=Ha*ct;ir.x=nr+he*Math.cos(rr),ir.y=Ua+he*Math.sin(rr)})})}if(p.nodes.forEach(T=>{const $=parseInt(T.community),H=parseInt(T.leiden_community),N=T.department,j=p.is_author_view?T.is_selected?"#e6194b":"#bbbbbb":Q==="department"?J(N):G(Q==="modularity-5"?H:$);k.addNode(T.id,{label:T.label,x:T.x,y:T.y,size:T.is_selected?18:12,color:j,highlighted:T.is_selected,forceLabel:yt})}),p.edges.forEach(T=>{if(k.hasNode(T.source)&&k.hasNode(T.target)){const $=T.weight||1,H=Math.pow($,.7),N=Math.min(4,Math.max(1.5,H)),K=`rgba(3, 138, 255, ${Math.min(.9,.5+.05*$).toFixed(2)})`;k.addEdge(T.source,T.target,{size:N,color:K,type:"curve"})}}),Se=new Xf(k,L,{minCameraRatio:.1,maxCameraRatio:10,defaultEdgeType:"curve",edgeProgramClasses:{curve:hp},renderLabels:!0,labelDensity:1,labelGridCellSize:300,labelRenderedSizeThreshold:0,defaultLabelSize:8,zIndex:!0,enableEdgeHovering:!1,enableNodeHovering:!1,enableCamera:!1}),!p.is_author_view&&!(de&&Q==="modularity-7")&&!(de&&Q==="modularity-5")){const T=document.createElement("div");T.id="networkLegend",Object.assign(T.style,{position:"absolute",bottom:"10px",left:"10px",backgroundColor:"rgba(255,255,255,0.95)",border:"1px solid #ccc",borderRadius:"8px",padding:"12px",fontSize:"13px",zIndex:1e3,boxShadow:"0px 0px 6px rgba(0,0,0,0.1)"});const $=document.createElement("div");if($.style.fontWeight="bold",$.style.marginBottom="6px",Q==="department")$.textContent=E==="es"?"Departamentos":"Departments";else if(Q==="keywords")$.textContent=E==="es"?"Comunidades de Palabras Clave":"Keyword Communities";else if(Q==="modularity-5"||Q==="modularity-7"){const N=Q==="modularity-7"?7:5;$.textContent=E==="es"?`Comunidades (${N})`:`Communities (${N})`}T.appendChild($);const H=document.createElement("div");if(H.style.marginBottom="8px",H.textContent=`${p.nodes.length} nodos / ${p.edges.length} enlaces`,T.appendChild(H),Q==="department")[...new Set(p.nodes.map(j=>j.department))].forEach(j=>{const K=document.createElement("div");K.style.display="flex",K.style.alignItems="center",K.style.marginBottom="4px";const Z=document.createElement("div");Object.assign(Z.style,{width:"14px",height:"14px",backgroundColor:J(j),marginRight:"6px",borderRadius:"3px"});const le=document.createElement("span");le.textContent=j,K.appendChild(Z),K.appendChild(le),T.appendChild(K)});else{let N=[];Q==="keywords"?N=[...new Set(p.nodes.map(j=>parseInt(j.community)))]:Q==="modularity-5"?N=[...new Set(p.nodes.map(j=>parseInt(j.leiden_community)))]:Q==="modularity-7"&&(N=[...new Set(p.nodes.map(j=>parseInt(j.community)))]),N.sort((j,K)=>j-K),N.forEach((j,K)=>{const Z=document.createElement("div");Z.style.display="flex",Z.style.alignItems="center",Z.style.marginBottom="4px";const le=document.createElement("div");Object.assign(le.style,{width:"14px",height:"14px",backgroundColor:G(j),marginRight:"6px",borderRadius:"3px"});const he=document.createElement("span");if(j===-1||isNaN(j))he.textContent="Outlier";else{const me=Q==="modularity-7"?K+1:j+1,we=E==="es"?"Comunidad":"Community";he.textContent=`${we} ${me}`}Z.appendChild(le),Z.appendChild(he),T.appendChild(Z)})}L.appendChild(T)}const te=document.createElement("div");te.innerText=E==="es"?"Haz click para activar la red":"Click to activate the network",Object.assign(te.style,{position:"absolute",top:0,left:0,width:"100%",height:"100%",backgroundColor:"rgba(255,255,255,0.85)",display:"flex",alignItems:"center",justifyContent:"center",fontSize:"24px",fontWeight:"bold",color:"#333",cursor:"pointer",zIndex:1e3,borderRadius:getComputedStyle(L).borderRadius}),L.appendChild(te),te.addEventListener("click",()=>{te.remove(),ye()});const X=document.createElement("div");Object.assign(X.style,{position:"absolute",backgroundColor:"#fff",border:"1px solid #aaa",padding:"4px 8px",fontSize:"12px",borderRadius:"4px",pointerEvents:"none",display:"none",zIndex:1e3}),document.body.appendChild(X);const ye=()=>{Se.setSettings({enableEdgeHovering:!0,enableNodeHovering:!0,enableCamera:!0}),Se.on("enterNode",({node:T,event:$})=>{const H=k.getNodeAttribute(T,"label"),N=k.neighbors(T),j=[];N.forEach(Z=>{const le=k.edge(T,Z)||k.edge(Z,T),he=k.getEdgeAttribute(le,"size")||1,me=k.getNodeAttribute(Z,"label");j.push(`• ${me} (${he})`)}),X.innerText=`${H}
${E==="es"?"Colabora con:":"Collaborates with:"}
${j.join(`
`)}`,X.style.left=`${$.clientX+10}px`,X.style.top=`${$.clientY+10}px`,X.style.display="block";const K=new Set(N);K.add(T),k.forEachNode(Z=>{k.setNodeAttribute(Z,"hidden",!K.has(Z)),k.setNodeAttribute(Z,"forceLabel",yt||K.has(Z))}),k.forEachEdge(Z=>{const le=k.source(Z),he=k.target(Z),me=K.has(le)&&K.has(he);k.setEdgeAttribute(Z,"hidden",!me)})}),Se.on("leaveNode",()=>{X.style.display="none",k.forEachNode(T=>{k.removeNodeAttribute(T,"hidden"),k.setNodeAttribute(T,"forceLabel",yt)}),k.forEachEdge(T=>k.removeEdgeAttribute(T,"hidden"))})};Se.getCamera().animatedReset({duration:500})}document.getElementById("applyClustering").addEventListener("click",()=>{const p=document.querySelector('input[name="configMode"]:checked').value,L=document.getElementById("clusteringModel").value,S=document.querySelector('input[name="modelConfigMode"]:checked').value;let E=document.getElementById("nClusters").value;L==="dbscan"?E=document.getElementById("dbscanClusters").value:L==="hdbscan"?E=document.getElementById("hdbscanClusters").value:L==="lovaina"&&(E=document.getElementById("lovainaClusters").value),Q="keywords",bt=L,rn=E;const U=new URLSearchParams({communityView:"keywords",clusteringModel:L,nClusters:E,autoMode:S==="auto",globalMode:p==="global"});fetch(`/api/dashboard/collaboration-network/?${U.toString()}`).then(k=>k.json()).then(k=>{if(k.error){console.error("Error desde backend:",k.error),alert(`Ocurrió un error al generar la red: ${k.error}`);return}if(!k.nodes||!k.edges){console.error("Respuesta incompleta del backend:",k),alert("La respuesta del servidor no contiene datos de red válidos.");return}window.currentNetworkData=k,an(L,E),on(k),document.activeElement.blur(),bootstrap.Modal.getInstance(document.getElementById("clusteringModal")).hide()}).catch(k=>{console.error("Error en la petición fetch:",k)})});function an(p=null,L=null){const S=document.getElementById("communityViewDropdown"),E=window.location.pathname.split("/")[1];let U="";if(Q==="department")U=E==="es"?"Por Departamento":"By Department";else if(Q==="modularity-7")U=E==="es"?de?"Louvain":"Louvain (7 comunidades)":de?"Louvain":"Louvain (7 communities)";else if(Q==="modularity-5")U=E==="es"?de?"Leiden":"Leiden (5 comunidades)":de?"Leiden":"Leiden (5 communities)";else if(Q==="keywords"){const k=p||bt,M=L||rn;k&&M?U=E==="es"?`Por palabras clave (${k}, ${M} clústeres)`:`By keywords (${k}, ${M} clusters)`:U=E==="es"?"Por palabras clave":"By keywords"}S.textContent=U}function ot(){const p=new URLSearchParams;e.value&&p.append("year_from",e.value),t.value&&p.append("year_to",t.value),re.forEach(k=>p.append("areas",k)),ie.forEach(k=>p.append("institutions",k)),se.forEach(k=>p.append("types",k)),ee&&p.append("author",ee);const L=window.location.pathname.split("/")[1],S=L==="es"?"Todas las Áreas":"All areas",E=L==="es"?"Todas las Instituciones":"All Institutions",U=L==="es"?"Todos los tipos":"All types";fetch(`/api/dashboard/filters/?${p.toString()}`).then(k=>{if(!k.ok)throw new Error(`HTTP error! status: ${k.status}`);return k.json()}).then(k=>{n.innerHTML=`<option value="">${S}</option>`,k.areas.forEach(M=>{const G=document.createElement("option");G.value=M.name,G.textContent=`${M.name} (${M.count})`,n.appendChild(G)}),i.innerHTML=`<option value="">${E}</option>`,k.institutions.forEach(M=>{const G=document.createElement("option");G.value=M.name,G.textContent=`${M.name} (${M.count})`,i.appendChild(G)}),r.innerHTML=`<option value="">${U}</option>`,k.publication_types.forEach(M=>{const G=document.createElement("option");G.value=M.publication_type,G.textContent=`${M.publication_type} (${M.count})`,r.appendChild(G)})}).catch(k=>{console.error("Error updating filters:",k);const M=document.createElement("div");M.className="alert alert-danger",M.style.position="fixed",M.style.top="20px",M.style.right="20px",M.style.zIndex="9999",M.innerHTML=`
                    <strong>Error:</strong> No se pudieron actualizar los filtros.
                    <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
                `,document.body.appendChild(M),setTimeout(()=>{M.remove()},5e3)}),Xe()}document.getElementById("toggleFullNetworkBtn").addEventListener("click",function(){const p=this,L=document.getElementById("collaborationNetwork"),S=window.location.pathname.split("/")[1];p.disabled=!0,p.innerHTML='<span class="spinner-border spinner-border-sm" role="status" aria-hidden="true"></span> '+(S==="es"?"Cargando...":"Loading...");const E=document.createElement("div");E.style.cssText=`
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(255, 255, 255, 0.8);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1000;
            border-radius: inherit;
        `,E.innerHTML=`
            <div class="spinner-border text-primary" role="status">
                <span class="visually-hidden">${S==="es"?"Cargando...":"Loading..."}</span>
            </div>
        `,L.appendChild(E),de=!de,p.textContent=S==="es"?de?"Mostrar Red de IPs":"Mostrar Red Completa":de?"Show IPs Network":"Show Full Network";const U=document.querySelector("#collaborationNetwork").closest(".card").querySelector(".card-title");U.textContent=S==="es"?de?"Red de Coautorías Interactiva Completa":"Red de Coautorías Interactiva entre IPs":de?"Complete Interactive Co-authorship Network":"Interactive Co-authorship Network between IPs";const k=new URLSearchParams({communityView:Q,fullNetwork:de});bt&&(k.append("clusteringModel",bt),k.append("nClusters",rn),k.append("autoMode","true"),k.append("globalMode","true")),document.querySelectorAll(".network-community-view").forEach(G=>{G.classList.remove("disabled"),G.style.pointerEvents="auto",G.style.opacity="1"}),fetch(`/api/dashboard/collaboration-network/?${k.toString()}`).then(G=>G.json()).then(G=>{if(G.error){console.error("Error desde backend:",G.error),alert(`Ocurrió un error al generar la red: ${G.error}`),de=!de;return}if(!G.nodes||!G.edges){console.error("Respuesta incompleta del backend:",G),alert("La respuesta del servidor no contiene datos de red válidos."),de=!de;return}window.currentNetworkData=G,on(G),!de&&(Q==="modularity-5"||Q==="keywords")?p.style.display="none":p.style.display="block"}).catch(G=>{console.error("Error en la petición fetch:",G)}).finally(()=>{E.remove(),p.disabled=!1})}),document.querySelectorAll(".network-community-view").forEach(p=>{p.addEventListener("click",function(L){if(L.preventDefault(),this.classList.contains("disabled"))return;const S=this.getAttribute("data-community-view");if(Q=S,document.querySelectorAll(".network-community-view").forEach(G=>G.classList.remove("active")),this.classList.add("active"),(S==="department"||S==="modularity-7"||S==="modularity-5")&&de){de=!1;const G=document.getElementById("toggleFullNetworkBtn"),J=window.location.pathname.split("/")[1];G.textContent=J==="es"?"Mostrar Red Completa":"Show Full Network"}const E=document.getElementById("toggleFullNetworkBtn");!de&&S==="keywords"?E.style.display="none":E.style.display="block";const U=document.getElementById("collaborationNetwork"),k=document.createElement("div");k.style.cssText=`
                position: absolute;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                background: rgba(255, 255, 255, 0.8);
                display: flex;
                justify-content: center;
                align-items: center;
                z-index: 1000;
                border-radius: inherit;
            `,k.innerHTML=`
                <div class="spinner-border text-primary" role="status">
                    <span class="visually-hidden">${window.location.pathname.split("/")[1]==="es"?"Cargando...":"Loading..."}</span>
                </div>
            `,U.appendChild(k);const M=new URLSearchParams({communityView:S,fullNetwork:de});bt&&(M.append("clusteringModel",bt),M.append("nClusters",rn),M.append("autoMode","true"),M.append("globalMode","true")),fetch(`/api/dashboard/collaboration-network/?${M.toString()}`).then(G=>G.json()).then(G=>{if(G.error){console.error("Error desde backend:",G.error);return}on(G)}).catch(G=>{console.error("Error en la petición fetch:",G)}).finally(()=>{k.remove()})})});let sn=!1;const Qi={es:{include:"Incluir áreas temáticas predichas por IA",exclude:"Excluir áreas temáticas predichas por IA"},en:{include:"Include AI-predicted areas",exclude:"Exclude AI-predicted areas"}};function er(){const p=window.location.pathname.split("/")[1]==="es"?"es":"en",L=document.getElementById("togglePredictedAreasBtn");L&&(L.textContent=sn?Qi[p].exclude:Qi[p].include)}function Oa(){let p=document.getElementById("areasChartLoading");if(p)p.style.display="flex";else{p=document.createElement("div"),p.id="areasChartLoading",p.style.position="absolute",p.style.top=0,p.style.left=0,p.style.width="100%",p.style.height="100%",p.style.background="rgba(255,255,255,0.7)",p.style.display="flex",p.style.justifyContent="center",p.style.alignItems="center",p.style.zIndex=10,p.innerHTML='<div class="spinner-border text-primary" role="status"><span class="visually-hidden">Cargando...</span></div>';const L=document.getElementById("areasChart").parentElement;L.style.position="relative",L.appendChild(p)}}function tr(){const p=document.getElementById("areasChartLoading");p&&(p.style.display="none")}window.addEventListener("DOMContentLoaded",function(){const p=document.getElementById("togglePredictedAreasBtn");p&&(p.addEventListener("click",function(){Oa(),sn=!sn,er(),Xe()}),er()),fp()})}document.addEventListener("DOMContentLoaded",()=>{pp()});
