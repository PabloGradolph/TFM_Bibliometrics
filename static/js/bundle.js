function pn(e,t){return e==null||t==null?NaN:e<t?-1:e>t?1:e>=t?0:NaN}function Ia(e,t){return e==null||t==null?NaN:t<e?-1:t>e?1:t>=e?0:NaN}function so(e){let t,n,i;e.length!==2?(t=pn,n=(s,u)=>pn(e(s),u),i=(s,u)=>e(s)-u):(t=e===pn||e===Ia?e:Fa,n=e,i=e);function r(s,u,l=0,c=s.length){if(l<c){if(t(u,u)!==0)return c;do{const d=l+c>>>1;n(s[d],u)<0?l=d+1:c=d}while(l<c)}return l}function o(s,u,l=0,c=s.length){if(l<c){if(t(u,u)!==0)return c;do{const d=l+c>>>1;n(s[d],u)<=0?l=d+1:c=d}while(l<c)}return l}function a(s,u,l=0,c=s.length){const d=r(s,u,l,c-1);return d>l&&i(s[d-1],u)>-i(s[d],u)?d-1:d}return{left:r,center:a,right:o}}function Fa(){return 0}function za(e){return e===null?NaN:+e}const Oa=so(pn),Ba=Oa.right;so(za).center;function Ua(e,t){let n,i;if(t===void 0)for(const r of e)r!=null&&(n===void 0?r>=r&&(n=i=r):(n>r&&(n=r),i<r&&(i=r)));else{let r=-1;for(let o of e)(o=t(o,++r,e))!=null&&(n===void 0?o>=o&&(n=i=o):(n>o&&(n=o),i<o&&(i=o)))}return[n,i]}class er extends Map{constructor(t,n=qa){if(super(),Object.defineProperties(this,{_intern:{value:new Map},_key:{value:n}}),t!=null)for(const[i,r]of t)this.set(i,r)}get(t){return super.get(tr(this,t))}has(t){return super.has(tr(this,t))}set(t,n){return super.set(Ha(this,t),n)}delete(t){return super.delete(Wa(this,t))}}function tr({_intern:e,_key:t},n){const i=t(n);return e.has(i)?e.get(i):n}function Ha({_intern:e,_key:t},n){const i=t(n);return e.has(i)?e.get(i):(e.set(i,n),n)}function Wa({_intern:e,_key:t},n){const i=t(n);return e.has(i)&&(n=e.get(i),e.delete(i)),n}function qa(e){return e!==null&&typeof e=="object"?e.valueOf():e}const Va=Math.sqrt(50),ja=Math.sqrt(10),Ya=Math.sqrt(2);function _n(e,t,n){const i=(t-e)/Math.max(0,n),r=Math.floor(Math.log10(i)),o=i/Math.pow(10,r),a=o>=Va?10:o>=ja?5:o>=Ya?2:1;let s,u,l;return r<0?(l=Math.pow(10,-r)/a,s=Math.round(e*l),u=Math.round(t*l),s/l<e&&++s,u/l>t&&--u,l=-l):(l=Math.pow(10,r)*a,s=Math.round(e/l),u=Math.round(t/l),s*l<e&&++s,u*l>t&&--u),u<s&&.5<=n&&n<2?_n(e,t,n*2):[s,u,l]}function Xa(e,t,n){if(t=+t,e=+e,n=+n,!(n>0))return[];if(e===t)return[e];const i=t<e,[r,o,a]=i?_n(t,e,n):_n(e,t,n);if(!(o>=r))return[];const s=o-r+1,u=new Array(s);if(i)if(a<0)for(let l=0;l<s;++l)u[l]=(o-l)/-a;else for(let l=0;l<s;++l)u[l]=(o-l)*a;else if(a<0)for(let l=0;l<s;++l)u[l]=(r+l)/-a;else for(let l=0;l<s;++l)u[l]=(r+l)*a;return u}function ci(e,t,n){return t=+t,e=+e,n=+n,_n(e,t,n)[2]}function Ka(e,t,n){t=+t,e=+e,n=+n;const i=t<e,r=i?ci(t,e,n):ci(e,t,n);return(i?-1:1)*(r<0?1/-r:r)}function nr(e,t){let n;if(t===void 0)for(const i of e)i!=null&&(n<i||n===void 0&&i>=i)&&(n=i);else{let i=-1;for(let r of e)(r=t(r,++i,e))!=null&&(n<r||n===void 0&&r>=r)&&(n=r)}return n}function Za(e,t,n){e=+e,t=+t,n=(r=arguments.length)<2?(t=e,e=0,1):r<3?1:+n;for(var i=-1,r=Math.max(0,Math.ceil((t-e)/n))|0,o=new Array(r);++i<r;)o[i]=e+i*n;return o}function Wn(e,t){let n=0;if(t===void 0)for(let i of e)(i=+i)&&(n+=i);else{let i=-1;for(let r of e)(r=+t(r,++i,e))&&(n+=r)}return n}function Ja(e){return e}var qn=1,Vn=2,di=3,Bt=4,ir=1e-6;function Qa(e){return"translate("+e+",0)"}function es(e){return"translate(0,"+e+")"}function ts(e){return t=>+e(t)}function ns(e,t){return t=Math.max(0,e.bandwidth()-t*2)/2,e.round()&&(t=Math.round(t)),n=>+e(n)+t}function is(){return!this.__axis}function uo(e,t){var n=[],i=null,r=null,o=6,a=6,s=3,u=typeof window<"u"&&window.devicePixelRatio>1?0:.5,l=e===qn||e===Bt?-1:1,c=e===Bt||e===Vn?"x":"y",d=e===qn||e===di?Qa:es;function h(f){var g=i??(t.ticks?t.ticks.apply(t,n):t.domain()),m=r??(t.tickFormat?t.tickFormat.apply(t,n):Ja),b=Math.max(o,0)+s,E=t.range(),x=+E[0]+u,_=+E[E.length-1]+u,p=(t.bandwidth?ns:ts)(t.copy(),u),v=f.selection?f.selection():f,w=v.selectAll(".domain").data([null]),k=v.selectAll(".tick").data(g,t).order(),I=k.exit(),O=k.enter().append("g").attr("class","tick"),F=k.select("line"),R=k.select("text");w=w.merge(w.enter().insert("path",".tick").attr("class","domain").attr("stroke","currentColor")),k=k.merge(O),F=F.merge(O.append("line").attr("stroke","currentColor").attr(c+"2",l*o)),R=R.merge(O.append("text").attr("fill","currentColor").attr(c,l*b).attr("dy",e===qn?"0em":e===di?"0.71em":"0.32em")),f!==v&&(w=w.transition(f),k=k.transition(f),F=F.transition(f),R=R.transition(f),I=I.transition(f).attr("opacity",ir).attr("transform",function(H){return isFinite(H=p(H))?d(H+u):this.getAttribute("transform")}),O.attr("opacity",ir).attr("transform",function(H){var P=this.parentNode.__axis;return d((P&&isFinite(P=P(H))?P:p(H))+u)})),I.remove(),w.attr("d",e===Bt||e===Vn?a?"M"+l*a+","+x+"H"+u+"V"+_+"H"+l*a:"M"+u+","+x+"V"+_:a?"M"+x+","+l*a+"V"+u+"H"+_+"V"+l*a:"M"+x+","+u+"H"+_),k.attr("opacity",1).attr("transform",function(H){return d(p(H)+u)}),F.attr(c+"2",l*o),R.attr(c,l*b).text(m),v.filter(is).attr("fill","none").attr("font-size",10).attr("font-family","sans-serif").attr("text-anchor",e===Vn?"start":e===Bt?"end":"middle"),v.each(function(){this.__axis=p})}return h.scale=function(f){return arguments.length?(t=f,h):t},h.ticks=function(){return n=Array.from(arguments),h},h.tickArguments=function(f){return arguments.length?(n=f==null?[]:Array.from(f),h):n.slice()},h.tickValues=function(f){return arguments.length?(i=f==null?null:Array.from(f),h):i&&i.slice()},h.tickFormat=function(f){return arguments.length?(r=f,h):r},h.tickSize=function(f){return arguments.length?(o=a=+f,h):o},h.tickSizeInner=function(f){return arguments.length?(o=+f,h):o},h.tickSizeOuter=function(f){return arguments.length?(a=+f,h):a},h.tickPadding=function(f){return arguments.length?(s=+f,h):s},h.offset=function(f){return arguments.length?(u=+f,h):u},h}function jn(e){return uo(di,e)}function rr(e){return uo(Bt,e)}var rs={value:()=>{}};function lo(){for(var e=0,t=arguments.length,n={},i;e<t;++e){if(!(i=arguments[e]+"")||i in n||/[\s.]/.test(i))throw new Error("illegal type: "+i);n[i]=[]}return new mn(n)}function mn(e){this._=e}function os(e,t){return e.trim().split(/^|\s+/).map(function(n){var i="",r=n.indexOf(".");if(r>=0&&(i=n.slice(r+1),n=n.slice(0,r)),n&&!t.hasOwnProperty(n))throw new Error("unknown type: "+n);return{type:n,name:i}})}mn.prototype=lo.prototype={constructor:mn,on:function(e,t){var n=this._,i=os(e+"",n),r,o=-1,a=i.length;if(arguments.length<2){for(;++o<a;)if((r=(e=i[o]).type)&&(r=as(n[r],e.name)))return r;return}if(t!=null&&typeof t!="function")throw new Error("invalid callback: "+t);for(;++o<a;)if(r=(e=i[o]).type)n[r]=or(n[r],e.name,t);else if(t==null)for(r in n)n[r]=or(n[r],e.name,null);return this},copy:function(){var e={},t=this._;for(var n in t)e[n]=t[n].slice();return new mn(e)},call:function(e,t){if((r=arguments.length-2)>0)for(var n=new Array(r),i=0,r,o;i<r;++i)n[i]=arguments[i+2];if(!this._.hasOwnProperty(e))throw new Error("unknown type: "+e);for(o=this._[e],i=0,r=o.length;i<r;++i)o[i].value.apply(t,n)},apply:function(e,t,n){if(!this._.hasOwnProperty(e))throw new Error("unknown type: "+e);for(var i=this._[e],r=0,o=i.length;r<o;++r)i[r].value.apply(t,n)}};function as(e,t){for(var n=0,i=e.length,r;n<i;++n)if((r=e[n]).name===t)return r.value}function or(e,t,n){for(var i=0,r=e.length;i<r;++i)if(e[i].name===t){e[i]=rs,e=e.slice(0,i).concat(e.slice(i+1));break}return n!=null&&e.push({name:t,value:n}),e}var hi="http://www.w3.org/1999/xhtml";const ar={svg:"http://www.w3.org/2000/svg",xhtml:hi,xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/"};function Gn(e){var t=e+="",n=t.indexOf(":");return n>=0&&(t=e.slice(0,n))!=="xmlns"&&(e=e.slice(n+1)),ar.hasOwnProperty(t)?{space:ar[t],local:e}:e}function ss(e){return function(){var t=this.ownerDocument,n=this.namespaceURI;return n===hi&&t.documentElement.namespaceURI===hi?t.createElement(e):t.createElementNS(n,e)}}function us(e){return function(){return this.ownerDocument.createElementNS(e.space,e.local)}}function co(e){var t=Gn(e);return(t.local?us:ss)(t)}function ls(){}function Li(e){return e==null?ls:function(){return this.querySelector(e)}}function cs(e){typeof e!="function"&&(e=Li(e));for(var t=this._groups,n=t.length,i=new Array(n),r=0;r<n;++r)for(var o=t[r],a=o.length,s=i[r]=new Array(a),u,l,c=0;c<a;++c)(u=o[c])&&(l=e.call(u,u.__data__,c,o))&&("__data__"in u&&(l.__data__=u.__data__),s[c]=l);return new Ce(i,this._parents)}function ds(e){return e==null?[]:Array.isArray(e)?e:Array.from(e)}function hs(){return[]}function ho(e){return e==null?hs:function(){return this.querySelectorAll(e)}}function fs(e){return function(){return ds(e.apply(this,arguments))}}function gs(e){typeof e=="function"?e=fs(e):e=ho(e);for(var t=this._groups,n=t.length,i=[],r=[],o=0;o<n;++o)for(var a=t[o],s=a.length,u,l=0;l<s;++l)(u=a[l])&&(i.push(e.call(u,u.__data__,l,a)),r.push(u));return new Ce(i,r)}function fo(e){return function(){return this.matches(e)}}function go(e){return function(t){return t.matches(e)}}var ps=Array.prototype.find;function ms(e){return function(){return ps.call(this.children,e)}}function vs(){return this.firstElementChild}function ys(e){return this.select(e==null?vs:ms(typeof e=="function"?e:go(e)))}var bs=Array.prototype.filter;function ws(){return Array.from(this.children)}function _s(e){return function(){return bs.call(this.children,e)}}function xs(e){return this.selectAll(e==null?ws:_s(typeof e=="function"?e:go(e)))}function Es(e){typeof e!="function"&&(e=fo(e));for(var t=this._groups,n=t.length,i=new Array(n),r=0;r<n;++r)for(var o=t[r],a=o.length,s=i[r]=[],u,l=0;l<a;++l)(u=o[l])&&e.call(u,u.__data__,l,o)&&s.push(u);return new Ce(i,this._parents)}function po(e){return new Array(e.length)}function Cs(){return new Ce(this._enter||this._groups.map(po),this._parents)}function xn(e,t){this.ownerDocument=e.ownerDocument,this.namespaceURI=e.namespaceURI,this._next=null,this._parent=e,this.__data__=t}xn.prototype={constructor:xn,appendChild:function(e){return this._parent.insertBefore(e,this._next)},insertBefore:function(e,t){return this._parent.insertBefore(e,t)},querySelector:function(e){return this._parent.querySelector(e)},querySelectorAll:function(e){return this._parent.querySelectorAll(e)}};function ks(e){return function(){return e}}function Ts(e,t,n,i,r,o){for(var a=0,s,u=t.length,l=o.length;a<l;++a)(s=t[a])?(s.__data__=o[a],i[a]=s):n[a]=new xn(e,o[a]);for(;a<u;++a)(s=t[a])&&(r[a]=s)}function As(e,t,n,i,r,o,a){var s,u,l=new Map,c=t.length,d=o.length,h=new Array(c),f;for(s=0;s<c;++s)(u=t[s])&&(h[s]=f=a.call(u,u.__data__,s,t)+"",l.has(f)?r[s]=u:l.set(f,u));for(s=0;s<d;++s)f=a.call(e,o[s],s,o)+"",(u=l.get(f))?(i[s]=u,u.__data__=o[s],l.delete(f)):n[s]=new xn(e,o[s]);for(s=0;s<c;++s)(u=t[s])&&l.get(h[s])===u&&(r[s]=u)}function Ss(e){return e.__data__}function Ls(e,t){if(!arguments.length)return Array.from(this,Ss);var n=t?As:Ts,i=this._parents,r=this._groups;typeof e!="function"&&(e=ks(e));for(var o=r.length,a=new Array(o),s=new Array(o),u=new Array(o),l=0;l<o;++l){var c=i[l],d=r[l],h=d.length,f=Rs(e.call(c,c&&c.__data__,l,i)),g=f.length,m=s[l]=new Array(g),b=a[l]=new Array(g),E=u[l]=new Array(h);n(c,d,m,b,E,f,t);for(var x=0,_=0,p,v;x<g;++x)if(p=m[x]){for(x>=_&&(_=x+1);!(v=b[_])&&++_<g;);p._next=v||null}}return a=new Ce(a,i),a._enter=s,a._exit=u,a}function Rs(e){return typeof e=="object"&&"length"in e?e:Array.from(e)}function Ns(){return new Ce(this._exit||this._groups.map(po),this._parents)}function Ms(e,t,n){var i=this.enter(),r=this,o=this.exit();return typeof e=="function"?(i=e(i),i&&(i=i.selection())):i=i.append(e+""),t!=null&&(r=t(r),r&&(r=r.selection())),n==null?o.remove():n(o),i&&r?i.merge(r).order():r}function Ds(e){for(var t=e.selection?e.selection():e,n=this._groups,i=t._groups,r=n.length,o=i.length,a=Math.min(r,o),s=new Array(r),u=0;u<a;++u)for(var l=n[u],c=i[u],d=l.length,h=s[u]=new Array(d),f,g=0;g<d;++g)(f=l[g]||c[g])&&(h[g]=f);for(;u<r;++u)s[u]=n[u];return new Ce(s,this._parents)}function $s(){for(var e=this._groups,t=-1,n=e.length;++t<n;)for(var i=e[t],r=i.length-1,o=i[r],a;--r>=0;)(a=i[r])&&(o&&a.compareDocumentPosition(o)^4&&o.parentNode.insertBefore(a,o),o=a);return this}function Gs(e){e||(e=Ps);function t(d,h){return d&&h?e(d.__data__,h.__data__):!d-!h}for(var n=this._groups,i=n.length,r=new Array(i),o=0;o<i;++o){for(var a=n[o],s=a.length,u=r[o]=new Array(s),l,c=0;c<s;++c)(l=a[c])&&(u[c]=l);u.sort(t)}return new Ce(r,this._parents).order()}function Ps(e,t){return e<t?-1:e>t?1:e>=t?0:NaN}function Is(){var e=arguments[0];return arguments[0]=this,e.apply(null,arguments),this}function Fs(){return Array.from(this)}function zs(){for(var e=this._groups,t=0,n=e.length;t<n;++t)for(var i=e[t],r=0,o=i.length;r<o;++r){var a=i[r];if(a)return a}return null}function Os(){let e=0;for(const t of this)++e;return e}function Bs(){return!this.node()}function Us(e){for(var t=this._groups,n=0,i=t.length;n<i;++n)for(var r=t[n],o=0,a=r.length,s;o<a;++o)(s=r[o])&&e.call(s,s.__data__,o,r);return this}function Hs(e){return function(){this.removeAttribute(e)}}function Ws(e){return function(){this.removeAttributeNS(e.space,e.local)}}function qs(e,t){return function(){this.setAttribute(e,t)}}function Vs(e,t){return function(){this.setAttributeNS(e.space,e.local,t)}}function js(e,t){return function(){var n=t.apply(this,arguments);n==null?this.removeAttribute(e):this.setAttribute(e,n)}}function Ys(e,t){return function(){var n=t.apply(this,arguments);n==null?this.removeAttributeNS(e.space,e.local):this.setAttributeNS(e.space,e.local,n)}}function Xs(e,t){var n=Gn(e);if(arguments.length<2){var i=this.node();return n.local?i.getAttributeNS(n.space,n.local):i.getAttribute(n)}return this.each((t==null?n.local?Ws:Hs:typeof t=="function"?n.local?Ys:js:n.local?Vs:qs)(n,t))}function mo(e){return e.ownerDocument&&e.ownerDocument.defaultView||e.document&&e||e.defaultView}function Ks(e){return function(){this.style.removeProperty(e)}}function Zs(e,t,n){return function(){this.style.setProperty(e,t,n)}}function Js(e,t,n){return function(){var i=t.apply(this,arguments);i==null?this.style.removeProperty(e):this.style.setProperty(e,i,n)}}function Qs(e,t,n){return arguments.length>1?this.each((t==null?Ks:typeof t=="function"?Js:Zs)(e,t,n??"")):Et(this.node(),e)}function Et(e,t){return e.style.getPropertyValue(t)||mo(e).getComputedStyle(e,null).getPropertyValue(t)}function eu(e){return function(){delete this[e]}}function tu(e,t){return function(){this[e]=t}}function nu(e,t){return function(){var n=t.apply(this,arguments);n==null?delete this[e]:this[e]=n}}function iu(e,t){return arguments.length>1?this.each((t==null?eu:typeof t=="function"?nu:tu)(e,t)):this.node()[e]}function vo(e){return e.trim().split(/^|\s+/)}function Ri(e){return e.classList||new yo(e)}function yo(e){this._node=e,this._names=vo(e.getAttribute("class")||"")}yo.prototype={add:function(e){var t=this._names.indexOf(e);t<0&&(this._names.push(e),this._node.setAttribute("class",this._names.join(" ")))},remove:function(e){var t=this._names.indexOf(e);t>=0&&(this._names.splice(t,1),this._node.setAttribute("class",this._names.join(" ")))},contains:function(e){return this._names.indexOf(e)>=0}};function bo(e,t){for(var n=Ri(e),i=-1,r=t.length;++i<r;)n.add(t[i])}function wo(e,t){for(var n=Ri(e),i=-1,r=t.length;++i<r;)n.remove(t[i])}function ru(e){return function(){bo(this,e)}}function ou(e){return function(){wo(this,e)}}function au(e,t){return function(){(t.apply(this,arguments)?bo:wo)(this,e)}}function su(e,t){var n=vo(e+"");if(arguments.length<2){for(var i=Ri(this.node()),r=-1,o=n.length;++r<o;)if(!i.contains(n[r]))return!1;return!0}return this.each((typeof t=="function"?au:t?ru:ou)(n,t))}function uu(){this.textContent=""}function lu(e){return function(){this.textContent=e}}function cu(e){return function(){var t=e.apply(this,arguments);this.textContent=t??""}}function du(e){return arguments.length?this.each(e==null?uu:(typeof e=="function"?cu:lu)(e)):this.node().textContent}function hu(){this.innerHTML=""}function fu(e){return function(){this.innerHTML=e}}function gu(e){return function(){var t=e.apply(this,arguments);this.innerHTML=t??""}}function pu(e){return arguments.length?this.each(e==null?hu:(typeof e=="function"?gu:fu)(e)):this.node().innerHTML}function mu(){this.nextSibling&&this.parentNode.appendChild(this)}function vu(){return this.each(mu)}function yu(){this.previousSibling&&this.parentNode.insertBefore(this,this.parentNode.firstChild)}function bu(){return this.each(yu)}function wu(e){var t=typeof e=="function"?e:co(e);return this.select(function(){return this.appendChild(t.apply(this,arguments))})}function _u(){return null}function xu(e,t){var n=typeof e=="function"?e:co(e),i=t==null?_u:typeof t=="function"?t:Li(t);return this.select(function(){return this.insertBefore(n.apply(this,arguments),i.apply(this,arguments)||null)})}function Eu(){var e=this.parentNode;e&&e.removeChild(this)}function Cu(){return this.each(Eu)}function ku(){var e=this.cloneNode(!1),t=this.parentNode;return t?t.insertBefore(e,this.nextSibling):e}function Tu(){var e=this.cloneNode(!0),t=this.parentNode;return t?t.insertBefore(e,this.nextSibling):e}function Au(e){return this.select(e?Tu:ku)}function Su(e){return arguments.length?this.property("__data__",e):this.node().__data__}function Lu(e){return function(t){e.call(this,t,this.__data__)}}function Ru(e){return e.trim().split(/^|\s+/).map(function(t){var n="",i=t.indexOf(".");return i>=0&&(n=t.slice(i+1),t=t.slice(0,i)),{type:t,name:n}})}function Nu(e){return function(){var t=this.__on;if(t){for(var n=0,i=-1,r=t.length,o;n<r;++n)o=t[n],(!e.type||o.type===e.type)&&o.name===e.name?this.removeEventListener(o.type,o.listener,o.options):t[++i]=o;++i?t.length=i:delete this.__on}}}function Mu(e,t,n){return function(){var i=this.__on,r,o=Lu(t);if(i){for(var a=0,s=i.length;a<s;++a)if((r=i[a]).type===e.type&&r.name===e.name){this.removeEventListener(r.type,r.listener,r.options),this.addEventListener(r.type,r.listener=o,r.options=n),r.value=t;return}}this.addEventListener(e.type,o,n),r={type:e.type,name:e.name,value:t,listener:o,options:n},i?i.push(r):this.__on=[r]}}function Du(e,t,n){var i=Ru(e+""),r,o=i.length,a;if(arguments.length<2){var s=this.node().__on;if(s){for(var u=0,l=s.length,c;u<l;++u)for(r=0,c=s[u];r<o;++r)if((a=i[r]).type===c.type&&a.name===c.name)return c.value}return}for(s=t?Mu:Nu,r=0;r<o;++r)this.each(s(i[r],t,n));return this}function _o(e,t,n){var i=mo(e),r=i.CustomEvent;typeof r=="function"?r=new r(t,n):(r=i.document.createEvent("Event"),n?(r.initEvent(t,n.bubbles,n.cancelable),r.detail=n.detail):r.initEvent(t,!1,!1)),e.dispatchEvent(r)}function $u(e,t){return function(){return _o(this,e,t)}}function Gu(e,t){return function(){return _o(this,e,t.apply(this,arguments))}}function Pu(e,t){return this.each((typeof t=="function"?Gu:$u)(e,t))}function*Iu(){for(var e=this._groups,t=0,n=e.length;t<n;++t)for(var i=e[t],r=0,o=i.length,a;r<o;++r)(a=i[r])&&(yield a)}var xo=[null];function Ce(e,t){this._groups=e,this._parents=t}function Jt(){return new Ce([[document.documentElement]],xo)}function Fu(){return this}Ce.prototype=Jt.prototype={constructor:Ce,select:cs,selectAll:gs,selectChild:ys,selectChildren:xs,filter:Es,data:Ls,enter:Cs,exit:Ns,join:Ms,merge:Ds,selection:Fu,order:$s,sort:Gs,call:Is,nodes:Fs,node:zs,size:Os,empty:Bs,each:Us,attr:Xs,style:Qs,property:iu,classed:su,text:du,html:pu,raise:vu,lower:bu,append:wu,insert:xu,remove:Cu,clone:Au,datum:Su,on:Du,dispatch:Pu,[Symbol.iterator]:Iu};function $e(e){return typeof e=="string"?new Ce([[document.querySelector(e)]],[document.documentElement]):new Ce([[e]],xo)}function He(e){return new Ce([document.querySelectorAll(e)],[document.documentElement])}function Ni(e,t,n){e.prototype=t.prototype=n,n.constructor=e}function Eo(e,t){var n=Object.create(e.prototype);for(var i in t)n[i]=t[i];return n}function Qt(){}var Yt=.7,En=1/Yt,_t="\\s*([+-]?\\d+)\\s*",Xt="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)\\s*",qe="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)%\\s*",zu=/^#([0-9a-f]{3,8})$/,Ou=new RegExp(`^rgb\\(${_t},${_t},${_t}\\)$`),Bu=new RegExp(`^rgb\\(${qe},${qe},${qe}\\)$`),Uu=new RegExp(`^rgba\\(${_t},${_t},${_t},${Xt}\\)$`),Hu=new RegExp(`^rgba\\(${qe},${qe},${qe},${Xt}\\)$`),Wu=new RegExp(`^hsl\\(${Xt},${qe},${qe}\\)$`),qu=new RegExp(`^hsla\\(${Xt},${qe},${qe},${Xt}\\)$`),sr={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074};Ni(Qt,pt,{copy(e){return Object.assign(new this.constructor,this,e)},displayable(){return this.rgb().displayable()},hex:ur,formatHex:ur,formatHex8:Vu,formatHsl:ju,formatRgb:lr,toString:lr});function ur(){return this.rgb().formatHex()}function Vu(){return this.rgb().formatHex8()}function ju(){return Co(this).formatHsl()}function lr(){return this.rgb().formatRgb()}function pt(e){var t,n;return e=(e+"").trim().toLowerCase(),(t=zu.exec(e))?(n=t[1].length,t=parseInt(t[1],16),n===6?cr(t):n===3?new Ee(t>>8&15|t>>4&240,t>>4&15|t&240,(t&15)<<4|t&15,1):n===8?rn(t>>24&255,t>>16&255,t>>8&255,(t&255)/255):n===4?rn(t>>12&15|t>>8&240,t>>8&15|t>>4&240,t>>4&15|t&240,((t&15)<<4|t&15)/255):null):(t=Ou.exec(e))?new Ee(t[1],t[2],t[3],1):(t=Bu.exec(e))?new Ee(t[1]*255/100,t[2]*255/100,t[3]*255/100,1):(t=Uu.exec(e))?rn(t[1],t[2],t[3],t[4]):(t=Hu.exec(e))?rn(t[1]*255/100,t[2]*255/100,t[3]*255/100,t[4]):(t=Wu.exec(e))?fr(t[1],t[2]/100,t[3]/100,1):(t=qu.exec(e))?fr(t[1],t[2]/100,t[3]/100,t[4]):sr.hasOwnProperty(e)?cr(sr[e]):e==="transparent"?new Ee(NaN,NaN,NaN,0):null}function cr(e){return new Ee(e>>16&255,e>>8&255,e&255,1)}function rn(e,t,n,i){return i<=0&&(e=t=n=NaN),new Ee(e,t,n,i)}function Yu(e){return e instanceof Qt||(e=pt(e)),e?(e=e.rgb(),new Ee(e.r,e.g,e.b,e.opacity)):new Ee}function fi(e,t,n,i){return arguments.length===1?Yu(e):new Ee(e,t,n,i??1)}function Ee(e,t,n,i){this.r=+e,this.g=+t,this.b=+n,this.opacity=+i}Ni(Ee,fi,Eo(Qt,{brighter(e){return e=e==null?En:Math.pow(En,e),new Ee(this.r*e,this.g*e,this.b*e,this.opacity)},darker(e){return e=e==null?Yt:Math.pow(Yt,e),new Ee(this.r*e,this.g*e,this.b*e,this.opacity)},rgb(){return this},clamp(){return new Ee(gt(this.r),gt(this.g),gt(this.b),Cn(this.opacity))},displayable(){return-.5<=this.r&&this.r<255.5&&-.5<=this.g&&this.g<255.5&&-.5<=this.b&&this.b<255.5&&0<=this.opacity&&this.opacity<=1},hex:dr,formatHex:dr,formatHex8:Xu,formatRgb:hr,toString:hr}));function dr(){return`#${ft(this.r)}${ft(this.g)}${ft(this.b)}`}function Xu(){return`#${ft(this.r)}${ft(this.g)}${ft(this.b)}${ft((isNaN(this.opacity)?1:this.opacity)*255)}`}function hr(){const e=Cn(this.opacity);return`${e===1?"rgb(":"rgba("}${gt(this.r)}, ${gt(this.g)}, ${gt(this.b)}${e===1?")":`, ${e})`}`}function Cn(e){return isNaN(e)?1:Math.max(0,Math.min(1,e))}function gt(e){return Math.max(0,Math.min(255,Math.round(e)||0))}function ft(e){return e=gt(e),(e<16?"0":"")+e.toString(16)}function fr(e,t,n,i){return i<=0?e=t=n=NaN:n<=0||n>=1?e=t=NaN:t<=0&&(e=NaN),new Fe(e,t,n,i)}function Co(e){if(e instanceof Fe)return new Fe(e.h,e.s,e.l,e.opacity);if(e instanceof Qt||(e=pt(e)),!e)return new Fe;if(e instanceof Fe)return e;e=e.rgb();var t=e.r/255,n=e.g/255,i=e.b/255,r=Math.min(t,n,i),o=Math.max(t,n,i),a=NaN,s=o-r,u=(o+r)/2;return s?(t===o?a=(n-i)/s+(n<i)*6:n===o?a=(i-t)/s+2:a=(t-n)/s+4,s/=u<.5?o+r:2-o-r,a*=60):s=u>0&&u<1?0:a,new Fe(a,s,u,e.opacity)}function Ku(e,t,n,i){return arguments.length===1?Co(e):new Fe(e,t,n,i??1)}function Fe(e,t,n,i){this.h=+e,this.s=+t,this.l=+n,this.opacity=+i}Ni(Fe,Ku,Eo(Qt,{brighter(e){return e=e==null?En:Math.pow(En,e),new Fe(this.h,this.s,this.l*e,this.opacity)},darker(e){return e=e==null?Yt:Math.pow(Yt,e),new Fe(this.h,this.s,this.l*e,this.opacity)},rgb(){var e=this.h%360+(this.h<0)*360,t=isNaN(e)||isNaN(this.s)?0:this.s,n=this.l,i=n+(n<.5?n:1-n)*t,r=2*n-i;return new Ee(Yn(e>=240?e-240:e+120,r,i),Yn(e,r,i),Yn(e<120?e+240:e-120,r,i),this.opacity)},clamp(){return new Fe(gr(this.h),on(this.s),on(this.l),Cn(this.opacity))},displayable(){return(0<=this.s&&this.s<=1||isNaN(this.s))&&0<=this.l&&this.l<=1&&0<=this.opacity&&this.opacity<=1},formatHsl(){const e=Cn(this.opacity);return`${e===1?"hsl(":"hsla("}${gr(this.h)}, ${on(this.s)*100}%, ${on(this.l)*100}%${e===1?")":`, ${e})`}`}}));function gr(e){return e=(e||0)%360,e<0?e+360:e}function on(e){return Math.max(0,Math.min(1,e||0))}function Yn(e,t,n){return(e<60?t+(n-t)*e/60:e<180?n:e<240?t+(n-t)*(240-e)/60:t)*255}const Mi=e=>()=>e;function Zu(e,t){return function(n){return e+n*t}}function Ju(e,t,n){return e=Math.pow(e,n),t=Math.pow(t,n)-e,n=1/n,function(i){return Math.pow(e+i*t,n)}}function Qu(e){return(e=+e)==1?ko:function(t,n){return n-t?Ju(t,n,e):Mi(isNaN(t)?n:t)}}function ko(e,t){var n=t-e;return n?Zu(e,n):Mi(isNaN(e)?t:e)}const kn=function e(t){var n=Qu(t);function i(r,o){var a=n((r=fi(r)).r,(o=fi(o)).r),s=n(r.g,o.g),u=n(r.b,o.b),l=ko(r.opacity,o.opacity);return function(c){return r.r=a(c),r.g=s(c),r.b=u(c),r.opacity=l(c),r+""}}return i.gamma=e,i}(1);function el(e,t){t||(t=[]);var n=e?Math.min(t.length,e.length):0,i=t.slice(),r;return function(o){for(r=0;r<n;++r)i[r]=e[r]*(1-o)+t[r]*o;return i}}function tl(e){return ArrayBuffer.isView(e)&&!(e instanceof DataView)}function nl(e,t){var n=t?t.length:0,i=e?Math.min(n,e.length):0,r=new Array(i),o=new Array(n),a;for(a=0;a<i;++a)r[a]=Di(e[a],t[a]);for(;a<n;++a)o[a]=t[a];return function(s){for(a=0;a<i;++a)o[a]=r[a](s);return o}}function il(e,t){var n=new Date;return e=+e,t=+t,function(i){return n.setTime(e*(1-i)+t*i),n}}function Ie(e,t){return e=+e,t=+t,function(n){return e*(1-n)+t*n}}function rl(e,t){var n={},i={},r;(e===null||typeof e!="object")&&(e={}),(t===null||typeof t!="object")&&(t={});for(r in t)r in e?n[r]=Di(e[r],t[r]):i[r]=t[r];return function(o){for(r in n)i[r]=n[r](o);return i}}var gi=/[-+]?(?:\d+\.?\d*|\.?\d+)(?:[eE][-+]?\d+)?/g,Xn=new RegExp(gi.source,"g");function ol(e){return function(){return e}}function al(e){return function(t){return e(t)+""}}function To(e,t){var n=gi.lastIndex=Xn.lastIndex=0,i,r,o,a=-1,s=[],u=[];for(e=e+"",t=t+"";(i=gi.exec(e))&&(r=Xn.exec(t));)(o=r.index)>n&&(o=t.slice(n,o),s[a]?s[a]+=o:s[++a]=o),(i=i[0])===(r=r[0])?s[a]?s[a]+=r:s[++a]=r:(s[++a]=null,u.push({i:a,x:Ie(i,r)})),n=Xn.lastIndex;return n<t.length&&(o=t.slice(n),s[a]?s[a]+=o:s[++a]=o),s.length<2?u[0]?al(u[0].x):ol(t):(t=u.length,function(l){for(var c=0,d;c<t;++c)s[(d=u[c]).i]=d.x(l);return s.join("")})}function Di(e,t){var n=typeof t,i;return t==null||n==="boolean"?Mi(t):(n==="number"?Ie:n==="string"?(i=pt(t))?(t=i,kn):To:t instanceof pt?kn:t instanceof Date?il:tl(t)?el:Array.isArray(t)?nl:typeof t.valueOf!="function"&&typeof t.toString!="function"||isNaN(t)?rl:Ie)(e,t)}function sl(e,t){return e=+e,t=+t,function(n){return Math.round(e*(1-n)+t*n)}}var pr=180/Math.PI,pi={translateX:0,translateY:0,rotate:0,skewX:0,scaleX:1,scaleY:1};function Ao(e,t,n,i,r,o){var a,s,u;return(a=Math.sqrt(e*e+t*t))&&(e/=a,t/=a),(u=e*n+t*i)&&(n-=e*u,i-=t*u),(s=Math.sqrt(n*n+i*i))&&(n/=s,i/=s,u/=s),e*i<t*n&&(e=-e,t=-t,u=-u,a=-a),{translateX:r,translateY:o,rotate:Math.atan2(t,e)*pr,skewX:Math.atan(u)*pr,scaleX:a,scaleY:s}}var an;function ul(e){const t=new(typeof DOMMatrix=="function"?DOMMatrix:WebKitCSSMatrix)(e+"");return t.isIdentity?pi:Ao(t.a,t.b,t.c,t.d,t.e,t.f)}function ll(e){return e==null||(an||(an=document.createElementNS("http://www.w3.org/2000/svg","g")),an.setAttribute("transform",e),!(e=an.transform.baseVal.consolidate()))?pi:(e=e.matrix,Ao(e.a,e.b,e.c,e.d,e.e,e.f))}function So(e,t,n,i){function r(l){return l.length?l.pop()+" ":""}function o(l,c,d,h,f,g){if(l!==d||c!==h){var m=f.push("translate(",null,t,null,n);g.push({i:m-4,x:Ie(l,d)},{i:m-2,x:Ie(c,h)})}else(d||h)&&f.push("translate("+d+t+h+n)}function a(l,c,d,h){l!==c?(l-c>180?c+=360:c-l>180&&(l+=360),h.push({i:d.push(r(d)+"rotate(",null,i)-2,x:Ie(l,c)})):c&&d.push(r(d)+"rotate("+c+i)}function s(l,c,d,h){l!==c?h.push({i:d.push(r(d)+"skewX(",null,i)-2,x:Ie(l,c)}):c&&d.push(r(d)+"skewX("+c+i)}function u(l,c,d,h,f,g){if(l!==d||c!==h){var m=f.push(r(f)+"scale(",null,",",null,")");g.push({i:m-4,x:Ie(l,d)},{i:m-2,x:Ie(c,h)})}else(d!==1||h!==1)&&f.push(r(f)+"scale("+d+","+h+")")}return function(l,c){var d=[],h=[];return l=e(l),c=e(c),o(l.translateX,l.translateY,c.translateX,c.translateY,d,h),a(l.rotate,c.rotate,d,h),s(l.skewX,c.skewX,d,h),u(l.scaleX,l.scaleY,c.scaleX,c.scaleY,d,h),l=c=null,function(f){for(var g=-1,m=h.length,b;++g<m;)d[(b=h[g]).i]=b.x(f);return d.join("")}}}var cl=So(ul,"px, ","px)","deg)"),dl=So(ll,", ",")",")"),Ct=0,Ut=0,$t=0,Lo=1e3,Tn,Ht,An=0,mt=0,Pn=0,Kt=typeof performance=="object"&&performance.now?performance:Date,Ro=typeof window=="object"&&window.requestAnimationFrame?window.requestAnimationFrame.bind(window):function(e){setTimeout(e,17)};function $i(){return mt||(Ro(hl),mt=Kt.now()+Pn)}function hl(){mt=0}function Sn(){this._call=this._time=this._next=null}Sn.prototype=No.prototype={constructor:Sn,restart:function(e,t,n){if(typeof e!="function")throw new TypeError("callback is not a function");n=(n==null?$i():+n)+(t==null?0:+t),!this._next&&Ht!==this&&(Ht?Ht._next=this:Tn=this,Ht=this),this._call=e,this._time=n,mi()},stop:function(){this._call&&(this._call=null,this._time=1/0,mi())}};function No(e,t,n){var i=new Sn;return i.restart(e,t,n),i}function fl(){$i(),++Ct;for(var e=Tn,t;e;)(t=mt-e._time)>=0&&e._call.call(void 0,t),e=e._next;--Ct}function mr(){mt=(An=Kt.now())+Pn,Ct=Ut=0;try{fl()}finally{Ct=0,pl(),mt=0}}function gl(){var e=Kt.now(),t=e-An;t>Lo&&(Pn-=t,An=e)}function pl(){for(var e,t=Tn,n,i=1/0;t;)t._call?(i>t._time&&(i=t._time),e=t,t=t._next):(n=t._next,t._next=null,t=e?e._next=n:Tn=n);Ht=e,mi(i)}function mi(e){if(!Ct){Ut&&(Ut=clearTimeout(Ut));var t=e-mt;t>24?(e<1/0&&(Ut=setTimeout(mr,e-Kt.now()-Pn)),$t&&($t=clearInterval($t))):($t||(An=Kt.now(),$t=setInterval(gl,Lo)),Ct=1,Ro(mr))}}function vr(e,t,n){var i=new Sn;return t=t==null?0:+t,i.restart(r=>{i.stop(),e(r+t)},t,n),i}var ml=lo("start","end","cancel","interrupt"),vl=[],Mo=0,yr=1,vi=2,vn=3,br=4,yi=5,yn=6;function In(e,t,n,i,r,o){var a=e.__transition;if(!a)e.__transition={};else if(n in a)return;yl(e,n,{name:t,index:i,group:r,on:ml,tween:vl,time:o.time,delay:o.delay,duration:o.duration,ease:o.ease,timer:null,state:Mo})}function Gi(e,t){var n=Oe(e,t);if(n.state>Mo)throw new Error("too late; already scheduled");return n}function Ve(e,t){var n=Oe(e,t);if(n.state>vn)throw new Error("too late; already running");return n}function Oe(e,t){var n=e.__transition;if(!n||!(n=n[t]))throw new Error("transition not found");return n}function yl(e,t,n){var i=e.__transition,r;i[t]=n,n.timer=No(o,0,n.time);function o(l){n.state=yr,n.timer.restart(a,n.delay,n.time),n.delay<=l&&a(l-n.delay)}function a(l){var c,d,h,f;if(n.state!==yr)return u();for(c in i)if(f=i[c],f.name===n.name){if(f.state===vn)return vr(a);f.state===br?(f.state=yn,f.timer.stop(),f.on.call("interrupt",e,e.__data__,f.index,f.group),delete i[c]):+c<t&&(f.state=yn,f.timer.stop(),f.on.call("cancel",e,e.__data__,f.index,f.group),delete i[c])}if(vr(function(){n.state===vn&&(n.state=br,n.timer.restart(s,n.delay,n.time),s(l))}),n.state=vi,n.on.call("start",e,e.__data__,n.index,n.group),n.state===vi){for(n.state=vn,r=new Array(h=n.tween.length),c=0,d=-1;c<h;++c)(f=n.tween[c].value.call(e,e.__data__,n.index,n.group))&&(r[++d]=f);r.length=d+1}}function s(l){for(var c=l<n.duration?n.ease.call(null,l/n.duration):(n.timer.restart(u),n.state=yi,1),d=-1,h=r.length;++d<h;)r[d].call(e,c);n.state===yi&&(n.on.call("end",e,e.__data__,n.index,n.group),u())}function u(){n.state=yn,n.timer.stop(),delete i[t];for(var l in i)return;delete e.__transition}}function bl(e,t){var n=e.__transition,i,r,o=!0,a;if(n){t=t==null?null:t+"";for(a in n){if((i=n[a]).name!==t){o=!1;continue}r=i.state>vi&&i.state<yi,i.state=yn,i.timer.stop(),i.on.call(r?"interrupt":"cancel",e,e.__data__,i.index,i.group),delete n[a]}o&&delete e.__transition}}function wl(e){return this.each(function(){bl(this,e)})}function _l(e,t){var n,i;return function(){var r=Ve(this,e),o=r.tween;if(o!==n){i=n=o;for(var a=0,s=i.length;a<s;++a)if(i[a].name===t){i=i.slice(),i.splice(a,1);break}}r.tween=i}}function xl(e,t,n){var i,r;if(typeof n!="function")throw new Error;return function(){var o=Ve(this,e),a=o.tween;if(a!==i){r=(i=a).slice();for(var s={name:t,value:n},u=0,l=r.length;u<l;++u)if(r[u].name===t){r[u]=s;break}u===l&&r.push(s)}o.tween=r}}function El(e,t){var n=this._id;if(e+="",arguments.length<2){for(var i=Oe(this.node(),n).tween,r=0,o=i.length,a;r<o;++r)if((a=i[r]).name===e)return a.value;return null}return this.each((t==null?_l:xl)(n,e,t))}function Pi(e,t,n){var i=e._id;return e.each(function(){var r=Ve(this,i);(r.value||(r.value={}))[t]=n.apply(this,arguments)}),function(r){return Oe(r,i).value[t]}}function Do(e,t){var n;return(typeof t=="number"?Ie:t instanceof pt?kn:(n=pt(t))?(t=n,kn):To)(e,t)}function Cl(e){return function(){this.removeAttribute(e)}}function kl(e){return function(){this.removeAttributeNS(e.space,e.local)}}function Tl(e,t,n){var i,r=n+"",o;return function(){var a=this.getAttribute(e);return a===r?null:a===i?o:o=t(i=a,n)}}function Al(e,t,n){var i,r=n+"",o;return function(){var a=this.getAttributeNS(e.space,e.local);return a===r?null:a===i?o:o=t(i=a,n)}}function Sl(e,t,n){var i,r,o;return function(){var a,s=n(this),u;return s==null?void this.removeAttribute(e):(a=this.getAttribute(e),u=s+"",a===u?null:a===i&&u===r?o:(r=u,o=t(i=a,s)))}}function Ll(e,t,n){var i,r,o;return function(){var a,s=n(this),u;return s==null?void this.removeAttributeNS(e.space,e.local):(a=this.getAttributeNS(e.space,e.local),u=s+"",a===u?null:a===i&&u===r?o:(r=u,o=t(i=a,s)))}}function Rl(e,t){var n=Gn(e),i=n==="transform"?dl:Do;return this.attrTween(e,typeof t=="function"?(n.local?Ll:Sl)(n,i,Pi(this,"attr."+e,t)):t==null?(n.local?kl:Cl)(n):(n.local?Al:Tl)(n,i,t))}function Nl(e,t){return function(n){this.setAttribute(e,t.call(this,n))}}function Ml(e,t){return function(n){this.setAttributeNS(e.space,e.local,t.call(this,n))}}function Dl(e,t){var n,i;function r(){var o=t.apply(this,arguments);return o!==i&&(n=(i=o)&&Ml(e,o)),n}return r._value=t,r}function $l(e,t){var n,i;function r(){var o=t.apply(this,arguments);return o!==i&&(n=(i=o)&&Nl(e,o)),n}return r._value=t,r}function Gl(e,t){var n="attr."+e;if(arguments.length<2)return(n=this.tween(n))&&n._value;if(t==null)return this.tween(n,null);if(typeof t!="function")throw new Error;var i=Gn(e);return this.tween(n,(i.local?Dl:$l)(i,t))}function Pl(e,t){return function(){Gi(this,e).delay=+t.apply(this,arguments)}}function Il(e,t){return t=+t,function(){Gi(this,e).delay=t}}function Fl(e){var t=this._id;return arguments.length?this.each((typeof e=="function"?Pl:Il)(t,e)):Oe(this.node(),t).delay}function zl(e,t){return function(){Ve(this,e).duration=+t.apply(this,arguments)}}function Ol(e,t){return t=+t,function(){Ve(this,e).duration=t}}function Bl(e){var t=this._id;return arguments.length?this.each((typeof e=="function"?zl:Ol)(t,e)):Oe(this.node(),t).duration}function Ul(e,t){if(typeof t!="function")throw new Error;return function(){Ve(this,e).ease=t}}function Hl(e){var t=this._id;return arguments.length?this.each(Ul(t,e)):Oe(this.node(),t).ease}function Wl(e,t){return function(){var n=t.apply(this,arguments);if(typeof n!="function")throw new Error;Ve(this,e).ease=n}}function ql(e){if(typeof e!="function")throw new Error;return this.each(Wl(this._id,e))}function Vl(e){typeof e!="function"&&(e=fo(e));for(var t=this._groups,n=t.length,i=new Array(n),r=0;r<n;++r)for(var o=t[r],a=o.length,s=i[r]=[],u,l=0;l<a;++l)(u=o[l])&&e.call(u,u.__data__,l,o)&&s.push(u);return new Je(i,this._parents,this._name,this._id)}function jl(e){if(e._id!==this._id)throw new Error;for(var t=this._groups,n=e._groups,i=t.length,r=n.length,o=Math.min(i,r),a=new Array(i),s=0;s<o;++s)for(var u=t[s],l=n[s],c=u.length,d=a[s]=new Array(c),h,f=0;f<c;++f)(h=u[f]||l[f])&&(d[f]=h);for(;s<i;++s)a[s]=t[s];return new Je(a,this._parents,this._name,this._id)}function Yl(e){return(e+"").trim().split(/^|\s+/).every(function(t){var n=t.indexOf(".");return n>=0&&(t=t.slice(0,n)),!t||t==="start"})}function Xl(e,t,n){var i,r,o=Yl(t)?Gi:Ve;return function(){var a=o(this,e),s=a.on;s!==i&&(r=(i=s).copy()).on(t,n),a.on=r}}function Kl(e,t){var n=this._id;return arguments.length<2?Oe(this.node(),n).on.on(e):this.each(Xl(n,e,t))}function Zl(e){return function(){var t=this.parentNode;for(var n in this.__transition)if(+n!==e)return;t&&t.removeChild(this)}}function Jl(){return this.on("end.remove",Zl(this._id))}function Ql(e){var t=this._name,n=this._id;typeof e!="function"&&(e=Li(e));for(var i=this._groups,r=i.length,o=new Array(r),a=0;a<r;++a)for(var s=i[a],u=s.length,l=o[a]=new Array(u),c,d,h=0;h<u;++h)(c=s[h])&&(d=e.call(c,c.__data__,h,s))&&("__data__"in c&&(d.__data__=c.__data__),l[h]=d,In(l[h],t,n,h,l,Oe(c,n)));return new Je(o,this._parents,t,n)}function ec(e){var t=this._name,n=this._id;typeof e!="function"&&(e=ho(e));for(var i=this._groups,r=i.length,o=[],a=[],s=0;s<r;++s)for(var u=i[s],l=u.length,c,d=0;d<l;++d)if(c=u[d]){for(var h=e.call(c,c.__data__,d,u),f,g=Oe(c,n),m=0,b=h.length;m<b;++m)(f=h[m])&&In(f,t,n,m,h,g);o.push(h),a.push(c)}return new Je(o,a,t,n)}var tc=Jt.prototype.constructor;function nc(){return new tc(this._groups,this._parents)}function ic(e,t){var n,i,r;return function(){var o=Et(this,e),a=(this.style.removeProperty(e),Et(this,e));return o===a?null:o===n&&a===i?r:r=t(n=o,i=a)}}function $o(e){return function(){this.style.removeProperty(e)}}function rc(e,t,n){var i,r=n+"",o;return function(){var a=Et(this,e);return a===r?null:a===i?o:o=t(i=a,n)}}function oc(e,t,n){var i,r,o;return function(){var a=Et(this,e),s=n(this),u=s+"";return s==null&&(u=s=(this.style.removeProperty(e),Et(this,e))),a===u?null:a===i&&u===r?o:(r=u,o=t(i=a,s))}}function ac(e,t){var n,i,r,o="style."+t,a="end."+o,s;return function(){var u=Ve(this,e),l=u.on,c=u.value[o]==null?s||(s=$o(t)):void 0;(l!==n||r!==c)&&(i=(n=l).copy()).on(a,r=c),u.on=i}}function sc(e,t,n){var i=(e+="")=="transform"?cl:Do;return t==null?this.styleTween(e,ic(e,i)).on("end.style."+e,$o(e)):typeof t=="function"?this.styleTween(e,oc(e,i,Pi(this,"style."+e,t))).each(ac(this._id,e)):this.styleTween(e,rc(e,i,t),n).on("end.style."+e,null)}function uc(e,t,n){return function(i){this.style.setProperty(e,t.call(this,i),n)}}function lc(e,t,n){var i,r;function o(){var a=t.apply(this,arguments);return a!==r&&(i=(r=a)&&uc(e,a,n)),i}return o._value=t,o}function cc(e,t,n){var i="style."+(e+="");if(arguments.length<2)return(i=this.tween(i))&&i._value;if(t==null)return this.tween(i,null);if(typeof t!="function")throw new Error;return this.tween(i,lc(e,t,n??""))}function dc(e){return function(){this.textContent=e}}function hc(e){return function(){var t=e(this);this.textContent=t??""}}function fc(e){return this.tween("text",typeof e=="function"?hc(Pi(this,"text",e)):dc(e==null?"":e+""))}function gc(e){return function(t){this.textContent=e.call(this,t)}}function pc(e){var t,n;function i(){var r=e.apply(this,arguments);return r!==n&&(t=(n=r)&&gc(r)),t}return i._value=e,i}function mc(e){var t="text";if(arguments.length<1)return(t=this.tween(t))&&t._value;if(e==null)return this.tween(t,null);if(typeof e!="function")throw new Error;return this.tween(t,pc(e))}function vc(){for(var e=this._name,t=this._id,n=Go(),i=this._groups,r=i.length,o=0;o<r;++o)for(var a=i[o],s=a.length,u,l=0;l<s;++l)if(u=a[l]){var c=Oe(u,t);In(u,e,n,l,a,{time:c.time+c.delay+c.duration,delay:0,duration:c.duration,ease:c.ease})}return new Je(i,this._parents,e,n)}function yc(){var e,t,n=this,i=n._id,r=n.size();return new Promise(function(o,a){var s={value:a},u={value:function(){--r===0&&o()}};n.each(function(){var l=Ve(this,i),c=l.on;c!==e&&(t=(e=c).copy(),t._.cancel.push(s),t._.interrupt.push(s),t._.end.push(u)),l.on=t}),r===0&&o()})}var bc=0;function Je(e,t,n,i){this._groups=e,this._parents=t,this._name=n,this._id=i}function Go(){return++bc}var Ye=Jt.prototype;Je.prototype={constructor:Je,select:Ql,selectAll:ec,selectChild:Ye.selectChild,selectChildren:Ye.selectChildren,filter:Vl,merge:jl,selection:nc,transition:vc,call:Ye.call,nodes:Ye.nodes,node:Ye.node,size:Ye.size,empty:Ye.empty,each:Ye.each,on:Kl,attr:Rl,attrTween:Gl,style:sc,styleTween:cc,text:fc,textTween:mc,remove:Jl,tween:El,delay:Fl,duration:Bl,ease:Hl,easeVarying:ql,end:yc,[Symbol.iterator]:Ye[Symbol.iterator]};function wc(e){return((e*=2)<=1?e*e*e:(e-=2)*e*e+2)/2}var _c={time:null,delay:0,duration:250,ease:wc};function xc(e,t){for(var n;!(n=e.__transition)||!(n=n[t]);)if(!(e=e.parentNode))throw new Error(`transition ${t} not found`);return n}function Ec(e){var t,n;e instanceof Je?(t=e._id,e=e._name):(t=Go(),(n=_c).time=$i(),e=e==null?null:e+"");for(var i=this._groups,r=i.length,o=0;o<r;++o)for(var a=i[o],s=a.length,u,l=0;l<s;++l)(u=a[l])&&In(u,e,t,l,a,n||xc(u,t));return new Je(i,this._parents,e,t)}Jt.prototype.interrupt=wl;Jt.prototype.transition=Ec;const bi=Math.PI,wi=2*bi,ht=1e-6,Cc=wi-ht;function Po(e){this._+=e[0];for(let t=1,n=e.length;t<n;++t)this._+=arguments[t]+e[t]}function kc(e){let t=Math.floor(e);if(!(t>=0))throw new Error(`invalid digits: ${e}`);if(t>15)return Po;const n=10**t;return function(i){this._+=i[0];for(let r=1,o=i.length;r<o;++r)this._+=Math.round(arguments[r]*n)/n+i[r]}}class Tc{constructor(t){this._x0=this._y0=this._x1=this._y1=null,this._="",this._append=t==null?Po:kc(t)}moveTo(t,n){this._append`M${this._x0=this._x1=+t},${this._y0=this._y1=+n}`}closePath(){this._x1!==null&&(this._x1=this._x0,this._y1=this._y0,this._append`Z`)}lineTo(t,n){this._append`L${this._x1=+t},${this._y1=+n}`}quadraticCurveTo(t,n,i,r){this._append`Q${+t},${+n},${this._x1=+i},${this._y1=+r}`}bezierCurveTo(t,n,i,r,o,a){this._append`C${+t},${+n},${+i},${+r},${this._x1=+o},${this._y1=+a}`}arcTo(t,n,i,r,o){if(t=+t,n=+n,i=+i,r=+r,o=+o,o<0)throw new Error(`negative radius: ${o}`);let a=this._x1,s=this._y1,u=i-t,l=r-n,c=a-t,d=s-n,h=c*c+d*d;if(this._x1===null)this._append`M${this._x1=t},${this._y1=n}`;else if(h>ht)if(!(Math.abs(d*u-l*c)>ht)||!o)this._append`L${this._x1=t},${this._y1=n}`;else{let f=i-a,g=r-s,m=u*u+l*l,b=f*f+g*g,E=Math.sqrt(m),x=Math.sqrt(h),_=o*Math.tan((bi-Math.acos((m+h-b)/(2*E*x)))/2),p=_/x,v=_/E;Math.abs(p-1)>ht&&this._append`L${t+p*c},${n+p*d}`,this._append`A${o},${o},0,0,${+(d*f>c*g)},${this._x1=t+v*u},${this._y1=n+v*l}`}}arc(t,n,i,r,o,a){if(t=+t,n=+n,i=+i,a=!!a,i<0)throw new Error(`negative radius: ${i}`);let s=i*Math.cos(r),u=i*Math.sin(r),l=t+s,c=n+u,d=1^a,h=a?r-o:o-r;this._x1===null?this._append`M${l},${c}`:(Math.abs(this._x1-l)>ht||Math.abs(this._y1-c)>ht)&&this._append`L${l},${c}`,i&&(h<0&&(h=h%wi+wi),h>Cc?this._append`A${i},${i},0,1,${d},${t-s},${n-u}A${i},${i},0,1,${d},${this._x1=l},${this._y1=c}`:h>ht&&this._append`A${i},${i},0,${+(h>=bi)},${d},${this._x1=t+i*Math.cos(o)},${this._y1=n+i*Math.sin(o)}`)}rect(t,n,i,r){this._append`M${this._x0=this._x1=+t},${this._y0=this._y1=+n}h${i=+i}v${+r}h${-i}Z`}toString(){return this._}}function Ac(e){return Math.abs(e=Math.round(e))>=1e21?e.toLocaleString("en").replace(/,/g,""):e.toString(10)}function Ln(e,t){if((n=(e=t?e.toExponential(t-1):e.toExponential()).indexOf("e"))<0)return null;var n,i=e.slice(0,n);return[i.length>1?i[0]+i.slice(2):i,+e.slice(n+1)]}function kt(e){return e=Ln(Math.abs(e)),e?e[1]:NaN}function Sc(e,t){return function(n,i){for(var r=n.length,o=[],a=0,s=e[0],u=0;r>0&&s>0&&(u+s+1>i&&(s=Math.max(1,i-u)),o.push(n.substring(r-=s,r+s)),!((u+=s+1)>i));)s=e[a=(a+1)%e.length];return o.reverse().join(t)}}function Lc(e){return function(t){return t.replace(/[0-9]/g,function(n){return e[+n]})}}var Rc=/^(?:(.)?([<>=^]))?([+\-( ])?([$#])?(0)?(\d+)?(,)?(\.\d+)?(~)?([a-z%])?$/i;function Rn(e){if(!(t=Rc.exec(e)))throw new Error("invalid format: "+e);var t;return new Ii({fill:t[1],align:t[2],sign:t[3],symbol:t[4],zero:t[5],width:t[6],comma:t[7],precision:t[8]&&t[8].slice(1),trim:t[9],type:t[10]})}Rn.prototype=Ii.prototype;function Ii(e){this.fill=e.fill===void 0?" ":e.fill+"",this.align=e.align===void 0?">":e.align+"",this.sign=e.sign===void 0?"-":e.sign+"",this.symbol=e.symbol===void 0?"":e.symbol+"",this.zero=!!e.zero,this.width=e.width===void 0?void 0:+e.width,this.comma=!!e.comma,this.precision=e.precision===void 0?void 0:+e.precision,this.trim=!!e.trim,this.type=e.type===void 0?"":e.type+""}Ii.prototype.toString=function(){return this.fill+this.align+this.sign+this.symbol+(this.zero?"0":"")+(this.width===void 0?"":Math.max(1,this.width|0))+(this.comma?",":"")+(this.precision===void 0?"":"."+Math.max(0,this.precision|0))+(this.trim?"~":"")+this.type};function Nc(e){e:for(var t=e.length,n=1,i=-1,r;n<t;++n)switch(e[n]){case".":i=r=n;break;case"0":i===0&&(i=n),r=n;break;default:if(!+e[n])break e;i>0&&(i=0);break}return i>0?e.slice(0,i)+e.slice(r+1):e}var Io;function Mc(e,t){var n=Ln(e,t);if(!n)return e+"";var i=n[0],r=n[1],o=r-(Io=Math.max(-8,Math.min(8,Math.floor(r/3)))*3)+1,a=i.length;return o===a?i:o>a?i+new Array(o-a+1).join("0"):o>0?i.slice(0,o)+"."+i.slice(o):"0."+new Array(1-o).join("0")+Ln(e,Math.max(0,t+o-1))[0]}function wr(e,t){var n=Ln(e,t);if(!n)return e+"";var i=n[0],r=n[1];return r<0?"0."+new Array(-r).join("0")+i:i.length>r+1?i.slice(0,r+1)+"."+i.slice(r+1):i+new Array(r-i.length+2).join("0")}const _r={"%":(e,t)=>(e*100).toFixed(t),b:e=>Math.round(e).toString(2),c:e=>e+"",d:Ac,e:(e,t)=>e.toExponential(t),f:(e,t)=>e.toFixed(t),g:(e,t)=>e.toPrecision(t),o:e=>Math.round(e).toString(8),p:(e,t)=>wr(e*100,t),r:wr,s:Mc,X:e=>Math.round(e).toString(16).toUpperCase(),x:e=>Math.round(e).toString(16)};function xr(e){return e}var Er=Array.prototype.map,Cr=["y","z","a","f","p","n","µ","m","","k","M","G","T","P","E","Z","Y"];function Dc(e){var t=e.grouping===void 0||e.thousands===void 0?xr:Sc(Er.call(e.grouping,Number),e.thousands+""),n=e.currency===void 0?"":e.currency[0]+"",i=e.currency===void 0?"":e.currency[1]+"",r=e.decimal===void 0?".":e.decimal+"",o=e.numerals===void 0?xr:Lc(Er.call(e.numerals,String)),a=e.percent===void 0?"%":e.percent+"",s=e.minus===void 0?"−":e.minus+"",u=e.nan===void 0?"NaN":e.nan+"";function l(d){d=Rn(d);var h=d.fill,f=d.align,g=d.sign,m=d.symbol,b=d.zero,E=d.width,x=d.comma,_=d.precision,p=d.trim,v=d.type;v==="n"?(x=!0,v="g"):_r[v]||(_===void 0&&(_=12),p=!0,v="g"),(b||h==="0"&&f==="=")&&(b=!0,h="0",f="=");var w=m==="$"?n:m==="#"&&/[boxX]/.test(v)?"0"+v.toLowerCase():"",k=m==="$"?i:/[%p]/.test(v)?a:"",I=_r[v],O=/[defgprs%]/.test(v);_=_===void 0?6:/[gprs]/.test(v)?Math.max(1,Math.min(21,_)):Math.max(0,Math.min(20,_));function F(R){var H=w,P=k,W,ie,le;if(v==="c")P=I(R)+P,R="";else{R=+R;var fe=R<0||1/R<0;if(R=isNaN(R)?u:I(Math.abs(R),_),p&&(R=Nc(R)),fe&&+R==0&&g!=="+"&&(fe=!1),H=(fe?g==="("?g:s:g==="-"||g==="("?"":g)+H,P=(v==="s"?Cr[8+Io/3]:"")+P+(fe&&g==="("?")":""),O){for(W=-1,ie=R.length;++W<ie;)if(le=R.charCodeAt(W),48>le||le>57){P=(le===46?r+R.slice(W+1):R.slice(W))+P,R=R.slice(0,W);break}}}x&&!b&&(R=t(R,1/0));var de=H.length+R.length+P.length,re=de<E?new Array(E-de+1).join(h):"";switch(x&&b&&(R=t(re+R,re.length?E-P.length:1/0),re=""),f){case"<":R=H+R+P+re;break;case"=":R=H+re+R+P;break;case"^":R=re.slice(0,de=re.length>>1)+H+R+P+re.slice(de);break;default:R=re+H+R+P;break}return o(R)}return F.toString=function(){return d+""},F}function c(d,h){var f=l((d=Rn(d),d.type="f",d)),g=Math.max(-8,Math.min(8,Math.floor(kt(h)/3)))*3,m=Math.pow(10,-g),b=Cr[8+g/3];return function(E){return f(m*E)+b}}return{format:l,formatPrefix:c}}var sn,Fi,Fo;$c({thousands:",",grouping:[3],currency:["$",""]});function $c(e){return sn=Dc(e),Fi=sn.format,Fo=sn.formatPrefix,sn}function Gc(e){return Math.max(0,-kt(Math.abs(e)))}function Pc(e,t){return Math.max(0,Math.max(-8,Math.min(8,Math.floor(kt(t)/3)))*3-kt(Math.abs(e)))}function Ic(e,t){return e=Math.abs(e),t=Math.abs(t)-e,Math.max(0,kt(t)-kt(e))+1}function zi(e,t){switch(arguments.length){case 0:break;case 1:this.range(e);break;default:this.range(t).domain(e);break}return this}const kr=Symbol("implicit");function Vt(){var e=new er,t=[],n=[],i=kr;function r(o){let a=e.get(o);if(a===void 0){if(i!==kr)return i;e.set(o,a=t.push(o)-1)}return n[a%n.length]}return r.domain=function(o){if(!arguments.length)return t.slice();t=[],e=new er;for(const a of o)e.has(a)||e.set(a,t.push(a)-1);return r},r.range=function(o){return arguments.length?(n=Array.from(o),r):n.slice()},r.unknown=function(o){return arguments.length?(i=o,r):i},r.copy=function(){return Vt(t,n).unknown(i)},zi.apply(r,arguments),r}function zo(){var e=Vt().unknown(void 0),t=e.domain,n=e.range,i=0,r=1,o,a,s=!1,u=0,l=0,c=.5;delete e.unknown;function d(){var h=t().length,f=r<i,g=f?r:i,m=f?i:r;o=(m-g)/Math.max(1,h-u+l*2),s&&(o=Math.floor(o)),g+=(m-g-o*(h-u))*c,a=o*(1-u),s&&(g=Math.round(g),a=Math.round(a));var b=Za(h).map(function(E){return g+o*E});return n(f?b.reverse():b)}return e.domain=function(h){return arguments.length?(t(h),d()):t()},e.range=function(h){return arguments.length?([i,r]=h,i=+i,r=+r,d()):[i,r]},e.rangeRound=function(h){return[i,r]=h,i=+i,r=+r,s=!0,d()},e.bandwidth=function(){return a},e.step=function(){return o},e.round=function(h){return arguments.length?(s=!!h,d()):s},e.padding=function(h){return arguments.length?(u=Math.min(1,l=+h),d()):u},e.paddingInner=function(h){return arguments.length?(u=Math.min(1,h),d()):u},e.paddingOuter=function(h){return arguments.length?(l=+h,d()):l},e.align=function(h){return arguments.length?(c=Math.max(0,Math.min(1,h)),d()):c},e.copy=function(){return zo(t(),[i,r]).round(s).paddingInner(u).paddingOuter(l).align(c)},zi.apply(d(),arguments)}function Fc(e){return function(){return e}}function zc(e){return+e}var Tr=[0,1];function bt(e){return e}function _i(e,t){return(t-=e=+e)?function(n){return(n-e)/t}:Fc(isNaN(t)?NaN:.5)}function Oc(e,t){var n;return e>t&&(n=e,e=t,t=n),function(i){return Math.max(e,Math.min(t,i))}}function Bc(e,t,n){var i=e[0],r=e[1],o=t[0],a=t[1];return r<i?(i=_i(r,i),o=n(a,o)):(i=_i(i,r),o=n(o,a)),function(s){return o(i(s))}}function Uc(e,t,n){var i=Math.min(e.length,t.length)-1,r=new Array(i),o=new Array(i),a=-1;for(e[i]<e[0]&&(e=e.slice().reverse(),t=t.slice().reverse());++a<i;)r[a]=_i(e[a],e[a+1]),o[a]=n(t[a],t[a+1]);return function(s){var u=Ba(e,s,1,i)-1;return o[u](r[u](s))}}function Hc(e,t){return t.domain(e.domain()).range(e.range()).interpolate(e.interpolate()).clamp(e.clamp()).unknown(e.unknown())}function Wc(){var e=Tr,t=Tr,n=Di,i,r,o,a=bt,s,u,l;function c(){var h=Math.min(e.length,t.length);return a!==bt&&(a=Oc(e[0],e[h-1])),s=h>2?Uc:Bc,u=l=null,d}function d(h){return h==null||isNaN(h=+h)?o:(u||(u=s(e.map(i),t,n)))(i(a(h)))}return d.invert=function(h){return a(r((l||(l=s(t,e.map(i),Ie)))(h)))},d.domain=function(h){return arguments.length?(e=Array.from(h,zc),c()):e.slice()},d.range=function(h){return arguments.length?(t=Array.from(h),c()):t.slice()},d.rangeRound=function(h){return t=Array.from(h),n=sl,c()},d.clamp=function(h){return arguments.length?(a=h?!0:bt,c()):a!==bt},d.interpolate=function(h){return arguments.length?(n=h,c()):n},d.unknown=function(h){return arguments.length?(o=h,d):o},function(h,f){return i=h,r=f,c()}}function qc(){return Wc()(bt,bt)}function Vc(e,t,n,i){var r=Ka(e,t,n),o;switch(i=Rn(i??",f"),i.type){case"s":{var a=Math.max(Math.abs(e),Math.abs(t));return i.precision==null&&!isNaN(o=Pc(r,a))&&(i.precision=o),Fo(i,a)}case"":case"e":case"g":case"p":case"r":{i.precision==null&&!isNaN(o=Ic(r,Math.max(Math.abs(e),Math.abs(t))))&&(i.precision=o-(i.type==="e"));break}case"f":case"%":{i.precision==null&&!isNaN(o=Gc(r))&&(i.precision=o-(i.type==="%")*2);break}}return Fi(i)}function jc(e){var t=e.domain;return e.ticks=function(n){var i=t();return Xa(i[0],i[i.length-1],n??10)},e.tickFormat=function(n,i){var r=t();return Vc(r[0],r[r.length-1],n??10,i)},e.nice=function(n){n==null&&(n=10);var i=t(),r=0,o=i.length-1,a=i[r],s=i[o],u,l,c=10;for(s<a&&(l=a,a=s,s=l,l=r,r=o,o=l);c-- >0;){if(l=ci(a,s,n),l===u)return i[r]=a,i[o]=s,t(i);if(l>0)a=Math.floor(a/l)*l,s=Math.ceil(s/l)*l;else if(l<0)a=Math.ceil(a*l)/l,s=Math.floor(s*l)/l;else break;u=l}return e},e}function Wt(){var e=qc();return e.copy=function(){return Hc(e,Wt())},zi.apply(e,arguments),jc(e)}function Yc(e){for(var t=e.length/6|0,n=new Array(t),i=0;i<t;)n[i]="#"+e.slice(i*6,++i*6);return n}const Ar=Yc("1f77b4ff7f0e2ca02cd627289467bd8c564be377c27f7f7fbcbd2217becf");function te(e){return function(){return e}}const Sr=Math.abs,ye=Math.atan2,ct=Math.cos,Xc=Math.max,Kn=Math.min,We=Math.sin,wt=Math.sqrt,xe=1e-12,Zt=Math.PI,Nn=Zt/2,bn=2*Zt;function Kc(e){return e>1?0:e<-1?Zt:Math.acos(e)}function Lr(e){return e>=1?Nn:e<=-1?-Nn:Math.asin(e)}function Oi(e){let t=3;return e.digits=function(n){if(!arguments.length)return t;if(n==null)t=null;else{const i=Math.floor(n);if(!(i>=0))throw new RangeError(`invalid digits: ${n}`);t=i}return e},()=>new Tc(t)}function Zc(e){return e.innerRadius}function Jc(e){return e.outerRadius}function Qc(e){return e.startAngle}function ed(e){return e.endAngle}function td(e){return e&&e.padAngle}function nd(e,t,n,i,r,o,a,s){var u=n-e,l=i-t,c=a-r,d=s-o,h=d*u-c*l;if(!(h*h<xe))return h=(c*(t-o)-d*(e-r))/h,[e+h*u,t+h*l]}function un(e,t,n,i,r,o,a){var s=e-n,u=t-i,l=(a?o:-o)/wt(s*s+u*u),c=l*u,d=-l*s,h=e+c,f=t+d,g=n+c,m=i+d,b=(h+g)/2,E=(f+m)/2,x=g-h,_=m-f,p=x*x+_*_,v=r-o,w=h*m-g*f,k=(_<0?-1:1)*wt(Xc(0,v*v*p-w*w)),I=(w*_-x*k)/p,O=(-w*x-_*k)/p,F=(w*_+x*k)/p,R=(-w*x+_*k)/p,H=I-b,P=O-E,W=F-b,ie=R-E;return H*H+P*P>W*W+ie*ie&&(I=F,O=R),{cx:I,cy:O,x01:-c,y01:-d,x11:I*(r/v-1),y11:O*(r/v-1)}}function id(){var e=Zc,t=Jc,n=te(0),i=null,r=Qc,o=ed,a=td,s=null,u=Oi(l);function l(){var c,d,h=+e.apply(this,arguments),f=+t.apply(this,arguments),g=r.apply(this,arguments)-Nn,m=o.apply(this,arguments)-Nn,b=Sr(m-g),E=m>g;if(s||(s=c=u()),f<h&&(d=f,f=h,h=d),!(f>xe))s.moveTo(0,0);else if(b>bn-xe)s.moveTo(f*ct(g),f*We(g)),s.arc(0,0,f,g,m,!E),h>xe&&(s.moveTo(h*ct(m),h*We(m)),s.arc(0,0,h,m,g,E));else{var x=g,_=m,p=g,v=m,w=b,k=b,I=a.apply(this,arguments)/2,O=I>xe&&(i?+i.apply(this,arguments):wt(h*h+f*f)),F=Kn(Sr(f-h)/2,+n.apply(this,arguments)),R=F,H=F,P,W;if(O>xe){var ie=Lr(O/h*We(I)),le=Lr(O/f*We(I));(w-=ie*2)>xe?(ie*=E?1:-1,p+=ie,v-=ie):(w=0,p=v=(g+m)/2),(k-=le*2)>xe?(le*=E?1:-1,x+=le,_-=le):(k=0,x=_=(g+m)/2)}var fe=f*ct(x),de=f*We(x),re=h*ct(v),ce=h*We(v);if(F>xe){var se=f*ct(_),he=f*We(_),ee=h*ct(p),Me=h*We(p),ge;if(b<Zt)if(ge=nd(fe,de,ee,Me,se,he,re,ce)){var Be=fe-ge[0],st=de-ge[1],Ue=se-ge[0],ke=he-ge[1],et=1/We(Kc((Be*Ue+st*ke)/(wt(Be*Be+st*st)*wt(Ue*Ue+ke*ke)))/2),tt=wt(ge[0]*ge[0]+ge[1]*ge[1]);R=Kn(F,(h-tt)/(et-1)),H=Kn(F,(f-tt)/(et+1))}else R=H=0}k>xe?H>xe?(P=un(ee,Me,fe,de,f,H,E),W=un(se,he,re,ce,f,H,E),s.moveTo(P.cx+P.x01,P.cy+P.y01),H<F?s.arc(P.cx,P.cy,H,ye(P.y01,P.x01),ye(W.y01,W.x01),!E):(s.arc(P.cx,P.cy,H,ye(P.y01,P.x01),ye(P.y11,P.x11),!E),s.arc(0,0,f,ye(P.cy+P.y11,P.cx+P.x11),ye(W.cy+W.y11,W.cx+W.x11),!E),s.arc(W.cx,W.cy,H,ye(W.y11,W.x11),ye(W.y01,W.x01),!E))):(s.moveTo(fe,de),s.arc(0,0,f,x,_,!E)):s.moveTo(fe,de),!(h>xe)||!(w>xe)?s.lineTo(re,ce):R>xe?(P=un(re,ce,se,he,h,-R,E),W=un(fe,de,ee,Me,h,-R,E),s.lineTo(P.cx+P.x01,P.cy+P.y01),R<F?s.arc(P.cx,P.cy,R,ye(P.y01,P.x01),ye(W.y01,W.x01),!E):(s.arc(P.cx,P.cy,R,ye(P.y01,P.x01),ye(P.y11,P.x11),!E),s.arc(0,0,h,ye(P.cy+P.y11,P.cx+P.x11),ye(W.cy+W.y11,W.cx+W.x11),E),s.arc(W.cx,W.cy,R,ye(W.y11,W.x11),ye(W.y01,W.x01),!E))):s.arc(0,0,h,v,p,E)}if(s.closePath(),c)return s=null,c+""||null}return l.centroid=function(){var c=(+e.apply(this,arguments)+ +t.apply(this,arguments))/2,d=(+r.apply(this,arguments)+ +o.apply(this,arguments))/2-Zt/2;return[ct(d)*c,We(d)*c]},l.innerRadius=function(c){return arguments.length?(e=typeof c=="function"?c:te(+c),l):e},l.outerRadius=function(c){return arguments.length?(t=typeof c=="function"?c:te(+c),l):t},l.cornerRadius=function(c){return arguments.length?(n=typeof c=="function"?c:te(+c),l):n},l.padRadius=function(c){return arguments.length?(i=c==null?null:typeof c=="function"?c:te(+c),l):i},l.startAngle=function(c){return arguments.length?(r=typeof c=="function"?c:te(+c),l):r},l.endAngle=function(c){return arguments.length?(o=typeof c=="function"?c:te(+c),l):o},l.padAngle=function(c){return arguments.length?(a=typeof c=="function"?c:te(+c),l):a},l.context=function(c){return arguments.length?(s=c??null,l):s},l}function Bi(e){return typeof e=="object"&&"length"in e?e:Array.from(e)}function Oo(e){this._context=e}Oo.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._point=0},lineEnd:function(){(this._line||this._line!==0&&this._point===1)&&this._context.closePath(),this._line=1-this._line},point:function(e,t){switch(e=+e,t=+t,this._point){case 0:this._point=1,this._line?this._context.lineTo(e,t):this._context.moveTo(e,t);break;case 1:this._point=2;default:this._context.lineTo(e,t);break}}};function Bo(e){return new Oo(e)}function Uo(e){return e[0]}function Ho(e){return e[1]}function Wo(e,t){var n=te(!0),i=null,r=Bo,o=null,a=Oi(s);e=typeof e=="function"?e:e===void 0?Uo:te(e),t=typeof t=="function"?t:t===void 0?Ho:te(t);function s(u){var l,c=(u=Bi(u)).length,d,h=!1,f;for(i==null&&(o=r(f=a())),l=0;l<=c;++l)!(l<c&&n(d=u[l],l,u))===h&&((h=!h)?o.lineStart():o.lineEnd()),h&&o.point(+e(d,l,u),+t(d,l,u));if(f)return o=null,f+""||null}return s.x=function(u){return arguments.length?(e=typeof u=="function"?u:te(+u),s):e},s.y=function(u){return arguments.length?(t=typeof u=="function"?u:te(+u),s):t},s.defined=function(u){return arguments.length?(n=typeof u=="function"?u:te(!!u),s):n},s.curve=function(u){return arguments.length?(r=u,i!=null&&(o=r(i)),s):r},s.context=function(u){return arguments.length?(u==null?i=o=null:o=r(i=u),s):i},s}function rd(e,t,n){var i=null,r=te(!0),o=null,a=Bo,s=null,u=Oi(l);e=typeof e=="function"?e:e===void 0?Uo:te(+e),t=typeof t=="function"?t:te(t===void 0?0:+t),n=typeof n=="function"?n:n===void 0?Ho:te(+n);function l(d){var h,f,g,m=(d=Bi(d)).length,b,E=!1,x,_=new Array(m),p=new Array(m);for(o==null&&(s=a(x=u())),h=0;h<=m;++h){if(!(h<m&&r(b=d[h],h,d))===E)if(E=!E)f=h,s.areaStart(),s.lineStart();else{for(s.lineEnd(),s.lineStart(),g=h-1;g>=f;--g)s.point(_[g],p[g]);s.lineEnd(),s.areaEnd()}E&&(_[h]=+e(b,h,d),p[h]=+t(b,h,d),s.point(i?+i(b,h,d):_[h],n?+n(b,h,d):p[h]))}if(x)return s=null,x+""||null}function c(){return Wo().defined(r).curve(a).context(o)}return l.x=function(d){return arguments.length?(e=typeof d=="function"?d:te(+d),i=null,l):e},l.x0=function(d){return arguments.length?(e=typeof d=="function"?d:te(+d),l):e},l.x1=function(d){return arguments.length?(i=d==null?null:typeof d=="function"?d:te(+d),l):i},l.y=function(d){return arguments.length?(t=typeof d=="function"?d:te(+d),n=null,l):t},l.y0=function(d){return arguments.length?(t=typeof d=="function"?d:te(+d),l):t},l.y1=function(d){return arguments.length?(n=d==null?null:typeof d=="function"?d:te(+d),l):n},l.lineX0=l.lineY0=function(){return c().x(e).y(t)},l.lineY1=function(){return c().x(e).y(n)},l.lineX1=function(){return c().x(i).y(t)},l.defined=function(d){return arguments.length?(r=typeof d=="function"?d:te(!!d),l):r},l.curve=function(d){return arguments.length?(a=d,o!=null&&(s=a(o)),l):a},l.context=function(d){return arguments.length?(d==null?o=s=null:s=a(o=d),l):o},l}function od(e,t){return t<e?-1:t>e?1:t>=e?0:NaN}function ad(e){return e}function sd(){var e=ad,t=od,n=null,i=te(0),r=te(bn),o=te(0);function a(s){var u,l=(s=Bi(s)).length,c,d,h=0,f=new Array(l),g=new Array(l),m=+i.apply(this,arguments),b=Math.min(bn,Math.max(-bn,r.apply(this,arguments)-m)),E,x=Math.min(Math.abs(b)/l,o.apply(this,arguments)),_=x*(b<0?-1:1),p;for(u=0;u<l;++u)(p=g[f[u]=u]=+e(s[u],u,s))>0&&(h+=p);for(t!=null?f.sort(function(v,w){return t(g[v],g[w])}):n!=null&&f.sort(function(v,w){return n(s[v],s[w])}),u=0,d=h?(b-l*_)/h:0;u<l;++u,m=E)c=f[u],p=g[c],E=m+(p>0?p*d:0)+_,g[c]={data:s[c],index:u,value:p,startAngle:m,endAngle:E,padAngle:x};return g}return a.value=function(s){return arguments.length?(e=typeof s=="function"?s:te(+s),a):e},a.sortValues=function(s){return arguments.length?(t=s,n=null,a):t},a.sort=function(s){return arguments.length?(n=s,t=null,a):n},a.startAngle=function(s){return arguments.length?(i=typeof s=="function"?s:te(+s),a):i},a.endAngle=function(s){return arguments.length?(r=typeof s=="function"?s:te(+s),a):r},a.padAngle=function(s){return arguments.length?(o=typeof s=="function"?s:te(+s),a):o},a}function Rr(e){return e<0?-1:1}function Nr(e,t,n){var i=e._x1-e._x0,r=t-e._x1,o=(e._y1-e._y0)/(i||r<0&&-0),a=(n-e._y1)/(r||i<0&&-0),s=(o*r+a*i)/(i+r);return(Rr(o)+Rr(a))*Math.min(Math.abs(o),Math.abs(a),.5*Math.abs(s))||0}function Mr(e,t){var n=e._x1-e._x0;return n?(3*(e._y1-e._y0)/n-t)/2:t}function Zn(e,t,n){var i=e._x0,r=e._y0,o=e._x1,a=e._y1,s=(o-i)/3;e._context.bezierCurveTo(i+s,r+s*t,o-s,a-s*n,o,a)}function Mn(e){this._context=e}Mn.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._y0=this._y1=this._t0=NaN,this._point=0},lineEnd:function(){switch(this._point){case 2:this._context.lineTo(this._x1,this._y1);break;case 3:Zn(this,this._t0,Mr(this,this._t0));break}(this._line||this._line!==0&&this._point===1)&&this._context.closePath(),this._line=1-this._line},point:function(e,t){var n=NaN;if(e=+e,t=+t,!(e===this._x1&&t===this._y1)){switch(this._point){case 0:this._point=1,this._line?this._context.lineTo(e,t):this._context.moveTo(e,t);break;case 1:this._point=2;break;case 2:this._point=3,Zn(this,Mr(this,n=Nr(this,e,t)),n);break;default:Zn(this,this._t0,n=Nr(this,e,t));break}this._x0=this._x1,this._x1=e,this._y0=this._y1,this._y1=t,this._t0=n}}};Object.create(Mn.prototype).point=function(e,t){Mn.prototype.point.call(this,t,e)};function Dr(e){return new Mn(e)}function qt(e,t,n){this.k=e,this.x=t,this.y=n}qt.prototype={constructor:qt,scale:function(e){return e===1?this:new qt(this.k*e,this.x,this.y)},translate:function(e,t){return e===0&t===0?this:new qt(this.k,this.x+this.k*e,this.y+this.k*t)},apply:function(e){return[e[0]*this.k+this.x,e[1]*this.k+this.y]},applyX:function(e){return e*this.k+this.x},applyY:function(e){return e*this.k+this.y},invert:function(e){return[(e[0]-this.x)/this.k,(e[1]-this.y)/this.k]},invertX:function(e){return(e-this.x)/this.k},invertY:function(e){return(e-this.y)/this.k},rescaleX:function(e){return e.copy().domain(e.range().map(this.invertX,this).map(e.invert,e))},rescaleY:function(e){return e.copy().domain(e.range().map(this.invertY,this).map(e.invert,e))},toString:function(){return"translate("+this.x+","+this.y+") scale("+this.k+")"}};qt.prototype;function ud(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}var ln={exports:{}},$r;function ld(){if($r)return ln.exports;$r=1;var e=typeof Reflect=="object"?Reflect:null,t=e&&typeof e.apply=="function"?e.apply:function(v,w,k){return Function.prototype.apply.call(v,w,k)},n;e&&typeof e.ownKeys=="function"?n=e.ownKeys:Object.getOwnPropertySymbols?n=function(v){return Object.getOwnPropertyNames(v).concat(Object.getOwnPropertySymbols(v))}:n=function(v){return Object.getOwnPropertyNames(v)};function i(p){console&&console.warn&&console.warn(p)}var r=Number.isNaN||function(v){return v!==v};function o(){o.init.call(this)}ln.exports=o,ln.exports.once=E,o.EventEmitter=o,o.prototype._events=void 0,o.prototype._eventsCount=0,o.prototype._maxListeners=void 0;var a=10;function s(p){if(typeof p!="function")throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof p)}Object.defineProperty(o,"defaultMaxListeners",{enumerable:!0,get:function(){return a},set:function(p){if(typeof p!="number"||p<0||r(p))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+p+".");a=p}}),o.init=function(){(this._events===void 0||this._events===Object.getPrototypeOf(this)._events)&&(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},o.prototype.setMaxListeners=function(v){if(typeof v!="number"||v<0||r(v))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+v+".");return this._maxListeners=v,this};function u(p){return p._maxListeners===void 0?o.defaultMaxListeners:p._maxListeners}o.prototype.getMaxListeners=function(){return u(this)},o.prototype.emit=function(v){for(var w=[],k=1;k<arguments.length;k++)w.push(arguments[k]);var I=v==="error",O=this._events;if(O!==void 0)I=I&&O.error===void 0;else if(!I)return!1;if(I){var F;if(w.length>0&&(F=w[0]),F instanceof Error)throw F;var R=new Error("Unhandled error."+(F?" ("+F.message+")":""));throw R.context=F,R}var H=O[v];if(H===void 0)return!1;if(typeof H=="function")t(H,this,w);else for(var P=H.length,W=g(H,P),k=0;k<P;++k)t(W[k],this,w);return!0};function l(p,v,w,k){var I,O,F;if(s(w),O=p._events,O===void 0?(O=p._events=Object.create(null),p._eventsCount=0):(O.newListener!==void 0&&(p.emit("newListener",v,w.listener?w.listener:w),O=p._events),F=O[v]),F===void 0)F=O[v]=w,++p._eventsCount;else if(typeof F=="function"?F=O[v]=k?[w,F]:[F,w]:k?F.unshift(w):F.push(w),I=u(p),I>0&&F.length>I&&!F.warned){F.warned=!0;var R=new Error("Possible EventEmitter memory leak detected. "+F.length+" "+String(v)+" listeners added. Use emitter.setMaxListeners() to increase limit");R.name="MaxListenersExceededWarning",R.emitter=p,R.type=v,R.count=F.length,i(R)}return p}o.prototype.addListener=function(v,w){return l(this,v,w,!1)},o.prototype.on=o.prototype.addListener,o.prototype.prependListener=function(v,w){return l(this,v,w,!0)};function c(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,arguments.length===0?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function d(p,v,w){var k={fired:!1,wrapFn:void 0,target:p,type:v,listener:w},I=c.bind(k);return I.listener=w,k.wrapFn=I,I}o.prototype.once=function(v,w){return s(w),this.on(v,d(this,v,w)),this},o.prototype.prependOnceListener=function(v,w){return s(w),this.prependListener(v,d(this,v,w)),this},o.prototype.removeListener=function(v,w){var k,I,O,F,R;if(s(w),I=this._events,I===void 0)return this;if(k=I[v],k===void 0)return this;if(k===w||k.listener===w)--this._eventsCount===0?this._events=Object.create(null):(delete I[v],I.removeListener&&this.emit("removeListener",v,k.listener||w));else if(typeof k!="function"){for(O=-1,F=k.length-1;F>=0;F--)if(k[F]===w||k[F].listener===w){R=k[F].listener,O=F;break}if(O<0)return this;O===0?k.shift():m(k,O),k.length===1&&(I[v]=k[0]),I.removeListener!==void 0&&this.emit("removeListener",v,R||w)}return this},o.prototype.off=o.prototype.removeListener,o.prototype.removeAllListeners=function(v){var w,k,I;if(k=this._events,k===void 0)return this;if(k.removeListener===void 0)return arguments.length===0?(this._events=Object.create(null),this._eventsCount=0):k[v]!==void 0&&(--this._eventsCount===0?this._events=Object.create(null):delete k[v]),this;if(arguments.length===0){var O=Object.keys(k),F;for(I=0;I<O.length;++I)F=O[I],F!=="removeListener"&&this.removeAllListeners(F);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if(w=k[v],typeof w=="function")this.removeListener(v,w);else if(w!==void 0)for(I=w.length-1;I>=0;I--)this.removeListener(v,w[I]);return this};function h(p,v,w){var k=p._events;if(k===void 0)return[];var I=k[v];return I===void 0?[]:typeof I=="function"?w?[I.listener||I]:[I]:w?b(I):g(I,I.length)}o.prototype.listeners=function(v){return h(this,v,!0)},o.prototype.rawListeners=function(v){return h(this,v,!1)},o.listenerCount=function(p,v){return typeof p.listenerCount=="function"?p.listenerCount(v):f.call(p,v)},o.prototype.listenerCount=f;function f(p){var v=this._events;if(v!==void 0){var w=v[p];if(typeof w=="function")return 1;if(w!==void 0)return w.length}return 0}o.prototype.eventNames=function(){return this._eventsCount>0?n(this._events):[]};function g(p,v){for(var w=new Array(v),k=0;k<v;++k)w[k]=p[k];return w}function m(p,v){for(;v+1<p.length;v++)p[v]=p[v+1];p.pop()}function b(p){for(var v=new Array(p.length),w=0;w<v.length;++w)v[w]=p[w].listener||p[w];return v}function E(p,v){return new Promise(function(w,k){function I(F){p.removeListener(v,O),k(F)}function O(){typeof p.removeListener=="function"&&p.removeListener("error",I),w([].slice.call(arguments))}_(p,v,O,{once:!0}),v!=="error"&&x(p,I,{once:!0})})}function x(p,v,w){typeof p.on=="function"&&_(p,"error",v,w)}function _(p,v,w,k){if(typeof p.on=="function")k.once?p.once(v,w):p.on(v,w);else if(typeof p.addEventListener=="function")p.addEventListener(v,function I(O){k.once&&p.removeEventListener(v,I),w(O)});else throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof p)}return ln.exports}var qo=ld();function cd(){const e=arguments[0];for(let t=1,n=arguments.length;t<n;t++)if(arguments[t])for(const i in arguments[t])e[i]=arguments[t][i];return e}let me=cd;typeof Object.assign=="function"&&(me=Object.assign);function Le(e,t,n,i){const r=e._nodes.get(t);let o=null;return r&&(i==="mixed"?o=r.out&&r.out[n]||r.undirected&&r.undirected[n]:i==="directed"?o=r.out&&r.out[n]:o=r.undirected&&r.undirected[n]),o}function ve(e){return typeof e=="object"&&e!==null}function Vo(e){let t;for(t in e)return!1;return!0}function Se(e,t,n){Object.defineProperty(e,t,{enumerable:!1,configurable:!1,writable:!0,value:n})}function Ge(e,t,n){const i={enumerable:!0,configurable:!0};typeof n=="function"?i.get=n:(i.value=n,i.writable=!1),Object.defineProperty(e,t,i)}function Gr(e){return!(!ve(e)||e.attributes&&!Array.isArray(e.attributes))}function dd(){let e=Math.floor(Math.random()*256)&255;return()=>e++}function Ze(){const e=arguments;let t=null,n=-1;return{[Symbol.iterator](){return this},next(){let i=null;do{if(t===null){if(n++,n>=e.length)return{done:!0};t=e[n][Symbol.iterator]()}if(i=t.next(),i.done){t=null;continue}break}while(!0);return i}}}function St(){return{[Symbol.iterator](){return this},next(){return{done:!0}}}}class Ui extends Error{constructor(t){super(),this.name="GraphError",this.message=t}}class B extends Ui{constructor(t){super(t),this.name="InvalidArgumentsGraphError",typeof Error.captureStackTrace=="function"&&Error.captureStackTrace(this,B.prototype.constructor)}}class G extends Ui{constructor(t){super(t),this.name="NotFoundGraphError",typeof Error.captureStackTrace=="function"&&Error.captureStackTrace(this,G.prototype.constructor)}}class Y extends Ui{constructor(t){super(t),this.name="UsageGraphError",typeof Error.captureStackTrace=="function"&&Error.captureStackTrace(this,Y.prototype.constructor)}}function jo(e,t){this.key=e,this.attributes=t,this.clear()}jo.prototype.clear=function(){this.inDegree=0,this.outDegree=0,this.undirectedDegree=0,this.undirectedLoops=0,this.directedLoops=0,this.in={},this.out={},this.undirected={}};function Yo(e,t){this.key=e,this.attributes=t,this.clear()}Yo.prototype.clear=function(){this.inDegree=0,this.outDegree=0,this.directedLoops=0,this.in={},this.out={}};function Xo(e,t){this.key=e,this.attributes=t,this.clear()}Xo.prototype.clear=function(){this.undirectedDegree=0,this.undirectedLoops=0,this.undirected={}};function Lt(e,t,n,i,r){this.key=t,this.attributes=r,this.undirected=e,this.source=n,this.target=i}Lt.prototype.attach=function(){let e="out",t="in";this.undirected&&(e=t="undirected");const n=this.source.key,i=this.target.key;this.source[e][i]=this,!(this.undirected&&n===i)&&(this.target[t][n]=this)};Lt.prototype.attachMulti=function(){let e="out",t="in";const n=this.source.key,i=this.target.key;this.undirected&&(e=t="undirected");const r=this.source[e],o=r[i];if(typeof o>"u"){r[i]=this,this.undirected&&n===i||(this.target[t][n]=this);return}o.previous=this,this.next=o,r[i]=this,this.target[t][n]=this};Lt.prototype.detach=function(){const e=this.source.key,t=this.target.key;let n="out",i="in";this.undirected&&(n=i="undirected"),delete this.source[n][t],delete this.target[i][e]};Lt.prototype.detachMulti=function(){const e=this.source.key,t=this.target.key;let n="out",i="in";this.undirected&&(n=i="undirected"),this.previous===void 0?this.next===void 0?(delete this.source[n][t],delete this.target[i][e]):(this.next.previous=void 0,this.source[n][t]=this.next,this.target[i][e]=this.next):(this.previous.next=this.next,this.next!==void 0&&(this.next.previous=this.previous))};const Ko=0,Zo=1,hd=2,Jo=3;function Qe(e,t,n,i,r,o,a){let s,u,l,c;if(i=""+i,n===Ko){if(s=e._nodes.get(i),!s)throw new G(`Graph.${t}: could not find the "${i}" node in the graph.`);l=r,c=o}else if(n===Jo){if(r=""+r,u=e._edges.get(r),!u)throw new G(`Graph.${t}: could not find the "${r}" edge in the graph.`);const d=u.source.key,h=u.target.key;if(i===d)s=u.target;else if(i===h)s=u.source;else throw new G(`Graph.${t}: the "${i}" node is not attached to the "${r}" edge (${d}, ${h}).`);l=o,c=a}else{if(u=e._edges.get(i),!u)throw new G(`Graph.${t}: could not find the "${i}" edge in the graph.`);n===Zo?s=u.source:s=u.target,l=r,c=o}return[s,l,c]}function fd(e,t,n){e.prototype[t]=function(i,r,o){const[a,s]=Qe(this,t,n,i,r,o);return a.attributes[s]}}function gd(e,t,n){e.prototype[t]=function(i,r){const[o]=Qe(this,t,n,i,r);return o.attributes}}function pd(e,t,n){e.prototype[t]=function(i,r,o){const[a,s]=Qe(this,t,n,i,r,o);return a.attributes.hasOwnProperty(s)}}function md(e,t,n){e.prototype[t]=function(i,r,o,a){const[s,u,l]=Qe(this,t,n,i,r,o,a);return s.attributes[u]=l,this.emit("nodeAttributesUpdated",{key:s.key,type:"set",attributes:s.attributes,name:u}),this}}function vd(e,t,n){e.prototype[t]=function(i,r,o,a){const[s,u,l]=Qe(this,t,n,i,r,o,a);if(typeof l!="function")throw new B(`Graph.${t}: updater should be a function.`);const c=s.attributes,d=l(c[u]);return c[u]=d,this.emit("nodeAttributesUpdated",{key:s.key,type:"set",attributes:s.attributes,name:u}),this}}function yd(e,t,n){e.prototype[t]=function(i,r,o){const[a,s]=Qe(this,t,n,i,r,o);return delete a.attributes[s],this.emit("nodeAttributesUpdated",{key:a.key,type:"remove",attributes:a.attributes,name:s}),this}}function bd(e,t,n){e.prototype[t]=function(i,r,o){const[a,s]=Qe(this,t,n,i,r,o);if(!ve(s))throw new B(`Graph.${t}: provided attributes are not a plain object.`);return a.attributes=s,this.emit("nodeAttributesUpdated",{key:a.key,type:"replace",attributes:a.attributes}),this}}function wd(e,t,n){e.prototype[t]=function(i,r,o){const[a,s]=Qe(this,t,n,i,r,o);if(!ve(s))throw new B(`Graph.${t}: provided attributes are not a plain object.`);return me(a.attributes,s),this.emit("nodeAttributesUpdated",{key:a.key,type:"merge",attributes:a.attributes,data:s}),this}}function _d(e,t,n){e.prototype[t]=function(i,r,o){const[a,s]=Qe(this,t,n,i,r,o);if(typeof s!="function")throw new B(`Graph.${t}: provided updater is not a function.`);return a.attributes=s(a.attributes),this.emit("nodeAttributesUpdated",{key:a.key,type:"update",attributes:a.attributes}),this}}const xd=[{name:e=>`get${e}Attribute`,attacher:fd},{name:e=>`get${e}Attributes`,attacher:gd},{name:e=>`has${e}Attribute`,attacher:pd},{name:e=>`set${e}Attribute`,attacher:md},{name:e=>`update${e}Attribute`,attacher:vd},{name:e=>`remove${e}Attribute`,attacher:yd},{name:e=>`replace${e}Attributes`,attacher:bd},{name:e=>`merge${e}Attributes`,attacher:wd},{name:e=>`update${e}Attributes`,attacher:_d}];function Ed(e){xd.forEach(function({name:t,attacher:n}){n(e,t("Node"),Ko),n(e,t("Source"),Zo),n(e,t("Target"),hd),n(e,t("Opposite"),Jo)})}function Cd(e,t,n){e.prototype[t]=function(i,r){let o;if(this.type!=="mixed"&&n!=="mixed"&&n!==this.type)throw new Y(`Graph.${t}: cannot find this type of edges in your ${this.type} graph.`);if(arguments.length>2){if(this.multi)throw new Y(`Graph.${t}: cannot use a {source,target} combo when asking about an edge's attributes in a MultiGraph since we cannot infer the one you want information about.`);const a=""+i,s=""+r;if(r=arguments[2],o=Le(this,a,s,n),!o)throw new G(`Graph.${t}: could not find an edge for the given path ("${a}" - "${s}").`)}else{if(n!=="mixed")throw new Y(`Graph.${t}: calling this method with only a key (vs. a source and target) does not make sense since an edge with this key could have the other type.`);if(i=""+i,o=this._edges.get(i),!o)throw new G(`Graph.${t}: could not find the "${i}" edge in the graph.`)}return o.attributes[r]}}function kd(e,t,n){e.prototype[t]=function(i){let r;if(this.type!=="mixed"&&n!=="mixed"&&n!==this.type)throw new Y(`Graph.${t}: cannot find this type of edges in your ${this.type} graph.`);if(arguments.length>1){if(this.multi)throw new Y(`Graph.${t}: cannot use a {source,target} combo when asking about an edge's attributes in a MultiGraph since we cannot infer the one you want information about.`);const o=""+i,a=""+arguments[1];if(r=Le(this,o,a,n),!r)throw new G(`Graph.${t}: could not find an edge for the given path ("${o}" - "${a}").`)}else{if(n!=="mixed")throw new Y(`Graph.${t}: calling this method with only a key (vs. a source and target) does not make sense since an edge with this key could have the other type.`);if(i=""+i,r=this._edges.get(i),!r)throw new G(`Graph.${t}: could not find the "${i}" edge in the graph.`)}return r.attributes}}function Td(e,t,n){e.prototype[t]=function(i,r){let o;if(this.type!=="mixed"&&n!=="mixed"&&n!==this.type)throw new Y(`Graph.${t}: cannot find this type of edges in your ${this.type} graph.`);if(arguments.length>2){if(this.multi)throw new Y(`Graph.${t}: cannot use a {source,target} combo when asking about an edge's attributes in a MultiGraph since we cannot infer the one you want information about.`);const a=""+i,s=""+r;if(r=arguments[2],o=Le(this,a,s,n),!o)throw new G(`Graph.${t}: could not find an edge for the given path ("${a}" - "${s}").`)}else{if(n!=="mixed")throw new Y(`Graph.${t}: calling this method with only a key (vs. a source and target) does not make sense since an edge with this key could have the other type.`);if(i=""+i,o=this._edges.get(i),!o)throw new G(`Graph.${t}: could not find the "${i}" edge in the graph.`)}return o.attributes.hasOwnProperty(r)}}function Ad(e,t,n){e.prototype[t]=function(i,r,o){let a;if(this.type!=="mixed"&&n!=="mixed"&&n!==this.type)throw new Y(`Graph.${t}: cannot find this type of edges in your ${this.type} graph.`);if(arguments.length>3){if(this.multi)throw new Y(`Graph.${t}: cannot use a {source,target} combo when asking about an edge's attributes in a MultiGraph since we cannot infer the one you want information about.`);const s=""+i,u=""+r;if(r=arguments[2],o=arguments[3],a=Le(this,s,u,n),!a)throw new G(`Graph.${t}: could not find an edge for the given path ("${s}" - "${u}").`)}else{if(n!=="mixed")throw new Y(`Graph.${t}: calling this method with only a key (vs. a source and target) does not make sense since an edge with this key could have the other type.`);if(i=""+i,a=this._edges.get(i),!a)throw new G(`Graph.${t}: could not find the "${i}" edge in the graph.`)}return a.attributes[r]=o,this.emit("edgeAttributesUpdated",{key:a.key,type:"set",attributes:a.attributes,name:r}),this}}function Sd(e,t,n){e.prototype[t]=function(i,r,o){let a;if(this.type!=="mixed"&&n!=="mixed"&&n!==this.type)throw new Y(`Graph.${t}: cannot find this type of edges in your ${this.type} graph.`);if(arguments.length>3){if(this.multi)throw new Y(`Graph.${t}: cannot use a {source,target} combo when asking about an edge's attributes in a MultiGraph since we cannot infer the one you want information about.`);const s=""+i,u=""+r;if(r=arguments[2],o=arguments[3],a=Le(this,s,u,n),!a)throw new G(`Graph.${t}: could not find an edge for the given path ("${s}" - "${u}").`)}else{if(n!=="mixed")throw new Y(`Graph.${t}: calling this method with only a key (vs. a source and target) does not make sense since an edge with this key could have the other type.`);if(i=""+i,a=this._edges.get(i),!a)throw new G(`Graph.${t}: could not find the "${i}" edge in the graph.`)}if(typeof o!="function")throw new B(`Graph.${t}: updater should be a function.`);return a.attributes[r]=o(a.attributes[r]),this.emit("edgeAttributesUpdated",{key:a.key,type:"set",attributes:a.attributes,name:r}),this}}function Ld(e,t,n){e.prototype[t]=function(i,r){let o;if(this.type!=="mixed"&&n!=="mixed"&&n!==this.type)throw new Y(`Graph.${t}: cannot find this type of edges in your ${this.type} graph.`);if(arguments.length>2){if(this.multi)throw new Y(`Graph.${t}: cannot use a {source,target} combo when asking about an edge's attributes in a MultiGraph since we cannot infer the one you want information about.`);const a=""+i,s=""+r;if(r=arguments[2],o=Le(this,a,s,n),!o)throw new G(`Graph.${t}: could not find an edge for the given path ("${a}" - "${s}").`)}else{if(n!=="mixed")throw new Y(`Graph.${t}: calling this method with only a key (vs. a source and target) does not make sense since an edge with this key could have the other type.`);if(i=""+i,o=this._edges.get(i),!o)throw new G(`Graph.${t}: could not find the "${i}" edge in the graph.`)}return delete o.attributes[r],this.emit("edgeAttributesUpdated",{key:o.key,type:"remove",attributes:o.attributes,name:r}),this}}function Rd(e,t,n){e.prototype[t]=function(i,r){let o;if(this.type!=="mixed"&&n!=="mixed"&&n!==this.type)throw new Y(`Graph.${t}: cannot find this type of edges in your ${this.type} graph.`);if(arguments.length>2){if(this.multi)throw new Y(`Graph.${t}: cannot use a {source,target} combo when asking about an edge's attributes in a MultiGraph since we cannot infer the one you want information about.`);const a=""+i,s=""+r;if(r=arguments[2],o=Le(this,a,s,n),!o)throw new G(`Graph.${t}: could not find an edge for the given path ("${a}" - "${s}").`)}else{if(n!=="mixed")throw new Y(`Graph.${t}: calling this method with only a key (vs. a source and target) does not make sense since an edge with this key could have the other type.`);if(i=""+i,o=this._edges.get(i),!o)throw new G(`Graph.${t}: could not find the "${i}" edge in the graph.`)}if(!ve(r))throw new B(`Graph.${t}: provided attributes are not a plain object.`);return o.attributes=r,this.emit("edgeAttributesUpdated",{key:o.key,type:"replace",attributes:o.attributes}),this}}function Nd(e,t,n){e.prototype[t]=function(i,r){let o;if(this.type!=="mixed"&&n!=="mixed"&&n!==this.type)throw new Y(`Graph.${t}: cannot find this type of edges in your ${this.type} graph.`);if(arguments.length>2){if(this.multi)throw new Y(`Graph.${t}: cannot use a {source,target} combo when asking about an edge's attributes in a MultiGraph since we cannot infer the one you want information about.`);const a=""+i,s=""+r;if(r=arguments[2],o=Le(this,a,s,n),!o)throw new G(`Graph.${t}: could not find an edge for the given path ("${a}" - "${s}").`)}else{if(n!=="mixed")throw new Y(`Graph.${t}: calling this method with only a key (vs. a source and target) does not make sense since an edge with this key could have the other type.`);if(i=""+i,o=this._edges.get(i),!o)throw new G(`Graph.${t}: could not find the "${i}" edge in the graph.`)}if(!ve(r))throw new B(`Graph.${t}: provided attributes are not a plain object.`);return me(o.attributes,r),this.emit("edgeAttributesUpdated",{key:o.key,type:"merge",attributes:o.attributes,data:r}),this}}function Md(e,t,n){e.prototype[t]=function(i,r){let o;if(this.type!=="mixed"&&n!=="mixed"&&n!==this.type)throw new Y(`Graph.${t}: cannot find this type of edges in your ${this.type} graph.`);if(arguments.length>2){if(this.multi)throw new Y(`Graph.${t}: cannot use a {source,target} combo when asking about an edge's attributes in a MultiGraph since we cannot infer the one you want information about.`);const a=""+i,s=""+r;if(r=arguments[2],o=Le(this,a,s,n),!o)throw new G(`Graph.${t}: could not find an edge for the given path ("${a}" - "${s}").`)}else{if(n!=="mixed")throw new Y(`Graph.${t}: calling this method with only a key (vs. a source and target) does not make sense since an edge with this key could have the other type.`);if(i=""+i,o=this._edges.get(i),!o)throw new G(`Graph.${t}: could not find the "${i}" edge in the graph.`)}if(typeof r!="function")throw new B(`Graph.${t}: provided updater is not a function.`);return o.attributes=r(o.attributes),this.emit("edgeAttributesUpdated",{key:o.key,type:"update",attributes:o.attributes}),this}}const Dd=[{name:e=>`get${e}Attribute`,attacher:Cd},{name:e=>`get${e}Attributes`,attacher:kd},{name:e=>`has${e}Attribute`,attacher:Td},{name:e=>`set${e}Attribute`,attacher:Ad},{name:e=>`update${e}Attribute`,attacher:Sd},{name:e=>`remove${e}Attribute`,attacher:Ld},{name:e=>`replace${e}Attributes`,attacher:Rd},{name:e=>`merge${e}Attributes`,attacher:Nd},{name:e=>`update${e}Attributes`,attacher:Md}];function $d(e){Dd.forEach(function({name:t,attacher:n}){n(e,t("Edge"),"mixed"),n(e,t("DirectedEdge"),"directed"),n(e,t("UndirectedEdge"),"undirected")})}const Gd=[{name:"edges",type:"mixed"},{name:"inEdges",type:"directed",direction:"in"},{name:"outEdges",type:"directed",direction:"out"},{name:"inboundEdges",type:"mixed",direction:"in"},{name:"outboundEdges",type:"mixed",direction:"out"},{name:"directedEdges",type:"directed"},{name:"undirectedEdges",type:"undirected"}];function Pd(e,t,n,i){let r=!1;for(const o in t){if(o===i)continue;const a=t[o];if(r=n(a.key,a.attributes,a.source.key,a.target.key,a.source.attributes,a.target.attributes,a.undirected),e&&r)return a.key}}function Id(e,t,n,i){let r,o,a,s=!1;for(const u in t)if(u!==i){r=t[u];do{if(o=r.source,a=r.target,s=n(r.key,r.attributes,o.key,a.key,o.attributes,a.attributes,r.undirected),e&&s)return r.key;r=r.next}while(r!==void 0)}}function Jn(e,t){const n=Object.keys(e),i=n.length;let r,o=0;return{[Symbol.iterator](){return this},next(){do if(r)r=r.next;else{if(o>=i)return{done:!0};const a=n[o++];if(a===t){r=void 0;continue}r=e[a]}while(!r);return{done:!1,value:{edge:r.key,attributes:r.attributes,source:r.source.key,target:r.target.key,sourceAttributes:r.source.attributes,targetAttributes:r.target.attributes,undirected:r.undirected}}}}}function Fd(e,t,n,i){const r=t[n];if(!r)return;const o=r.source,a=r.target;if(i(r.key,r.attributes,o.key,a.key,o.attributes,a.attributes,r.undirected)&&e)return r.key}function zd(e,t,n,i){let r=t[n];if(!r)return;let o=!1;do{if(o=i(r.key,r.attributes,r.source.key,r.target.key,r.source.attributes,r.target.attributes,r.undirected),e&&o)return r.key;r=r.next}while(r!==void 0)}function Qn(e,t){let n=e[t];if(n.next!==void 0)return{[Symbol.iterator](){return this},next(){if(!n)return{done:!0};const r={edge:n.key,attributes:n.attributes,source:n.source.key,target:n.target.key,sourceAttributes:n.source.attributes,targetAttributes:n.target.attributes,undirected:n.undirected};return n=n.next,{done:!1,value:r}}};let i=!1;return{[Symbol.iterator](){return this},next(){return i===!0?{done:!0}:(i=!0,{done:!1,value:{edge:n.key,attributes:n.attributes,source:n.source.key,target:n.target.key,sourceAttributes:n.source.attributes,targetAttributes:n.target.attributes,undirected:n.undirected}})}}}function Od(e,t){if(e.size===0)return[];if(t==="mixed"||t===e.type)return Array.from(e._edges.keys());const n=t==="undirected"?e.undirectedSize:e.directedSize,i=new Array(n),r=t==="undirected",o=e._edges.values();let a=0,s,u;for(;s=o.next(),s.done!==!0;)u=s.value,u.undirected===r&&(i[a++]=u.key);return i}function Qo(e,t,n,i){if(t.size===0)return;const r=n!=="mixed"&&n!==t.type,o=n==="undirected";let a,s,u=!1;const l=t._edges.values();for(;a=l.next(),a.done!==!0;){if(s=a.value,r&&s.undirected!==o)continue;const{key:c,attributes:d,source:h,target:f}=s;if(u=i(c,d,h.key,f.key,h.attributes,f.attributes,s.undirected),e&&u)return c}}function Bd(e,t){if(e.size===0)return St();const n=t!=="mixed"&&t!==e.type,i=t==="undirected",r=e._edges.values();return{[Symbol.iterator](){return this},next(){let o,a;for(;;){if(o=r.next(),o.done)return o;if(a=o.value,!(n&&a.undirected!==i))break}return{value:{edge:a.key,attributes:a.attributes,source:a.source.key,target:a.target.key,sourceAttributes:a.source.attributes,targetAttributes:a.target.attributes,undirected:a.undirected},done:!1}}}}function Hi(e,t,n,i,r,o){const a=t?Id:Pd;let s;if(n!=="undirected"&&(i!=="out"&&(s=a(e,r.in,o),e&&s)||i!=="in"&&(s=a(e,r.out,o,i?void 0:r.key),e&&s))||n!=="directed"&&(s=a(e,r.undirected,o),e&&s))return s}function Ud(e,t,n,i){const r=[];return Hi(!1,e,t,n,i,function(o){r.push(o)}),r}function Hd(e,t,n){let i=St();return e!=="undirected"&&(t!=="out"&&typeof n.in<"u"&&(i=Ze(i,Jn(n.in))),t!=="in"&&typeof n.out<"u"&&(i=Ze(i,Jn(n.out,t?void 0:n.key)))),e!=="directed"&&typeof n.undirected<"u"&&(i=Ze(i,Jn(n.undirected))),i}function Wi(e,t,n,i,r,o,a){const s=n?zd:Fd;let u;if(t!=="undirected"&&(typeof r.in<"u"&&i!=="out"&&(u=s(e,r.in,o,a),e&&u)||typeof r.out<"u"&&i!=="in"&&(i||r.key!==o)&&(u=s(e,r.out,o,a),e&&u))||t!=="directed"&&typeof r.undirected<"u"&&(u=s(e,r.undirected,o,a),e&&u))return u}function Wd(e,t,n,i,r){const o=[];return Wi(!1,e,t,n,i,r,function(a){o.push(a)}),o}function qd(e,t,n,i){let r=St();return e!=="undirected"&&(typeof n.in<"u"&&t!=="out"&&i in n.in&&(r=Ze(r,Qn(n.in,i))),typeof n.out<"u"&&t!=="in"&&i in n.out&&(t||n.key!==i)&&(r=Ze(r,Qn(n.out,i)))),e!=="directed"&&typeof n.undirected<"u"&&i in n.undirected&&(r=Ze(r,Qn(n.undirected,i))),r}function Vd(e,t){const{name:n,type:i,direction:r}=t;e.prototype[n]=function(o,a){if(i!=="mixed"&&this.type!=="mixed"&&i!==this.type)return[];if(!arguments.length)return Od(this,i);if(arguments.length===1){o=""+o;const s=this._nodes.get(o);if(typeof s>"u")throw new G(`Graph.${n}: could not find the "${o}" node in the graph.`);return Ud(this.multi,i==="mixed"?this.type:i,r,s)}if(arguments.length===2){o=""+o,a=""+a;const s=this._nodes.get(o);if(!s)throw new G(`Graph.${n}:  could not find the "${o}" source node in the graph.`);if(!this._nodes.has(a))throw new G(`Graph.${n}:  could not find the "${a}" target node in the graph.`);return Wd(i,this.multi,r,s,a)}throw new B(`Graph.${n}: too many arguments (expecting 0, 1 or 2 and got ${arguments.length}).`)}}function jd(e,t){const{name:n,type:i,direction:r}=t,o="forEach"+n[0].toUpperCase()+n.slice(1,-1);e.prototype[o]=function(l,c,d){if(!(i!=="mixed"&&this.type!=="mixed"&&i!==this.type)){if(arguments.length===1)return d=l,Qo(!1,this,i,d);if(arguments.length===2){l=""+l,d=c;const h=this._nodes.get(l);if(typeof h>"u")throw new G(`Graph.${o}: could not find the "${l}" node in the graph.`);return Hi(!1,this.multi,i==="mixed"?this.type:i,r,h,d)}if(arguments.length===3){l=""+l,c=""+c;const h=this._nodes.get(l);if(!h)throw new G(`Graph.${o}:  could not find the "${l}" source node in the graph.`);if(!this._nodes.has(c))throw new G(`Graph.${o}:  could not find the "${c}" target node in the graph.`);return Wi(!1,i,this.multi,r,h,c,d)}throw new B(`Graph.${o}: too many arguments (expecting 1, 2 or 3 and got ${arguments.length}).`)}};const a="map"+n[0].toUpperCase()+n.slice(1);e.prototype[a]=function(){const l=Array.prototype.slice.call(arguments),c=l.pop();let d;if(l.length===0){let h=0;i!=="directed"&&(h+=this.undirectedSize),i!=="undirected"&&(h+=this.directedSize),d=new Array(h);let f=0;l.push((g,m,b,E,x,_,p)=>{d[f++]=c(g,m,b,E,x,_,p)})}else d=[],l.push((h,f,g,m,b,E,x)=>{d.push(c(h,f,g,m,b,E,x))});return this[o].apply(this,l),d};const s="filter"+n[0].toUpperCase()+n.slice(1);e.prototype[s]=function(){const l=Array.prototype.slice.call(arguments),c=l.pop(),d=[];return l.push((h,f,g,m,b,E,x)=>{c(h,f,g,m,b,E,x)&&d.push(h)}),this[o].apply(this,l),d};const u="reduce"+n[0].toUpperCase()+n.slice(1);e.prototype[u]=function(){let l=Array.prototype.slice.call(arguments);if(l.length<2||l.length>4)throw new B(`Graph.${u}: invalid number of arguments (expecting 2, 3 or 4 and got ${l.length}).`);if(typeof l[l.length-1]=="function"&&typeof l[l.length-2]!="function")throw new B(`Graph.${u}: missing initial value. You must provide it because the callback takes more than one argument and we cannot infer the initial value from the first iteration, as you could with a simple array.`);let c,d;l.length===2?(c=l[0],d=l[1],l=[]):l.length===3?(c=l[1],d=l[2],l=[l[0]]):l.length===4&&(c=l[2],d=l[3],l=[l[0],l[1]]);let h=d;return l.push((f,g,m,b,E,x,_)=>{h=c(h,f,g,m,b,E,x,_)}),this[o].apply(this,l),h}}function Yd(e,t){const{name:n,type:i,direction:r}=t,o="find"+n[0].toUpperCase()+n.slice(1,-1);e.prototype[o]=function(u,l,c){if(i!=="mixed"&&this.type!=="mixed"&&i!==this.type)return!1;if(arguments.length===1)return c=u,Qo(!0,this,i,c);if(arguments.length===2){u=""+u,c=l;const d=this._nodes.get(u);if(typeof d>"u")throw new G(`Graph.${o}: could not find the "${u}" node in the graph.`);return Hi(!0,this.multi,i==="mixed"?this.type:i,r,d,c)}if(arguments.length===3){u=""+u,l=""+l;const d=this._nodes.get(u);if(!d)throw new G(`Graph.${o}:  could not find the "${u}" source node in the graph.`);if(!this._nodes.has(l))throw new G(`Graph.${o}:  could not find the "${l}" target node in the graph.`);return Wi(!0,i,this.multi,r,d,l,c)}throw new B(`Graph.${o}: too many arguments (expecting 1, 2 or 3 and got ${arguments.length}).`)};const a="some"+n[0].toUpperCase()+n.slice(1,-1);e.prototype[a]=function(){const u=Array.prototype.slice.call(arguments),l=u.pop();return u.push((d,h,f,g,m,b,E)=>l(d,h,f,g,m,b,E)),!!this[o].apply(this,u)};const s="every"+n[0].toUpperCase()+n.slice(1,-1);e.prototype[s]=function(){const u=Array.prototype.slice.call(arguments),l=u.pop();return u.push((d,h,f,g,m,b,E)=>!l(d,h,f,g,m,b,E)),!this[o].apply(this,u)}}function Xd(e,t){const{name:n,type:i,direction:r}=t,o=n.slice(0,-1)+"Entries";e.prototype[o]=function(a,s){if(i!=="mixed"&&this.type!=="mixed"&&i!==this.type)return St();if(!arguments.length)return Bd(this,i);if(arguments.length===1){a=""+a;const u=this._nodes.get(a);if(!u)throw new G(`Graph.${o}: could not find the "${a}" node in the graph.`);return Hd(i,r,u)}if(arguments.length===2){a=""+a,s=""+s;const u=this._nodes.get(a);if(!u)throw new G(`Graph.${o}:  could not find the "${a}" source node in the graph.`);if(!this._nodes.has(s))throw new G(`Graph.${o}:  could not find the "${s}" target node in the graph.`);return qd(i,r,u,s)}throw new B(`Graph.${o}: too many arguments (expecting 0, 1 or 2 and got ${arguments.length}).`)}}function Kd(e){Gd.forEach(t=>{Vd(e,t),jd(e,t),Yd(e,t),Xd(e,t)})}const Zd=[{name:"neighbors",type:"mixed"},{name:"inNeighbors",type:"directed",direction:"in"},{name:"outNeighbors",type:"directed",direction:"out"},{name:"inboundNeighbors",type:"mixed",direction:"in"},{name:"outboundNeighbors",type:"mixed",direction:"out"},{name:"directedNeighbors",type:"directed"},{name:"undirectedNeighbors",type:"undirected"}];function Fn(){this.A=null,this.B=null}Fn.prototype.wrap=function(e){this.A===null?this.A=e:this.B===null&&(this.B=e)};Fn.prototype.has=function(e){return this.A!==null&&e in this.A||this.B!==null&&e in this.B};function Gt(e,t,n,i,r){for(const o in i){const a=i[o],s=a.source,u=a.target,l=s===n?u:s;if(t&&t.has(l.key))continue;const c=r(l.key,l.attributes);if(e&&c)return l.key}}function qi(e,t,n,i,r){if(t!=="mixed"){if(t==="undirected")return Gt(e,null,i,i.undirected,r);if(typeof n=="string")return Gt(e,null,i,i[n],r)}const o=new Fn;let a;if(t!=="undirected"){if(n!=="out"){if(a=Gt(e,null,i,i.in,r),e&&a)return a;o.wrap(i.in)}if(n!=="in"){if(a=Gt(e,o,i,i.out,r),e&&a)return a;o.wrap(i.out)}}if(t!=="directed"&&(a=Gt(e,o,i,i.undirected,r),e&&a))return a}function Jd(e,t,n){if(e!=="mixed"){if(e==="undirected")return Object.keys(n.undirected);if(typeof t=="string")return Object.keys(n[t])}const i=[];return qi(!1,e,t,n,function(r){i.push(r)}),i}function Pt(e,t,n){const i=Object.keys(n),r=i.length;let o=0;return{[Symbol.iterator](){return this},next(){let a=null;do{if(o>=r)return e&&e.wrap(n),{done:!0};const s=n[i[o++]],u=s.source,l=s.target;if(a=u===t?l:u,e&&e.has(a.key)){a=null;continue}}while(a===null);return{done:!1,value:{neighbor:a.key,attributes:a.attributes}}}}}function Qd(e,t,n){if(e!=="mixed"){if(e==="undirected")return Pt(null,n,n.undirected);if(typeof t=="string")return Pt(null,n,n[t])}let i=St();const r=new Fn;return e!=="undirected"&&(t!=="out"&&(i=Ze(i,Pt(r,n,n.in))),t!=="in"&&(i=Ze(i,Pt(r,n,n.out)))),e!=="directed"&&(i=Ze(i,Pt(r,n,n.undirected))),i}function eh(e,t){const{name:n,type:i,direction:r}=t;e.prototype[n]=function(o){if(i!=="mixed"&&this.type!=="mixed"&&i!==this.type)return[];o=""+o;const a=this._nodes.get(o);if(typeof a>"u")throw new G(`Graph.${n}: could not find the "${o}" node in the graph.`);return Jd(i==="mixed"?this.type:i,r,a)}}function th(e,t){const{name:n,type:i,direction:r}=t,o="forEach"+n[0].toUpperCase()+n.slice(1,-1);e.prototype[o]=function(l,c){if(i!=="mixed"&&this.type!=="mixed"&&i!==this.type)return;l=""+l;const d=this._nodes.get(l);if(typeof d>"u")throw new G(`Graph.${o}: could not find the "${l}" node in the graph.`);qi(!1,i==="mixed"?this.type:i,r,d,c)};const a="map"+n[0].toUpperCase()+n.slice(1);e.prototype[a]=function(l,c){const d=[];return this[o](l,(h,f)=>{d.push(c(h,f))}),d};const s="filter"+n[0].toUpperCase()+n.slice(1);e.prototype[s]=function(l,c){const d=[];return this[o](l,(h,f)=>{c(h,f)&&d.push(h)}),d};const u="reduce"+n[0].toUpperCase()+n.slice(1);e.prototype[u]=function(l,c,d){if(arguments.length<3)throw new B(`Graph.${u}: missing initial value. You must provide it because the callback takes more than one argument and we cannot infer the initial value from the first iteration, as you could with a simple array.`);let h=d;return this[o](l,(f,g)=>{h=c(h,f,g)}),h}}function nh(e,t){const{name:n,type:i,direction:r}=t,o=n[0].toUpperCase()+n.slice(1,-1),a="find"+o;e.prototype[a]=function(l,c){if(i!=="mixed"&&this.type!=="mixed"&&i!==this.type)return;l=""+l;const d=this._nodes.get(l);if(typeof d>"u")throw new G(`Graph.${a}: could not find the "${l}" node in the graph.`);return qi(!0,i==="mixed"?this.type:i,r,d,c)};const s="some"+o;e.prototype[s]=function(l,c){return!!this[a](l,c)};const u="every"+o;e.prototype[u]=function(l,c){return!this[a](l,(h,f)=>!c(h,f))}}function ih(e,t){const{name:n,type:i,direction:r}=t,o=n.slice(0,-1)+"Entries";e.prototype[o]=function(a){if(i!=="mixed"&&this.type!=="mixed"&&i!==this.type)return St();a=""+a;const s=this._nodes.get(a);if(typeof s>"u")throw new G(`Graph.${o}: could not find the "${a}" node in the graph.`);return Qd(i==="mixed"?this.type:i,r,s)}}function rh(e){Zd.forEach(t=>{eh(e,t),th(e,t),nh(e,t),ih(e,t)})}function cn(e,t,n,i,r){const o=i._nodes.values(),a=i.type;let s,u,l,c,d,h;for(;s=o.next(),s.done!==!0;){let f=!1;if(u=s.value,a!=="undirected"){c=u.out;for(l in c){d=c[l];do h=d.target,f=!0,r(u.key,h.key,u.attributes,h.attributes,d.key,d.attributes,d.undirected),d=d.next;while(d)}}if(a!=="directed"){c=u.undirected;for(l in c)if(!(t&&u.key>l)){d=c[l];do h=d.target,h.key!==l&&(h=d.source),f=!0,r(u.key,h.key,u.attributes,h.attributes,d.key,d.attributes,d.undirected),d=d.next;while(d)}}n&&!f&&r(u.key,null,u.attributes,null,null,null,null)}}function oh(e,t){const n={key:e};return Vo(t.attributes)||(n.attributes=me({},t.attributes)),n}function ah(e,t,n){const i={key:t,source:n.source.key,target:n.target.key};return Vo(n.attributes)||(i.attributes=me({},n.attributes)),e==="mixed"&&n.undirected&&(i.undirected=!0),i}function sh(e){if(!ve(e))throw new B('Graph.import: invalid serialized node. A serialized node should be a plain object with at least a "key" property.');if(!("key"in e))throw new B("Graph.import: serialized node is missing its key.");if("attributes"in e&&(!ve(e.attributes)||e.attributes===null))throw new B("Graph.import: invalid attributes. Attributes should be a plain object, null or omitted.")}function uh(e){if(!ve(e))throw new B('Graph.import: invalid serialized edge. A serialized edge should be a plain object with at least a "source" & "target" property.');if(!("source"in e))throw new B("Graph.import: serialized edge is missing its source.");if(!("target"in e))throw new B("Graph.import: serialized edge is missing its target.");if("attributes"in e&&(!ve(e.attributes)||e.attributes===null))throw new B("Graph.import: invalid attributes. Attributes should be a plain object, null or omitted.");if("undirected"in e&&typeof e.undirected!="boolean")throw new B("Graph.import: invalid undirectedness information. Undirected should be boolean or omitted.")}const lh=dd(),ch=new Set(["directed","undirected","mixed"]),Pr=new Set(["domain","_events","_eventsCount","_maxListeners"]),dh=[{name:e=>`${e}Edge`,generateKey:!0},{name:e=>`${e}DirectedEdge`,generateKey:!0,type:"directed"},{name:e=>`${e}UndirectedEdge`,generateKey:!0,type:"undirected"},{name:e=>`${e}EdgeWithKey`},{name:e=>`${e}DirectedEdgeWithKey`,type:"directed"},{name:e=>`${e}UndirectedEdgeWithKey`,type:"undirected"}],hh={allowSelfLoops:!0,multi:!1,type:"mixed"};function fh(e,t,n){if(n&&!ve(n))throw new B(`Graph.addNode: invalid attributes. Expecting an object but got "${n}"`);if(t=""+t,n=n||{},e._nodes.has(t))throw new Y(`Graph.addNode: the "${t}" node already exist in the graph.`);const i=new e.NodeDataClass(t,n);return e._nodes.set(t,i),e.emit("nodeAdded",{key:t,attributes:n}),i}function Ir(e,t,n){const i=new e.NodeDataClass(t,n);return e._nodes.set(t,i),e.emit("nodeAdded",{key:t,attributes:n}),i}function ea(e,t,n,i,r,o,a,s){if(!i&&e.type==="undirected")throw new Y(`Graph.${t}: you cannot add a directed edge to an undirected graph. Use the #.addEdge or #.addUndirectedEdge instead.`);if(i&&e.type==="directed")throw new Y(`Graph.${t}: you cannot add an undirected edge to a directed graph. Use the #.addEdge or #.addDirectedEdge instead.`);if(s&&!ve(s))throw new B(`Graph.${t}: invalid attributes. Expecting an object but got "${s}"`);if(o=""+o,a=""+a,s=s||{},!e.allowSelfLoops&&o===a)throw new Y(`Graph.${t}: source & target are the same ("${o}"), thus creating a loop explicitly forbidden by this graph 'allowSelfLoops' option set to false.`);const u=e._nodes.get(o),l=e._nodes.get(a);if(!u)throw new G(`Graph.${t}: source node "${o}" not found.`);if(!l)throw new G(`Graph.${t}: target node "${a}" not found.`);const c={key:null,undirected:i,source:o,target:a,attributes:s};if(n)r=e._edgeKeyGenerator();else if(r=""+r,e._edges.has(r))throw new Y(`Graph.${t}: the "${r}" edge already exists in the graph.`);if(!e.multi&&(i?typeof u.undirected[a]<"u":typeof u.out[a]<"u"))throw new Y(`Graph.${t}: an edge linking "${o}" to "${a}" already exists. If you really want to add multiple edges linking those nodes, you should create a multi graph by using the 'multi' option.`);const d=new Lt(i,r,u,l,s);e._edges.set(r,d);const h=o===a;return i?(u.undirectedDegree++,l.undirectedDegree++,h&&(u.undirectedLoops++,e._undirectedSelfLoopCount++)):(u.outDegree++,l.inDegree++,h&&(u.directedLoops++,e._directedSelfLoopCount++)),e.multi?d.attachMulti():d.attach(),i?e._undirectedSize++:e._directedSize++,c.key=r,e.emit("edgeAdded",c),r}function gh(e,t,n,i,r,o,a,s,u){if(!i&&e.type==="undirected")throw new Y(`Graph.${t}: you cannot merge/update a directed edge to an undirected graph. Use the #.mergeEdge/#.updateEdge or #.addUndirectedEdge instead.`);if(i&&e.type==="directed")throw new Y(`Graph.${t}: you cannot merge/update an undirected edge to a directed graph. Use the #.mergeEdge/#.updateEdge or #.addDirectedEdge instead.`);if(s){if(u){if(typeof s!="function")throw new B(`Graph.${t}: invalid updater function. Expecting a function but got "${s}"`)}else if(!ve(s))throw new B(`Graph.${t}: invalid attributes. Expecting an object but got "${s}"`)}o=""+o,a=""+a;let l;if(u&&(l=s,s=void 0),!e.allowSelfLoops&&o===a)throw new Y(`Graph.${t}: source & target are the same ("${o}"), thus creating a loop explicitly forbidden by this graph 'allowSelfLoops' option set to false.`);let c=e._nodes.get(o),d=e._nodes.get(a),h,f;if(!n&&(h=e._edges.get(r),h)){if((h.source.key!==o||h.target.key!==a)&&(!i||h.source.key!==a||h.target.key!==o))throw new Y(`Graph.${t}: inconsistency detected when attempting to merge the "${r}" edge with "${o}" source & "${a}" target vs. ("${h.source.key}", "${h.target.key}").`);f=h}if(!f&&!e.multi&&c&&(f=i?c.undirected[a]:c.out[a]),f){const x=[f.key,!1,!1,!1];if(u?!l:!s)return x;if(u){const _=f.attributes;f.attributes=l(_),e.emit("edgeAttributesUpdated",{type:"replace",key:f.key,attributes:f.attributes})}else me(f.attributes,s),e.emit("edgeAttributesUpdated",{type:"merge",key:f.key,attributes:f.attributes,data:s});return x}s=s||{},u&&l&&(s=l(s));const g={key:null,undirected:i,source:o,target:a,attributes:s};if(n)r=e._edgeKeyGenerator();else if(r=""+r,e._edges.has(r))throw new Y(`Graph.${t}: the "${r}" edge already exists in the graph.`);let m=!1,b=!1;c||(c=Ir(e,o,{}),m=!0,o===a&&(d=c,b=!0)),d||(d=Ir(e,a,{}),b=!0),h=new Lt(i,r,c,d,s),e._edges.set(r,h);const E=o===a;return i?(c.undirectedDegree++,d.undirectedDegree++,E&&(c.undirectedLoops++,e._undirectedSelfLoopCount++)):(c.outDegree++,d.inDegree++,E&&(c.directedLoops++,e._directedSelfLoopCount++)),e.multi?h.attachMulti():h.attach(),i?e._undirectedSize++:e._directedSize++,g.key=r,e.emit("edgeAdded",g),[r,!0,m,b]}function yt(e,t){e._edges.delete(t.key);const{source:n,target:i,attributes:r}=t,o=t.undirected,a=n===i;o?(n.undirectedDegree--,i.undirectedDegree--,a&&(n.undirectedLoops--,e._undirectedSelfLoopCount--)):(n.outDegree--,i.inDegree--,a&&(n.directedLoops--,e._directedSelfLoopCount--)),e.multi?t.detachMulti():t.detach(),o?e._undirectedSize--:e._directedSize--,e.emit("edgeDropped",{key:t.key,attributes:r,source:n.key,target:i.key,undirected:o})}class ae extends qo.EventEmitter{constructor(t){if(super(),t=me({},hh,t),typeof t.multi!="boolean")throw new B(`Graph.constructor: invalid 'multi' option. Expecting a boolean but got "${t.multi}".`);if(!ch.has(t.type))throw new B(`Graph.constructor: invalid 'type' option. Should be one of "mixed", "directed" or "undirected" but got "${t.type}".`);if(typeof t.allowSelfLoops!="boolean")throw new B(`Graph.constructor: invalid 'allowSelfLoops' option. Expecting a boolean but got "${t.allowSelfLoops}".`);const n=t.type==="mixed"?jo:t.type==="directed"?Yo:Xo;Se(this,"NodeDataClass",n);const i="geid_"+lh()+"_";let r=0;const o=()=>{let a;do a=i+r++;while(this._edges.has(a));return a};Se(this,"_attributes",{}),Se(this,"_nodes",new Map),Se(this,"_edges",new Map),Se(this,"_directedSize",0),Se(this,"_undirectedSize",0),Se(this,"_directedSelfLoopCount",0),Se(this,"_undirectedSelfLoopCount",0),Se(this,"_edgeKeyGenerator",o),Se(this,"_options",t),Pr.forEach(a=>Se(this,a,this[a])),Ge(this,"order",()=>this._nodes.size),Ge(this,"size",()=>this._edges.size),Ge(this,"directedSize",()=>this._directedSize),Ge(this,"undirectedSize",()=>this._undirectedSize),Ge(this,"selfLoopCount",()=>this._directedSelfLoopCount+this._undirectedSelfLoopCount),Ge(this,"directedSelfLoopCount",()=>this._directedSelfLoopCount),Ge(this,"undirectedSelfLoopCount",()=>this._undirectedSelfLoopCount),Ge(this,"multi",this._options.multi),Ge(this,"type",this._options.type),Ge(this,"allowSelfLoops",this._options.allowSelfLoops),Ge(this,"implementation",()=>"graphology")}_resetInstanceCounters(){this._directedSize=0,this._undirectedSize=0,this._directedSelfLoopCount=0,this._undirectedSelfLoopCount=0}hasNode(t){return this._nodes.has(""+t)}hasDirectedEdge(t,n){if(this.type==="undirected")return!1;if(arguments.length===1){const i=""+t,r=this._edges.get(i);return!!r&&!r.undirected}else if(arguments.length===2){t=""+t,n=""+n;const i=this._nodes.get(t);return i?i.out.hasOwnProperty(n):!1}throw new B(`Graph.hasDirectedEdge: invalid arity (${arguments.length}, instead of 1 or 2). You can either ask for an edge id or for the existence of an edge between a source & a target.`)}hasUndirectedEdge(t,n){if(this.type==="directed")return!1;if(arguments.length===1){const i=""+t,r=this._edges.get(i);return!!r&&r.undirected}else if(arguments.length===2){t=""+t,n=""+n;const i=this._nodes.get(t);return i?i.undirected.hasOwnProperty(n):!1}throw new B(`Graph.hasDirectedEdge: invalid arity (${arguments.length}, instead of 1 or 2). You can either ask for an edge id or for the existence of an edge between a source & a target.`)}hasEdge(t,n){if(arguments.length===1){const i=""+t;return this._edges.has(i)}else if(arguments.length===2){t=""+t,n=""+n;const i=this._nodes.get(t);return i?typeof i.out<"u"&&i.out.hasOwnProperty(n)||typeof i.undirected<"u"&&i.undirected.hasOwnProperty(n):!1}throw new B(`Graph.hasEdge: invalid arity (${arguments.length}, instead of 1 or 2). You can either ask for an edge id or for the existence of an edge between a source & a target.`)}directedEdge(t,n){if(this.type==="undirected")return;if(t=""+t,n=""+n,this.multi)throw new Y("Graph.directedEdge: this method is irrelevant with multigraphs since there might be multiple edges between source & target. See #.directedEdges instead.");const i=this._nodes.get(t);if(!i)throw new G(`Graph.directedEdge: could not find the "${t}" source node in the graph.`);if(!this._nodes.has(n))throw new G(`Graph.directedEdge: could not find the "${n}" target node in the graph.`);const r=i.out&&i.out[n]||void 0;if(r)return r.key}undirectedEdge(t,n){if(this.type==="directed")return;if(t=""+t,n=""+n,this.multi)throw new Y("Graph.undirectedEdge: this method is irrelevant with multigraphs since there might be multiple edges between source & target. See #.undirectedEdges instead.");const i=this._nodes.get(t);if(!i)throw new G(`Graph.undirectedEdge: could not find the "${t}" source node in the graph.`);if(!this._nodes.has(n))throw new G(`Graph.undirectedEdge: could not find the "${n}" target node in the graph.`);const r=i.undirected&&i.undirected[n]||void 0;if(r)return r.key}edge(t,n){if(this.multi)throw new Y("Graph.edge: this method is irrelevant with multigraphs since there might be multiple edges between source & target. See #.edges instead.");t=""+t,n=""+n;const i=this._nodes.get(t);if(!i)throw new G(`Graph.edge: could not find the "${t}" source node in the graph.`);if(!this._nodes.has(n))throw new G(`Graph.edge: could not find the "${n}" target node in the graph.`);const r=i.out&&i.out[n]||i.undirected&&i.undirected[n]||void 0;if(r)return r.key}areDirectedNeighbors(t,n){t=""+t,n=""+n;const i=this._nodes.get(t);if(!i)throw new G(`Graph.areDirectedNeighbors: could not find the "${t}" node in the graph.`);return this.type==="undirected"?!1:n in i.in||n in i.out}areOutNeighbors(t,n){t=""+t,n=""+n;const i=this._nodes.get(t);if(!i)throw new G(`Graph.areOutNeighbors: could not find the "${t}" node in the graph.`);return this.type==="undirected"?!1:n in i.out}areInNeighbors(t,n){t=""+t,n=""+n;const i=this._nodes.get(t);if(!i)throw new G(`Graph.areInNeighbors: could not find the "${t}" node in the graph.`);return this.type==="undirected"?!1:n in i.in}areUndirectedNeighbors(t,n){t=""+t,n=""+n;const i=this._nodes.get(t);if(!i)throw new G(`Graph.areUndirectedNeighbors: could not find the "${t}" node in the graph.`);return this.type==="directed"?!1:n in i.undirected}areNeighbors(t,n){t=""+t,n=""+n;const i=this._nodes.get(t);if(!i)throw new G(`Graph.areNeighbors: could not find the "${t}" node in the graph.`);return this.type!=="undirected"&&(n in i.in||n in i.out)||this.type!=="directed"&&n in i.undirected}areInboundNeighbors(t,n){t=""+t,n=""+n;const i=this._nodes.get(t);if(!i)throw new G(`Graph.areInboundNeighbors: could not find the "${t}" node in the graph.`);return this.type!=="undirected"&&n in i.in||this.type!=="directed"&&n in i.undirected}areOutboundNeighbors(t,n){t=""+t,n=""+n;const i=this._nodes.get(t);if(!i)throw new G(`Graph.areOutboundNeighbors: could not find the "${t}" node in the graph.`);return this.type!=="undirected"&&n in i.out||this.type!=="directed"&&n in i.undirected}inDegree(t){t=""+t;const n=this._nodes.get(t);if(!n)throw new G(`Graph.inDegree: could not find the "${t}" node in the graph.`);return this.type==="undirected"?0:n.inDegree}outDegree(t){t=""+t;const n=this._nodes.get(t);if(!n)throw new G(`Graph.outDegree: could not find the "${t}" node in the graph.`);return this.type==="undirected"?0:n.outDegree}directedDegree(t){t=""+t;const n=this._nodes.get(t);if(!n)throw new G(`Graph.directedDegree: could not find the "${t}" node in the graph.`);return this.type==="undirected"?0:n.inDegree+n.outDegree}undirectedDegree(t){t=""+t;const n=this._nodes.get(t);if(!n)throw new G(`Graph.undirectedDegree: could not find the "${t}" node in the graph.`);return this.type==="directed"?0:n.undirectedDegree}inboundDegree(t){t=""+t;const n=this._nodes.get(t);if(!n)throw new G(`Graph.inboundDegree: could not find the "${t}" node in the graph.`);let i=0;return this.type!=="directed"&&(i+=n.undirectedDegree),this.type!=="undirected"&&(i+=n.inDegree),i}outboundDegree(t){t=""+t;const n=this._nodes.get(t);if(!n)throw new G(`Graph.outboundDegree: could not find the "${t}" node in the graph.`);let i=0;return this.type!=="directed"&&(i+=n.undirectedDegree),this.type!=="undirected"&&(i+=n.outDegree),i}degree(t){t=""+t;const n=this._nodes.get(t);if(!n)throw new G(`Graph.degree: could not find the "${t}" node in the graph.`);let i=0;return this.type!=="directed"&&(i+=n.undirectedDegree),this.type!=="undirected"&&(i+=n.inDegree+n.outDegree),i}inDegreeWithoutSelfLoops(t){t=""+t;const n=this._nodes.get(t);if(!n)throw new G(`Graph.inDegreeWithoutSelfLoops: could not find the "${t}" node in the graph.`);return this.type==="undirected"?0:n.inDegree-n.directedLoops}outDegreeWithoutSelfLoops(t){t=""+t;const n=this._nodes.get(t);if(!n)throw new G(`Graph.outDegreeWithoutSelfLoops: could not find the "${t}" node in the graph.`);return this.type==="undirected"?0:n.outDegree-n.directedLoops}directedDegreeWithoutSelfLoops(t){t=""+t;const n=this._nodes.get(t);if(!n)throw new G(`Graph.directedDegreeWithoutSelfLoops: could not find the "${t}" node in the graph.`);return this.type==="undirected"?0:n.inDegree+n.outDegree-n.directedLoops*2}undirectedDegreeWithoutSelfLoops(t){t=""+t;const n=this._nodes.get(t);if(!n)throw new G(`Graph.undirectedDegreeWithoutSelfLoops: could not find the "${t}" node in the graph.`);return this.type==="directed"?0:n.undirectedDegree-n.undirectedLoops*2}inboundDegreeWithoutSelfLoops(t){t=""+t;const n=this._nodes.get(t);if(!n)throw new G(`Graph.inboundDegreeWithoutSelfLoops: could not find the "${t}" node in the graph.`);let i=0,r=0;return this.type!=="directed"&&(i+=n.undirectedDegree,r+=n.undirectedLoops*2),this.type!=="undirected"&&(i+=n.inDegree,r+=n.directedLoops),i-r}outboundDegreeWithoutSelfLoops(t){t=""+t;const n=this._nodes.get(t);if(!n)throw new G(`Graph.outboundDegreeWithoutSelfLoops: could not find the "${t}" node in the graph.`);let i=0,r=0;return this.type!=="directed"&&(i+=n.undirectedDegree,r+=n.undirectedLoops*2),this.type!=="undirected"&&(i+=n.outDegree,r+=n.directedLoops),i-r}degreeWithoutSelfLoops(t){t=""+t;const n=this._nodes.get(t);if(!n)throw new G(`Graph.degreeWithoutSelfLoops: could not find the "${t}" node in the graph.`);let i=0,r=0;return this.type!=="directed"&&(i+=n.undirectedDegree,r+=n.undirectedLoops*2),this.type!=="undirected"&&(i+=n.inDegree+n.outDegree,r+=n.directedLoops*2),i-r}source(t){t=""+t;const n=this._edges.get(t);if(!n)throw new G(`Graph.source: could not find the "${t}" edge in the graph.`);return n.source.key}target(t){t=""+t;const n=this._edges.get(t);if(!n)throw new G(`Graph.target: could not find the "${t}" edge in the graph.`);return n.target.key}extremities(t){t=""+t;const n=this._edges.get(t);if(!n)throw new G(`Graph.extremities: could not find the "${t}" edge in the graph.`);return[n.source.key,n.target.key]}opposite(t,n){t=""+t,n=""+n;const i=this._edges.get(n);if(!i)throw new G(`Graph.opposite: could not find the "${n}" edge in the graph.`);const r=i.source.key,o=i.target.key;if(t===r)return o;if(t===o)return r;throw new G(`Graph.opposite: the "${t}" node is not attached to the "${n}" edge (${r}, ${o}).`)}hasExtremity(t,n){t=""+t,n=""+n;const i=this._edges.get(t);if(!i)throw new G(`Graph.hasExtremity: could not find the "${t}" edge in the graph.`);return i.source.key===n||i.target.key===n}isUndirected(t){t=""+t;const n=this._edges.get(t);if(!n)throw new G(`Graph.isUndirected: could not find the "${t}" edge in the graph.`);return n.undirected}isDirected(t){t=""+t;const n=this._edges.get(t);if(!n)throw new G(`Graph.isDirected: could not find the "${t}" edge in the graph.`);return!n.undirected}isSelfLoop(t){t=""+t;const n=this._edges.get(t);if(!n)throw new G(`Graph.isSelfLoop: could not find the "${t}" edge in the graph.`);return n.source===n.target}addNode(t,n){return fh(this,t,n).key}mergeNode(t,n){if(n&&!ve(n))throw new B(`Graph.mergeNode: invalid attributes. Expecting an object but got "${n}"`);t=""+t,n=n||{};let i=this._nodes.get(t);return i?(n&&(me(i.attributes,n),this.emit("nodeAttributesUpdated",{type:"merge",key:t,attributes:i.attributes,data:n})),[t,!1]):(i=new this.NodeDataClass(t,n),this._nodes.set(t,i),this.emit("nodeAdded",{key:t,attributes:n}),[t,!0])}updateNode(t,n){if(n&&typeof n!="function")throw new B(`Graph.updateNode: invalid updater function. Expecting a function but got "${n}"`);t=""+t;let i=this._nodes.get(t);if(i){if(n){const o=i.attributes;i.attributes=n(o),this.emit("nodeAttributesUpdated",{type:"replace",key:t,attributes:i.attributes})}return[t,!1]}const r=n?n({}):{};return i=new this.NodeDataClass(t,r),this._nodes.set(t,i),this.emit("nodeAdded",{key:t,attributes:r}),[t,!0]}dropNode(t){t=""+t;const n=this._nodes.get(t);if(!n)throw new G(`Graph.dropNode: could not find the "${t}" node in the graph.`);let i;if(this.type!=="undirected"){for(const r in n.out){i=n.out[r];do yt(this,i),i=i.next;while(i)}for(const r in n.in){i=n.in[r];do yt(this,i),i=i.next;while(i)}}if(this.type!=="directed")for(const r in n.undirected){i=n.undirected[r];do yt(this,i),i=i.next;while(i)}this._nodes.delete(t),this.emit("nodeDropped",{key:t,attributes:n.attributes})}dropEdge(t){let n;if(arguments.length>1){const i=""+arguments[0],r=""+arguments[1];if(n=Le(this,i,r,this.type),!n)throw new G(`Graph.dropEdge: could not find the "${i}" -> "${r}" edge in the graph.`)}else if(t=""+t,n=this._edges.get(t),!n)throw new G(`Graph.dropEdge: could not find the "${t}" edge in the graph.`);return yt(this,n),this}dropDirectedEdge(t,n){if(arguments.length<2)throw new Y("Graph.dropDirectedEdge: it does not make sense to try and drop a directed edge by key. What if the edge with this key is undirected? Use #.dropEdge for this purpose instead.");if(this.multi)throw new Y("Graph.dropDirectedEdge: cannot use a {source,target} combo when dropping an edge in a MultiGraph since we cannot infer the one you want to delete as there could be multiple ones.");t=""+t,n=""+n;const i=Le(this,t,n,"directed");if(!i)throw new G(`Graph.dropDirectedEdge: could not find a "${t}" -> "${n}" edge in the graph.`);return yt(this,i),this}dropUndirectedEdge(t,n){if(arguments.length<2)throw new Y("Graph.dropUndirectedEdge: it does not make sense to drop a directed edge by key. What if the edge with this key is undirected? Use #.dropEdge for this purpose instead.");if(this.multi)throw new Y("Graph.dropUndirectedEdge: cannot use a {source,target} combo when dropping an edge in a MultiGraph since we cannot infer the one you want to delete as there could be multiple ones.");const i=Le(this,t,n,"undirected");if(!i)throw new G(`Graph.dropUndirectedEdge: could not find a "${t}" -> "${n}" edge in the graph.`);return yt(this,i),this}clear(){this._edges.clear(),this._nodes.clear(),this._resetInstanceCounters(),this.emit("cleared")}clearEdges(){const t=this._nodes.values();let n;for(;n=t.next(),n.done!==!0;)n.value.clear();this._edges.clear(),this._resetInstanceCounters(),this.emit("edgesCleared")}getAttribute(t){return this._attributes[t]}getAttributes(){return this._attributes}hasAttribute(t){return this._attributes.hasOwnProperty(t)}setAttribute(t,n){return this._attributes[t]=n,this.emit("attributesUpdated",{type:"set",attributes:this._attributes,name:t}),this}updateAttribute(t,n){if(typeof n!="function")throw new B("Graph.updateAttribute: updater should be a function.");const i=this._attributes[t];return this._attributes[t]=n(i),this.emit("attributesUpdated",{type:"set",attributes:this._attributes,name:t}),this}removeAttribute(t){return delete this._attributes[t],this.emit("attributesUpdated",{type:"remove",attributes:this._attributes,name:t}),this}replaceAttributes(t){if(!ve(t))throw new B("Graph.replaceAttributes: provided attributes are not a plain object.");return this._attributes=t,this.emit("attributesUpdated",{type:"replace",attributes:this._attributes}),this}mergeAttributes(t){if(!ve(t))throw new B("Graph.mergeAttributes: provided attributes are not a plain object.");return me(this._attributes,t),this.emit("attributesUpdated",{type:"merge",attributes:this._attributes,data:t}),this}updateAttributes(t){if(typeof t!="function")throw new B("Graph.updateAttributes: provided updater is not a function.");return this._attributes=t(this._attributes),this.emit("attributesUpdated",{type:"update",attributes:this._attributes}),this}updateEachNodeAttributes(t,n){if(typeof t!="function")throw new B("Graph.updateEachNodeAttributes: expecting an updater function.");if(n&&!Gr(n))throw new B("Graph.updateEachNodeAttributes: invalid hints. Expecting an object having the following shape: {attributes?: [string]}");const i=this._nodes.values();let r,o;for(;r=i.next(),r.done!==!0;)o=r.value,o.attributes=t(o.key,o.attributes);this.emit("eachNodeAttributesUpdated",{hints:n||null})}updateEachEdgeAttributes(t,n){if(typeof t!="function")throw new B("Graph.updateEachEdgeAttributes: expecting an updater function.");if(n&&!Gr(n))throw new B("Graph.updateEachEdgeAttributes: invalid hints. Expecting an object having the following shape: {attributes?: [string]}");const i=this._edges.values();let r,o,a,s;for(;r=i.next(),r.done!==!0;)o=r.value,a=o.source,s=o.target,o.attributes=t(o.key,o.attributes,a.key,s.key,a.attributes,s.attributes,o.undirected);this.emit("eachEdgeAttributesUpdated",{hints:n||null})}forEachAdjacencyEntry(t){if(typeof t!="function")throw new B("Graph.forEachAdjacencyEntry: expecting a callback.");cn(!1,!1,!1,this,t)}forEachAdjacencyEntryWithOrphans(t){if(typeof t!="function")throw new B("Graph.forEachAdjacencyEntryWithOrphans: expecting a callback.");cn(!1,!1,!0,this,t)}forEachAssymetricAdjacencyEntry(t){if(typeof t!="function")throw new B("Graph.forEachAssymetricAdjacencyEntry: expecting a callback.");cn(!1,!0,!1,this,t)}forEachAssymetricAdjacencyEntryWithOrphans(t){if(typeof t!="function")throw new B("Graph.forEachAssymetricAdjacencyEntryWithOrphans: expecting a callback.");cn(!1,!0,!0,this,t)}nodes(){return Array.from(this._nodes.keys())}forEachNode(t){if(typeof t!="function")throw new B("Graph.forEachNode: expecting a callback.");const n=this._nodes.values();let i,r;for(;i=n.next(),i.done!==!0;)r=i.value,t(r.key,r.attributes)}findNode(t){if(typeof t!="function")throw new B("Graph.findNode: expecting a callback.");const n=this._nodes.values();let i,r;for(;i=n.next(),i.done!==!0;)if(r=i.value,t(r.key,r.attributes))return r.key}mapNodes(t){if(typeof t!="function")throw new B("Graph.mapNode: expecting a callback.");const n=this._nodes.values();let i,r;const o=new Array(this.order);let a=0;for(;i=n.next(),i.done!==!0;)r=i.value,o[a++]=t(r.key,r.attributes);return o}someNode(t){if(typeof t!="function")throw new B("Graph.someNode: expecting a callback.");const n=this._nodes.values();let i,r;for(;i=n.next(),i.done!==!0;)if(r=i.value,t(r.key,r.attributes))return!0;return!1}everyNode(t){if(typeof t!="function")throw new B("Graph.everyNode: expecting a callback.");const n=this._nodes.values();let i,r;for(;i=n.next(),i.done!==!0;)if(r=i.value,!t(r.key,r.attributes))return!1;return!0}filterNodes(t){if(typeof t!="function")throw new B("Graph.filterNodes: expecting a callback.");const n=this._nodes.values();let i,r;const o=[];for(;i=n.next(),i.done!==!0;)r=i.value,t(r.key,r.attributes)&&o.push(r.key);return o}reduceNodes(t,n){if(typeof t!="function")throw new B("Graph.reduceNodes: expecting a callback.");if(arguments.length<2)throw new B("Graph.reduceNodes: missing initial value. You must provide it because the callback takes more than one argument and we cannot infer the initial value from the first iteration, as you could with a simple array.");let i=n;const r=this._nodes.values();let o,a;for(;o=r.next(),o.done!==!0;)a=o.value,i=t(i,a.key,a.attributes);return i}nodeEntries(){const t=this._nodes.values();return{[Symbol.iterator](){return this},next(){const n=t.next();if(n.done)return n;const i=n.value;return{value:{node:i.key,attributes:i.attributes},done:!1}}}}export(){const t=new Array(this._nodes.size);let n=0;this._nodes.forEach((r,o)=>{t[n++]=oh(o,r)});const i=new Array(this._edges.size);return n=0,this._edges.forEach((r,o)=>{i[n++]=ah(this.type,o,r)}),{options:{type:this.type,multi:this.multi,allowSelfLoops:this.allowSelfLoops},attributes:this.getAttributes(),nodes:t,edges:i}}import(t,n=!1){if(t instanceof ae)return t.forEachNode((u,l)=>{n?this.mergeNode(u,l):this.addNode(u,l)}),t.forEachEdge((u,l,c,d,h,f,g)=>{n?g?this.mergeUndirectedEdgeWithKey(u,c,d,l):this.mergeDirectedEdgeWithKey(u,c,d,l):g?this.addUndirectedEdgeWithKey(u,c,d,l):this.addDirectedEdgeWithKey(u,c,d,l)}),this;if(!ve(t))throw new B("Graph.import: invalid argument. Expecting a serialized graph or, alternatively, a Graph instance.");if(t.attributes){if(!ve(t.attributes))throw new B("Graph.import: invalid attributes. Expecting a plain object.");n?this.mergeAttributes(t.attributes):this.replaceAttributes(t.attributes)}let i,r,o,a,s;if(t.nodes){if(o=t.nodes,!Array.isArray(o))throw new B("Graph.import: invalid nodes. Expecting an array.");for(i=0,r=o.length;i<r;i++){a=o[i],sh(a);const{key:u,attributes:l}=a;n?this.mergeNode(u,l):this.addNode(u,l)}}if(t.edges){let u=!1;if(this.type==="undirected"&&(u=!0),o=t.edges,!Array.isArray(o))throw new B("Graph.import: invalid edges. Expecting an array.");for(i=0,r=o.length;i<r;i++){s=o[i],uh(s);const{source:l,target:c,attributes:d,undirected:h=u}=s;let f;"key"in s?(f=n?h?this.mergeUndirectedEdgeWithKey:this.mergeDirectedEdgeWithKey:h?this.addUndirectedEdgeWithKey:this.addDirectedEdgeWithKey,f.call(this,s.key,l,c,d)):(f=n?h?this.mergeUndirectedEdge:this.mergeDirectedEdge:h?this.addUndirectedEdge:this.addDirectedEdge,f.call(this,l,c,d))}}return this}nullCopy(t){const n=new ae(me({},this._options,t));return n.replaceAttributes(me({},this.getAttributes())),n}emptyCopy(t){const n=this.nullCopy(t);return this._nodes.forEach((i,r)=>{const o=me({},i.attributes);i=new n.NodeDataClass(r,o),n._nodes.set(r,i)}),n}copy(t){if(t=t||{},typeof t.type=="string"&&t.type!==this.type&&t.type!=="mixed")throw new Y(`Graph.copy: cannot create an incompatible copy from "${this.type}" type to "${t.type}" because this would mean losing information about the current graph.`);if(typeof t.multi=="boolean"&&t.multi!==this.multi&&t.multi!==!0)throw new Y("Graph.copy: cannot create an incompatible copy by downgrading a multi graph to a simple one because this would mean losing information about the current graph.");if(typeof t.allowSelfLoops=="boolean"&&t.allowSelfLoops!==this.allowSelfLoops&&t.allowSelfLoops!==!0)throw new Y("Graph.copy: cannot create an incompatible copy from a graph allowing self loops to one that does not because this would mean losing information about the current graph.");const n=this.emptyCopy(t),i=this._edges.values();let r,o;for(;r=i.next(),r.done!==!0;)o=r.value,ea(n,"copy",!1,o.undirected,o.key,o.source.key,o.target.key,me({},o.attributes));return n}toJSON(){return this.export()}toString(){return"[object Graph]"}inspect(){const t={};this._nodes.forEach((o,a)=>{t[a]=o.attributes});const n={},i={};this._edges.forEach((o,a)=>{const s=o.undirected?"--":"->";let u="",l=o.source.key,c=o.target.key,d;o.undirected&&l>c&&(d=l,l=c,c=d);const h=`(${l})${s}(${c})`;a.startsWith("geid_")?this.multi&&(typeof i[h]>"u"?i[h]=0:i[h]++,u+=`${i[h]}. `):u+=`[${a}]: `,u+=h,n[u]=o.attributes});const r={};for(const o in this)this.hasOwnProperty(o)&&!Pr.has(o)&&typeof this[o]!="function"&&typeof o!="symbol"&&(r[o]=this[o]);return r.attributes=this._attributes,r.nodes=t,r.edges=n,Se(r,"constructor",this.constructor),r}}typeof Symbol<"u"&&(ae.prototype[Symbol.for("nodejs.util.inspect.custom")]=ae.prototype.inspect);dh.forEach(e=>{["add","merge","update"].forEach(t=>{const n=e.name(t),i=t==="add"?ea:gh;e.generateKey?ae.prototype[n]=function(r,o,a){return i(this,n,!0,(e.type||this.type)==="undirected",null,r,o,a,t==="update")}:ae.prototype[n]=function(r,o,a,s){return i(this,n,!1,(e.type||this.type)==="undirected",r,o,a,s,t==="update")}})});Ed(ae);$d(ae);Kd(ae);rh(ae);class ta extends ae{constructor(t){const n=me({type:"directed"},t);if("multi"in n&&n.multi!==!1)throw new B("DirectedGraph.from: inconsistent indication that the graph should be multi in given options!");if(n.type!=="directed")throw new B('DirectedGraph.from: inconsistent "'+n.type+'" type in given options!');super(n)}}class na extends ae{constructor(t){const n=me({type:"undirected"},t);if("multi"in n&&n.multi!==!1)throw new B("UndirectedGraph.from: inconsistent indication that the graph should be multi in given options!");if(n.type!=="undirected")throw new B('UndirectedGraph.from: inconsistent "'+n.type+'" type in given options!');super(n)}}class ia extends ae{constructor(t){const n=me({multi:!0},t);if("multi"in n&&n.multi!==!0)throw new B("MultiGraph.from: inconsistent indication that the graph should be simple in given options!");super(n)}}class ra extends ae{constructor(t){const n=me({type:"directed",multi:!0},t);if("multi"in n&&n.multi!==!0)throw new B("MultiDirectedGraph.from: inconsistent indication that the graph should be simple in given options!");if(n.type!=="directed")throw new B('MultiDirectedGraph.from: inconsistent "'+n.type+'" type in given options!');super(n)}}class oa extends ae{constructor(t){const n=me({type:"undirected",multi:!0},t);if("multi"in n&&n.multi!==!0)throw new B("MultiUndirectedGraph.from: inconsistent indication that the graph should be simple in given options!");if(n.type!=="undirected")throw new B('MultiUndirectedGraph.from: inconsistent "'+n.type+'" type in given options!');super(n)}}function Rt(e){e.from=function(t,n){const i=me({},t.options,n),r=new e(i);return r.import(t),r}}Rt(ae);Rt(ta);Rt(na);Rt(ia);Rt(ra);Rt(oa);ae.Graph=ae;ae.DirectedGraph=ta;ae.UndirectedGraph=na;ae.MultiGraph=ia;ae.MultiDirectedGraph=ra;ae.MultiUndirectedGraph=oa;ae.InvalidArgumentsGraphError=B;ae.NotFoundGraphError=G;ae.UsageGraphError=Y;function ph(e,t){if(typeof e!="object"||!e)return e;var n=e[Symbol.toPrimitive];if(n!==void 0){var i=n.call(e,t);if(typeof i!="object")return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}function jt(e){var t=ph(e,"string");return typeof t=="symbol"?t:t+""}function be(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function Fr(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,jt(i.key),i)}}function we(e,t,n){return t&&Fr(e.prototype,t),n&&Fr(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e}function Tt(e){return Tt=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},Tt(e)}function aa(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(aa=function(){return!!e})()}function mh(e){if(e===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function vh(e,t){if(t&&(typeof t=="object"||typeof t=="function"))return t;if(t!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return mh(e)}function Re(e,t,n){return t=Tt(t),vh(e,aa()?Reflect.construct(t,n||[],Tt(e).constructor):t.apply(e,n))}function xi(e,t){return xi=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(n,i){return n.__proto__=i,n},xi(e,t)}function Ne(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&xi(e,t)}function yh(e){if(Array.isArray(e))return e}function bh(e,t){var n=e==null?null:typeof Symbol<"u"&&e[Symbol.iterator]||e["@@iterator"];if(n!=null){var i,r,o,a,s=[],u=!0,l=!1;try{if(o=(n=n.call(e)).next,t===0){if(Object(n)!==n)return;u=!1}else for(;!(u=(i=o.call(n)).done)&&(s.push(i.value),s.length!==t);u=!0);}catch(c){l=!0,r=c}finally{try{if(!u&&n.return!=null&&(a=n.return(),Object(a)!==a))return}finally{if(l)throw r}}return s}}function Ei(e,t){(t==null||t>e.length)&&(t=e.length);for(var n=0,i=Array(t);n<t;n++)i[n]=e[n];return i}function sa(e,t){if(e){if(typeof e=="string")return Ei(e,t);var n={}.toString.call(e).slice(8,-1);return n==="Object"&&e.constructor&&(n=e.constructor.name),n==="Map"||n==="Set"?Array.from(e):n==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?Ei(e,t):void 0}}function wh(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function At(e,t){return yh(e)||bh(e,t)||sa(e,t)||wh()}var ei={black:"#000000",silver:"#C0C0C0",gray:"#808080",grey:"#808080",white:"#FFFFFF",maroon:"#800000",red:"#FF0000",purple:"#800080",fuchsia:"#FF00FF",green:"#008000",lime:"#00FF00",olive:"#808000",yellow:"#FFFF00",navy:"#000080",blue:"#0000FF",teal:"#008080",aqua:"#00FFFF",darkblue:"#00008B",mediumblue:"#0000CD",darkgreen:"#006400",darkcyan:"#008B8B",deepskyblue:"#00BFFF",darkturquoise:"#00CED1",mediumspringgreen:"#00FA9A",springgreen:"#00FF7F",cyan:"#00FFFF",midnightblue:"#191970",dodgerblue:"#1E90FF",lightseagreen:"#20B2AA",forestgreen:"#228B22",seagreen:"#2E8B57",darkslategray:"#2F4F4F",darkslategrey:"#2F4F4F",limegreen:"#32CD32",mediumseagreen:"#3CB371",turquoise:"#40E0D0",royalblue:"#4169E1",steelblue:"#4682B4",darkslateblue:"#483D8B",mediumturquoise:"#48D1CC",indigo:"#4B0082",darkolivegreen:"#556B2F",cadetblue:"#5F9EA0",cornflowerblue:"#6495ED",rebeccapurple:"#663399",mediumaquamarine:"#66CDAA",dimgray:"#696969",dimgrey:"#696969",slateblue:"#6A5ACD",olivedrab:"#6B8E23",slategray:"#708090",slategrey:"#708090",lightslategray:"#778899",lightslategrey:"#778899",mediumslateblue:"#7B68EE",lawngreen:"#7CFC00",chartreuse:"#7FFF00",aquamarine:"#7FFFD4",skyblue:"#87CEEB",lightskyblue:"#87CEFA",blueviolet:"#8A2BE2",darkred:"#8B0000",darkmagenta:"#8B008B",saddlebrown:"#8B4513",darkseagreen:"#8FBC8F",lightgreen:"#90EE90",mediumpurple:"#9370DB",darkviolet:"#9400D3",palegreen:"#98FB98",darkorchid:"#9932CC",yellowgreen:"#9ACD32",sienna:"#A0522D",brown:"#A52A2A",darkgray:"#A9A9A9",darkgrey:"#A9A9A9",lightblue:"#ADD8E6",greenyellow:"#ADFF2F",paleturquoise:"#AFEEEE",lightsteelblue:"#B0C4DE",powderblue:"#B0E0E6",firebrick:"#B22222",darkgoldenrod:"#B8860B",mediumorchid:"#BA55D3",rosybrown:"#BC8F8F",darkkhaki:"#BDB76B",mediumvioletred:"#C71585",indianred:"#CD5C5C",peru:"#CD853F",chocolate:"#D2691E",tan:"#D2B48C",lightgray:"#D3D3D3",lightgrey:"#D3D3D3",thistle:"#D8BFD8",orchid:"#DA70D6",goldenrod:"#DAA520",palevioletred:"#DB7093",crimson:"#DC143C",gainsboro:"#DCDCDC",plum:"#DDA0DD",burlywood:"#DEB887",lightcyan:"#E0FFFF",lavender:"#E6E6FA",darksalmon:"#E9967A",violet:"#EE82EE",palegoldenrod:"#EEE8AA",lightcoral:"#F08080",khaki:"#F0E68C",aliceblue:"#F0F8FF",honeydew:"#F0FFF0",azure:"#F0FFFF",sandybrown:"#F4A460",wheat:"#F5DEB3",beige:"#F5F5DC",whitesmoke:"#F5F5F5",mintcream:"#F5FFFA",ghostwhite:"#F8F8FF",salmon:"#FA8072",antiquewhite:"#FAEBD7",linen:"#FAF0E6",lightgoldenrodyellow:"#FAFAD2",oldlace:"#FDF5E6",magenta:"#FF00FF",deeppink:"#FF1493",orangered:"#FF4500",tomato:"#FF6347",hotpink:"#FF69B4",coral:"#FF7F50",darkorange:"#FF8C00",lightsalmon:"#FFA07A",orange:"#FFA500",lightpink:"#FFB6C1",pink:"#FFC0CB",gold:"#FFD700",peachpuff:"#FFDAB9",navajowhite:"#FFDEAD",moccasin:"#FFE4B5",bisque:"#FFE4C4",mistyrose:"#FFE4E1",blanchedalmond:"#FFEBCD",papayawhip:"#FFEFD5",lavenderblush:"#FFF0F5",seashell:"#FFF5EE",cornsilk:"#FFF8DC",lemonchiffon:"#FFFACD",floralwhite:"#FFFAF0",snow:"#FFFAFA",lightyellow:"#FFFFE0",ivory:"#FFFFF0"},ua=new Int8Array(4),ti=new Int32Array(ua.buffer,0,1),_h=new Float32Array(ua.buffer,0,1),xh=/^\s*rgba?\s*\(/,Eh=/^\s*rgba?\s*\(\s*([0-9]*)\s*,\s*([0-9]*)\s*,\s*([0-9]*)(?:\s*,\s*(.*)?)?\)\s*$/;function Ch(e){var t=0,n=0,i=0,r=1;if(e[0]==="#")e.length===4?(t=parseInt(e.charAt(1)+e.charAt(1),16),n=parseInt(e.charAt(2)+e.charAt(2),16),i=parseInt(e.charAt(3)+e.charAt(3),16)):(t=parseInt(e.charAt(1)+e.charAt(2),16),n=parseInt(e.charAt(3)+e.charAt(4),16),i=parseInt(e.charAt(5)+e.charAt(6),16)),e.length===9&&(r=parseInt(e.charAt(7)+e.charAt(8),16)/255);else if(xh.test(e)){var o=e.match(Eh);o&&(t=+o[1],n=+o[2],i=+o[3],o[4]&&(r=+o[4]))}return{r:t,g:n,b:i,a:r}}var xt={};for(var dn in ei)xt[dn]=Nt(ei[dn]),xt[ei[dn]]=xt[dn];function la(e,t,n,i,r){return ti[0]=i<<24|n<<16|t<<8|e,ti[0]=ti[0]&4278190079,_h[0]}function Nt(e){if(e=e.toLowerCase(),typeof xt[e]<"u")return xt[e];var t=Ch(e),n=t.r,i=t.g,r=t.b,o=t.a;o=o*255|0;var a=la(n,i,r,o);return xt[e]=a,a}var ni={};function ca(e){if(typeof ni[e]<"u")return ni[e];var t=(e&16711680)>>>16,n=(e&65280)>>>8,i=e&255,r=255,o=la(t,n,i,r);return ni[e]=o,o}function zr(e,t,n,i){return n+(t<<8)+(e<<16)}function Or(e,t,n,i,r,o){var a=Math.floor(n/o*r),s=Math.floor(e.drawingBufferHeight/o-i/o*r),u=new Uint8Array(4);e.bindFramebuffer(e.FRAMEBUFFER,t),e.readPixels(a,s,1,1,e.RGBA,e.UNSIGNED_BYTE,u);var l=At(u,4),c=l[0],d=l[1],h=l[2],f=l[3];return[c,d,h,f]}function A(e,t,n){return(t=jt(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function Br(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable})),n.push.apply(n,i)}return n}function V(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?Br(Object(n),!0).forEach(function(i){A(e,i,n[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Br(Object(n)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(n,i))})}return e}function kh(e,t){for(;!{}.hasOwnProperty.call(e,t)&&(e=Tt(e))!==null;);return e}function Ci(){return Ci=typeof Reflect<"u"&&Reflect.get?Reflect.get.bind():function(e,t,n){var i=kh(e,t);if(i){var r=Object.getOwnPropertyDescriptor(i,t);return r.get?r.get.call(arguments.length<3?e:n):r.value}},Ci.apply(null,arguments)}function da(e,t,n,i){var r=Ci(Tt(e.prototype),t,n);return typeof r=="function"?function(o){return r.apply(n,o)}:r}function Th(e){return e.normalized?1:e.size}function ii(e){var t=0;return e.forEach(function(n){return t+=Th(n)}),t}function ha(e,t,n){var i=e==="VERTEX"?t.VERTEX_SHADER:t.FRAGMENT_SHADER,r=t.createShader(i);if(r===null)throw new Error("loadShader: error while creating the shader");t.shaderSource(r,n),t.compileShader(r);var o=t.getShaderParameter(r,t.COMPILE_STATUS);if(!o){var a=t.getShaderInfoLog(r);throw t.deleteShader(r),new Error(`loadShader: error while compiling the shader:
`.concat(a,`
`).concat(n))}return r}function Ah(e,t){return ha("VERTEX",e,t)}function Sh(e,t){return ha("FRAGMENT",e,t)}function Lh(e,t){var n=e.createProgram();if(n===null)throw new Error("loadProgram: error while creating the program.");var i,r;for(i=0,r=t.length;i<r;i++)e.attachShader(n,t[i]);e.linkProgram(n);var o=e.getProgramParameter(n,e.LINK_STATUS);if(!o)throw e.deleteProgram(n),new Error("loadProgram: error while linking the program.");return n}function Ur(e){var t=e.gl,n=e.buffer,i=e.program,r=e.vertexShader,o=e.fragmentShader;t.deleteShader(r),t.deleteShader(o),t.deleteProgram(i),t.deleteBuffer(n)}var Hr=`#define PICKING_MODE
`,Rh=A(A(A(A(A(A(A(A({},WebGL2RenderingContext.BOOL,1),WebGL2RenderingContext.BYTE,1),WebGL2RenderingContext.UNSIGNED_BYTE,1),WebGL2RenderingContext.SHORT,2),WebGL2RenderingContext.UNSIGNED_SHORT,2),WebGL2RenderingContext.INT,4),WebGL2RenderingContext.UNSIGNED_INT,4),WebGL2RenderingContext.FLOAT,4),fa=function(){function e(t,n,i){be(this,e),A(this,"array",new Float32Array),A(this,"constantArray",new Float32Array),A(this,"capacity",0),A(this,"verticesCount",0);var r=this.getDefinition();if(this.VERTICES=r.VERTICES,this.VERTEX_SHADER_SOURCE=r.VERTEX_SHADER_SOURCE,this.FRAGMENT_SHADER_SOURCE=r.FRAGMENT_SHADER_SOURCE,this.UNIFORMS=r.UNIFORMS,this.ATTRIBUTES=r.ATTRIBUTES,this.METHOD=r.METHOD,this.CONSTANT_ATTRIBUTES="CONSTANT_ATTRIBUTES"in r?r.CONSTANT_ATTRIBUTES:[],this.CONSTANT_DATA="CONSTANT_DATA"in r?r.CONSTANT_DATA:[],this.isInstanced="CONSTANT_ATTRIBUTES"in r,this.ATTRIBUTES_ITEMS_COUNT=ii(this.ATTRIBUTES),this.STRIDE=this.VERTICES*this.ATTRIBUTES_ITEMS_COUNT,this.renderer=i,this.normalProgram=this.getProgramInfo("normal",t,r.VERTEX_SHADER_SOURCE,r.FRAGMENT_SHADER_SOURCE,null),this.pickProgram=n?this.getProgramInfo("pick",t,Hr+r.VERTEX_SHADER_SOURCE,Hr+r.FRAGMENT_SHADER_SOURCE,n):null,this.isInstanced){var o=ii(this.CONSTANT_ATTRIBUTES);if(this.CONSTANT_DATA.length!==this.VERTICES)throw new Error("Program: error while getting constant data (expected ".concat(this.VERTICES," items, received ").concat(this.CONSTANT_DATA.length," instead)"));this.constantArray=new Float32Array(this.CONSTANT_DATA.length*o);for(var a=0;a<this.CONSTANT_DATA.length;a++){var s=this.CONSTANT_DATA[a];if(s.length!==o)throw new Error("Program: error while getting constant data (one vector has ".concat(s.length," items instead of ").concat(o,")"));for(var u=0;u<s.length;u++)this.constantArray[a*o+u]=s[u]}this.STRIDE=this.ATTRIBUTES_ITEMS_COUNT}}return we(e,[{key:"kill",value:function(){Ur(this.normalProgram),this.pickProgram&&(Ur(this.pickProgram),this.pickProgram=null)}},{key:"getProgramInfo",value:function(n,i,r,o,a){var s=this.getDefinition(),u=i.createBuffer();if(u===null)throw new Error("Program: error while creating the WebGL buffer.");var l=Ah(i,r),c=Sh(i,o),d=Lh(i,[l,c]),h={};s.UNIFORMS.forEach(function(m){var b=i.getUniformLocation(d,m);b&&(h[m]=b)});var f={};s.ATTRIBUTES.forEach(function(m){f[m.name]=i.getAttribLocation(d,m.name)});var g;if("CONSTANT_ATTRIBUTES"in s&&(s.CONSTANT_ATTRIBUTES.forEach(function(m){f[m.name]=i.getAttribLocation(d,m.name)}),g=i.createBuffer(),g===null))throw new Error("Program: error while creating the WebGL constant buffer.");return{name:n,program:d,gl:i,frameBuffer:a,buffer:u,constantBuffer:g||{},uniformLocations:h,attributeLocations:f,isPicking:n==="pick",vertexShader:l,fragmentShader:c}}},{key:"bindProgram",value:function(n){var i=this,r=0,o=n.gl,a=n.buffer;this.isInstanced?(o.bindBuffer(o.ARRAY_BUFFER,n.constantBuffer),r=0,this.CONSTANT_ATTRIBUTES.forEach(function(s){return r+=i.bindAttribute(s,n,r,!1)}),o.bufferData(o.ARRAY_BUFFER,this.constantArray,o.STATIC_DRAW),o.bindBuffer(o.ARRAY_BUFFER,n.buffer),r=0,this.ATTRIBUTES.forEach(function(s){return r+=i.bindAttribute(s,n,r,!0)}),o.bufferData(o.ARRAY_BUFFER,this.array,o.DYNAMIC_DRAW)):(o.bindBuffer(o.ARRAY_BUFFER,a),r=0,this.ATTRIBUTES.forEach(function(s){return r+=i.bindAttribute(s,n,r)}),o.bufferData(o.ARRAY_BUFFER,this.array,o.DYNAMIC_DRAW)),o.bindBuffer(o.ARRAY_BUFFER,null)}},{key:"unbindProgram",value:function(n){var i=this;this.isInstanced?(this.CONSTANT_ATTRIBUTES.forEach(function(r){return i.unbindAttribute(r,n,!1)}),this.ATTRIBUTES.forEach(function(r){return i.unbindAttribute(r,n,!0)})):this.ATTRIBUTES.forEach(function(r){return i.unbindAttribute(r,n)})}},{key:"bindAttribute",value:function(n,i,r,o){var a=Rh[n.type];if(typeof a!="number")throw new Error('Program.bind: yet unsupported attribute type "'.concat(n.type,'"'));var s=i.attributeLocations[n.name],u=i.gl;if(s!==-1){u.enableVertexAttribArray(s);var l=this.isInstanced?(o?this.ATTRIBUTES_ITEMS_COUNT:ii(this.CONSTANT_ATTRIBUTES))*Float32Array.BYTES_PER_ELEMENT:this.ATTRIBUTES_ITEMS_COUNT*Float32Array.BYTES_PER_ELEMENT;if(u.vertexAttribPointer(s,n.size,n.type,n.normalized||!1,l,r),this.isInstanced&&o)if(u instanceof WebGL2RenderingContext)u.vertexAttribDivisor(s,1);else{var c=u.getExtension("ANGLE_instanced_arrays");c&&c.vertexAttribDivisorANGLE(s,1)}}return n.size*a}},{key:"unbindAttribute",value:function(n,i,r){var o=i.attributeLocations[n.name],a=i.gl;if(o!==-1&&(a.disableVertexAttribArray(o),this.isInstanced&&r))if(a instanceof WebGL2RenderingContext)a.vertexAttribDivisor(o,0);else{var s=a.getExtension("ANGLE_instanced_arrays");s&&s.vertexAttribDivisorANGLE(o,0)}}},{key:"reallocate",value:function(n){n!==this.capacity&&(this.capacity=n,this.verticesCount=this.VERTICES*n,this.array=new Float32Array(this.isInstanced?this.capacity*this.ATTRIBUTES_ITEMS_COUNT:this.verticesCount*this.ATTRIBUTES_ITEMS_COUNT))}},{key:"hasNothingToRender",value:function(){return this.verticesCount===0}},{key:"renderProgram",value:function(n,i){var r=i.gl,o=i.program;r.enable(r.BLEND),r.useProgram(o),this.setUniforms(n,i),this.drawWebGL(this.METHOD,i)}},{key:"render",value:function(n){this.hasNothingToRender()||(this.pickProgram&&(this.pickProgram.gl.viewport(0,0,n.width*n.pixelRatio/n.downSizingRatio,n.height*n.pixelRatio/n.downSizingRatio),this.bindProgram(this.pickProgram),this.renderProgram(V(V({},n),{},{pixelRatio:n.pixelRatio/n.downSizingRatio}),this.pickProgram),this.unbindProgram(this.pickProgram)),this.normalProgram.gl.viewport(0,0,n.width*n.pixelRatio,n.height*n.pixelRatio),this.bindProgram(this.normalProgram),this.renderProgram(n,this.normalProgram),this.unbindProgram(this.normalProgram))}},{key:"drawWebGL",value:function(n,i){var r=i.gl,o=i.frameBuffer;if(r.bindFramebuffer(r.FRAMEBUFFER,o),!this.isInstanced)r.drawArrays(n,0,this.verticesCount);else if(r instanceof WebGL2RenderingContext)r.drawArraysInstanced(n,0,this.VERTICES,this.capacity);else{var a=r.getExtension("ANGLE_instanced_arrays");a&&a.drawArraysInstancedANGLE(n,0,this.VERTICES,this.capacity)}}}])}(),Nh=function(e){function t(){return be(this,t),Re(this,t,arguments)}return Ne(t,e),we(t,[{key:"kill",value:function(){da(t,"kill",this)([])}},{key:"process",value:function(i,r,o){var a=r*this.STRIDE;if(o.hidden){for(var s=a+this.STRIDE;a<s;a++)this.array[a]=0;return}return this.processVisibleItem(ca(i),a,o)}}])}(fa),zn=function(e){function t(){var n;be(this,t);for(var i=arguments.length,r=new Array(i),o=0;o<i;o++)r[o]=arguments[o];return n=Re(this,t,[].concat(r)),A(n,"drawLabel",void 0),n}return Ne(t,e),we(t,[{key:"kill",value:function(){da(t,"kill",this)([])}},{key:"process",value:function(i,r,o,a,s){var u=r*this.STRIDE;if(s.hidden||o.hidden||a.hidden){for(var l=u+this.STRIDE;u<l;u++)this.array[u]=0;return}return this.processVisibleItem(ca(i),u,o,a,s)}}])}(fa);function Mh(e,t){return function(){function n(i,r,o){be(this,n),A(this,"drawLabel",t),this.programs=e.map(function(a){return new a(i,r,o)})}return we(n,[{key:"reallocate",value:function(r){this.programs.forEach(function(o){return o.reallocate(r)})}},{key:"process",value:function(r,o,a,s,u){this.programs.forEach(function(l){return l.process(r,o,a,s,u)})}},{key:"render",value:function(r){this.programs.forEach(function(o){return o.render(r)})}},{key:"kill",value:function(){this.programs.forEach(function(r){return r.kill()})}}])}()}function Dh(e,t,n,i,r){var o=r.edgeLabelSize,a=r.edgeLabelFont,s=r.edgeLabelWeight,u=r.edgeLabelColor.attribute?t[r.edgeLabelColor.attribute]||r.edgeLabelColor.color||"#000":r.edgeLabelColor.color,l=t.label;if(l){e.fillStyle=u,e.font="".concat(s," ").concat(o,"px ").concat(a);var c=n.size,d=i.size,h=n.x,f=n.y,g=i.x,m=i.y,b=(h+g)/2,E=(f+m)/2,x=g-h,_=m-f,p=Math.sqrt(x*x+_*_);if(!(p<c+d)){h+=x*c/p,f+=_*c/p,g-=x*d/p,m-=_*d/p,b=(h+g)/2,E=(f+m)/2,x=g-h,_=m-f,p=Math.sqrt(x*x+_*_);var v=e.measureText(l).width;if(v>p){var w="…";for(l=l+w,v=e.measureText(l).width;v>p&&l.length>1;)l=l.slice(0,-2)+w,v=e.measureText(l).width;if(l.length<4)return}var k;x>0?_>0?k=Math.acos(x/p):k=Math.asin(_/p):_>0?k=Math.acos(x/p)+Math.PI:k=Math.asin(x/p)+Math.PI/2,e.save(),e.translate(b,E),e.rotate(k),e.fillText(l,-v/2,t.size/2+o),e.restore()}}}function ga(e,t,n){if(t.label){var i=n.labelSize,r=n.labelFont,o=n.labelWeight,a=n.labelColor.attribute?t[n.labelColor.attribute]||n.labelColor.color||"#000":n.labelColor.color;e.fillStyle=a,e.font="".concat(o," ").concat(i,"px ").concat(r),e.fillText(t.label,t.x+t.size+3,t.y+i/3)}}function $h(e,t,n){var i=n.labelSize,r=n.labelFont,o=n.labelWeight;e.font="".concat(o," ").concat(i,"px ").concat(r),e.fillStyle="#FFF",e.shadowOffsetX=0,e.shadowOffsetY=0,e.shadowBlur=8,e.shadowColor="#000";var a=2;if(typeof t.label=="string"){var s=e.measureText(t.label).width,u=Math.round(s+5),l=Math.round(i+2*a),c=Math.max(t.size,i/2)+a,d=Math.asin(l/2/c),h=Math.sqrt(Math.abs(Math.pow(c,2)-Math.pow(l/2,2)));e.beginPath(),e.moveTo(t.x+h,t.y+l/2),e.lineTo(t.x+c+u,t.y+l/2),e.lineTo(t.x+c+u,t.y-l/2),e.lineTo(t.x+h,t.y-l/2),e.arc(t.x,t.y,c,d,-d),e.closePath(),e.fill()}else e.beginPath(),e.arc(t.x,t.y,t.size+a,0,Math.PI*2),e.closePath(),e.fill();e.shadowOffsetX=0,e.shadowOffsetY=0,e.shadowBlur=0,ga(e,t,n)}var Gh=`
precision highp float;

varying vec4 v_color;
varying vec2 v_diffVector;
varying float v_radius;

uniform float u_correctionRatio;

const vec4 transparent = vec4(0.0, 0.0, 0.0, 0.0);

void main(void) {
  float border = u_correctionRatio * 2.0;
  float dist = length(v_diffVector) - v_radius + border;

  // No antialiasing for picking mode:
  #ifdef PICKING_MODE
  if (dist > border)
    gl_FragColor = transparent;
  else
    gl_FragColor = v_color;

  #else
  float t = 0.0;
  if (dist > border)
    t = 1.0;
  else if (dist > 0.0)
    t = dist / border;

  gl_FragColor = mix(v_color, transparent, t);
  #endif
}
`,Ph=Gh,Ih=`
attribute vec4 a_id;
attribute vec4 a_color;
attribute vec2 a_position;
attribute float a_size;
attribute float a_angle;

uniform mat3 u_matrix;
uniform float u_sizeRatio;
uniform float u_correctionRatio;

varying vec4 v_color;
varying vec2 v_diffVector;
varying float v_radius;
varying float v_border;

const float bias = 255.0 / 254.0;

void main() {
  float size = a_size * u_correctionRatio / u_sizeRatio * 4.0;
  vec2 diffVector = size * vec2(cos(a_angle), sin(a_angle));
  vec2 position = a_position + diffVector;
  gl_Position = vec4(
    (u_matrix * vec3(position, 1)).xy,
    0,
    1
  );

  v_diffVector = diffVector;
  v_radius = size / 2.0;

  #ifdef PICKING_MODE
  // For picking mode, we use the ID as the color:
  v_color = a_id;
  #else
  // For normal mode, we use the color:
  v_color = a_color;
  #endif

  v_color.a *= bias;
}
`,Fh=Ih,pa=WebGLRenderingContext,Wr=pa.UNSIGNED_BYTE,ri=pa.FLOAT,zh=["u_sizeRatio","u_correctionRatio","u_matrix"],On=function(e){function t(){return be(this,t),Re(this,t,arguments)}return Ne(t,e),we(t,[{key:"getDefinition",value:function(){return{VERTICES:3,VERTEX_SHADER_SOURCE:Fh,FRAGMENT_SHADER_SOURCE:Ph,METHOD:WebGLRenderingContext.TRIANGLES,UNIFORMS:zh,ATTRIBUTES:[{name:"a_position",size:2,type:ri},{name:"a_size",size:1,type:ri},{name:"a_color",size:4,type:Wr,normalized:!0},{name:"a_id",size:4,type:Wr,normalized:!0}],CONSTANT_ATTRIBUTES:[{name:"a_angle",size:1,type:ri}],CONSTANT_DATA:[[t.ANGLE_1],[t.ANGLE_2],[t.ANGLE_3]]}}},{key:"processVisibleItem",value:function(i,r,o){var a=this.array,s=Nt(o.color);a[r++]=o.x,a[r++]=o.y,a[r++]=o.size,a[r++]=s,a[r++]=i}},{key:"setUniforms",value:function(i,r){var o=r.gl,a=r.uniformLocations,s=a.u_sizeRatio,u=a.u_correctionRatio,l=a.u_matrix;o.uniform1f(u,i.correctionRatio),o.uniform1f(s,i.sizeRatio),o.uniformMatrix3fv(l,!1,i.matrix)}}])}(Nh);A(On,"ANGLE_1",0);A(On,"ANGLE_2",2*Math.PI/3);A(On,"ANGLE_3",4*Math.PI/3);var Oh=`
precision mediump float;

varying vec4 v_color;

void main(void) {
  gl_FragColor = v_color;
}
`,Bh=Oh,Uh=`
attribute vec2 a_position;
attribute vec2 a_normal;
attribute float a_radius;
attribute vec3 a_barycentric;

#ifdef PICKING_MODE
attribute vec4 a_id;
#else
attribute vec4 a_color;
#endif

uniform mat3 u_matrix;
uniform float u_sizeRatio;
uniform float u_correctionRatio;
uniform float u_minEdgeThickness;
uniform float u_lengthToThicknessRatio;
uniform float u_widenessToThicknessRatio;

varying vec4 v_color;

const float bias = 255.0 / 254.0;

void main() {
  float minThickness = u_minEdgeThickness;

  float normalLength = length(a_normal);
  vec2 unitNormal = a_normal / normalLength;

  // These first computations are taken from edge.vert.glsl and
  // edge.clamped.vert.glsl. Please read it to get better comments on what's
  // happening:
  float pixelsThickness = max(normalLength / u_sizeRatio, minThickness);
  float webGLThickness = pixelsThickness * u_correctionRatio;
  float webGLNodeRadius = a_radius * 2.0 * u_correctionRatio / u_sizeRatio;
  float webGLArrowHeadLength = webGLThickness * u_lengthToThicknessRatio * 2.0;
  float webGLArrowHeadThickness = webGLThickness * u_widenessToThicknessRatio;

  float da = a_barycentric.x;
  float db = a_barycentric.y;
  float dc = a_barycentric.z;

  vec2 delta = vec2(
      da * (webGLNodeRadius * unitNormal.y)
    + db * ((webGLNodeRadius + webGLArrowHeadLength) * unitNormal.y + webGLArrowHeadThickness * unitNormal.x)
    + dc * ((webGLNodeRadius + webGLArrowHeadLength) * unitNormal.y - webGLArrowHeadThickness * unitNormal.x),

      da * (-webGLNodeRadius * unitNormal.x)
    + db * (-(webGLNodeRadius + webGLArrowHeadLength) * unitNormal.x + webGLArrowHeadThickness * unitNormal.y)
    + dc * (-(webGLNodeRadius + webGLArrowHeadLength) * unitNormal.x - webGLArrowHeadThickness * unitNormal.y)
  );

  vec2 position = (u_matrix * vec3(a_position + delta, 1)).xy;

  gl_Position = vec4(position, 0, 1);

  #ifdef PICKING_MODE
  // For picking mode, we use the ID as the color:
  v_color = a_id;
  #else
  // For normal mode, we use the color:
  v_color = a_color;
  #endif

  v_color.a *= bias;
}
`,Hh=Uh,ma=WebGLRenderingContext,qr=ma.UNSIGNED_BYTE,hn=ma.FLOAT,Wh=["u_matrix","u_sizeRatio","u_correctionRatio","u_minEdgeThickness","u_lengthToThicknessRatio","u_widenessToThicknessRatio"],Bn={extremity:"target",lengthToThicknessRatio:2.5,widenessToThicknessRatio:2};function va(e){var t=V(V({},Bn),{});return function(n){function i(){return be(this,i),Re(this,i,arguments)}return Ne(i,n),we(i,[{key:"getDefinition",value:function(){return{VERTICES:3,VERTEX_SHADER_SOURCE:Hh,FRAGMENT_SHADER_SOURCE:Bh,METHOD:WebGLRenderingContext.TRIANGLES,UNIFORMS:Wh,ATTRIBUTES:[{name:"a_position",size:2,type:hn},{name:"a_normal",size:2,type:hn},{name:"a_radius",size:1,type:hn},{name:"a_color",size:4,type:qr,normalized:!0},{name:"a_id",size:4,type:qr,normalized:!0}],CONSTANT_ATTRIBUTES:[{name:"a_barycentric",size:3,type:hn}],CONSTANT_DATA:[[1,0,0],[0,1,0],[0,0,1]]}}},{key:"processVisibleItem",value:function(o,a,s,u,l){if(t.extremity==="source"){var c=[u,s];s=c[0],u=c[1]}var d=l.size||1,h=u.size||1,f=s.x,g=s.y,m=u.x,b=u.y,E=Nt(l.color),x=m-f,_=b-g,p=x*x+_*_,v=0,w=0;p&&(p=1/Math.sqrt(p),v=-_*p*d,w=x*p*d);var k=this.array;k[a++]=m,k[a++]=b,k[a++]=-v,k[a++]=-w,k[a++]=h,k[a++]=E,k[a++]=o}},{key:"setUniforms",value:function(o,a){var s=a.gl,u=a.uniformLocations,l=u.u_matrix,c=u.u_sizeRatio,d=u.u_correctionRatio,h=u.u_minEdgeThickness,f=u.u_lengthToThicknessRatio,g=u.u_widenessToThicknessRatio;s.uniformMatrix3fv(l,!1,o.matrix),s.uniform1f(c,o.sizeRatio),s.uniform1f(d,o.correctionRatio),s.uniform1f(h,o.minEdgeThickness),s.uniform1f(f,t.lengthToThicknessRatio),s.uniform1f(g,t.widenessToThicknessRatio)}}])}(zn)}va();var qh=`
precision mediump float;

varying vec4 v_color;
varying vec2 v_normal;
varying float v_thickness;
varying float v_feather;

const vec4 transparent = vec4(0.0, 0.0, 0.0, 0.0);

void main(void) {
  // We only handle antialiasing for normal mode:
  #ifdef PICKING_MODE
  gl_FragColor = v_color;
  #else
  float dist = length(v_normal) * v_thickness;

  float t = smoothstep(
    v_thickness - v_feather,
    v_thickness,
    dist
  );

  gl_FragColor = mix(v_color, transparent, t);
  #endif
}
`,ya=qh,Vh=`
attribute vec4 a_id;
attribute vec4 a_color;
attribute vec2 a_normal;
attribute float a_normalCoef;
attribute vec2 a_positionStart;
attribute vec2 a_positionEnd;
attribute float a_positionCoef;
attribute float a_radius;
attribute float a_radiusCoef;

uniform mat3 u_matrix;
uniform float u_zoomRatio;
uniform float u_sizeRatio;
uniform float u_pixelRatio;
uniform float u_correctionRatio;
uniform float u_minEdgeThickness;
uniform float u_lengthToThicknessRatio;
uniform float u_feather;

varying vec4 v_color;
varying vec2 v_normal;
varying float v_thickness;
varying float v_feather;

const float bias = 255.0 / 254.0;

void main() {
  float minThickness = u_minEdgeThickness;

  float radius = a_radius * a_radiusCoef;
  vec2 normal = a_normal * a_normalCoef;
  vec2 position = a_positionStart * (1.0 - a_positionCoef) + a_positionEnd * a_positionCoef;

  float normalLength = length(normal);
  vec2 unitNormal = normal / normalLength;

  // These first computations are taken from edge.vert.glsl. Please read it to
  // get better comments on what's happening:
  float pixelsThickness = max(normalLength, minThickness * u_sizeRatio);
  float webGLThickness = pixelsThickness * u_correctionRatio / u_sizeRatio;

  // Here, we move the point to leave space for the arrow head:
  float direction = sign(radius);
  float webGLNodeRadius = direction * radius * 2.0 * u_correctionRatio / u_sizeRatio;
  float webGLArrowHeadLength = webGLThickness * u_lengthToThicknessRatio * 2.0;

  vec2 compensationVector = vec2(-direction * unitNormal.y, direction * unitNormal.x) * (webGLNodeRadius + webGLArrowHeadLength);

  // Here is the proper position of the vertex
  gl_Position = vec4((u_matrix * vec3(position + unitNormal * webGLThickness + compensationVector, 1)).xy, 0, 1);

  v_thickness = webGLThickness / u_zoomRatio;

  v_normal = unitNormal;

  v_feather = u_feather * u_correctionRatio / u_zoomRatio / u_pixelRatio * 2.0;

  #ifdef PICKING_MODE
  // For picking mode, we use the ID as the color:
  v_color = a_id;
  #else
  // For normal mode, we use the color:
  v_color = a_color;
  #endif

  v_color.a *= bias;
}
`,jh=Vh,ba=WebGLRenderingContext,Vr=ba.UNSIGNED_BYTE,dt=ba.FLOAT,Yh=["u_matrix","u_zoomRatio","u_sizeRatio","u_correctionRatio","u_pixelRatio","u_feather","u_minEdgeThickness","u_lengthToThicknessRatio"],Xh={lengthToThicknessRatio:Bn.lengthToThicknessRatio};function wa(e){var t=V(V({},Xh),{});return function(n){function i(){return be(this,i),Re(this,i,arguments)}return Ne(i,n),we(i,[{key:"getDefinition",value:function(){return{VERTICES:6,VERTEX_SHADER_SOURCE:jh,FRAGMENT_SHADER_SOURCE:ya,METHOD:WebGLRenderingContext.TRIANGLES,UNIFORMS:Yh,ATTRIBUTES:[{name:"a_positionStart",size:2,type:dt},{name:"a_positionEnd",size:2,type:dt},{name:"a_normal",size:2,type:dt},{name:"a_color",size:4,type:Vr,normalized:!0},{name:"a_id",size:4,type:Vr,normalized:!0},{name:"a_radius",size:1,type:dt}],CONSTANT_ATTRIBUTES:[{name:"a_positionCoef",size:1,type:dt},{name:"a_normalCoef",size:1,type:dt},{name:"a_radiusCoef",size:1,type:dt}],CONSTANT_DATA:[[0,1,0],[0,-1,0],[1,1,1],[1,1,1],[0,-1,0],[1,-1,-1]]}}},{key:"processVisibleItem",value:function(o,a,s,u,l){var c=l.size||1,d=s.x,h=s.y,f=u.x,g=u.y,m=Nt(l.color),b=f-d,E=g-h,x=u.size||1,_=b*b+E*E,p=0,v=0;_&&(_=1/Math.sqrt(_),p=-E*_*c,v=b*_*c);var w=this.array;w[a++]=d,w[a++]=h,w[a++]=f,w[a++]=g,w[a++]=p,w[a++]=v,w[a++]=m,w[a++]=o,w[a++]=x}},{key:"setUniforms",value:function(o,a){var s=a.gl,u=a.uniformLocations,l=u.u_matrix,c=u.u_zoomRatio,d=u.u_feather,h=u.u_pixelRatio,f=u.u_correctionRatio,g=u.u_sizeRatio,m=u.u_minEdgeThickness,b=u.u_lengthToThicknessRatio;s.uniformMatrix3fv(l,!1,o.matrix),s.uniform1f(c,o.zoomRatio),s.uniform1f(g,o.sizeRatio),s.uniform1f(f,o.correctionRatio),s.uniform1f(h,o.pixelRatio),s.uniform1f(d,o.antiAliasingFeather),s.uniform1f(m,o.minEdgeThickness),s.uniform1f(b,t.lengthToThicknessRatio)}}])}(zn)}wa();function Kh(e){return Mh([wa(),va()])}var Zh=Kh(),Jh=Zh,Qh=`
attribute vec4 a_id;
attribute vec4 a_color;
attribute vec2 a_normal;
attribute float a_normalCoef;
attribute vec2 a_positionStart;
attribute vec2 a_positionEnd;
attribute float a_positionCoef;

uniform mat3 u_matrix;
uniform float u_sizeRatio;
uniform float u_zoomRatio;
uniform float u_pixelRatio;
uniform float u_correctionRatio;
uniform float u_minEdgeThickness;
uniform float u_feather;

varying vec4 v_color;
varying vec2 v_normal;
varying float v_thickness;
varying float v_feather;

const float bias = 255.0 / 254.0;

void main() {
  float minThickness = u_minEdgeThickness;

  vec2 normal = a_normal * a_normalCoef;
  vec2 position = a_positionStart * (1.0 - a_positionCoef) + a_positionEnd * a_positionCoef;

  float normalLength = length(normal);
  vec2 unitNormal = normal / normalLength;

  // We require edges to be at least "minThickness" pixels thick *on screen*
  // (so we need to compensate the size ratio):
  float pixelsThickness = max(normalLength, minThickness * u_sizeRatio);

  // Then, we need to retrieve the normalized thickness of the edge in the WebGL
  // referential (in a ([0, 1], [0, 1]) space), using our "magic" correction
  // ratio:
  float webGLThickness = pixelsThickness * u_correctionRatio / u_sizeRatio;

  // Here is the proper position of the vertex
  gl_Position = vec4((u_matrix * vec3(position + unitNormal * webGLThickness, 1)).xy, 0, 1);

  // For the fragment shader though, we need a thickness that takes the "magic"
  // correction ratio into account (as in webGLThickness), but so that the
  // antialiasing effect does not depend on the zoom level. So here's yet
  // another thickness version:
  v_thickness = webGLThickness / u_zoomRatio;

  v_normal = unitNormal;

  v_feather = u_feather * u_correctionRatio / u_zoomRatio / u_pixelRatio * 2.0;

  #ifdef PICKING_MODE
  // For picking mode, we use the ID as the color:
  v_color = a_id;
  #else
  // For normal mode, we use the color:
  v_color = a_color;
  #endif

  v_color.a *= bias;
}
`,ef=Qh,_a=WebGLRenderingContext,jr=_a.UNSIGNED_BYTE,It=_a.FLOAT,tf=["u_matrix","u_zoomRatio","u_sizeRatio","u_correctionRatio","u_pixelRatio","u_feather","u_minEdgeThickness"],nf=function(e){function t(){return be(this,t),Re(this,t,arguments)}return Ne(t,e),we(t,[{key:"getDefinition",value:function(){return{VERTICES:6,VERTEX_SHADER_SOURCE:ef,FRAGMENT_SHADER_SOURCE:ya,METHOD:WebGLRenderingContext.TRIANGLES,UNIFORMS:tf,ATTRIBUTES:[{name:"a_positionStart",size:2,type:It},{name:"a_positionEnd",size:2,type:It},{name:"a_normal",size:2,type:It},{name:"a_color",size:4,type:jr,normalized:!0},{name:"a_id",size:4,type:jr,normalized:!0}],CONSTANT_ATTRIBUTES:[{name:"a_positionCoef",size:1,type:It},{name:"a_normalCoef",size:1,type:It}],CONSTANT_DATA:[[0,1],[0,-1],[1,1],[1,1],[0,-1],[1,-1]]}}},{key:"processVisibleItem",value:function(i,r,o,a,s){var u=s.size||1,l=o.x,c=o.y,d=a.x,h=a.y,f=Nt(s.color),g=d-l,m=h-c,b=g*g+m*m,E=0,x=0;b&&(b=1/Math.sqrt(b),E=-m*b*u,x=g*b*u);var _=this.array;_[r++]=l,_[r++]=c,_[r++]=d,_[r++]=h,_[r++]=E,_[r++]=x,_[r++]=f,_[r++]=i}},{key:"setUniforms",value:function(i,r){var o=r.gl,a=r.uniformLocations,s=a.u_matrix,u=a.u_zoomRatio,l=a.u_feather,c=a.u_pixelRatio,d=a.u_correctionRatio,h=a.u_sizeRatio,f=a.u_minEdgeThickness;o.uniformMatrix3fv(s,!1,i.matrix),o.uniform1f(u,i.zoomRatio),o.uniform1f(h,i.sizeRatio),o.uniform1f(d,i.correctionRatio),o.uniform1f(c,i.pixelRatio),o.uniform1f(l,i.antiAliasingFeather),o.uniform1f(f,i.minEdgeThickness)}}])}(zn),Vi=function(e){function t(){var n;return be(this,t),n=Re(this,t),n.rawEmitter=n,n}return Ne(t,e),we(t)}(qo.EventEmitter),oi,Yr;function rf(){return Yr||(Yr=1,oi=function(t){return t!==null&&typeof t=="object"&&typeof t.addUndirectedEdgeWithKey=="function"&&typeof t.dropNode=="function"&&typeof t.multi=="boolean"}),oi}var of=rf();const af=ud(of);var sf=function(t){return t},uf=function(t){return t*t},lf=function(t){return t*(2-t)},cf=function(t){return(t*=2)<1?.5*t*t:-.5*(--t*(t-2)-1)},df=function(t){return t*t*t},hf=function(t){return--t*t*t+1},ff=function(t){return(t*=2)<1?.5*t*t*t:.5*((t-=2)*t*t+2)},gf={linear:sf,quadraticIn:uf,quadraticOut:lf,quadraticInOut:cf,cubicIn:df,cubicOut:hf,cubicInOut:ff},pf={easing:"quadraticInOut",duration:150};function Pe(){return Float32Array.of(1,0,0,0,1,0,0,0,1)}function fn(e,t,n){return e[0]=t,e[4]=typeof n=="number"?n:t,e}function Xr(e,t){var n=Math.sin(t),i=Math.cos(t);return e[0]=i,e[1]=n,e[3]=-n,e[4]=i,e}function Kr(e,t,n){return e[6]=t,e[7]=n,e}function ot(e,t){var n=e[0],i=e[1],r=e[2],o=e[3],a=e[4],s=e[5],u=e[6],l=e[7],c=e[8],d=t[0],h=t[1],f=t[2],g=t[3],m=t[4],b=t[5],E=t[6],x=t[7],_=t[8];return e[0]=d*n+h*o+f*u,e[1]=d*i+h*a+f*l,e[2]=d*r+h*s+f*c,e[3]=g*n+m*o+b*u,e[4]=g*i+m*a+b*l,e[5]=g*r+m*s+b*c,e[6]=E*n+x*o+_*u,e[7]=E*i+x*a+_*l,e[8]=E*r+x*s+_*c,e}function ki(e,t){var n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:1,i=e[0],r=e[1],o=e[3],a=e[4],s=e[6],u=e[7],l=t.x,c=t.y;return{x:l*i+c*o+s*n,y:l*r+c*a+u*n}}function mf(e,t){var n=e.height/e.width,i=t.height/t.width;return n<1&&i>1||n>1&&i<1?1:Math.min(Math.max(i,1/i),Math.max(1/n,n))}function Ft(e,t,n,i,r){var o=e.angle,a=e.ratio,s=e.x,u=e.y,l=t.width,c=t.height,d=Pe(),h=Math.min(l,c)-2*i,f=mf(t,n);return r?(ot(d,Kr(Pe(),s,u)),ot(d,fn(Pe(),a)),ot(d,Xr(Pe(),o)),ot(d,fn(Pe(),l/h/2/f,c/h/2/f))):(ot(d,fn(Pe(),2*(h/l)*f,2*(h/c)*f)),ot(d,Xr(Pe(),-o)),ot(d,fn(Pe(),1/a)),ot(d,Kr(Pe(),-s,-u))),d}function vf(e,t,n){var i=ki(e,{x:Math.cos(t.angle),y:Math.sin(t.angle)},0),r=i.x,o=i.y;return 1/Math.sqrt(Math.pow(r,2)+Math.pow(o,2))/n.width}function yf(e){if(!e.order)return{x:[0,1],y:[0,1]};var t=1/0,n=-1/0,i=1/0,r=-1/0;return e.forEachNode(function(o,a){var s=a.x,u=a.y;s<t&&(t=s),s>n&&(n=s),u<i&&(i=u),u>r&&(r=u)}),{x:[t,n],y:[i,r]}}function bf(e){if(!af(e))throw new Error("Sigma: invalid graph instance.");e.forEachNode(function(t,n){if(!Number.isFinite(n.x)||!Number.isFinite(n.y))throw new Error("Sigma: Coordinates of node ".concat(t," are invalid. A node must have a numeric 'x' and 'y' attribute."))})}function wf(e,t,n){var i=document.createElement(e);if(t)for(var r in t)i.style[r]=t[r];if(n)for(var o in n)i.setAttribute(o,n[o]);return i}function Zr(){return typeof window.devicePixelRatio<"u"?window.devicePixelRatio:1}function Jr(e,t,n){return n.sort(function(i,r){var o=t(i)||0,a=t(r)||0;return o<a?-1:o>a?1:0})}function Qr(e){var t=At(e.x,2),n=t[0],i=t[1],r=At(e.y,2),o=r[0],a=r[1],s=Math.max(i-n,a-o),u=(i+n)/2,l=(a+o)/2;(s===0||Math.abs(s)===1/0||isNaN(s))&&(s=1),isNaN(u)&&(u=0),isNaN(l)&&(l=0);var c=function(h){return{x:.5+(h.x-u)/s,y:.5+(h.y-l)/s}};return c.applyTo=function(d){d.x=.5+(d.x-u)/s,d.y=.5+(d.y-l)/s},c.inverse=function(d){return{x:u+s*(d.x-.5),y:l+s*(d.y-.5)}},c.ratio=s,c}function Ti(e){"@babel/helpers - typeof";return Ti=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Ti(e)}function eo(e,t){var n=t.size;if(n!==0){var i=e.length;e.length+=n;var r=0;t.forEach(function(o){e[i+r]=o,r++})}}function ai(e){e=e||{};for(var t=0,n=arguments.length<=1?0:arguments.length-1;t<n;t++){var i=t+1<1||arguments.length<=t+1?void 0:arguments[t+1];i&&Object.assign(e,i)}return e}var ji={hideEdgesOnMove:!1,hideLabelsOnMove:!1,renderLabels:!0,renderEdgeLabels:!1,enableEdgeEvents:!1,defaultNodeColor:"#999",defaultNodeType:"circle",defaultEdgeColor:"#ccc",defaultEdgeType:"line",labelFont:"Arial",labelSize:14,labelWeight:"normal",labelColor:{color:"#000"},edgeLabelFont:"Arial",edgeLabelSize:14,edgeLabelWeight:"normal",edgeLabelColor:{attribute:"color"},stagePadding:30,defaultDrawEdgeLabel:Dh,defaultDrawNodeLabel:ga,defaultDrawNodeHover:$h,minEdgeThickness:1.7,antiAliasingFeather:1,dragTimeout:100,draggedEventsTolerance:3,inertiaDuration:200,inertiaRatio:3,zoomDuration:250,zoomingRatio:1.7,doubleClickTimeout:300,doubleClickZoomingRatio:2.2,doubleClickZoomingDuration:200,tapMoveTolerance:10,zoomToSizeRatioFunction:Math.sqrt,itemSizesReference:"screen",autoRescale:!0,autoCenter:!0,labelDensity:1,labelGridCellSize:100,labelRenderedSizeThreshold:6,nodeReducer:null,edgeReducer:null,zIndex:!1,minCameraRatio:null,maxCameraRatio:null,enableCameraZooming:!0,enableCameraPanning:!0,enableCameraRotation:!0,cameraPanBoundaries:null,allowInvalidContainer:!1,nodeProgramClasses:{},nodeHoverProgramClasses:{},edgeProgramClasses:{}},_f={circle:On},xf={arrow:Jh,line:nf};function si(e){if(typeof e.labelDensity!="number"||e.labelDensity<0)throw new Error("Settings: invalid `labelDensity`. Expecting a positive number.");var t=e.minCameraRatio,n=e.maxCameraRatio;if(typeof t=="number"&&typeof n=="number"&&n<t)throw new Error("Settings: invalid camera ratio boundaries. Expecting `maxCameraRatio` to be greater than `minCameraRatio`.")}function Ef(e){var t=ai({},ji,e);return t.nodeProgramClasses=ai({},_f,t.nodeProgramClasses),t.edgeProgramClasses=ai({},xf,t.edgeProgramClasses),t}var gn=1.5,to=function(e){function t(){var n;return be(this,t),n=Re(this,t),A(n,"x",.5),A(n,"y",.5),A(n,"angle",0),A(n,"ratio",1),A(n,"minRatio",null),A(n,"maxRatio",null),A(n,"enabledZooming",!0),A(n,"enabledPanning",!0),A(n,"enabledRotation",!0),A(n,"clean",null),A(n,"nextFrame",null),A(n,"previousState",null),A(n,"enabled",!0),n.previousState=n.getState(),n}return Ne(t,e),we(t,[{key:"enable",value:function(){return this.enabled=!0,this}},{key:"disable",value:function(){return this.enabled=!1,this}},{key:"getState",value:function(){return{x:this.x,y:this.y,angle:this.angle,ratio:this.ratio}}},{key:"hasState",value:function(i){return this.x===i.x&&this.y===i.y&&this.ratio===i.ratio&&this.angle===i.angle}},{key:"getPreviousState",value:function(){var i=this.previousState;return i?{x:i.x,y:i.y,angle:i.angle,ratio:i.ratio}:null}},{key:"getBoundedRatio",value:function(i){var r=i;return typeof this.minRatio=="number"&&(r=Math.max(r,this.minRatio)),typeof this.maxRatio=="number"&&(r=Math.min(r,this.maxRatio)),r}},{key:"validateState",value:function(i){var r={};return this.enabledPanning&&typeof i.x=="number"&&(r.x=i.x),this.enabledPanning&&typeof i.y=="number"&&(r.y=i.y),this.enabledZooming&&typeof i.ratio=="number"&&(r.ratio=this.getBoundedRatio(i.ratio)),this.enabledRotation&&typeof i.angle=="number"&&(r.angle=i.angle),this.clean?this.clean(V(V({},this.getState()),r)):r}},{key:"isAnimated",value:function(){return!!this.nextFrame}},{key:"setState",value:function(i){if(!this.enabled)return this;this.previousState=this.getState();var r=this.validateState(i);return typeof r.x=="number"&&(this.x=r.x),typeof r.y=="number"&&(this.y=r.y),typeof r.ratio=="number"&&(this.ratio=r.ratio),typeof r.angle=="number"&&(this.angle=r.angle),this.hasState(this.previousState)||this.emit("updated",this.getState()),this}},{key:"updateState",value:function(i){return this.setState(i(this.getState())),this}},{key:"animate",value:function(i){var r=this,o=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},a=arguments.length>2?arguments[2]:void 0;if(!a)return new Promise(function(f){return r.animate(i,o,f)});if(this.enabled){var s=V(V({},pf),o),u=this.validateState(i),l=typeof s.easing=="function"?s.easing:gf[s.easing],c=Date.now(),d=this.getState(),h=function(){var g=(Date.now()-c)/s.duration;if(g>=1){r.nextFrame=null,r.setState(u),r.animationCallback&&(r.animationCallback.call(null),r.animationCallback=void 0);return}var m=l(g),b={};typeof u.x=="number"&&(b.x=d.x+(u.x-d.x)*m),typeof u.y=="number"&&(b.y=d.y+(u.y-d.y)*m),r.enabledRotation&&typeof u.angle=="number"&&(b.angle=d.angle+(u.angle-d.angle)*m),typeof u.ratio=="number"&&(b.ratio=d.ratio+(u.ratio-d.ratio)*m),r.setState(b),r.nextFrame=requestAnimationFrame(h)};this.nextFrame?(cancelAnimationFrame(this.nextFrame),this.animationCallback&&this.animationCallback.call(null),this.nextFrame=requestAnimationFrame(h)):h(),this.animationCallback=a}}},{key:"animatedZoom",value:function(i){return i?typeof i=="number"?this.animate({ratio:this.ratio/i}):this.animate({ratio:this.ratio/(i.factor||gn)},i):this.animate({ratio:this.ratio/gn})}},{key:"animatedUnzoom",value:function(i){return i?typeof i=="number"?this.animate({ratio:this.ratio*i}):this.animate({ratio:this.ratio*(i.factor||gn)},i):this.animate({ratio:this.ratio*gn})}},{key:"animatedReset",value:function(i){return this.animate({x:.5,y:.5,ratio:1,angle:0},i)}},{key:"copy",value:function(){return t.from(this.getState())}}],[{key:"from",value:function(i){var r=new t;return r.setState(i)}}])}(Vi);function ze(e,t){var n=t.getBoundingClientRect();return{x:e.clientX-n.left,y:e.clientY-n.top}}function Xe(e,t){var n=V(V({},ze(e,t)),{},{sigmaDefaultPrevented:!1,preventSigmaDefault:function(){n.sigmaDefaultPrevented=!0},original:e});return n}function zt(e){var t="x"in e?e:V(V({},e.touches[0]||e.previousTouches[0]),{},{original:e.original,sigmaDefaultPrevented:e.sigmaDefaultPrevented,preventSigmaDefault:function(){e.sigmaDefaultPrevented=!0,t.sigmaDefaultPrevented=!0}});return t}function Cf(e,t){return V(V({},Xe(e,t)),{},{delta:xa(e)})}var kf=2;function wn(e){for(var t=[],n=0,i=Math.min(e.length,kf);n<i;n++)t.push(e[n]);return t}function Ot(e,t,n){var i={touches:wn(e.touches).map(function(r){return ze(r,n)}),previousTouches:t.map(function(r){return ze(r,n)}),sigmaDefaultPrevented:!1,preventSigmaDefault:function(){i.sigmaDefaultPrevented=!0},original:e};return i}function xa(e){if(typeof e.deltaY<"u")return e.deltaY*-3/360;if(typeof e.detail<"u")return e.detail/-9;throw new Error("Captor: could not extract delta from event.")}var Ea=function(e){function t(n,i){var r;return be(this,t),r=Re(this,t),r.container=n,r.renderer=i,r}return Ne(t,e),we(t)}(Vi),Tf=["doubleClickTimeout","doubleClickZoomingDuration","doubleClickZoomingRatio","dragTimeout","draggedEventsTolerance","inertiaDuration","inertiaRatio","zoomDuration","zoomingRatio"],Af=Tf.reduce(function(e,t){return V(V({},e),{},A({},t,ji[t]))},{}),Sf=function(e){function t(n,i){var r;return be(this,t),r=Re(this,t,[n,i]),A(r,"enabled",!0),A(r,"draggedEvents",0),A(r,"downStartTime",null),A(r,"lastMouseX",null),A(r,"lastMouseY",null),A(r,"isMouseDown",!1),A(r,"isMoving",!1),A(r,"movingTimeout",null),A(r,"startCameraState",null),A(r,"clicks",0),A(r,"doubleClickTimeout",null),A(r,"currentWheelDirection",0),A(r,"settings",Af),r.handleClick=r.handleClick.bind(r),r.handleRightClick=r.handleRightClick.bind(r),r.handleDown=r.handleDown.bind(r),r.handleUp=r.handleUp.bind(r),r.handleMove=r.handleMove.bind(r),r.handleWheel=r.handleWheel.bind(r),r.handleLeave=r.handleLeave.bind(r),r.handleEnter=r.handleEnter.bind(r),n.addEventListener("click",r.handleClick,{capture:!1}),n.addEventListener("contextmenu",r.handleRightClick,{capture:!1}),n.addEventListener("mousedown",r.handleDown,{capture:!1}),n.addEventListener("wheel",r.handleWheel,{capture:!1}),n.addEventListener("mouseleave",r.handleLeave,{capture:!1}),n.addEventListener("mouseenter",r.handleEnter,{capture:!1}),document.addEventListener("mousemove",r.handleMove,{capture:!1}),document.addEventListener("mouseup",r.handleUp,{capture:!1}),r}return Ne(t,e),we(t,[{key:"kill",value:function(){var i=this.container;i.removeEventListener("click",this.handleClick),i.removeEventListener("contextmenu",this.handleRightClick),i.removeEventListener("mousedown",this.handleDown),i.removeEventListener("wheel",this.handleWheel),i.removeEventListener("mouseleave",this.handleLeave),i.removeEventListener("mouseenter",this.handleEnter),document.removeEventListener("mousemove",this.handleMove),document.removeEventListener("mouseup",this.handleUp)}},{key:"handleClick",value:function(i){var r=this;if(this.enabled){if(this.clicks++,this.clicks===2)return this.clicks=0,typeof this.doubleClickTimeout=="number"&&(clearTimeout(this.doubleClickTimeout),this.doubleClickTimeout=null),this.handleDoubleClick(i);setTimeout(function(){r.clicks=0,r.doubleClickTimeout=null},this.settings.doubleClickTimeout),this.draggedEvents<this.settings.draggedEventsTolerance&&this.emit("click",Xe(i,this.container))}}},{key:"handleRightClick",value:function(i){this.enabled&&this.emit("rightClick",Xe(i,this.container))}},{key:"handleDoubleClick",value:function(i){if(this.enabled){i.preventDefault(),i.stopPropagation();var r=Xe(i,this.container);if(this.emit("doubleClick",r),!r.sigmaDefaultPrevented){var o=this.renderer.getCamera(),a=o.getBoundedRatio(o.getState().ratio/this.settings.doubleClickZoomingRatio);o.animate(this.renderer.getViewportZoomedState(ze(i,this.container),a),{easing:"quadraticInOut",duration:this.settings.doubleClickZoomingDuration})}}}},{key:"handleDown",value:function(i){if(this.enabled){if(i.button===0){this.startCameraState=this.renderer.getCamera().getState();var r=ze(i,this.container),o=r.x,a=r.y;this.lastMouseX=o,this.lastMouseY=a,this.draggedEvents=0,this.downStartTime=Date.now(),this.isMouseDown=!0}this.emit("mousedown",Xe(i,this.container))}}},{key:"handleUp",value:function(i){var r=this;if(!(!this.enabled||!this.isMouseDown)){var o=this.renderer.getCamera();this.isMouseDown=!1,typeof this.movingTimeout=="number"&&(clearTimeout(this.movingTimeout),this.movingTimeout=null);var a=ze(i,this.container),s=a.x,u=a.y,l=o.getState(),c=o.getPreviousState()||{x:0,y:0};this.isMoving?o.animate({x:l.x+this.settings.inertiaRatio*(l.x-c.x),y:l.y+this.settings.inertiaRatio*(l.y-c.y)},{duration:this.settings.inertiaDuration,easing:"quadraticOut"}):(this.lastMouseX!==s||this.lastMouseY!==u)&&o.setState({x:l.x,y:l.y}),this.isMoving=!1,setTimeout(function(){var d=r.draggedEvents>0;r.draggedEvents=0,d&&r.renderer.getSetting("hideEdgesOnMove")&&r.renderer.refresh()},0),this.emit("mouseup",Xe(i,this.container))}}},{key:"handleMove",value:function(i){var r=this;if(this.enabled){var o=Xe(i,this.container);if(this.emit("mousemovebody",o),(i.target===this.container||i.composedPath()[0]===this.container)&&this.emit("mousemove",o),!o.sigmaDefaultPrevented&&this.isMouseDown){this.isMoving=!0,this.draggedEvents++,typeof this.movingTimeout=="number"&&clearTimeout(this.movingTimeout),this.movingTimeout=window.setTimeout(function(){r.movingTimeout=null,r.isMoving=!1},this.settings.dragTimeout);var a=this.renderer.getCamera(),s=ze(i,this.container),u=s.x,l=s.y,c=this.renderer.viewportToFramedGraph({x:this.lastMouseX,y:this.lastMouseY}),d=this.renderer.viewportToFramedGraph({x:u,y:l}),h=c.x-d.x,f=c.y-d.y,g=a.getState(),m=g.x+h,b=g.y+f;a.setState({x:m,y:b}),this.lastMouseX=u,this.lastMouseY=l,i.preventDefault(),i.stopPropagation()}}}},{key:"handleLeave",value:function(i){this.emit("mouseleave",Xe(i,this.container))}},{key:"handleEnter",value:function(i){this.emit("mouseenter",Xe(i,this.container))}},{key:"handleWheel",value:function(i){var r=this,o=this.renderer.getCamera();if(!(!this.enabled||!o.enabledZooming)){var a=xa(i);if(a){var s=Cf(i,this.container);if(this.emit("wheel",s),s.sigmaDefaultPrevented){i.preventDefault(),i.stopPropagation();return}var u=o.getState().ratio,l=a>0?1/this.settings.zoomingRatio:this.settings.zoomingRatio,c=o.getBoundedRatio(u*l),d=a>0?1:-1,h=Date.now();u!==c&&(i.preventDefault(),i.stopPropagation(),!(this.currentWheelDirection===d&&this.lastWheelTriggerTime&&h-this.lastWheelTriggerTime<this.settings.zoomDuration/5)&&(o.animate(this.renderer.getViewportZoomedState(ze(i,this.container),c),{easing:"quadraticOut",duration:this.settings.zoomDuration},function(){r.currentWheelDirection=0}),this.currentWheelDirection=d,this.lastWheelTriggerTime=h))}}}},{key:"setSettings",value:function(i){this.settings=i}}])}(Ea),Lf=["dragTimeout","inertiaDuration","inertiaRatio","doubleClickTimeout","doubleClickZoomingRatio","doubleClickZoomingDuration","tapMoveTolerance"],Rf=Lf.reduce(function(e,t){return V(V({},e),{},A({},t,ji[t]))},{}),Nf=function(e){function t(n,i){var r;return be(this,t),r=Re(this,t,[n,i]),A(r,"enabled",!0),A(r,"isMoving",!1),A(r,"hasMoved",!1),A(r,"touchMode",0),A(r,"startTouchesPositions",[]),A(r,"lastTouches",[]),A(r,"lastTap",null),A(r,"settings",Rf),r.handleStart=r.handleStart.bind(r),r.handleLeave=r.handleLeave.bind(r),r.handleMove=r.handleMove.bind(r),n.addEventListener("touchstart",r.handleStart,{capture:!1}),n.addEventListener("touchcancel",r.handleLeave,{capture:!1}),document.addEventListener("touchend",r.handleLeave,{capture:!1,passive:!1}),document.addEventListener("touchmove",r.handleMove,{capture:!1,passive:!1}),r}return Ne(t,e),we(t,[{key:"kill",value:function(){var i=this.container;i.removeEventListener("touchstart",this.handleStart),i.removeEventListener("touchcancel",this.handleLeave),document.removeEventListener("touchend",this.handleLeave),document.removeEventListener("touchmove",this.handleMove)}},{key:"getDimensions",value:function(){return{width:this.container.offsetWidth,height:this.container.offsetHeight}}},{key:"handleStart",value:function(i){var r=this;if(this.enabled){i.preventDefault();var o=wn(i.touches);if(this.touchMode=o.length,this.startCameraState=this.renderer.getCamera().getState(),this.startTouchesPositions=o.map(function(f){return ze(f,r.container)}),this.touchMode===2){var a=At(this.startTouchesPositions,2),s=a[0],u=s.x,l=s.y,c=a[1],d=c.x,h=c.y;this.startTouchesAngle=Math.atan2(h-l,d-u),this.startTouchesDistance=Math.sqrt(Math.pow(d-u,2)+Math.pow(h-l,2))}this.emit("touchdown",Ot(i,this.lastTouches,this.container)),this.lastTouches=o,this.lastTouchesPositions=this.startTouchesPositions}}},{key:"handleLeave",value:function(i){if(!(!this.enabled||!this.startTouchesPositions.length)){switch(i.cancelable&&i.preventDefault(),this.movingTimeout&&(this.isMoving=!1,clearTimeout(this.movingTimeout)),this.touchMode){case 2:if(i.touches.length===1){this.handleStart(i),i.preventDefault();break}case 1:if(this.isMoving){var r=this.renderer.getCamera(),o=r.getState(),a=r.getPreviousState()||{x:0,y:0};r.animate({x:o.x+this.settings.inertiaRatio*(o.x-a.x),y:o.y+this.settings.inertiaRatio*(o.y-a.y)},{duration:this.settings.inertiaDuration,easing:"quadraticOut"})}this.hasMoved=!1,this.isMoving=!1,this.touchMode=0;break}if(this.emit("touchup",Ot(i,this.lastTouches,this.container)),!i.touches.length){var s=ze(this.lastTouches[0],this.container),u=this.startTouchesPositions[0],l=Math.pow(s.x-u.x,2)+Math.pow(s.y-u.y,2);if(!i.touches.length&&l<Math.pow(this.settings.tapMoveTolerance,2))if(this.lastTap&&Date.now()-this.lastTap.time<this.settings.doubleClickTimeout){var c=Ot(i,this.lastTouches,this.container);if(this.emit("doubletap",c),this.lastTap=null,!c.sigmaDefaultPrevented){var d=this.renderer.getCamera(),h=d.getBoundedRatio(d.getState().ratio/this.settings.doubleClickZoomingRatio);d.animate(this.renderer.getViewportZoomedState(s,h),{easing:"quadraticInOut",duration:this.settings.doubleClickZoomingDuration})}}else{var f=Ot(i,this.lastTouches,this.container);this.emit("tap",f),this.lastTap={time:Date.now(),position:f.touches[0]||f.previousTouches[0]}}}this.lastTouches=wn(i.touches),this.startTouchesPositions=[]}}},{key:"handleMove",value:function(i){var r=this;if(!(!this.enabled||!this.startTouchesPositions.length)){i.preventDefault();var o=wn(i.touches),a=o.map(function(se){return ze(se,r.container)}),s=this.lastTouches;this.lastTouches=o,this.lastTouchesPositions=a;var u=Ot(i,s,this.container);if(this.emit("touchmove",u),!u.sigmaDefaultPrevented&&(this.hasMoved||(this.hasMoved=a.some(function(se,he){var ee=r.startTouchesPositions[he];return ee&&(se.x!==ee.x||se.y!==ee.y)})),!!this.hasMoved)){this.isMoving=!0,this.movingTimeout&&clearTimeout(this.movingTimeout),this.movingTimeout=window.setTimeout(function(){r.isMoving=!1},this.settings.dragTimeout);var l=this.renderer.getCamera(),c=this.startCameraState,d=this.renderer.getSetting("stagePadding");switch(this.touchMode){case 1:{var h=this.renderer.viewportToFramedGraph((this.startTouchesPositions||[])[0]),f=h.x,g=h.y,m=this.renderer.viewportToFramedGraph(a[0]),b=m.x,E=m.y;l.setState({x:c.x+f-b,y:c.y+g-E});break}case 2:{var x={x:.5,y:.5,angle:0,ratio:1},_=a[0],p=_.x,v=_.y,w=a[1],k=w.x,I=w.y,O=Math.atan2(I-v,k-p)-this.startTouchesAngle,F=Math.hypot(I-v,k-p)/this.startTouchesDistance,R=l.getBoundedRatio(c.ratio/F);x.ratio=R,x.angle=c.angle+O;var H=this.getDimensions(),P=this.renderer.viewportToFramedGraph((this.startTouchesPositions||[])[0],{cameraState:c}),W=Math.min(H.width,H.height)-2*d,ie=W/H.width,le=W/H.height,fe=R/W,de=p-W/2/ie,re=v-W/2/le,ce=[de*Math.cos(-x.angle)-re*Math.sin(-x.angle),re*Math.cos(-x.angle)+de*Math.sin(-x.angle)];de=ce[0],re=ce[1],x.x=P.x-de*fe,x.y=P.y+re*fe,l.setState(x);break}}}}}},{key:"setSettings",value:function(i){this.settings=i}}])}(Ea);function Mf(e){if(Array.isArray(e))return Ei(e)}function Df(e){if(typeof Symbol<"u"&&e[Symbol.iterator]!=null||e["@@iterator"]!=null)return Array.from(e)}function $f(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function no(e){return Mf(e)||Df(e)||sa(e)||$f()}function Gf(e,t){if(e==null)return{};var n={};for(var i in e)if({}.hasOwnProperty.call(e,i)){if(t.indexOf(i)!==-1)continue;n[i]=e[i]}return n}function ui(e,t){if(e==null)return{};var n,i,r=Gf(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(i=0;i<o.length;i++)n=o[i],t.indexOf(n)===-1&&{}.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}var io=function(){function e(t,n){be(this,e),this.key=t,this.size=n}return we(e,null,[{key:"compare",value:function(n,i){return n.size>i.size?-1:n.size<i.size||n.key>i.key?1:-1}}])}(),ro=function(){function e(){be(this,e),A(this,"width",0),A(this,"height",0),A(this,"cellSize",0),A(this,"columns",0),A(this,"rows",0),A(this,"cells",{})}return we(e,[{key:"resizeAndClear",value:function(n,i){this.width=n.width,this.height=n.height,this.cellSize=i,this.columns=Math.ceil(n.width/i),this.rows=Math.ceil(n.height/i),this.cells={}}},{key:"getIndex",value:function(n){var i=Math.floor(n.x/this.cellSize),r=Math.floor(n.y/this.cellSize);return r*this.columns+i}},{key:"add",value:function(n,i,r){var o=new io(n,i),a=this.getIndex(r),s=this.cells[a];s||(s=[],this.cells[a]=s),s.push(o)}},{key:"organize",value:function(){for(var n in this.cells){var i=this.cells[n];i.sort(io.compare)}}},{key:"getLabelsToDisplay",value:function(n,i){var r=this.cellSize*this.cellSize,o=r/n/n,a=o*i/r,s=Math.ceil(a),u=[];for(var l in this.cells)for(var c=this.cells[l],d=0;d<Math.min(s,c.length);d++)u.push(c[d].key);return u}}])}();function Pf(e){var t=e.graph,n=e.hoveredNode,i=e.highlightedNodes,r=e.displayedNodeLabels,o=[];return t.forEachEdge(function(a,s,u,l){(u===n||l===n||i.has(u)||i.has(l)||r.has(u)&&r.has(l))&&o.push(a)}),o}var If=150,Ff=50,Ke=Object.prototype.hasOwnProperty;function zf(e,t,n){if(!Ke.call(n,"x")||!Ke.call(n,"y"))throw new Error('Sigma: could not find a valid position (x, y) for node "'.concat(t,'". All your nodes must have a number "x" and "y". Maybe your forgot to apply a layout or your "nodeReducer" is not returning the correct data?'));return n.color||(n.color=e.defaultNodeColor),!n.label&&n.label!==""&&(n.label=null),n.label!==void 0&&n.label!==null?n.label=""+n.label:n.label=null,n.size||(n.size=2),Ke.call(n,"hidden")||(n.hidden=!1),Ke.call(n,"highlighted")||(n.highlighted=!1),Ke.call(n,"forceLabel")||(n.forceLabel=!1),(!n.type||n.type==="")&&(n.type=e.defaultNodeType),n.zIndex||(n.zIndex=0),n}function Of(e,t,n){return n.color||(n.color=e.defaultEdgeColor),n.label||(n.label=""),n.size||(n.size=.5),Ke.call(n,"hidden")||(n.hidden=!1),Ke.call(n,"forceLabel")||(n.forceLabel=!1),(!n.type||n.type==="")&&(n.type=e.defaultEdgeType),n.zIndex||(n.zIndex=0),n}var Bf=function(e){function t(n,i){var r,o=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};if(be(this,t),r=Re(this,t),A(r,"elements",{}),A(r,"canvasContexts",{}),A(r,"webGLContexts",{}),A(r,"pickingLayers",new Set),A(r,"textures",{}),A(r,"frameBuffers",{}),A(r,"activeListeners",{}),A(r,"labelGrid",new ro),A(r,"nodeDataCache",{}),A(r,"edgeDataCache",{}),A(r,"nodeProgramIndex",{}),A(r,"edgeProgramIndex",{}),A(r,"nodesWithForcedLabels",new Set),A(r,"edgesWithForcedLabels",new Set),A(r,"nodeExtent",{x:[0,1],y:[0,1]}),A(r,"nodeZExtent",[1/0,-1/0]),A(r,"edgeZExtent",[1/0,-1/0]),A(r,"matrix",Pe()),A(r,"invMatrix",Pe()),A(r,"correctionRatio",1),A(r,"customBBox",null),A(r,"normalizationFunction",Qr({x:[0,1],y:[0,1]})),A(r,"graphToViewportRatio",1),A(r,"itemIDsIndex",{}),A(r,"nodeIndices",{}),A(r,"edgeIndices",{}),A(r,"width",0),A(r,"height",0),A(r,"pixelRatio",Zr()),A(r,"pickingDownSizingRatio",2*r.pixelRatio),A(r,"displayedNodeLabels",new Set),A(r,"displayedEdgeLabels",new Set),A(r,"highlightedNodes",new Set),A(r,"hoveredNode",null),A(r,"hoveredEdge",null),A(r,"renderFrame",null),A(r,"renderHighlightedNodesFrame",null),A(r,"needToProcess",!1),A(r,"checkEdgesEventsFrame",null),A(r,"nodePrograms",{}),A(r,"nodeHoverPrograms",{}),A(r,"edgePrograms",{}),r.settings=Ef(o),si(r.settings),bf(n),!(i instanceof HTMLElement))throw new Error("Sigma: container should be an html element.");r.graph=n,r.container=i,r.createWebGLContext("edges",{picking:o.enableEdgeEvents}),r.createCanvasContext("edgeLabels"),r.createWebGLContext("nodes",{picking:!0}),r.createCanvasContext("labels"),r.createCanvasContext("hovers"),r.createWebGLContext("hoverNodes"),r.createCanvasContext("mouse",{style:{touchAction:"none",userSelect:"none"}}),r.resize();for(var a in r.settings.nodeProgramClasses)r.registerNodeProgram(a,r.settings.nodeProgramClasses[a],r.settings.nodeHoverProgramClasses[a]);for(var s in r.settings.edgeProgramClasses)r.registerEdgeProgram(s,r.settings.edgeProgramClasses[s]);return r.camera=new to,r.bindCameraHandlers(),r.mouseCaptor=new Sf(r.elements.mouse,r),r.mouseCaptor.setSettings(r.settings),r.touchCaptor=new Nf(r.elements.mouse,r),r.touchCaptor.setSettings(r.settings),r.bindEventHandlers(),r.bindGraphHandlers(),r.handleSettingsUpdate(),r.refresh(),r}return Ne(t,e),we(t,[{key:"registerNodeProgram",value:function(i,r,o){return this.nodePrograms[i]&&this.nodePrograms[i].kill(),this.nodeHoverPrograms[i]&&this.nodeHoverPrograms[i].kill(),this.nodePrograms[i]=new r(this.webGLContexts.nodes,this.frameBuffers.nodes,this),this.nodeHoverPrograms[i]=new(o||r)(this.webGLContexts.hoverNodes,null,this),this}},{key:"registerEdgeProgram",value:function(i,r){return this.edgePrograms[i]&&this.edgePrograms[i].kill(),this.edgePrograms[i]=new r(this.webGLContexts.edges,this.frameBuffers.edges,this),this}},{key:"unregisterNodeProgram",value:function(i){if(this.nodePrograms[i]){var r=this.nodePrograms,o=r[i],a=ui(r,[i].map(jt));o.kill(),this.nodePrograms=a}if(this.nodeHoverPrograms[i]){var s=this.nodeHoverPrograms,u=s[i],l=ui(s,[i].map(jt));u.kill(),this.nodePrograms=l}return this}},{key:"unregisterEdgeProgram",value:function(i){if(this.edgePrograms[i]){var r=this.edgePrograms,o=r[i],a=ui(r,[i].map(jt));o.kill(),this.edgePrograms=a}return this}},{key:"resetWebGLTexture",value:function(i){var r=this.webGLContexts[i],o=this.frameBuffers[i],a=this.textures[i];a&&r.deleteTexture(a);var s=r.createTexture();return r.bindFramebuffer(r.FRAMEBUFFER,o),r.bindTexture(r.TEXTURE_2D,s),r.texImage2D(r.TEXTURE_2D,0,r.RGBA,this.width,this.height,0,r.RGBA,r.UNSIGNED_BYTE,null),r.framebufferTexture2D(r.FRAMEBUFFER,r.COLOR_ATTACHMENT0,r.TEXTURE_2D,s,0),this.textures[i]=s,this}},{key:"bindCameraHandlers",value:function(){var i=this;return this.activeListeners.camera=function(){i.scheduleRender()},this.camera.on("updated",this.activeListeners.camera),this}},{key:"unbindCameraHandlers",value:function(){return this.camera.removeListener("updated",this.activeListeners.camera),this}},{key:"getNodeAtPosition",value:function(i){var r=i.x,o=i.y,a=Or(this.webGLContexts.nodes,this.frameBuffers.nodes,r,o,this.pixelRatio,this.pickingDownSizingRatio),s=zr.apply(void 0,no(a)),u=this.itemIDsIndex[s];return u&&u.type==="node"?u.id:null}},{key:"bindEventHandlers",value:function(){var i=this;this.activeListeners.handleResize=function(){i.scheduleRefresh()},window.addEventListener("resize",this.activeListeners.handleResize),this.activeListeners.handleMove=function(o){var a=zt(o),s={event:a,preventSigmaDefault:function(){a.preventSigmaDefault()}},u=i.getNodeAtPosition(a);if(u&&i.hoveredNode!==u&&!i.nodeDataCache[u].hidden){i.hoveredNode&&i.emit("leaveNode",V(V({},s),{},{node:i.hoveredNode})),i.hoveredNode=u,i.emit("enterNode",V(V({},s),{},{node:u})),i.scheduleHighlightedNodesRender();return}if(i.hoveredNode&&i.getNodeAtPosition(a)!==i.hoveredNode){var l=i.hoveredNode;i.hoveredNode=null,i.emit("leaveNode",V(V({},s),{},{node:l})),i.scheduleHighlightedNodesRender();return}if(i.settings.enableEdgeEvents){var c=i.hoveredNode?null:i.getEdgeAtPoint(s.event.x,s.event.y);c!==i.hoveredEdge&&(i.hoveredEdge&&i.emit("leaveEdge",V(V({},s),{},{edge:i.hoveredEdge})),c&&i.emit("enterEdge",V(V({},s),{},{edge:c})),i.hoveredEdge=c)}},this.activeListeners.handleMoveBody=function(o){var a=zt(o);i.emit("moveBody",{event:a,preventSigmaDefault:function(){a.preventSigmaDefault()}})},this.activeListeners.handleLeave=function(o){var a=zt(o),s={event:a,preventSigmaDefault:function(){a.preventSigmaDefault()}};i.hoveredNode&&(i.emit("leaveNode",V(V({},s),{},{node:i.hoveredNode})),i.scheduleHighlightedNodesRender()),i.settings.enableEdgeEvents&&i.hoveredEdge&&(i.emit("leaveEdge",V(V({},s),{},{edge:i.hoveredEdge})),i.scheduleHighlightedNodesRender()),i.emit("leaveStage",V({},s))},this.activeListeners.handleEnter=function(o){var a=zt(o),s={event:a,preventSigmaDefault:function(){a.preventSigmaDefault()}};i.emit("enterStage",V({},s))};var r=function(a){return function(s){var u=zt(s),l={event:u,preventSigmaDefault:function(){u.preventSigmaDefault()}},c=i.getNodeAtPosition(u);if(c)return i.emit("".concat(a,"Node"),V(V({},l),{},{node:c}));if(i.settings.enableEdgeEvents){var d=i.getEdgeAtPoint(u.x,u.y);if(d)return i.emit("".concat(a,"Edge"),V(V({},l),{},{edge:d}))}return i.emit("".concat(a,"Stage"),l)}};return this.activeListeners.handleClick=r("click"),this.activeListeners.handleRightClick=r("rightClick"),this.activeListeners.handleDoubleClick=r("doubleClick"),this.activeListeners.handleWheel=r("wheel"),this.activeListeners.handleDown=r("down"),this.activeListeners.handleUp=r("up"),this.mouseCaptor.on("mousemove",this.activeListeners.handleMove),this.mouseCaptor.on("mousemovebody",this.activeListeners.handleMoveBody),this.mouseCaptor.on("click",this.activeListeners.handleClick),this.mouseCaptor.on("rightClick",this.activeListeners.handleRightClick),this.mouseCaptor.on("doubleClick",this.activeListeners.handleDoubleClick),this.mouseCaptor.on("wheel",this.activeListeners.handleWheel),this.mouseCaptor.on("mousedown",this.activeListeners.handleDown),this.mouseCaptor.on("mouseup",this.activeListeners.handleUp),this.mouseCaptor.on("mouseleave",this.activeListeners.handleLeave),this.mouseCaptor.on("mouseenter",this.activeListeners.handleEnter),this.touchCaptor.on("touchdown",this.activeListeners.handleDown),this.touchCaptor.on("touchdown",this.activeListeners.handleMove),this.touchCaptor.on("touchup",this.activeListeners.handleUp),this.touchCaptor.on("touchmove",this.activeListeners.handleMove),this.touchCaptor.on("tap",this.activeListeners.handleClick),this.touchCaptor.on("doubletap",this.activeListeners.handleDoubleClick),this.touchCaptor.on("touchmove",this.activeListeners.handleMoveBody),this}},{key:"bindGraphHandlers",value:function(){var i=this,r=this.graph,o=new Set(["x","y","zIndex","type"]);return this.activeListeners.eachNodeAttributesUpdatedGraphUpdate=function(a){var s,u=(s=a.hints)===null||s===void 0?void 0:s.attributes;i.graph.forEachNode(function(c){return i.updateNode(c)});var l=!u||u.some(function(c){return o.has(c)});i.refresh({partialGraph:{nodes:r.nodes()},skipIndexation:!l,schedule:!0})},this.activeListeners.eachEdgeAttributesUpdatedGraphUpdate=function(a){var s,u=(s=a.hints)===null||s===void 0?void 0:s.attributes;i.graph.forEachEdge(function(c){return i.updateEdge(c)});var l=u&&["zIndex","type"].some(function(c){return u==null?void 0:u.includes(c)});i.refresh({partialGraph:{edges:r.edges()},skipIndexation:!l,schedule:!0})},this.activeListeners.addNodeGraphUpdate=function(a){var s=a.key;i.addNode(s),i.refresh({partialGraph:{nodes:[s]},skipIndexation:!1,schedule:!0})},this.activeListeners.updateNodeGraphUpdate=function(a){var s=a.key;i.refresh({partialGraph:{nodes:[s]},skipIndexation:!1,schedule:!0})},this.activeListeners.dropNodeGraphUpdate=function(a){var s=a.key;i.removeNode(s),i.refresh({schedule:!0})},this.activeListeners.addEdgeGraphUpdate=function(a){var s=a.key;i.addEdge(s),i.refresh({partialGraph:{edges:[s]},schedule:!0})},this.activeListeners.updateEdgeGraphUpdate=function(a){var s=a.key;i.refresh({partialGraph:{edges:[s]},skipIndexation:!1,schedule:!0})},this.activeListeners.dropEdgeGraphUpdate=function(a){var s=a.key;i.removeEdge(s),i.refresh({schedule:!0})},this.activeListeners.clearEdgesGraphUpdate=function(){i.clearEdgeState(),i.clearEdgeIndices(),i.refresh({schedule:!0})},this.activeListeners.clearGraphUpdate=function(){i.clearEdgeState(),i.clearNodeState(),i.clearEdgeIndices(),i.clearNodeIndices(),i.refresh({schedule:!0})},r.on("nodeAdded",this.activeListeners.addNodeGraphUpdate),r.on("nodeDropped",this.activeListeners.dropNodeGraphUpdate),r.on("nodeAttributesUpdated",this.activeListeners.updateNodeGraphUpdate),r.on("eachNodeAttributesUpdated",this.activeListeners.eachNodeAttributesUpdatedGraphUpdate),r.on("edgeAdded",this.activeListeners.addEdgeGraphUpdate),r.on("edgeDropped",this.activeListeners.dropEdgeGraphUpdate),r.on("edgeAttributesUpdated",this.activeListeners.updateEdgeGraphUpdate),r.on("eachEdgeAttributesUpdated",this.activeListeners.eachEdgeAttributesUpdatedGraphUpdate),r.on("edgesCleared",this.activeListeners.clearEdgesGraphUpdate),r.on("cleared",this.activeListeners.clearGraphUpdate),this}},{key:"unbindGraphHandlers",value:function(){var i=this.graph;i.removeListener("nodeAdded",this.activeListeners.addNodeGraphUpdate),i.removeListener("nodeDropped",this.activeListeners.dropNodeGraphUpdate),i.removeListener("nodeAttributesUpdated",this.activeListeners.updateNodeGraphUpdate),i.removeListener("eachNodeAttributesUpdated",this.activeListeners.eachNodeAttributesUpdatedGraphUpdate),i.removeListener("edgeAdded",this.activeListeners.addEdgeGraphUpdate),i.removeListener("edgeDropped",this.activeListeners.dropEdgeGraphUpdate),i.removeListener("edgeAttributesUpdated",this.activeListeners.updateEdgeGraphUpdate),i.removeListener("eachEdgeAttributesUpdated",this.activeListeners.eachEdgeAttributesUpdatedGraphUpdate),i.removeListener("edgesCleared",this.activeListeners.clearEdgesGraphUpdate),i.removeListener("cleared",this.activeListeners.clearGraphUpdate)}},{key:"getEdgeAtPoint",value:function(i,r){var o=Or(this.webGLContexts.edges,this.frameBuffers.edges,i,r,this.pixelRatio,this.pickingDownSizingRatio),a=zr.apply(void 0,no(o)),s=this.itemIDsIndex[a];return s&&s.type==="edge"?s.id:null}},{key:"process",value:function(){var i=this;this.emit("beforeProcess");var r=this.graph,o=this.settings,a=this.getDimensions();if(this.nodeExtent=yf(this.graph),!this.settings.autoRescale){var s=a.width,u=a.height,l=this.nodeExtent,c=l.x,d=l.y;this.nodeExtent={x:[(c[0]+c[1])/2-s/2,(c[0]+c[1])/2+s/2],y:[(d[0]+d[1])/2-u/2,(d[0]+d[1])/2+u/2]}}this.normalizationFunction=Qr(this.customBBox||this.nodeExtent);var h=new to,f=Ft(h.getState(),a,this.getGraphDimensions(),this.getStagePadding());this.labelGrid.resizeAndClear(a,o.labelGridCellSize);for(var g={},m={},b={},E={},x=1,_=r.nodes(),p=0,v=_.length;p<v;p++){var w=_[p],k=this.nodeDataCache[w],I=r.getNodeAttributes(w);k.x=I.x,k.y=I.y,this.normalizationFunction.applyTo(k),typeof k.label=="string"&&!k.hidden&&this.labelGrid.add(w,k.size,this.framedGraphToViewport(k,{matrix:f})),g[k.type]=(g[k.type]||0)+1}this.labelGrid.organize();for(var O in this.nodePrograms){if(!Ke.call(this.nodePrograms,O))throw new Error('Sigma: could not find a suitable program for node type "'.concat(O,'"!'));this.nodePrograms[O].reallocate(g[O]||0),g[O]=0}this.settings.zIndex&&this.nodeZExtent[0]!==this.nodeZExtent[1]&&(_=Jr(this.nodeZExtent,function(ge){return i.nodeDataCache[ge].zIndex},_));for(var F=0,R=_.length;F<R;F++){var H=_[F];m[H]=x,E[m[H]]={type:"node",id:H},x++;var P=this.nodeDataCache[H];this.addNodeToProgram(H,m[H],g[P.type]++)}for(var W={},ie=r.edges(),le=0,fe=ie.length;le<fe;le++){var de=ie[le],re=this.edgeDataCache[de];W[re.type]=(W[re.type]||0)+1}this.settings.zIndex&&this.edgeZExtent[0]!==this.edgeZExtent[1]&&(ie=Jr(this.edgeZExtent,function(ge){return i.edgeDataCache[ge].zIndex},ie));for(var ce in this.edgePrograms){if(!Ke.call(this.edgePrograms,ce))throw new Error('Sigma: could not find a suitable program for edge type "'.concat(ce,'"!'));this.edgePrograms[ce].reallocate(W[ce]||0),W[ce]=0}for(var se=0,he=ie.length;se<he;se++){var ee=ie[se];b[ee]=x,E[b[ee]]={type:"edge",id:ee},x++;var Me=this.edgeDataCache[ee];this.addEdgeToProgram(ee,b[ee],W[Me.type]++)}return this.itemIDsIndex=E,this.nodeIndices=m,this.edgeIndices=b,this.emit("afterProcess"),this}},{key:"handleSettingsUpdate",value:function(i){var r=this,o=this.settings;if(this.camera.minRatio=o.minCameraRatio,this.camera.maxRatio=o.maxCameraRatio,this.camera.enabledZooming=o.enableCameraZooming,this.camera.enabledPanning=o.enableCameraPanning,this.camera.enabledRotation=o.enableCameraRotation,o.cameraPanBoundaries?this.camera.clean=function(c){return r.cleanCameraState(c,o.cameraPanBoundaries&&Ti(o.cameraPanBoundaries)==="object"?o.cameraPanBoundaries:{})}:this.camera.clean=null,this.camera.setState(this.camera.validateState(this.camera.getState())),i){if(i.edgeProgramClasses!==o.edgeProgramClasses){for(var a in o.edgeProgramClasses)o.edgeProgramClasses[a]!==i.edgeProgramClasses[a]&&this.registerEdgeProgram(a,o.edgeProgramClasses[a]);for(var s in i.edgeProgramClasses)o.edgeProgramClasses[s]||this.unregisterEdgeProgram(s)}if(i.nodeProgramClasses!==o.nodeProgramClasses||i.nodeHoverProgramClasses!==o.nodeHoverProgramClasses){for(var u in o.nodeProgramClasses)(o.nodeProgramClasses[u]!==i.nodeProgramClasses[u]||o.nodeHoverProgramClasses[u]!==i.nodeHoverProgramClasses[u])&&this.registerNodeProgram(u,o.nodeProgramClasses[u],o.nodeHoverProgramClasses[u]);for(var l in i.nodeProgramClasses)o.nodeProgramClasses[l]||this.unregisterNodeProgram(l)}}return this.mouseCaptor.setSettings(this.settings),this.touchCaptor.setSettings(this.settings),this}},{key:"cleanCameraState",value:function(i){var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},o=r.tolerance,a=o===void 0?0:o,s=r.boundaries,u=V({},i),l=s||this.nodeExtent,c=At(l.x,2),d=c[0],h=c[1],f=At(l.y,2),g=f[0],m=f[1],b=[this.graphToViewport({x:d,y:g},{cameraState:i}),this.graphToViewport({x:h,y:g},{cameraState:i}),this.graphToViewport({x:d,y:m},{cameraState:i}),this.graphToViewport({x:h,y:m},{cameraState:i})],E=1/0,x=-1/0,_=1/0,p=-1/0;b.forEach(function(W){var ie=W.x,le=W.y;E=Math.min(E,ie),x=Math.max(x,ie),_=Math.min(_,le),p=Math.max(p,le)});var v=x-E,w=p-_,k=this.getDimensions(),I=k.width,O=k.height,F=0,R=0;if(v>=I?x<I-a?F=x-(I-a):E>a&&(F=E-a):x>I+a?F=x-(I+a):E<-a&&(F=E+a),w>=O?p<O-a?R=p-(O-a):_>a&&(R=_-a):p>O+a?R=p-(O+a):_<-a&&(R=_+a),F||R){var H=this.viewportToFramedGraph({x:0,y:0},{cameraState:i}),P=this.viewportToFramedGraph({x:F,y:R},{cameraState:i});F=P.x-H.x,R=P.y-H.y,u.x+=F,u.y+=R}return u}},{key:"renderLabels",value:function(){if(!this.settings.renderLabels)return this;var i=this.camera.getState(),r=this.labelGrid.getLabelsToDisplay(i.ratio,this.settings.labelDensity);eo(r,this.nodesWithForcedLabels),this.displayedNodeLabels=new Set;for(var o=this.canvasContexts.labels,a=0,s=r.length;a<s;a++){var u=r[a],l=this.nodeDataCache[u];if(!this.displayedNodeLabels.has(u)&&!l.hidden){var c=this.framedGraphToViewport(l),d=c.x,h=c.y,f=this.scaleSize(l.size);if(!(!l.forceLabel&&f<this.settings.labelRenderedSizeThreshold)&&!(d<-150||d>this.width+If||h<-50||h>this.height+Ff)){this.displayedNodeLabels.add(u);var g=this.settings.defaultDrawNodeLabel,m=this.nodePrograms[l.type],b=(m==null?void 0:m.drawLabel)||g;b(o,V(V({key:u},l),{},{size:f,x:d,y:h}),this.settings)}}}return this}},{key:"renderEdgeLabels",value:function(){if(!this.settings.renderEdgeLabels)return this;var i=this.canvasContexts.edgeLabels;i.clearRect(0,0,this.width,this.height);var r=Pf({graph:this.graph,hoveredNode:this.hoveredNode,displayedNodeLabels:this.displayedNodeLabels,highlightedNodes:this.highlightedNodes});eo(r,this.edgesWithForcedLabels);for(var o=new Set,a=0,s=r.length;a<s;a++){var u=r[a],l=this.graph.extremities(u),c=this.nodeDataCache[l[0]],d=this.nodeDataCache[l[1]],h=this.edgeDataCache[u];if(!o.has(u)&&!(h.hidden||c.hidden||d.hidden)){var f=this.settings.defaultDrawEdgeLabel,g=this.edgePrograms[h.type],m=(g==null?void 0:g.drawLabel)||f;m(i,V(V({key:u},h),{},{size:this.scaleSize(h.size)}),V(V(V({key:l[0]},c),this.framedGraphToViewport(c)),{},{size:this.scaleSize(c.size)}),V(V(V({key:l[1]},d),this.framedGraphToViewport(d)),{},{size:this.scaleSize(d.size)}),this.settings),o.add(u)}}return this.displayedEdgeLabels=o,this}},{key:"renderHighlightedNodes",value:function(){var i=this,r=this.canvasContexts.hovers;r.clearRect(0,0,this.width,this.height);var o=function(f){var g=i.nodeDataCache[f],m=i.framedGraphToViewport(g),b=m.x,E=m.y,x=i.scaleSize(g.size),_=i.settings.defaultDrawNodeHover,p=i.nodePrograms[g.type],v=(p==null?void 0:p.drawHover)||_;v(r,V(V({key:f},g),{},{size:x,x:b,y:E}),i.settings)},a=[];this.hoveredNode&&!this.nodeDataCache[this.hoveredNode].hidden&&a.push(this.hoveredNode),this.highlightedNodes.forEach(function(h){h!==i.hoveredNode&&a.push(h)}),a.forEach(function(h){return o(h)});var s={};a.forEach(function(h){var f=i.nodeDataCache[h].type;s[f]=(s[f]||0)+1});for(var u in this.nodeHoverPrograms)this.nodeHoverPrograms[u].reallocate(s[u]||0),s[u]=0;a.forEach(function(h){var f=i.nodeDataCache[h];i.nodeHoverPrograms[f.type].process(0,s[f.type]++,f)}),this.webGLContexts.hoverNodes.clear(this.webGLContexts.hoverNodes.COLOR_BUFFER_BIT);var l=this.getRenderParams();for(var c in this.nodeHoverPrograms){var d=this.nodeHoverPrograms[c];d.render(l)}}},{key:"scheduleHighlightedNodesRender",value:function(){var i=this;this.renderHighlightedNodesFrame||this.renderFrame||(this.renderHighlightedNodesFrame=requestAnimationFrame(function(){i.renderHighlightedNodesFrame=null,i.renderHighlightedNodes(),i.renderEdgeLabels()}))}},{key:"render",value:function(){var i=this;this.emit("beforeRender");var r=function(){return i.emit("afterRender"),i};if(this.renderFrame&&(cancelAnimationFrame(this.renderFrame),this.renderFrame=null),this.resize(),this.needToProcess&&this.process(),this.needToProcess=!1,this.clear(),this.pickingLayers.forEach(function(b){return i.resetWebGLTexture(b)}),!this.graph.order)return r();var o=this.mouseCaptor,a=this.camera.isAnimated()||o.isMoving||o.draggedEvents||o.currentWheelDirection,s=this.camera.getState(),u=this.getDimensions(),l=this.getGraphDimensions(),c=this.getStagePadding();this.matrix=Ft(s,u,l,c),this.invMatrix=Ft(s,u,l,c,!0),this.correctionRatio=vf(this.matrix,s,u),this.graphToViewportRatio=this.getGraphToViewportRatio();var d=this.getRenderParams();for(var h in this.nodePrograms){var f=this.nodePrograms[h];f.render(d)}if(!this.settings.hideEdgesOnMove||!a)for(var g in this.edgePrograms){var m=this.edgePrograms[g];m.render(d)}return this.settings.hideLabelsOnMove&&a||(this.renderLabels(),this.renderEdgeLabels(),this.renderHighlightedNodes()),r()}},{key:"addNode",value:function(i){var r=Object.assign({},this.graph.getNodeAttributes(i));this.settings.nodeReducer&&(r=this.settings.nodeReducer(i,r));var o=zf(this.settings,i,r);this.nodeDataCache[i]=o,this.nodesWithForcedLabels.delete(i),o.forceLabel&&!o.hidden&&this.nodesWithForcedLabels.add(i),this.highlightedNodes.delete(i),o.highlighted&&!o.hidden&&this.highlightedNodes.add(i),this.settings.zIndex&&(o.zIndex<this.nodeZExtent[0]&&(this.nodeZExtent[0]=o.zIndex),o.zIndex>this.nodeZExtent[1]&&(this.nodeZExtent[1]=o.zIndex))}},{key:"updateNode",value:function(i){this.addNode(i);var r=this.nodeDataCache[i];this.normalizationFunction.applyTo(r)}},{key:"removeNode",value:function(i){delete this.nodeDataCache[i],delete this.nodeProgramIndex[i],this.highlightedNodes.delete(i),this.hoveredNode===i&&(this.hoveredNode=null),this.nodesWithForcedLabels.delete(i)}},{key:"addEdge",value:function(i){var r=Object.assign({},this.graph.getEdgeAttributes(i));this.settings.edgeReducer&&(r=this.settings.edgeReducer(i,r));var o=Of(this.settings,i,r);this.edgeDataCache[i]=o,this.edgesWithForcedLabels.delete(i),o.forceLabel&&!o.hidden&&this.edgesWithForcedLabels.add(i),this.settings.zIndex&&(o.zIndex<this.edgeZExtent[0]&&(this.edgeZExtent[0]=o.zIndex),o.zIndex>this.edgeZExtent[1]&&(this.edgeZExtent[1]=o.zIndex))}},{key:"updateEdge",value:function(i){this.addEdge(i)}},{key:"removeEdge",value:function(i){delete this.edgeDataCache[i],delete this.edgeProgramIndex[i],this.hoveredEdge===i&&(this.hoveredEdge=null),this.edgesWithForcedLabels.delete(i)}},{key:"clearNodeIndices",value:function(){this.labelGrid=new ro,this.nodeExtent={x:[0,1],y:[0,1]},this.nodeDataCache={},this.edgeProgramIndex={},this.nodesWithForcedLabels=new Set,this.nodeZExtent=[1/0,-1/0],this.highlightedNodes=new Set}},{key:"clearEdgeIndices",value:function(){this.edgeDataCache={},this.edgeProgramIndex={},this.edgesWithForcedLabels=new Set,this.edgeZExtent=[1/0,-1/0]}},{key:"clearIndices",value:function(){this.clearEdgeIndices(),this.clearNodeIndices()}},{key:"clearNodeState",value:function(){this.displayedNodeLabels=new Set,this.highlightedNodes=new Set,this.hoveredNode=null}},{key:"clearEdgeState",value:function(){this.displayedEdgeLabels=new Set,this.highlightedNodes=new Set,this.hoveredEdge=null}},{key:"clearState",value:function(){this.clearEdgeState(),this.clearNodeState()}},{key:"addNodeToProgram",value:function(i,r,o){var a=this.nodeDataCache[i],s=this.nodePrograms[a.type];if(!s)throw new Error('Sigma: could not find a suitable program for node type "'.concat(a.type,'"!'));s.process(r,o,a),this.nodeProgramIndex[i]=o}},{key:"addEdgeToProgram",value:function(i,r,o){var a=this.edgeDataCache[i],s=this.edgePrograms[a.type];if(!s)throw new Error('Sigma: could not find a suitable program for edge type "'.concat(a.type,'"!'));var u=this.graph.extremities(i),l=this.nodeDataCache[u[0]],c=this.nodeDataCache[u[1]];s.process(r,o,l,c,a),this.edgeProgramIndex[i]=o}},{key:"getRenderParams",value:function(){return{matrix:this.matrix,invMatrix:this.invMatrix,width:this.width,height:this.height,pixelRatio:this.pixelRatio,zoomRatio:this.camera.ratio,cameraAngle:this.camera.angle,sizeRatio:1/this.scaleSize(),correctionRatio:this.correctionRatio,downSizingRatio:this.pickingDownSizingRatio,minEdgeThickness:this.settings.minEdgeThickness,antiAliasingFeather:this.settings.antiAliasingFeather}}},{key:"getStagePadding",value:function(){var i=this.settings,r=i.stagePadding,o=i.autoRescale;return o&&r||0}},{key:"createLayer",value:function(i,r){var o=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};if(this.elements[i])throw new Error('Sigma: a layer named "'.concat(i,'" already exists'));var a=wf(r,{position:"absolute"},{class:"sigma-".concat(i)});return o.style&&Object.assign(a.style,o.style),this.elements[i]=a,"beforeLayer"in o&&o.beforeLayer?this.elements[o.beforeLayer].before(a):"afterLayer"in o&&o.afterLayer?this.elements[o.afterLayer].after(a):this.container.appendChild(a),a}},{key:"createCanvas",value:function(i){var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return this.createLayer(i,"canvas",r)}},{key:"createCanvasContext",value:function(i){var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},o=this.createCanvas(i,r),a={preserveDrawingBuffer:!1,antialias:!1};return this.canvasContexts[i]=o.getContext("2d",a),this}},{key:"createWebGLContext",value:function(i){var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},o=(r==null?void 0:r.canvas)||this.createCanvas(i,r);r.hidden&&o.remove();var a=V({preserveDrawingBuffer:!1,antialias:!1},r),s;s=o.getContext("webgl2",a),s||(s=o.getContext("webgl",a)),s||(s=o.getContext("experimental-webgl",a));var u=s;if(this.webGLContexts[i]=u,u.blendFunc(u.ONE,u.ONE_MINUS_SRC_ALPHA),r.picking){this.pickingLayers.add(i);var l=u.createFramebuffer();if(!l)throw new Error("Sigma: cannot create a new frame buffer for layer ".concat(i));this.frameBuffers[i]=l}return u}},{key:"killLayer",value:function(i){var r=this.elements[i];if(!r)throw new Error("Sigma: cannot kill layer ".concat(i,", which does not exist"));if(this.webGLContexts[i]){var o,a=this.webGLContexts[i];(o=a.getExtension("WEBGL_lose_context"))===null||o===void 0||o.loseContext(),delete this.webGLContexts[i]}else this.canvasContexts[i]&&delete this.canvasContexts[i];return r.remove(),delete this.elements[i],this}},{key:"getCamera",value:function(){return this.camera}},{key:"setCamera",value:function(i){this.unbindCameraHandlers(),this.camera=i,this.bindCameraHandlers()}},{key:"getContainer",value:function(){return this.container}},{key:"getGraph",value:function(){return this.graph}},{key:"setGraph",value:function(i){i!==this.graph&&(this.hoveredNode&&!i.hasNode(this.hoveredNode)&&(this.hoveredNode=null),this.hoveredEdge&&!i.hasEdge(this.hoveredEdge)&&(this.hoveredEdge=null),this.unbindGraphHandlers(),this.checkEdgesEventsFrame!==null&&(cancelAnimationFrame(this.checkEdgesEventsFrame),this.checkEdgesEventsFrame=null),this.graph=i,this.bindGraphHandlers(),this.refresh())}},{key:"getMouseCaptor",value:function(){return this.mouseCaptor}},{key:"getTouchCaptor",value:function(){return this.touchCaptor}},{key:"getDimensions",value:function(){return{width:this.width,height:this.height}}},{key:"getGraphDimensions",value:function(){var i=this.customBBox||this.nodeExtent;return{width:i.x[1]-i.x[0]||1,height:i.y[1]-i.y[0]||1}}},{key:"getNodeDisplayData",value:function(i){var r=this.nodeDataCache[i];return r?Object.assign({},r):void 0}},{key:"getEdgeDisplayData",value:function(i){var r=this.edgeDataCache[i];return r?Object.assign({},r):void 0}},{key:"getNodeDisplayedLabels",value:function(){return new Set(this.displayedNodeLabels)}},{key:"getEdgeDisplayedLabels",value:function(){return new Set(this.displayedEdgeLabels)}},{key:"getSettings",value:function(){return V({},this.settings)}},{key:"getSetting",value:function(i){return this.settings[i]}},{key:"setSetting",value:function(i,r){var o=V({},this.settings);return this.settings[i]=r,si(this.settings),this.handleSettingsUpdate(o),this.scheduleRefresh(),this}},{key:"updateSetting",value:function(i,r){return this.setSetting(i,r(this.settings[i])),this}},{key:"setSettings",value:function(i){var r=V({},this.settings);return this.settings=V(V({},this.settings),i),si(this.settings),this.handleSettingsUpdate(r),this.scheduleRefresh(),this}},{key:"resize",value:function(i){var r=this.width,o=this.height;if(this.width=this.container.offsetWidth,this.height=this.container.offsetHeight,this.pixelRatio=Zr(),this.width===0)if(this.settings.allowInvalidContainer)this.width=1;else throw new Error("Sigma: Container has no width. You can set the allowInvalidContainer setting to true to stop seeing this error.");if(this.height===0)if(this.settings.allowInvalidContainer)this.height=1;else throw new Error("Sigma: Container has no height. You can set the allowInvalidContainer setting to true to stop seeing this error.");if(!i&&r===this.width&&o===this.height)return this;for(var a in this.elements){var s=this.elements[a];s.style.width=this.width+"px",s.style.height=this.height+"px"}for(var u in this.canvasContexts)this.elements[u].setAttribute("width",this.width*this.pixelRatio+"px"),this.elements[u].setAttribute("height",this.height*this.pixelRatio+"px"),this.pixelRatio!==1&&this.canvasContexts[u].scale(this.pixelRatio,this.pixelRatio);for(var l in this.webGLContexts){this.elements[l].setAttribute("width",this.width*this.pixelRatio+"px"),this.elements[l].setAttribute("height",this.height*this.pixelRatio+"px");var c=this.webGLContexts[l];if(c.viewport(0,0,this.width*this.pixelRatio,this.height*this.pixelRatio),this.pickingLayers.has(l)){var d=this.textures[l];d&&c.deleteTexture(d)}}return this.emit("resize"),this}},{key:"clear",value:function(){return this.emit("beforeClear"),this.webGLContexts.nodes.bindFramebuffer(WebGLRenderingContext.FRAMEBUFFER,null),this.webGLContexts.nodes.clear(WebGLRenderingContext.COLOR_BUFFER_BIT),this.webGLContexts.edges.bindFramebuffer(WebGLRenderingContext.FRAMEBUFFER,null),this.webGLContexts.edges.clear(WebGLRenderingContext.COLOR_BUFFER_BIT),this.webGLContexts.hoverNodes.clear(WebGLRenderingContext.COLOR_BUFFER_BIT),this.canvasContexts.labels.clearRect(0,0,this.width,this.height),this.canvasContexts.hovers.clearRect(0,0,this.width,this.height),this.canvasContexts.edgeLabels.clearRect(0,0,this.width,this.height),this.emit("afterClear"),this}},{key:"refresh",value:function(i){var r=this,o=(i==null?void 0:i.skipIndexation)!==void 0?i==null?void 0:i.skipIndexation:!1,a=(i==null?void 0:i.schedule)!==void 0?i.schedule:!1,s=!i||!i.partialGraph;if(s)this.clearEdgeIndices(),this.clearNodeIndices(),this.graph.forEachNode(function(p){return r.addNode(p)}),this.graph.forEachEdge(function(p){return r.addEdge(p)});else{for(var u,l,c=((u=i.partialGraph)===null||u===void 0?void 0:u.nodes)||[],d=0,h=(c==null?void 0:c.length)||0;d<h;d++){var f=c[d];if(this.updateNode(f),o){var g=this.nodeProgramIndex[f];if(g===void 0)throw new Error('Sigma: node "'.concat(f,`" can't be repaint`));this.addNodeToProgram(f,this.nodeIndices[f],g)}}for(var m=(i==null||(l=i.partialGraph)===null||l===void 0?void 0:l.edges)||[],b=0,E=m.length;b<E;b++){var x=m[b];if(this.updateEdge(x),o){var _=this.edgeProgramIndex[x];if(_===void 0)throw new Error('Sigma: edge "'.concat(x,`" can't be repaint`));this.addEdgeToProgram(x,this.edgeIndices[x],_)}}}return(s||!o)&&(this.needToProcess=!0),a?this.scheduleRender():this.render(),this}},{key:"scheduleRender",value:function(){var i=this;return this.renderFrame||(this.renderFrame=requestAnimationFrame(function(){i.render()})),this}},{key:"scheduleRefresh",value:function(i){return this.refresh(V(V({},i),{},{schedule:!0}))}},{key:"getViewportZoomedState",value:function(i,r){var o=this.camera.getState(),a=o.ratio,s=o.angle,u=o.x,l=o.y,c=this.settings,d=c.minCameraRatio,h=c.maxCameraRatio;typeof h=="number"&&(r=Math.min(r,h)),typeof d=="number"&&(r=Math.max(r,d));var f=r/a,g={x:this.width/2,y:this.height/2},m=this.viewportToFramedGraph(i),b=this.viewportToFramedGraph(g);return{angle:s,x:(m.x-b.x)*(1-f)+u,y:(m.y-b.y)*(1-f)+l,ratio:r}}},{key:"viewRectangle",value:function(){var i=this.viewportToFramedGraph({x:0,y:0}),r=this.viewportToFramedGraph({x:this.width,y:0}),o=this.viewportToFramedGraph({x:0,y:this.height});return{x1:i.x,y1:i.y,x2:r.x,y2:r.y,height:r.y-o.y}}},{key:"framedGraphToViewport",value:function(i){var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},o=!!r.cameraState||!!r.viewportDimensions||!!r.graphDimensions,a=r.matrix?r.matrix:o?Ft(r.cameraState||this.camera.getState(),r.viewportDimensions||this.getDimensions(),r.graphDimensions||this.getGraphDimensions(),r.padding||this.getStagePadding()):this.matrix,s=ki(a,i);return{x:(1+s.x)*this.width/2,y:(1-s.y)*this.height/2}}},{key:"viewportToFramedGraph",value:function(i){var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},o=!!r.cameraState||!!r.viewportDimensions||!r.graphDimensions,a=r.matrix?r.matrix:o?Ft(r.cameraState||this.camera.getState(),r.viewportDimensions||this.getDimensions(),r.graphDimensions||this.getGraphDimensions(),r.padding||this.getStagePadding(),!0):this.invMatrix,s=ki(a,{x:i.x/this.width*2-1,y:1-i.y/this.height*2});return isNaN(s.x)&&(s.x=0),isNaN(s.y)&&(s.y=0),s}},{key:"viewportToGraph",value:function(i){var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return this.normalizationFunction.inverse(this.viewportToFramedGraph(i,r))}},{key:"graphToViewport",value:function(i){var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return this.framedGraphToViewport(this.normalizationFunction(i),r)}},{key:"getGraphToViewportRatio",value:function(){var i={x:0,y:0},r={x:1,y:1},o=Math.sqrt(Math.pow(i.x-r.x,2)+Math.pow(i.y-r.y,2)),a=this.graphToViewport(i),s=this.graphToViewport(r),u=Math.sqrt(Math.pow(a.x-s.x,2)+Math.pow(a.y-s.y,2));return u/o}},{key:"getBBox",value:function(){return this.nodeExtent}},{key:"getCustomBBox",value:function(){return this.customBBox}},{key:"setCustomBBox",value:function(i){return this.customBBox=i,this.scheduleRender(),this}},{key:"kill",value:function(){this.emit("kill"),this.removeAllListeners(),this.unbindCameraHandlers(),window.removeEventListener("resize",this.activeListeners.handleResize),this.mouseCaptor.kill(),this.touchCaptor.kill(),this.unbindGraphHandlers(),this.clearIndices(),this.clearState(),this.nodeDataCache={},this.edgeDataCache={},this.highlightedNodes.clear(),this.renderFrame&&(cancelAnimationFrame(this.renderFrame),this.renderFrame=null),this.renderHighlightedNodesFrame&&(cancelAnimationFrame(this.renderHighlightedNodesFrame),this.renderHighlightedNodesFrame=null);for(var i=this.container;i.firstChild;)i.removeChild(i.firstChild);for(var r in this.nodePrograms)this.nodePrograms[r].kill();for(var o in this.nodeHoverPrograms)this.nodeHoverPrograms[o].kill();for(var a in this.edgePrograms)this.edgePrograms[a].kill();this.nodePrograms={},this.nodeHoverPrograms={},this.edgePrograms={};for(var s in this.elements)this.killLayer(s);this.canvasContexts={},this.webGLContexts={},this.elements={}}},{key:"scaleSize",value:function(){var i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:1,r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:this.camera.ratio;return i/this.settings.zoomToSizeRatioFunction(r)*(this.getSetting("itemSizesReference")==="positions"?r*this.graphToViewportRatio:1)}},{key:"getCanvases",value:function(){var i={};for(var r in this.elements)this.elements[r]instanceof HTMLCanvasElement&&(i[r]=this.elements[r]);return i}}])}(Vi),Uf=Bf;function Hf(e,t){if(typeof e!="object"||!e)return e;var n=e[Symbol.toPrimitive];if(n!==void 0){var i=n.call(e,t);if(typeof i!="object")return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}function Ca(e){var t=Hf(e,"string");return typeof t=="symbol"?t:t+""}function ka(e,t,n){return(t=Ca(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function oo(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable})),n.push.apply(n,i)}return n}function Dn(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?oo(Object(n),!0).forEach(function(i){ka(e,i,n[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):oo(Object(n)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(n,i))})}return e}function Wf(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function qf(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,Ca(i.key),i)}}function Vf(e,t,n){return t&&qf(e.prototype,t),Object.defineProperty(e,"prototype",{writable:!1}),e}function $n(e){return $n=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},$n(e)}function Ta(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(Ta=function(){return!!e})()}function Aa(e){if(e===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function jf(e,t){if(t&&(typeof t=="object"||typeof t=="function"))return t;if(t!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return Aa(e)}function Yf(e,t,n){return t=$n(t),jf(e,Ta()?Reflect.construct(t,n||[],$n(e).constructor):t.apply(e,n))}function Ai(e,t){return Ai=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(n,i){return n.__proto__=i,n},Ai(e,t)}function Xf(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&Ai(e,t)}function Si(e,t){(t==null||t>e.length)&&(t=e.length);for(var n=0,i=Array(t);n<t;n++)i[n]=e[n];return i}function Kf(e){if(Array.isArray(e))return Si(e)}function Zf(e){if(typeof Symbol<"u"&&e[Symbol.iterator]!=null||e["@@iterator"]!=null)return Array.from(e)}function Jf(e,t){if(e){if(typeof e=="string")return Si(e,t);var n={}.toString.call(e).slice(8,-1);return n==="Object"&&e.constructor&&(n=e.constructor.name),n==="Map"||n==="Set"?Array.from(e):n==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?Si(e,t):void 0}}function Qf(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function li(e){return Kf(e)||Zf(e)||Jf(e)||Qf()}function Sa(e,t,n,i){var r=Math.pow(1-e,2)*t.x+2*(1-e)*e*n.x+Math.pow(e,2)*i.x,o=Math.pow(1-e,2)*t.y+2*(1-e)*e*n.y+Math.pow(e,2)*i.y;return{x:r,y:o}}function eg(e,t,n){for(var i=20,r=0,o=e,a=0;a<i;a++){var s=Sa((a+1)/i,e,t,n);r+=Math.sqrt(Math.pow(o.x-s.x,2)+Math.pow(o.y-s.y,2)),o=s}return r}function tg(e){var t=e.curvatureAttribute,n=e.defaultCurvature,i=e.keepLabelUpright,r=i===void 0?!0:i;return function(o,a,s,u,l){var c=l.edgeLabelSize,d=a[t]||n,h=l.edgeLabelFont,f=l.edgeLabelWeight,g=l.edgeLabelColor.attribute?a[l.edgeLabelColor.attribute]||l.edgeLabelColor.color||"#000":l.edgeLabelColor.color,m=a.label;if(m){o.fillStyle=g,o.font="".concat(f," ").concat(c,"px ").concat(h);var b=!r||s.x<u.x,E=b?s.x:u.x,x=b?s.y:u.y,_=b?u.x:s.x,p=b?u.y:s.y,v=(E+_)/2,w=(x+p)/2,k=_-E,I=p-x,O=Math.sqrt(Math.pow(k,2)+Math.pow(I,2)),F=b?1:-1,R=v+I*d*F,H=w-k*d*F,P=a.size*.7+5,W={x:H-x,y:-(R-E)},ie=Math.sqrt(Math.pow(W.x,2)+Math.pow(W.y,2)),le={x:p-H,y:-(_-R)},fe=Math.sqrt(Math.pow(le.x,2)+Math.pow(le.y,2));E+=P*W.x/ie,x+=P*W.y/ie,_+=P*le.x/fe,p+=P*le.y/fe,R+=P*I/O,H-=P*k/O;var de={x:R,y:H},re={x:E,y:x},ce={x:_,y:p},se=eg(re,de,ce);if(!(se<s.size+u.size)){var he=o.measureText(m).width,ee=se-s.size-u.size;if(he>ee){var Me="…";for(m=m+Me,he=o.measureText(m).width;he>ee&&m.length>1;)m=m.slice(0,-2)+Me,he=o.measureText(m).width;if(m.length<4)return}for(var ge={},Be=0,st=m.length;Be<st;Be++){var Ue=m[Be];ge[Ue]||(ge[Ue]=o.measureText(Ue).width*(1+d*.35))}for(var ke=.5-he/se/2,et=0,tt=m.length;et<tt;et++){var je=m[et],nt=Sa(ke,re,de,ce),Mt=2*(1-ke)*(R-E)+2*ke*(_-R),Un=2*(1-ke)*(H-x)+2*ke*(p-H),it=Math.atan2(Un,Mt);o.save(),o.translate(nt.x,nt.y),o.rotate(it),o.fillText(je,0,0),o.restore(),ke+=ge[je]/se}}}}}function ng(e){var t=e.arrowHead,n=(t==null?void 0:t.extremity)==="target"||(t==null?void 0:t.extremity)==="both",i=(t==null?void 0:t.extremity)==="source"||(t==null?void 0:t.extremity)==="both",r=`
precision highp float;

varying vec4 v_color;
varying float v_thickness;
varying float v_feather;
varying vec2 v_cpA;
varying vec2 v_cpB;
varying vec2 v_cpC;
`.concat(n?`
varying float v_targetSize;
varying vec2 v_targetPoint;`:"",`
`).concat(i?`
varying float v_sourceSize;
varying vec2 v_sourcePoint;`:"",`
`).concat(t?`
uniform float u_lengthToThicknessRatio;
uniform float u_widenessToThicknessRatio;`:"",`

float det(vec2 a, vec2 b) {
  return a.x * b.y - b.x * a.y;
}

vec2 getDistanceVector(vec2 b0, vec2 b1, vec2 b2) {
  float a = det(b0, b2), b = 2.0 * det(b1, b0), d = 2.0 * det(b2, b1);
  float f = b * d - a * a;
  vec2 d21 = b2 - b1, d10 = b1 - b0, d20 = b2 - b0;
  vec2 gf = 2.0 * (b * d21 + d * d10 + a * d20);
  gf = vec2(gf.y, -gf.x);
  vec2 pp = -f * gf / dot(gf, gf);
  vec2 d0p = b0 - pp;
  float ap = det(d0p, d20), bp = 2.0 * det(d10, d0p);
  float t = clamp((ap + bp) / (2.0 * a + b + d), 0.0, 1.0);
  return mix(mix(b0, b1, t), mix(b1, b2, t), t);
}

float distToQuadraticBezierCurve(vec2 p, vec2 b0, vec2 b1, vec2 b2) {
  return length(getDistanceVector(b0 - p, b1 - p, b2 - p));
}

const vec4 transparent = vec4(0.0, 0.0, 0.0, 0.0);

void main(void) {
  float dist = distToQuadraticBezierCurve(gl_FragCoord.xy, v_cpA, v_cpB, v_cpC);
  float thickness = v_thickness;
`).concat(n?`
  float distToTarget = length(gl_FragCoord.xy - v_targetPoint);
  float targetArrowLength = v_targetSize + thickness * u_lengthToThicknessRatio;
  if (distToTarget < targetArrowLength) {
    thickness = (distToTarget - v_targetSize) / (targetArrowLength - v_targetSize) * u_widenessToThicknessRatio * thickness;
  }`:"",`
`).concat(i?`
  float distToSource = length(gl_FragCoord.xy - v_sourcePoint);
  float sourceArrowLength = v_sourceSize + thickness * u_lengthToThicknessRatio;
  if (distToSource < sourceArrowLength) {
    thickness = (distToSource - v_sourceSize) / (sourceArrowLength - v_sourceSize) * u_widenessToThicknessRatio * thickness;
  }`:"",`

  float halfThickness = thickness / 2.0;
  if (dist < halfThickness) {
    #ifdef PICKING_MODE
    gl_FragColor = v_color;
    #else
    float t = smoothstep(
      halfThickness - v_feather,
      halfThickness,
      dist
    );

    gl_FragColor = mix(v_color, transparent, t);
    #endif
  } else {
    gl_FragColor = transparent;
  }
}
`);return r}function ig(e){var t=e.arrowHead,n=(t==null?void 0:t.extremity)==="target"||(t==null?void 0:t.extremity)==="both",i=(t==null?void 0:t.extremity)==="source"||(t==null?void 0:t.extremity)==="both",r=`
attribute vec4 a_id;
attribute vec4 a_color;
attribute float a_direction;
attribute float a_thickness;
attribute vec2 a_source;
attribute vec2 a_target;
attribute float a_current;
attribute float a_curvature;
`.concat(n?`attribute float a_targetSize;
`:"",`
`).concat(i?`attribute float a_sourceSize;
`:"",`

uniform mat3 u_matrix;
uniform float u_sizeRatio;
uniform float u_pixelRatio;
uniform vec2 u_dimensions;
uniform float u_minEdgeThickness;
uniform float u_feather;

varying vec4 v_color;
varying float v_thickness;
varying float v_feather;
varying vec2 v_cpA;
varying vec2 v_cpB;
varying vec2 v_cpC;
`).concat(n?`
varying float v_targetSize;
varying vec2 v_targetPoint;`:"",`
`).concat(i?`
varying float v_sourceSize;
varying vec2 v_sourcePoint;`:"",`
`).concat(t?`
uniform float u_widenessToThicknessRatio;`:"",`

const float bias = 255.0 / 254.0;
const float epsilon = 0.7;

vec2 clipspaceToViewport(vec2 pos, vec2 dimensions) {
  return vec2(
    (pos.x + 1.0) * dimensions.x / 2.0,
    (pos.y + 1.0) * dimensions.y / 2.0
  );
}

vec2 viewportToClipspace(vec2 pos, vec2 dimensions) {
  return vec2(
    pos.x / dimensions.x * 2.0 - 1.0,
    pos.y / dimensions.y * 2.0 - 1.0
  );
}

void main() {
  float minThickness = u_minEdgeThickness;

  // Selecting the correct position
  // Branchless "position = a_source if a_current == 1.0 else a_target"
  vec2 position = a_source * max(0.0, a_current) + a_target * max(0.0, 1.0 - a_current);
  position = (u_matrix * vec3(position, 1)).xy;

  vec2 source = (u_matrix * vec3(a_source, 1)).xy;
  vec2 target = (u_matrix * vec3(a_target, 1)).xy;

  vec2 viewportPosition = clipspaceToViewport(position, u_dimensions);
  vec2 viewportSource = clipspaceToViewport(source, u_dimensions);
  vec2 viewportTarget = clipspaceToViewport(target, u_dimensions);

  vec2 delta = viewportTarget.xy - viewportSource.xy;
  float len = length(delta);
  vec2 normal = vec2(-delta.y, delta.x) * a_direction;
  vec2 unitNormal = normal / len;
  float boundingBoxThickness = len * a_curvature;

  float curveThickness = max(minThickness, a_thickness / u_sizeRatio);
  v_thickness = curveThickness * u_pixelRatio;
  v_feather = u_feather;

  v_cpA = viewportSource;
  v_cpB = 0.5 * (viewportSource + viewportTarget) + unitNormal * a_direction * boundingBoxThickness;
  v_cpC = viewportTarget;

  vec2 viewportOffsetPosition = (
    viewportPosition +
    unitNormal * (boundingBoxThickness / 2.0 + sign(boundingBoxThickness) * (`).concat(t?"curveThickness * u_widenessToThicknessRatio":"curveThickness",` + epsilon)) *
    max(0.0, a_direction) // NOTE: cutting the bounding box in half to avoid overdraw
  );

  position = viewportToClipspace(viewportOffsetPosition, u_dimensions);
  gl_Position = vec4(position, 0, 1);
    
`).concat(n?`
  v_targetSize = a_targetSize * u_pixelRatio / u_sizeRatio;
  v_targetPoint = viewportTarget;
`:"",`
`).concat(i?`
  v_sourceSize = a_sourceSize * u_pixelRatio / u_sizeRatio;
  v_sourcePoint = viewportSource;
`:"",`

  #ifdef PICKING_MODE
  // For picking mode, we use the ID as the color:
  v_color = a_id;
  #else
  // For normal mode, we use the color:
  v_color = a_color;
  #endif

  v_color.a *= bias;
}
`);return r}var La=.25,rg={arrowHead:null,curvatureAttribute:"curvature",defaultCurvature:La},Ra=WebGLRenderingContext,ao=Ra.UNSIGNED_BYTE,at=Ra.FLOAT;function Yi(e){var t=Dn(Dn({},rg),e||{}),n=t,i=n.arrowHead,r=n.curvatureAttribute,o=n.drawLabel,a=(i==null?void 0:i.extremity)==="target"||(i==null?void 0:i.extremity)==="both",s=(i==null?void 0:i.extremity)==="source"||(i==null?void 0:i.extremity)==="both",u=["u_matrix","u_sizeRatio","u_dimensions","u_pixelRatio","u_feather","u_minEdgeThickness"].concat(li(i?["u_lengthToThicknessRatio","u_widenessToThicknessRatio"]:[]));return function(l){Xf(c,l);function c(){var d;Wf(this,c);for(var h=arguments.length,f=new Array(h),g=0;g<h;g++)f[g]=arguments[g];return d=Yf(this,c,[].concat(f)),ka(Aa(d),"drawLabel",o||tg(t)),d}return Vf(c,[{key:"getDefinition",value:function(){return{VERTICES:6,VERTEX_SHADER_SOURCE:ig(t),FRAGMENT_SHADER_SOURCE:ng(t),METHOD:WebGLRenderingContext.TRIANGLES,UNIFORMS:u,ATTRIBUTES:[{name:"a_source",size:2,type:at},{name:"a_target",size:2,type:at}].concat(li(a?[{name:"a_targetSize",size:1,type:at}]:[]),li(s?[{name:"a_sourceSize",size:1,type:at}]:[]),[{name:"a_thickness",size:1,type:at},{name:"a_curvature",size:1,type:at},{name:"a_color",size:4,type:ao,normalized:!0},{name:"a_id",size:4,type:ao,normalized:!0}]),CONSTANT_ATTRIBUTES:[{name:"a_current",size:1,type:at},{name:"a_direction",size:1,type:at}],CONSTANT_DATA:[[0,1],[0,-1],[1,1],[0,-1],[1,1],[1,-1]]}}},{key:"processVisibleItem",value:function(h,f,g,m,b){var E,x=b.size||1,_=g.x,p=g.y,v=m.x,w=m.y,k=Nt(b.color),I=(E=b[r])!==null&&E!==void 0?E:La,O=this.array;O[f++]=_,O[f++]=p,O[f++]=v,O[f++]=w,a&&(O[f++]=m.size),s&&(O[f++]=g.size),O[f++]=x,O[f++]=I,O[f++]=k,O[f++]=h}},{key:"setUniforms",value:function(h,f){var g=f.gl,m=f.uniformLocations,b=m.u_matrix,E=m.u_pixelRatio,x=m.u_feather,_=m.u_sizeRatio,p=m.u_dimensions,v=m.u_minEdgeThickness;if(g.uniformMatrix3fv(b,!1,h.matrix),g.uniform1f(E,h.pixelRatio),g.uniform1f(_,h.sizeRatio),g.uniform1f(x,h.antiAliasingFeather),g.uniform2f(p,h.width*h.pixelRatio,h.height*h.pixelRatio),g.uniform1f(v,h.minEdgeThickness),i){var w=m.u_lengthToThicknessRatio,k=m.u_widenessToThicknessRatio;g.uniform1f(w,i.lengthToThicknessRatio),g.uniform1f(k,i.widenessToThicknessRatio)}}}]),c}(zn)}var og=Yi();Yi({arrowHead:Bn});Yi({arrowHead:Dn(Dn({},Bn),{},{extremity:"both"})});function ag(){const e=document.getElementById("yearFrom"),t=document.getElementById("yearTo"),n=document.getElementById("areaFilter"),i=document.getElementById("institutionFilter"),r=document.getElementById("typeFilter"),o=document.getElementById("clearFilters"),a=document.getElementById("selectedAreas"),s=document.getElementById("selectedInstitutions"),u=document.getElementById("selectedTypes"),l=document.getElementById("standardSearch"),c=document.getElementById("standardSearchBtn"),d=document.getElementById("searchSuggestions"),h=document.getElementById("selectedAuthor"),f=document.getElementById("authorLimitMessage"),g=document.getElementById("clusteringModel"),m=document.getElementById("nClusters"),b=document.getElementById("nClustersValue"),E=document.getElementById("nClustersContainer"),x=document.getElementById("modelDescription");document.getElementById("applyClustering");const _=document.getElementById("rangeContainer"),p=document.getElementById("dbscanOptions"),v=document.getElementById("hdbscanOptions"),w=document.getElementById("dbscanClusters"),k=document.getElementById("hdbscanClusters"),I=document.getElementById("manualMode"),O=document.getElementById("globalBestMode"),F=document.getElementById("modelManualMode"),R=document.getElementById("modelAutoMode"),H=document.getElementById("manualConfigContainer"),P=document.getElementById("lovainaOptions"),W={kmeans:'Agrupa los datos en un número fijo de categorías (clusters) tratando de minimizar la distancia entre los puntos de cada grupo y su centroide, es decir, su "centro". Este método busca particiones compactas y bien separadas, y es especialmente útil cuando los grupos tienen forma redonda o esférica. Es rápido y eficiente, aunque sensible a la elección inicial del número de grupos (k) y a los valores extremos.',agglomerative:"Construye agrupaciones de forma jerárquica: comienza considerando cada autor como un grupo separado y va fusionando los más similares en pasos sucesivos. El resultado es una estructura en forma de árbol (dendrograma), que permite explorar diferentes niveles de agrupación según la profundidad del corte. Es útil cuando no se conoce el número exacto de grupos y se desea analizar la relación progresiva entre autores.",spectral:"Transforma la relación entre autores en una red (o grafo) de similitudes y la descompone matemáticamente para encontrar estructuras ocultas. Posteriormente, agrupa los autores en ese nuevo espacio. Es muy útil cuando las agrupaciones no tienen una forma clara o son no convexas, como anillos o cadenas, y aprovecha la conectividad global de los datos.",gmm:"Parte de la idea de que los datos provienen de una combinación de distribuciones estadísticas llamadas Gaussianas (curvas en forma de campana). En lugar de asignar cada punto a un único cluster, estima la probabilidad de que pertenezca a cada uno. Esto le permite detectar clusters superpuestos o de formas más complejas que los que detecta KMeans, siendo ideal cuando se sospecha que los datos tienen estructuras suaves o ambiguas.",dbscan:"Identifica grupos basándose en la densidad de los puntos: busca regiones donde los puntos están muy juntos y los separa de las regiones más dispersas. Es especialmente útil cuando los clusters tienen formas arbitrarias y no se conoce el número de grupos a priori. Puede identificar puntos de ruido (outliers) y no requiere especificar el número de clusters.",hdbscan:"Es una versión jerárquica de DBSCAN que puede encontrar clusters de diferentes densidades. En lugar de usar un único umbral de densidad, construye una jerarquía de clusters y luego selecciona los más significativos. Es robusto a los parámetros y puede encontrar clusters de formas arbitrarias.",lovaina:"Algoritmo de detección de comunidades que optimiza la modularidad de la red. Funciona de manera iterativa, moviendo nodos entre comunidades para maximizar la modularidad. Es especialmente efectivo para detectar comunidades en redes grandes y puede encontrar comunidades de diferentes tamaños."},ie={kmeans:'It groups the data into a fixed number of categories (clusters) trying to minimize the distance between the points of each group and its centroid, that is, its "center". This method looks for compact and well-separated partitions, and is especially useful when the clusters are round or spherical in shape. It is fast and efficient, although sensitive to the initial choice of the number of groups (k) and to extreme values.',agglomerative:"It builds groupings in a hierarchical way: it starts by considering each author as a separate group and merges the most similar ones in successive steps. The result is a tree-like structure (dendrogram), which allows exploring different levels of grouping according to the depth of the cut. It is useful when the exact number of groups is not known and it is desired to analyze the progressive relationship between authors.",spectral:"It transforms the relationship between authors into a network (or graph) of similarities and decomposes it mathematically to find hidden structures. It then clusters the authors in this new space. It is very useful when the groupings do not have a clear shape or are non-convex, such as rings or chains, and takes advantage of the global connectivity of the data.",gmm:"It starts from the idea that the data come from a combination of statistical distributions called Gaussian (bell-shaped curves). Instead of assigning each point to a single cluster, it estimates the probability that it belongs to each cluster. This allows it to detect overlapping or more complex-shaped clusters than KMeans detects, making it ideal when data are suspected of having soft or ambiguous structures.",dbscan:"Identifies groups based on the density of points: it looks for regions where points are very close together and separates them from more scattered regions. It is especially useful when clusters have arbitrary shapes and the number of groups is not known a priori. It can identify noise points (outliers) and does not require specifying the number of clusters.",hdbscan:"It is a hierarchical version of DBSCAN that can find clusters of different densities. Instead of using a single density threshold, it builds a hierarchy of clusters and then selects the most significant ones. It is robust to parameters and can find clusters of arbitrary shapes.",lovaina:"A community detection algorithm that optimizes network modularity. It works iteratively, moving nodes between communities to maximize modularity. It is especially effective for detecting communities in large networks and can find communities of different sizes."},le={clusters:"clusters",bestConfig:"Mejor Configuración",globalBestConfig:"Mejor Configuración Global",manualConfig:"Configuración Manual",numberOfClusters:"Número de Clusters",clusteringModel:"Modelo de Clustering",apply:"Aplicar",cancel:"Cancelar",globalBestDescription:"Usa la mejor configuración de clustering encontrada entre todos los modelos y parámetros."},fe={clusters:"clusters",bestConfig:"Best Configuration",globalBestConfig:"Global Best Configuration",manualConfig:"Manual Configuration",numberOfClusters:"Number of Clusters",clusteringModel:"Clustering Model",apply:"Apply",cancel:"Cancel",globalBestDescription:"Uses the best clustering configuration found across all models and parameters."};function de(){const y=Dt==="es"?le:fe,L=Dt==="es"?W:ie,S={clusteringModelLabel:document.querySelector('label[for="clusteringModel"]'),nClustersLabel:document.querySelector('label[for="nClusters"]'),manualModeLabel:document.querySelector('label[for="manualMode"]'),globalBestModeLabel:document.querySelector('label[for="globalBestMode"]'),modelManualModeLabel:document.querySelector('label[for="modelManualMode"]'),modelAutoModeLabel:document.querySelector('label[for="modelAutoMode"]'),globalBestDescription:document.querySelector("#globalBestMode + .form-text"),applyButton:document.getElementById("applyClustering"),cancelButton:document.querySelector(".btn-secondary")};S.clusteringModelLabel&&(S.clusteringModelLabel.textContent=y.clusteringModel),S.nClustersLabel&&(S.nClustersLabel.textContent=y.numberOfClusters),S.manualModeLabel&&(S.manualModeLabel.textContent=y.manualConfig),S.globalBestModeLabel&&(S.globalBestModeLabel.textContent=y.globalBestConfig),S.modelManualModeLabel&&(S.modelManualModeLabel.textContent=y.manualConfig),S.modelAutoModeLabel&&(S.modelAutoModeLabel.textContent=y.bestConfig),S.globalBestDescription&&(S.globalBestDescription.textContent=y.globalBestDescription),S.applyButton&&(S.applyButton.textContent=y.apply),S.cancelButton&&(S.cancelButton.textContent=y.cancel),w&&Array.from(w.options).forEach(C=>{C.text=`${C.value} ${y.clusters}`}),k&&Array.from(k.options).forEach(C=>{C.text=`${C.value} ${y.clusters}`}),g&&x&&(x.textContent=L[g.value]||"")}g&&x&&g.addEventListener("change",function(){const y=this.value,L=Dt==="es"?W:ie;x.textContent=L[y]||"",y==="dbscan"?(_.classList.add("d-none"),p.classList.remove("d-none"),v.classList.add("d-none"),P.classList.add("d-none")):y==="hdbscan"?(_.classList.add("d-none"),p.classList.add("d-none"),v.classList.remove("d-none"),P.classList.add("d-none")):y==="lovaina"?(_.classList.add("d-none"),p.classList.add("d-none"),v.classList.add("d-none"),P.classList.remove("d-none")):(_.classList.remove("d-none"),p.classList.add("d-none"),v.classList.add("d-none"),P.classList.add("d-none"))}),I&&O&&H&&(I.addEventListener("change",function(){this.checked&&H.classList.remove("d-none")}),O.addEventListener("change",function(){this.checked&&H.classList.add("d-none")})),F&&R&&E&&(F.addEventListener("change",function(){this.checked&&E.classList.remove("d-none")}),R.addEventListener("change",function(){this.checked&&E.classList.add("d-none")})),m&&b&&m.addEventListener("input",function(){b.textContent=this.value});const re=document.getElementById("clusteringModal");re&&re.addEventListener("show.bs.modal",function(){de()}),document.querySelectorAll(".dropdown-item.network-community-view").forEach(y=>{y.addEventListener("click",function(L){L.preventDefault();const S=this.dataset.communityView;if(S==="keywords"){new bootstrap.Modal(document.getElementById("clusteringModal")).show();return}if(ue===S){document.querySelectorAll(".dropdown-item.network-community-view").forEach(C=>{C.classList.remove("active")}),this.classList.add("active");return}ue=S,document.querySelectorAll(".dropdown-item.network-community-view").forEach(C=>{C.classList.remove("active")}),this.classList.add("active"),tn(),it()})});let ce=new Set,se=new Set,he=new Set,ee=null,Me=null;function ge(){ee?(c.classList.remove("btn-primary","btn-success"),c.classList.add("btn-secondary"),c.disabled=!0):(c.innerHTML='<i class="fas fa-search"></i>',c.classList.remove("btn-success","btn-secondary"),c.classList.add("btn-primary"),c.disabled=!1)}function Be(y){if(!y||ee){d.style.display="none";return}fetch(`/api/search/authors/?q=${encodeURIComponent(y)}`).then(L=>L.json()).then(L=>{const S=d.querySelector(".list-group");if(S.innerHTML="",L.suggestions.length===0){d.style.display="none";return}L.suggestions.forEach(C=>{const N=document.createElement("a");N.href="#",N.className="list-group-item list-group-item-action",N.innerHTML=`
                        ${C.name}
                        <span class="badge bg-secondary float-end">${C.count} pub.</span>
                    `,N.addEventListener("click",D=>{D.preventDefault(),st(C.name)}),S.appendChild(N)}),d.style.display="block"}).catch(L=>{console.error("Error fetching author suggestions:",L),d.style.display="none"})}function st(y){ee=y,l.value="",l.disabled=!0,d.style.display="none",f.style.display="block",ge(),h.innerHTML=`
            <span class="badge bg-primary me-2 mb-2">
                ${y}
                <button type="button" class="btn-close btn-close-white ms-1" 
                        style="font-size: 0.5rem; vertical-align: middle;"
                        aria-label="Remove"></button>
            </span>
        `,h.querySelector(".btn-close").addEventListener("click",()=>{ee=null,h.innerHTML="",l.disabled=!1,f.style.display="none",ge();const Q=document.getElementById("authorMetricsCard");Q&&Q.remove();const K=document.getElementById("networkCol");K&&(K.className="col-12"),rt()});const L=document.getElementById("collaborationRow"),S=document.createElement("div");S.id="authorMetricsCard",S.className="col-md-6 mt-3 mt-md-0 mb-10 h-100";const C=window.location.pathname.split("/")[1],N=C==="es"?"Resumen de Métricas del Autor":"Author Metrics Summary",D=C==="es"?"Métrica":"Metrics",$=C==="es"?"Valor":"Value";S.innerHTML=`
            <div class="card dashboard-card h-100">
                <div class="card-body d-flex flex-column">
                    <div class="d-flex justify-content-between align-items-center mb-3">
                        <h5 class="card-title mb-0">${N}</h5>
                    </div>
                    <div id="authorMetricsContent" class="flex-grow-1">
                        <div class="table-responsive">
                            <table class="table table-hover">
                                <thead>
                                    <tr>
                                        <th>${D}</th>
                                        <th>${$}</th>
                                    </tr>
                                </thead>
                                <tbody id="authorMetricsTable">
                                    <!-- Data will be loaded dynamically -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
        `,L.appendChild(S);const X=document.getElementById("networkCol");X&&(X.className="col-12 col-md-6 mb-10");const J=document.getElementById("pubsCol");J&&(J.className="col-12 mt-4"),fetch(`/api/author/metrics/?author_id=${encodeURIComponent(y)}`).then(Q=>Q.json()).then(Q=>{if(Q.error){console.error("Error fetching author metrics:",Q.error);return}const K=document.getElementById("authorMetricsTable");if(!K)return;const U={orcid:"ORCID",total_publications:"Total Publications",total_citations:"Total Citations",citations_wos:"WoS Citations",citations_scopus:"Scopus Citations",h_index:"H-index (WoS/Scopus)",h_index_gb:"H-index (Gesbib)",h_index_h5gb:"H5-index (Gesbib)",international_index:"International Collaboration Index"};K.innerHTML="",Object.entries(Q.metrics).forEach(([q,M])=>{const z=document.createElement("tr");if(q==="orcid"&&typeof M=="string"&&M.trim()!==""){const T=M.replace(/^http:/,"https:");z.innerHTML=`
                            <td>${U[q]}</td>
                            <td><a href="${T}" target="_blank" rel="noopener noreferrer">${T}</a></td>
                        `}else z.innerHTML=`
                            <td>${U[q]||q}</td>
                            <td>${M}</td>
                        `;K.appendChild(z)})}).catch(Q=>{console.error("Error fetching author metrics:",Q)}),rt()}function Ue(){if(!ee&&!l.value.trim())return;c.innerHTML='<i class="fas fa-spinner fa-spin"></i>';const y=new URLSearchParams;ee?y.append("author",ee):y.append("q",l.value.trim()),fetch(`/api/search/?${y.toString()}`).then(L=>L.json()).then(L=>{c.innerHTML='<i class="fas fa-search"></i>',ke(L.results)}).catch(L=>{console.error("Error performing search:",L),c.innerHTML='<i class="fas fa-search"></i>',alert("Error al realizar la búsqueda. Por favor, inténtelo de nuevo.")})}function ke(y){const S=window.location.pathname.split("/")[1]==="es"?"Resultados de la búsqueda":"Search Results";let C=document.getElementById("searchResultsModal");C||(C=document.createElement("div"),C.id="searchResultsModal",C.className="modal fade",C.setAttribute("tabindex","-1"),C.innerHTML=`
                <div class="modal-dialog modal-lg">
                    <div class="modal-content">
                        <div class="modal-header">
                            <h5 class="modal-title">${S}</h5>
                            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                        </div>
                        <div class="modal-body">
                            <div id="searchResultsList"></div>
                        </div>
                    </div>
                </div>
            `,document.body.appendChild(C));const N=document.getElementById("searchResultsList");y.length===0?N.innerHTML='<p class="text-center">No se encontraron resultados.</p>':N.innerHTML=y.map($=>`
                <div class="card mb-3">
                    <div class="card-body" data-publication-id="${$.id}" style="cursor: pointer;">
                        <h5 class="card-title">${$.title}</h5>
                        <h6 class="card-subtitle mb-2 text-muted">
                            ${$.year} - ${$.publication_type}
                        </h6>
                        <p class="card-text">
                            <strong>Autores:</strong> ${$.authors.join(", ")}<br>
                            <strong>Instituciones:</strong> ${$.institutions.join(", ")}<br>
                            <strong>Áreas:</strong> ${$.areas.join(", ")}
                        </p>
                        ${$.url?`<a href="${$.url}" class="card-link" target="_blank">Ver publicación</a>`:""}
                    </div>
                </div>
            `).join(""),N.querySelectorAll(".card-body").forEach($=>{$.addEventListener("click",function(){const X=this.dataset.publicationId;X&&(window.location.href=`/publication/${X}/`)})}),new bootstrap.Modal(C).show()}l.addEventListener("input",function(){ee||(clearTimeout(Me),Me=setTimeout(()=>{Be(this.value.trim())},300))}),l.addEventListener("focus",function(){this.value.trim()&&!ee&&Be(this.value.trim())}),document.addEventListener("click",function(y){!y.target.closest("#standardSearch")&&!y.target.closest("#searchSuggestions")&&(d.style.display="none")}),c.addEventListener("click",Ue),l.addEventListener("keypress",function(y){y.key==="Enter"&&Ue()}),ge(),et(),Un();function et(){fetch("/api/dashboard/filters/").then(y=>y.json()).then(y=>{const L=y.years.map(S=>S.year);e.min=Math.min(...L),e.max=Math.max(...L),t.min=Math.min(...L),t.max=Math.max(...L),y.areas.forEach(S=>{const C=document.createElement("option");C.value=S.name,C.textContent=`${S.name} (${S.count})`,n.appendChild(C)}),y.institutions.forEach(S=>{const C=document.createElement("option");C.value=S.name,C.textContent=`${S.name} (${S.count})`,i.appendChild(C)}),y.publication_types.forEach(S=>{const C=document.createElement("option");C.value=S.publication_type,C.textContent=`${S.publication_type} (${S.count})`,r.appendChild(C)}),it()}).catch(y=>console.error("Error loading filter data:",y))}function tt(y,L,S){const C=document.createElement("span");C.className="badge bg-primary me-2 mb-2";const N=y.length>40?y.substring(0,40)+"...":y;C.innerHTML=`
            ${N}
            <button type="button" class="btn-close btn-close-white ms-1" 
                    style="font-size: 0.5rem; vertical-align: middle;"
                    aria-label="Remove"></button>
        `,C.querySelector(".btn-close").addEventListener("click",()=>{S.delete(y),C.remove(),it()}),L.appendChild(C)}let je="pie",nt=null;function Mt(y){je==="pie"?Ma(y):Da(y)}function Un(){const y=document.querySelector('[data-areas-view="pie"]'),L=document.querySelector('[data-areas-view="bar"]');!y||!L||(y.addEventListener("click",function(){y.classList.contains("active")||(y.classList.add("active"),L.classList.remove("active"),je="pie",nt&&Mt(nt))}),L.addEventListener("click",function(){L.classList.contains("active")||(L.classList.add("active"),y.classList.remove("active"),je="bar",nt&&Mt(nt))}))}function it(){const y={year_from:e.value,year_to:t.value,areas:Array.from(ce),institutions:Array.from(se),types:Array.from(he)},L=y.year_from&&y.year_to&&y.year_from===y.year_to,S=document.querySelector('[data-view="monthly"]'),C=document.querySelector('[data-view="yearly"]');S.disabled=!L,L?y.view_type=S.classList.contains("active")?"monthly":"yearly":(S.classList.remove("active"),C.classList.add("active"),y.view_type="yearly");const N=new URLSearchParams;y.year_from&&N.append("year_from",y.year_from),y.year_to&&N.append("year_to",y.year_to),y.areas.forEach(D=>N.append("areas",D)),y.institutions.forEach(D=>N.append("institutions",D)),y.types.forEach(D=>N.append("types",D)),N.append("view_type",y.view_type),ee&&N.append("author",ee),fetch(`/api/dashboard/data/?${N.toString()}`).then(D=>D.json()).then(D=>{const $=new URLSearchParams(N);$.append("view_type",ue),fetch(`/api/dashboard/collaboration-network/?${$.toString()}`).then(Q=>Q.json()).then(Q=>{Zi(Q)}).catch(Q=>{console.error("Error fetching collaboration network data:",Q)}),Na(D.timeline,y.view_type,D.timeline_info),nt=D.areas;const X=document.querySelector('[data-areas-view="pie"]'),J=document.querySelector('[data-areas-view="bar"]');X&&J&&!X.classList.contains("active")&&!J.classList.contains("active")?(X.classList.add("active"),J.classList.remove("active"),je="pie"):J&&J.classList.contains("active")?je="bar":X&&X.classList.contains("active")&&(je="pie"),Mt(D.areas),Hn(1).then(()=>{})}).catch(D=>console.error("Error updating visualizations:",D))}let De={metric:null,direction:"desc"};function Hn(y=1){const L=document.getElementById("metricsTable"),S=document.getElementById("publicationsPagination"),C=L.closest("table");if(C){let $=C.querySelector(".loading-overlay");$||($=document.createElement("div"),$.className="loading-overlay",$.style.cssText=`
                    position: absolute;
                    top: 0;
                    left: 0;
                    width: 100%;
                    height: 100%;
                    background: rgba(255, 255, 255, 0.8);
                    display: flex;
                    justify-content: center;
                    align-items: center;
                    z-index: 1000;
                `,$.innerHTML=`
                    <div class="spinner-border text-primary" role="status">
                        <span class="visually-hidden">Cargando...</span>
                    </div>
                `,C.style.position="relative",C.appendChild($)),$.style.display="flex",C.style.pointerEvents="none",C.style.opacity="0.7"}const N={year_from:e.value,year_to:t.value,areas:Array.from(ce),institutions:Array.from(se),types:Array.from(he),page:y},D=new URLSearchParams;return N.year_from&&D.append("year_from",N.year_from),N.year_to&&D.append("year_to",N.year_to),N.areas.forEach($=>D.append("areas",$)),N.institutions.forEach($=>D.append("institutions",$)),N.types.forEach($=>D.append("types",$)),D.append("page",N.page),ee&&D.append("author",ee),De.metric&&(D.append("sort_by",De.metric),D.append("sort_order",De.direction)),fetch(`/api/dashboard/publications/?${D.toString()}`).then($=>{if(!$.ok)throw new Error("Network response was not ok");return $.json()}).then($=>{if(!L||!S)return Promise.reject("Required elements not found");const{data:X,pagination:J}=$.publications,Q=[{key:"Dimensions Citations",label:"Dimensions Citations"},{key:"WoS Citations",label:"WoS Citations"},{key:"Scopus Citations",label:"Scopus Citations"},{key:"FCR",label:"FCR"},{key:"RCR",label:"RCR"},{key:"International Collaboration",label:"International Collaboration"}],K=document.createElement("thead");if(K.innerHTML=`
                    <tr>
                        <th style="max-width: 300px;">Título</th>
                        ${Q.map(({key:q,label:M})=>`
                            <th class="sortable" data-metric="${q}">
                                ${M}
                                <i class="fas fa-sort${De.metric===q?`-${De.direction==="desc"?"down":"up"}`:""} ms-1"></i>
                            </th>
                        `).join("")}
                    </tr>
                `,C){const q=C.querySelector("thead");q&&q.remove(),C.insertBefore(K,L)}K.querySelectorAll(".sortable").forEach(q=>{q.addEventListener("click",function(){const M=this.dataset.metric,z=this.querySelector("i");K.querySelectorAll(".sortable i").forEach(T=>{T.className="fas fa-sort ms-1"}),De.metric===M?De.direction=De.direction==="desc"?"asc":"desc":(De.metric=M,De.direction="desc"),z.className=`fas fa-sort-${De.direction==="desc"?"down":"up"} ms-1`,Hn(1)})});function U(q){L.innerHTML=q.map(M=>`
                        <tr class="publication-row" data-publication-id="${M.id}" style="cursor: pointer;">
                            <td style="max-width: 300px; overflow: hidden; text-overflow: ellipsis; white-space: nowrap;">${M.title}</td>
                            ${Q.map(({key:z})=>{const T=M.metrics[z];return`<td>${T&&T.value!==null?T.value:""}</td>`}).join("")}
                            <td>${M.international_collab!==null?M.international_collab:"-"}</td>
                        </tr>
                    `).join(""),L.querySelectorAll(".publication-row").forEach(M=>{M.addEventListener("click",function(){const z=this.dataset.publicationId;z&&(window.location.href=`/publication/${z}/`)})})}if(U(X),J.total_pages>1){let q=`
                        <li class="page-item ${J.current_page===1?"disabled":""}">
                            <a class="page-link" href="#" data-page="1">&laquo;</a>
                        </li>
                        <li class="page-item ${J.current_page===1?"disabled":""}">
                            <a class="page-link" href="#" data-page="${J.current_page-1}">&lt;</a>
                        </li>
                    `;const M=Math.max(1,J.current_page-2),z=Math.min(J.total_pages,J.current_page+2);for(let T=M;T<=z;T++)q+=`
                            <li class="page-item ${T===J.current_page?"active":""}">
                                <a class="page-link" href="#" data-page="${T}">${T}</a>
                            </li>
                        `;q+=`
                        <li class="page-item ${J.current_page===J.total_pages?"disabled":""}">
                            <a class="page-link" href="#" data-page="${J.current_page+1}">&gt;</a>
                        </li>
                        <li class="page-item ${J.current_page===J.total_pages?"disabled":""}">
                            <a class="page-link" href="#" data-page="${J.total_pages}">&raquo;</a>
                        </li>
                    `,S.innerHTML=q}else S.innerHTML="";if(S.querySelectorAll(".page-link").forEach(q=>{q.addEventListener("click",function(M){M.preventDefault();const z=parseInt(this.dataset.page);isNaN(z)||Hn(z)})}),C){const q=C.querySelector(".loading-overlay");q&&(q.style.display="none"),C.style.pointerEvents="auto",C.style.opacity="1"}return Promise.resolve()}).catch($=>{if(console.error("Error updating publications table:",$),C){const X=C.querySelector(".loading-overlay");X&&(X.style.display="none"),C.style.pointerEvents="auto",C.style.opacity="1"}return Promise.reject($)})}function Na(y,L,S){$e("#timelineChart").html("");const C={top:20,right:20,bottom:70,left:60},N=document.getElementById("timelineChart").clientWidth-C.left-C.right,D=300-C.top-C.bottom,$=$e("#timelineChart").append("svg").attr("width",N+C.left+C.right).attr("height",D+C.top+C.bottom).style("display","block").style("margin","0 auto").append("g").attr("transform",`translate(${C.left},${C.top})`);let X;L==="monthly"?X=Wt().domain([1,12]).range([0,N]):X=Wt().domain(Ua(y,T=>T.year)).range([0,N]);const J=Wt().domain([0,nr(y,T=>T.count)]).nice().range([D,0]);let Q;L==="monthly"?Q=jn(X).ticks(12).tickFormat(T=>["Ene","Feb","Mar","Abr","May","Jun","Jul","Ago","Sep","Oct","Nov","Dic"][T-1]):Q=jn(X).ticks(N/80).tickFormat(Fi("d"));const K=rr(J).ticks(D/40);$.append("g").attr("transform",`translate(0,${D})`).call(Q).selectAll("text").style("text-anchor","middle"),$.append("g").call(K);const U=Wo().x(T=>X(L==="monthly"?T.month:T.year)).y(T=>J(T.count)).curve(Dr),q=rd().x(T=>X(L==="monthly"?T.month:T.year)).y0(D).y1(T=>J(T.count)).curve(Dr);$.append("path").datum(y).attr("fill","#e3f2fd").attr("d",q),$.append("path").datum(y).attr("fill","none").attr("stroke","#2196f3").attr("stroke-width",2).attr("d",U);const M=document.createElement("div");M.className="tooltip",M.style.opacity=0,M.style.position="absolute",M.style.backgroundColor="rgba(255,255,255,0.95)",M.style.border="1px solid #2196f3",M.style.borderRadius="4px",M.style.padding="6px 10px",M.style.fontSize="13px",M.style.pointerEvents="none",M.style.zIndex="1000",M.style.boxShadow="0 2px 4px rgba(0,0,0,0.1)",document.body.appendChild(M);const z=document.createElement("div");if(z.className="info-box",z.style.display="none",z.style.position="absolute",z.style.backgroundColor="white",z.style.border="2px solid #2196f3",z.style.borderRadius="6px",z.style.padding="10px 15px",z.style.fontSize="14px",z.style.zIndex="1000",z.style.boxShadow="0 4px 8px rgba(0,0,0,0.1)",z.style.pointerEvents="none",document.body.appendChild(z),$.selectAll(".point").data(y).enter().append("circle").attr("class","point").attr("cx",T=>X(L==="monthly"?T.month:T.year)).attr("cy",T=>J(T.count)).attr("r",5).attr("fill","#2196f3").attr("stroke","#fff").attr("stroke-width",2).style("cursor","pointer").on("mouseover",function(T,Z){$e(this).attr("r",7).attr("fill","#1976d2"),M.style.opacity=1;let j;L==="monthly"?j=`<b>${["Enero","Febrero","Marzo","Abril","Mayo","Junio","Julio","Agosto","Septiembre","Octubre","Noviembre","Diciembre"][Z.month-1]}</b><br><b>Publicaciones:</b> ${Z.count}`:j=`<b>Año:</b> ${Z.year}<br><b>Publicaciones:</b> ${Z.count}`,M.innerHTML=j,M.style.left=`${T.pageX+10}px`,M.style.top=`${T.pageY+10}px`}).on("mouseout",function(){$e(this).attr("r",5).attr("fill","#2196f3"),M.style.opacity=0}).on("click",function(T,Z){T.stopPropagation(),He(".info-box").style("display","none");const j=document.getElementById("timelineChart").getBoundingClientRect(),ne=T.clientX-j.left,pe=T.clientY-j.top,oe=120,_e=60;let Ae=ne,ut=pe-_e-10;Ae+oe/2>j.width?Ae=j.width-oe/2:Ae-oe/2<0&&(Ae=oe/2),ut<0&&(ut=pe+10);let lt;L==="monthly"?lt=`
                        <div style="font-weight: bold; margin-bottom: 5px;">${["Enero","Febrero","Marzo","Abril","Mayo","Junio","Julio","Agosto","Septiembre","Octubre","Noviembre","Diciembre"][Z.month-1]}</div>
                        <div>Publicaciones: ${Z.count}</div>
                    `:lt=`
                        <div style="font-weight: bold; margin-bottom: 5px;">Año ${Z.year}</div>
                        <div>Publicaciones: ${Z.count}</div>
                    `,z.innerHTML=lt,z.style.display="block",z.style.left=`${Ae-oe/2}px`,z.style.top=`${ut}px`}),$.on("click",function(T){T.target.classList.contains("point")||He(".info-box").style("display","none")}),document.addEventListener("click",function(T){T.target.closest("#timelineChart")||He(".info-box").style("display","none")}),document.getElementById("timelineChart").addEventListener("click",function(T){T.target.closest(".point")||He(".info-box").style("display","none")}),$.append("text").attr("transform","rotate(-90)").attr("y",0-C.left+20).attr("x",0-D/2).attr("dy","1em").style("text-anchor","middle").style("font-size","12px").text("Número de publicaciones"),$.append("text").attr("transform",`translate(${N/2}, ${D+C.bottom-30})`).attr("dy","1em").style("text-anchor","middle").style("font-size","12px").text(L==="monthly"?"Mes":"Año"),L==="monthly"&&S&&S.no_month_count>0){const T=$e("#timelineChart").append("div").attr("class","alert alert-info").style("position","absolute").style("top","50px").style("right","10px").style("padding","8px 12px").style("font-size","12px").style("border-radius","4px").style("background-color","#e3f2fd").style("border","1px solid #2196f3").style("color","#0d47a1").style("z-index","1000").style("display","flex").style("align-items","center").style("gap","8px").style("max-width","300px");(S.no_month_count/S.total_count*100).toFixed(1),T.html(`
                <div style="flex-grow: 1;">
                    <i class="fas fa-info-circle"></i>
                    ${S.no_month_count} publicación(es) sin mes asignado 
                    se han contabilizado en enero
                </div>
                <button type="button" class="btn-close" style="font-size: 0.7rem;" aria-label="Close"></button>
            `),T.select(".btn-close").on("click",function(){T.remove()})}}function Ma(y){y=y.filter(M=>M.thematic_areas__name!==null);const L=14;if(y.length>L){const M=y.slice().sort((j,ne)=>ne.count-j.count),z=M.slice(0,L);y=[{thematic_areas__name:"Otras",count:M.slice(L).reduce((j,ne)=>j+ne.count,0)},...z]}$e("#areasChart").html("");const S={top:20,right:150,bottom:20,left:20},C=document.getElementById("areasChart").clientWidth-S.left-S.right,N=320-S.top-S.bottom,D=Math.min(C,N)/2,$=$e("#areasChart").append("svg").attr("width",C+S.left+S.right).attr("height",N+S.top+S.bottom).style("display","block").style("margin","0 auto").append("g").attr("transform",`translate(${D+S.left},${N/2+S.top})`),X=Vt().domain(y.map(M=>M.thematic_areas__name)).range(Ar),J=sd().value(M=>M.count).sort(null),Q=id().innerRadius(0).outerRadius(D),K=$e("#areasChart").append("div").attr("class","info-box").style("display","none").style("position","absolute").style("background-color","white").style("border","2px solid #2196f3").style("border-radius","6px").style("padding","10px 15px").style("font-size","14px").style("z-index","1000").style("box-shadow","0 4px 8px rgba(0,0,0,0.1)").style("pointer-events","none");$.selectAll("path").data(J(y)).enter().append("path").attr("d",Q).attr("fill",M=>X(M.data.thematic_areas__name)).attr("stroke","white").style("stroke-width","2px").style("cursor","pointer").on("click",function(M,z){M.stopPropagation(),He(".info-box").style("display","none");const T=document.getElementById("areasChart").getBoundingClientRect(),Z=M.clientX-T.left,j=M.clientY-T.top,ne=180,pe=70;let oe=Z,_e=j-pe-10;oe+ne/2>T.width?oe=T.width-ne/2:oe-ne/2<0&&(oe=ne/2),_e<0&&(_e=j+10);const Ae=(z.data.count/Wn(y,nn=>nn.count)*100).toFixed(1),ut=`
                    <div style="font-weight: bold; margin-bottom: 5px;">${z.data.thematic_areas__name}</div>
                    <div>Publicaciones: ${z.data.count}</div>
                    <div>Porcentaje: ${Ae}%</div>
                `,lt=X(z.data.thematic_areas__name);K.html(ut).style("display","block").style("left",oe-ne/2+"px").style("top",_e+"px").style("border",`2px solid ${lt}`)});const q=$.append("g").attr("transform",`translate(${D+20}, ${-280/2})`).selectAll(".legend-item").data(y).enter().append("g").attr("class","legend-item").attr("transform",(M,z)=>`translate(0, ${z*20})`);q.append("rect").attr("width",15).attr("height",15).attr("fill",M=>X(M.thematic_areas__name)),q.append("text").attr("x",20).attr("y",12).style("font-size","10px").text(M=>{const z=M.thematic_areas__name,T=(M.count/Wn(y,Z=>Z.count)*100).toFixed(1);return`${z} (${M.count} pubs, ${T}%)`}),document.getElementById("areasChart").addEventListener("click",function(M){M.target.closest("path")||He(".info-box").style("display","none")}),document.addEventListener("click",function(M){M.target.closest("#areasChart")||He(".info-box").style("display","none")})}function Da(y){y=y.filter(K=>K.thematic_areas__name!==null);const L=25;if(y.length>L){const K=y.slice().sort((z,T)=>T.count-z.count),U=K.slice(0,L),M=K.slice(L).reduce((z,T)=>z+T.count,0);y=[...U,{thematic_areas__name:"Otras",count:M}]}$e("#areasChart").html("");const S={top:20,right:20,bottom:30,left:60},C=document.getElementById("areasChart").clientWidth-S.left-S.right,N=300-S.top-S.bottom,D=$e("#areasChart").append("svg").attr("width",C+S.left+S.right).attr("height",N+S.top+S.bottom).style("display","block").style("margin","0 auto").append("g").attr("transform",`translate(${S.left},${S.top})`),$=zo().domain(y.map(K=>K.thematic_areas__name)).range([0,C]).padding(.2),X=Wt().domain([0,nr(y,K=>K.count)]).nice().range([N,0]);D.append("g").attr("transform",`translate(0,${N})`).call(jn($).tickFormat("")),D.append("g").call(rr(X).ticks(N/40));const J=Vt().domain(y.map(K=>K.thematic_areas__name)).range(Ar),Q=$e("#areasChart").append("div").attr("class","info-box").style("display","none").style("position","absolute").style("background-color","white").style("border","2px solid #2196f3").style("border-radius","6px").style("padding","10px 15px").style("font-size","14px").style("z-index","1000").style("box-shadow","0 4px 8px rgba(0,0,0,0.1)").style("pointer-events","none");D.selectAll(".bar").data(y).enter().append("rect").attr("class","bar").attr("x",K=>$(K.thematic_areas__name)).attr("y",K=>X(K.count)).attr("width",$.bandwidth()).attr("height",K=>N-X(K.count)).attr("fill",K=>J(K.thematic_areas__name)).style("cursor","pointer").on("click",function(K,U){K.stopPropagation(),He(".info-box").style("display","none");const q=document.getElementById("areasChart").getBoundingClientRect(),M=K.clientX-q.left,z=K.clientY-q.top,T=180,Z=70;let j=M,ne=z-Z-10;j+T/2>q.width?j=q.width-T/2:j-T/2<0&&(j=T/2),ne<0&&(ne=z+10);const pe=(U.count/Wn(y,Ae=>Ae.count)*100).toFixed(1),oe=`
                    <div style="font-weight: bold; margin-bottom: 5px;">${U.thematic_areas__name}</div>
                    <div>Publicaciones: ${U.count}</div>
                    <div>Porcentaje: ${pe}%</div>
                `,_e=J(U.thematic_areas__name);Q.html(oe).style("display","block").style("left",j-T/2+"px").style("top",ne+"px").style("border",`2px solid ${_e}`)}),document.getElementById("areasChart").addEventListener("click",function(K){K.target.closest("rect")||He(".info-box").style("display","none")}),document.addEventListener("click",function(K){K.target.closest("#areasChart")||He(".info-box").style("display","none")}),D.append("text").attr("transform","rotate(-90)").attr("y",-40).attr("x",-250/2).attr("dy","1em").style("text-anchor","middle").style("font-size","12px").text("Número de publicaciones"),D.append("text").attr("transform",`translate(${C/2}, ${N+S.bottom-20})`).attr("dy","1em").style("text-anchor","middle").style("font-size","12px").text("Áreas temáticas")}document.querySelectorAll("[data-view]").forEach(y=>{y.addEventListener("click",function(){this.disabled||(document.querySelectorAll("[data-view]").forEach(L=>L.classList.remove("active")),this.classList.add("active"),it())})}),e.addEventListener("change",rt),t.addEventListener("change",rt),n.addEventListener("change",()=>{const y=n.value;y&&!ce.has(y)&&(ce.add(y),tt(y,a,ce),rt()),n.value=""}),i.addEventListener("change",()=>{const y=i.value;y&&!se.has(y)&&(se.add(y),tt(y,s,se),rt()),i.value=""}),r.addEventListener("change",()=>{const y=r.value;y&&!he.has(y)&&(he.add(y),tt(y,u,he),rt()),r.value=""}),o.addEventListener("click",()=>{e.value="",t.value="",ce.clear(),se.clear(),he.clear(),a.innerHTML="",s.innerHTML="",u.innerHTML="",rt()});let Te=null,vt=!1;const en=document.getElementById("toggleLabelsBtn"),Dt=window.location.pathname.split("/")[1],$a=Dt==="es"?"Ocultar etiquetas extra":"Hide Extra Labels",Ga=Dt==="es"?"Mostrar etiquetas":"Show All Labels";en&&en.addEventListener("click",()=>{Te&&(vt=!vt,vt?(Te.setSettings({labelDensity:1/0,labelGridCellSize:1,labelRenderedSizeThreshold:0}),en.textContent=`${$a}`):(Te.setSettings({labelDensity:1,labelGridCellSize:200,labelRenderedSizeThreshold:0}),en.textContent=`${Ga}`),Te.refresh())});let ue="modularity-7",Xi=null,Ki=null;document.querySelectorAll(".dropdown-item.network-community-view").forEach(y=>{y.addEventListener("click",function(L){L.preventDefault();const S=this.dataset.communityView;if(ue===S){document.querySelectorAll(".dropdown-item.network-community-view").forEach(C=>{C.classList.remove("active")}),this.classList.add("active");return}ue=S,document.querySelectorAll(".dropdown-item.network-community-view").forEach(C=>{C.classList.remove("active")}),this.classList.add("active"),tn(),it()})});function Zi(y){const L=document.getElementById("collaborationNetwork");if(!L)return;const S=document.querySelector("#collaborationNetwork").closest(".card").querySelector(".card-title"),C=window.location.pathname.split("/")[1];if(y.is_author_view){const U=y.nodes.find(q=>q.is_selected);U&&(S.textContent=C==="es"?`Colaboraciones de ${U.label}`:`Collaborations of ${U.label}`),document.querySelector("#communityViewDropdown").closest(".dropdown").style.display="none"}else document.querySelector("#communityViewDropdown").closest(".dropdown").style.display="block",tn(y.model||null,y.n_clusters||null),ue==="keywords"?S.textContent=C==="es"?"Red de coincidencia de palabras clave (entre IPs)":"Keyword Coincidence Network (between IPs)":S.textContent=C==="es"?"Red de Coautorías Interactiva entre IPs":"Interactive Co-authorship network between IPs";Te&&(Te.kill(),Te=null),L.innerHTML="";const N=new ae,D=["#e6194b","#3cb44b","#ffe119","#4363d8","#f58231","#911eb4","#42d4f4","#f032e6","#bfef45","#fabed4","#469990","#dcbeff","#9a6324","#fffac8","#800000","#aaffc3","#808000","#ffd8b1","#000075","#a9a9a9","#000000","#6a3d9a","#b15928","#1f78b4"],$=U=>U===-1||isNaN(U)?"#A9A9A9":D[U%D.length],X=Vt().domain(["Departamento 1","Departamento 2","Departamento 3","Unknown"]).range(["#1f78b4","#ff7f0e","#2ca02c","#999999"]);if(y.is_author_view){const U=L.clientWidth/2,q=L.clientHeight/2,M=250,z=y.nodes.find(j=>j.is_selected);if(!z)return;z.x=U,z.y=q;const T=y.nodes.filter(j=>!j.is_selected),Z=2*Math.PI/Math.max(T.length,1);T.forEach((j,ne)=>{const pe=ne*Z;j.x=U+M*Math.cos(pe),j.y=q+M*Math.sin(pe)})}else{let U;ue==="department"?U="department":ue==="modularity-5"?U="leiden_community":U="community";const q=[...new Set(y.nodes.map(oe=>oe[U]))].filter(oe=>oe!==void 0),M=q.indexOf(-1);M>-1&&(q.splice(M,1),q.push(-1));const z={};q.forEach(oe=>{z[oe]=y.nodes.filter(_e=>_e[U]===oe)});const T=L.clientWidth/2,Z=L.clientHeight/2,j=q.length,ne=Math.min(T,Z)*.8,pe=ne/Math.sqrt(j)*.5;q.forEach((oe,_e)=>{const Ae=z[oe],ut=2*Math.PI/Math.max(Ae.length,5),lt=T+ne*Math.cos(2*Math.PI*_e/j),nn=Z+ne*Math.sin(2*Math.PI*_e/j);Ae.forEach((Ji,Pa)=>{const Qi=Pa*ut;Ji.x=lt+pe*Math.cos(Qi),Ji.y=nn+pe*Math.sin(Qi)})})}if(y.nodes.forEach(U=>{const q=parseInt(U.community),M=parseInt(U.leiden_community),z=U.department,T=y.is_author_view?U.is_selected?"#e6194b":"#bbbbbb":ue==="department"?X(z):$(ue==="modularity-5"?M:q);N.addNode(U.id,{label:U.label,x:U.x,y:U.y,size:U.is_selected?18:12,color:T,highlighted:U.is_selected,forceLabel:vt})}),y.edges.forEach(U=>{if(N.hasNode(U.source)&&N.hasNode(U.target)){const q=U.weight||1,M=Math.pow(q,.7),z=Math.min(4,Math.max(1.5,M)),Z=`rgba(3, 138, 255, ${Math.min(.9,.5+.05*q).toFixed(2)})`;N.addEdge(U.source,U.target,{size:z,color:Z,type:"curve"})}}),Te=new Uf(N,L,{minCameraRatio:.1,maxCameraRatio:10,defaultEdgeType:"curve",edgeProgramClasses:{curve:og},renderLabels:!0,labelDensity:1,labelGridCellSize:300,labelRenderedSizeThreshold:0,defaultLabelSize:8,zIndex:!0,enableEdgeHovering:!1,enableNodeHovering:!1,enableCamera:!1}),!y.is_author_view){const U=document.createElement("div");U.id="networkLegend",Object.assign(U.style,{position:"absolute",bottom:"10px",left:"10px",backgroundColor:"rgba(255,255,255,0.95)",border:"1px solid #ccc",borderRadius:"8px",padding:"12px",fontSize:"13px",zIndex:1e3,boxShadow:"0px 0px 6px rgba(0,0,0,0.1)"});const q=document.createElement("div");if(q.style.fontWeight="bold",q.style.marginBottom="6px",ue==="department")q.textContent=C==="es"?"Departamentos":"Departments";else if(ue==="keywords")q.textContent=C==="es"?"Comunidades de Palabras Clave":"Keyword Communities";else if(ue==="modularity-5"||ue==="modularity-7"){const z=ue==="modularity-7"?7:5;q.textContent=C==="es"?`Comunidades de Modularidad (${z})`:`Modularity Communities (${z})`}U.appendChild(q);const M=document.createElement("div");if(M.style.marginBottom="8px",M.textContent=`${y.nodes.length} nodos / ${y.edges.length} enlaces`,U.appendChild(M),ue==="department")[...new Set(y.nodes.map(T=>T.department))].filter(T=>T!=="Unknown").forEach(T=>{const Z=document.createElement("div");Z.style.display="flex",Z.style.alignItems="center",Z.style.marginBottom="4px";const j=document.createElement("div");Object.assign(j.style,{width:"14px",height:"14px",backgroundColor:X(T),marginRight:"6px",borderRadius:"3px",border:"1px solid #333"});const ne=document.createElement("span");ne.textContent=T,Z.appendChild(j),Z.appendChild(ne),U.appendChild(Z)});else{let z=[];ue==="keywords"?z=[...new Set(y.nodes.map(T=>parseInt(T.community)))]:ue==="modularity-5"?z=[...new Set(y.nodes.map(T=>parseInt(T.leiden_community)))]:ue==="modularity-7"&&(z=[...new Set(y.nodes.map(T=>parseInt(T.community)))]),z.sort((T,Z)=>T-Z),z.forEach((T,Z)=>{const j=document.createElement("div");j.style.display="flex",j.style.alignItems="center",j.style.marginBottom="4px";const ne=document.createElement("div");Object.assign(ne.style,{width:"14px",height:"14px",backgroundColor:$(T),marginRight:"6px",borderRadius:"3px"});const pe=document.createElement("span");if(T===-1||isNaN(T))pe.textContent="Outlier";else{const oe=ue==="modularity-7"?Z+1:T+1,_e=C==="es"?"Comunidad":"Community";pe.textContent=`${_e} ${oe}`}j.appendChild(ne),j.appendChild(pe),U.appendChild(j)})}L.appendChild(U)}const J=document.createElement("div");J.innerText="Haz click para activar la red",Object.assign(J.style,{position:"absolute",top:0,left:0,width:"100%",height:"100%",backgroundColor:"rgba(255,255,255,0.85)",display:"flex",alignItems:"center",justifyContent:"center",fontSize:"24px",fontWeight:"bold",color:"#333",cursor:"pointer",zIndex:1e3,borderRadius:getComputedStyle(L).borderRadius}),L.appendChild(J),J.addEventListener("click",()=>{J.remove(),K()});const Q=document.createElement("div");Object.assign(Q.style,{position:"absolute",backgroundColor:"#fff",border:"1px solid #aaa",padding:"4px 8px",fontSize:"12px",borderRadius:"4px",pointerEvents:"none",display:"none",zIndex:1e3}),document.body.appendChild(Q);const K=()=>{Te.setSettings({enableEdgeHovering:!0,enableNodeHovering:!0,enableCamera:!0}),Te.on("enterNode",({node:U,event:q})=>{const M=N.getNodeAttribute(U,"label"),z=N.neighbors(U),T=[];z.forEach(j=>{const ne=N.edge(U,j)||N.edge(j,U),pe=N.getEdgeAttribute(ne,"size")||1,oe=N.getNodeAttribute(j,"label");T.push(`• ${oe} (${pe})`)}),Q.innerText=`${M}
Colabora con:
${T.join(`
`)}`,Q.style.left=`${q.clientX+10}px`,Q.style.top=`${q.clientY+10}px`,Q.style.display="block";const Z=new Set(z);Z.add(U),N.forEachNode(j=>{N.setNodeAttribute(j,"hidden",!Z.has(j)),N.setNodeAttribute(j,"forceLabel",vt||Z.has(j))}),N.forEachEdge(j=>{const ne=N.source(j),pe=N.target(j),oe=Z.has(ne)&&Z.has(pe);N.setEdgeAttribute(j,"hidden",!oe)})}),Te.on("leaveNode",()=>{Q.style.display="none",N.forEachNode(U=>{N.removeNodeAttribute(U,"hidden"),N.setNodeAttribute(U,"forceLabel",vt)}),N.forEachEdge(U=>N.removeEdgeAttribute(U,"hidden"))})};Te.getCamera().animatedReset({duration:500})}document.getElementById("applyClustering").addEventListener("click",()=>{const y=document.querySelector('input[name="configMode"]:checked').value,L=document.getElementById("clusteringModel").value,S=document.querySelector('input[name="modelConfigMode"]:checked').value;let C=document.getElementById("nClusters").value;L==="dbscan"?C=document.getElementById("dbscanClusters").value:L==="hdbscan"?C=document.getElementById("hdbscanClusters").value:L==="lovaina"&&(C=document.getElementById("lovainaClusters").value),ue="keywords",Xi=L,Ki=C;const N=new URLSearchParams({communityView:"keywords",clusteringModel:L,nClusters:C,autoMode:S==="auto",globalMode:y==="global"});fetch(`/api/dashboard/collaboration-network/?${N.toString()}`).then(D=>D.json()).then(D=>{if(D.error){console.error("Error desde backend:",D.error),alert(`Ocurrió un error al generar la red: ${D.error}`);return}if(!D.nodes||!D.edges){console.error("Respuesta incompleta del backend:",D),alert("La respuesta del servidor no contiene datos de red válidos.");return}window.currentNetworkData=D,tn(L,C),Zi(D),document.activeElement.blur(),bootstrap.Modal.getInstance(document.getElementById("clusteringModal")).hide()}).catch(D=>{console.error("Error en la petición fetch:",D)})});function tn(y=null,L=null){const S=document.getElementById("communityViewDropdown");if(!S)return;const C=window.location.pathname.split("/")[1];let N="";if(ue==="department")N=C==="es"?"Por departamento":"By Department";else if(ue==="modularity-7")N=C==="es"?"Mejor modularidad (7 comunidades)":"Best Modularity (7 communities)";else if(ue==="modularity-5")N=C==="es"?"Mejor modularidad (5 comunidades)":"Best Modularity (5 communities)";else if(ue==="keywords"){const D=y||Xi,$=L||Ki;D&&$?N=C==="es"?`Por palabras clave (${D}, ${$} clústeres)`:`By keywords (${D}, ${$} clusters)`:N=C==="es"?"Por palabras clave":"By keywords"}else N=C==="es"?"Vista de Comunidades":"Community View";S.textContent=N}function rt(){const y=new URLSearchParams;e.value&&y.append("year_from",e.value),t.value&&y.append("year_to",t.value),ce.forEach(D=>y.append("areas",D)),se.forEach(D=>y.append("institutions",D)),he.forEach(D=>y.append("types",D)),ee&&y.append("author",ee);const L=window.location.pathname.split("/")[1],S=L==="es"?"Todas las Áreas":"All areas",C=L==="es"?"Todas las Instituciones":"All Institutions",N=L==="es"?"Todos los tipos":"All types";fetch(`/api/dashboard/filters/?${y.toString()}`).then(D=>{if(!D.ok)throw new Error(`HTTP error! status: ${D.status}`);return D.json()}).then(D=>{n.innerHTML=`<option value="">${S}</option>`,D.areas.forEach($=>{const X=document.createElement("option");X.value=$.name,X.textContent=`${$.name} (${$.count})`,n.appendChild(X)}),i.innerHTML=`<option value="">${C}</option>`,D.institutions.forEach($=>{const X=document.createElement("option");X.value=$.name,X.textContent=`${$.name} (${$.count})`,i.appendChild(X)}),r.innerHTML=`<option value="">${N}</option>`,D.publication_types.forEach($=>{const X=document.createElement("option");X.value=$.publication_type,X.textContent=`${$.publication_type} (${$.count})`,r.appendChild(X)})}).catch(D=>{console.error("Error updating filters:",D);const $=document.createElement("div");$.className="alert alert-danger",$.style.position="fixed",$.style.top="20px",$.style.right="20px",$.style.zIndex="9999",$.innerHTML=`
                    <strong>Error:</strong> No se pudieron actualizar los filtros.
                    <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
                `,document.body.appendChild($),setTimeout(()=>{$.remove()},5e3)}),it()}}document.addEventListener("DOMContentLoaded",()=>{ag()});
