function fn(e,t){return e==null||t==null?NaN:e<t?-1:e>t?1:e>=t?0:NaN}function Da(e,t){return e==null||t==null?NaN:t<e?-1:t>e?1:t>=e?0:NaN}function io(e){let t,n,i;e.length!==2?(t=fn,n=(s,u)=>fn(e(s),u),i=(s,u)=>e(s)-u):(t=e===fn||e===Da?e:$a,n=e,i=e);function r(s,u,l=0,c=s.length){if(l<c){if(t(u,u)!==0)return c;do{const d=l+c>>>1;n(s[d],u)<0?l=d+1:c=d}while(l<c)}return l}function o(s,u,l=0,c=s.length){if(l<c){if(t(u,u)!==0)return c;do{const d=l+c>>>1;n(s[d],u)<=0?l=d+1:c=d}while(l<c)}return l}function a(s,u,l=0,c=s.length){const d=r(s,u,l,c-1);return d>l&&i(s[d-1],u)>-i(s[d],u)?d-1:d}return{left:r,center:a,right:o}}function $a(){return 0}function Ga(e){return e===null?NaN:+e}const Pa=io(fn),Fa=Pa.right;io(Ga).center;function Ia(e,t){let n,i;if(t===void 0)for(const r of e)r!=null&&(n===void 0?r>=r&&(n=i=r):(n>r&&(n=r),i<r&&(i=r)));else{let r=-1;for(let o of e)(o=t(o,++r,e))!=null&&(n===void 0?o>=o&&(n=i=o):(n>o&&(n=o),i<o&&(i=o)))}return[n,i]}class Ki extends Map{constructor(t,n=Ba){if(super(),Object.defineProperties(this,{_intern:{value:new Map},_key:{value:n}}),t!=null)for(const[i,r]of t)this.set(i,r)}get(t){return super.get(Zi(this,t))}has(t){return super.has(Zi(this,t))}set(t,n){return super.set(za(this,t),n)}delete(t){return super.delete(Oa(this,t))}}function Zi({_intern:e,_key:t},n){const i=t(n);return e.has(i)?e.get(i):n}function za({_intern:e,_key:t},n){const i=t(n);return e.has(i)?e.get(i):(e.set(i,n),n)}function Oa({_intern:e,_key:t},n){const i=t(n);return e.has(i)&&(n=e.get(i),e.delete(i)),n}function Ba(e){return e!==null&&typeof e=="object"?e.valueOf():e}const Ua=Math.sqrt(50),Ha=Math.sqrt(10),Wa=Math.sqrt(2);function bn(e,t,n){const i=(t-e)/Math.max(0,n),r=Math.floor(Math.log10(i)),o=i/Math.pow(10,r),a=o>=Ua?10:o>=Ha?5:o>=Wa?2:1;let s,u,l;return r<0?(l=Math.pow(10,-r)/a,s=Math.round(e*l),u=Math.round(t*l),s/l<e&&++s,u/l>t&&--u,l=-l):(l=Math.pow(10,r)*a,s=Math.round(e/l),u=Math.round(t/l),s*l<e&&++s,u*l>t&&--u),u<s&&.5<=n&&n<2?bn(e,t,n*2):[s,u,l]}function qa(e,t,n){if(t=+t,e=+e,n=+n,!(n>0))return[];if(e===t)return[e];const i=t<e,[r,o,a]=i?bn(t,e,n):bn(e,t,n);if(!(o>=r))return[];const s=o-r+1,u=new Array(s);if(i)if(a<0)for(let l=0;l<s;++l)u[l]=(o-l)/-a;else for(let l=0;l<s;++l)u[l]=(o-l)*a;else if(a<0)for(let l=0;l<s;++l)u[l]=(r+l)/-a;else for(let l=0;l<s;++l)u[l]=(r+l)*a;return u}function ui(e,t,n){return t=+t,e=+e,n=+n,bn(e,t,n)[2]}function Va(e,t,n){t=+t,e=+e,n=+n;const i=t<e,r=i?ui(t,e,n):ui(e,t,n);return(i?-1:1)*(r<0?1/-r:r)}function Ji(e,t){let n;if(t===void 0)for(const i of e)i!=null&&(n<i||n===void 0&&i>=i)&&(n=i);else{let i=-1;for(let r of e)(r=t(r,++i,e))!=null&&(n<r||n===void 0&&r>=r)&&(n=r)}return n}function ja(e,t,n){e=+e,t=+t,n=(r=arguments.length)<2?(t=e,e=0,1):r<3?1:+n;for(var i=-1,r=Math.max(0,Math.ceil((t-e)/n))|0,o=new Array(r);++i<r;)o[i]=e+i*n;return o}function Un(e,t){let n=0;if(t===void 0)for(let i of e)(i=+i)&&(n+=i);else{let i=-1;for(let r of e)(r=+t(r,++i,e))&&(n+=r)}return n}function Ya(e){return e}var Hn=1,Wn=2,li=3,Ot=4,Qi=1e-6;function Xa(e){return"translate("+e+",0)"}function Ka(e){return"translate(0,"+e+")"}function Za(e){return t=>+e(t)}function Ja(e,t){return t=Math.max(0,e.bandwidth()-t*2)/2,e.round()&&(t=Math.round(t)),n=>+e(n)+t}function Qa(){return!this.__axis}function ro(e,t){var n=[],i=null,r=null,o=6,a=6,s=3,u=typeof window<"u"&&window.devicePixelRatio>1?0:.5,l=e===Hn||e===Ot?-1:1,c=e===Ot||e===Wn?"x":"y",d=e===Hn||e===li?Xa:Ka;function h(f){var g=i??(t.ticks?t.ticks.apply(t,n):t.domain()),m=r??(t.tickFormat?t.tickFormat.apply(t,n):Ya),b=Math.max(o,0)+s,C=t.range(),_=+C[0]+u,x=+C[C.length-1]+u,p=(t.bandwidth?Ja:Za)(t.copy(),u),v=f.selection?f.selection():f,w=v.selectAll(".domain").data([null]),k=v.selectAll(".tick").data(g,t).order(),D=k.exit(),I=k.enter().append("g").attr("class","tick"),F=k.select("line"),R=k.select("text");w=w.merge(w.enter().insert("path",".tick").attr("class","domain").attr("stroke","currentColor")),k=k.merge(I),F=F.merge(I.append("line").attr("stroke","currentColor").attr(c+"2",l*o)),R=R.merge(I.append("text").attr("fill","currentColor").attr(c,l*b).attr("dy",e===Hn?"0em":e===li?"0.71em":"0.32em")),f!==v&&(w=w.transition(f),k=k.transition(f),F=F.transition(f),R=R.transition(f),D=D.transition(f).attr("opacity",Qi).attr("transform",function(H){return isFinite(H=p(H))?d(H+u):this.getAttribute("transform")}),I.attr("opacity",Qi).attr("transform",function(H){var $=this.parentNode.__axis;return d(($&&isFinite($=$(H))?$:p(H))+u)})),D.remove(),w.attr("d",e===Ot||e===Wn?a?"M"+l*a+","+_+"H"+u+"V"+x+"H"+l*a:"M"+u+","+_+"V"+x:a?"M"+_+","+l*a+"V"+u+"H"+x+"V"+l*a:"M"+_+","+u+"H"+x),k.attr("opacity",1).attr("transform",function(H){return d(p(H)+u)}),F.attr(c+"2",l*o),R.attr(c,l*b).text(m),v.filter(Qa).attr("fill","none").attr("font-size",10).attr("font-family","sans-serif").attr("text-anchor",e===Wn?"start":e===Ot?"end":"middle"),v.each(function(){this.__axis=p})}return h.scale=function(f){return arguments.length?(t=f,h):t},h.ticks=function(){return n=Array.from(arguments),h},h.tickArguments=function(f){return arguments.length?(n=f==null?[]:Array.from(f),h):n.slice()},h.tickValues=function(f){return arguments.length?(i=f==null?null:Array.from(f),h):i&&i.slice()},h.tickFormat=function(f){return arguments.length?(r=f,h):r},h.tickSize=function(f){return arguments.length?(o=a=+f,h):o},h.tickSizeInner=function(f){return arguments.length?(o=+f,h):o},h.tickSizeOuter=function(f){return arguments.length?(a=+f,h):a},h.tickPadding=function(f){return arguments.length?(s=+f,h):s},h.offset=function(f){return arguments.length?(u=+f,h):u},h}function qn(e){return ro(li,e)}function er(e){return ro(Ot,e)}var es={value:()=>{}};function oo(){for(var e=0,t=arguments.length,n={},i;e<t;++e){if(!(i=arguments[e]+"")||i in n||/[\s.]/.test(i))throw new Error("illegal type: "+i);n[i]=[]}return new gn(n)}function gn(e){this._=e}function ts(e,t){return e.trim().split(/^|\s+/).map(function(n){var i="",r=n.indexOf(".");if(r>=0&&(i=n.slice(r+1),n=n.slice(0,r)),n&&!t.hasOwnProperty(n))throw new Error("unknown type: "+n);return{type:n,name:i}})}gn.prototype=oo.prototype={constructor:gn,on:function(e,t){var n=this._,i=ts(e+"",n),r,o=-1,a=i.length;if(arguments.length<2){for(;++o<a;)if((r=(e=i[o]).type)&&(r=ns(n[r],e.name)))return r;return}if(t!=null&&typeof t!="function")throw new Error("invalid callback: "+t);for(;++o<a;)if(r=(e=i[o]).type)n[r]=tr(n[r],e.name,t);else if(t==null)for(r in n)n[r]=tr(n[r],e.name,null);return this},copy:function(){var e={},t=this._;for(var n in t)e[n]=t[n].slice();return new gn(e)},call:function(e,t){if((r=arguments.length-2)>0)for(var n=new Array(r),i=0,r,o;i<r;++i)n[i]=arguments[i+2];if(!this._.hasOwnProperty(e))throw new Error("unknown type: "+e);for(o=this._[e],i=0,r=o.length;i<r;++i)o[i].value.apply(t,n)},apply:function(e,t,n){if(!this._.hasOwnProperty(e))throw new Error("unknown type: "+e);for(var i=this._[e],r=0,o=i.length;r<o;++r)i[r].value.apply(t,n)}};function ns(e,t){for(var n=0,i=e.length,r;n<i;++n)if((r=e[n]).name===t)return r.value}function tr(e,t,n){for(var i=0,r=e.length;i<r;++i)if(e[i].name===t){e[i]=es,e=e.slice(0,i).concat(e.slice(i+1));break}return n!=null&&e.push({name:t,value:n}),e}var ci="http://www.w3.org/1999/xhtml";const nr={svg:"http://www.w3.org/2000/svg",xhtml:ci,xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/"};function Dn(e){var t=e+="",n=t.indexOf(":");return n>=0&&(t=e.slice(0,n))!=="xmlns"&&(e=e.slice(n+1)),nr.hasOwnProperty(t)?{space:nr[t],local:e}:e}function is(e){return function(){var t=this.ownerDocument,n=this.namespaceURI;return n===ci&&t.documentElement.namespaceURI===ci?t.createElement(e):t.createElementNS(n,e)}}function rs(e){return function(){return this.ownerDocument.createElementNS(e.space,e.local)}}function ao(e){var t=Dn(e);return(t.local?rs:is)(t)}function os(){}function Si(e){return e==null?os:function(){return this.querySelector(e)}}function as(e){typeof e!="function"&&(e=Si(e));for(var t=this._groups,n=t.length,i=new Array(n),r=0;r<n;++r)for(var o=t[r],a=o.length,s=i[r]=new Array(a),u,l,c=0;c<a;++c)(u=o[c])&&(l=e.call(u,u.__data__,c,o))&&("__data__"in u&&(l.__data__=u.__data__),s[c]=l);return new Ee(i,this._parents)}function ss(e){return e==null?[]:Array.isArray(e)?e:Array.from(e)}function us(){return[]}function so(e){return e==null?us:function(){return this.querySelectorAll(e)}}function ls(e){return function(){return ss(e.apply(this,arguments))}}function cs(e){typeof e=="function"?e=ls(e):e=so(e);for(var t=this._groups,n=t.length,i=[],r=[],o=0;o<n;++o)for(var a=t[o],s=a.length,u,l=0;l<s;++l)(u=a[l])&&(i.push(e.call(u,u.__data__,l,a)),r.push(u));return new Ee(i,r)}function uo(e){return function(){return this.matches(e)}}function lo(e){return function(t){return t.matches(e)}}var ds=Array.prototype.find;function hs(e){return function(){return ds.call(this.children,e)}}function fs(){return this.firstElementChild}function gs(e){return this.select(e==null?fs:hs(typeof e=="function"?e:lo(e)))}var ps=Array.prototype.filter;function ms(){return Array.from(this.children)}function vs(e){return function(){return ps.call(this.children,e)}}function ys(e){return this.selectAll(e==null?ms:vs(typeof e=="function"?e:lo(e)))}function bs(e){typeof e!="function"&&(e=uo(e));for(var t=this._groups,n=t.length,i=new Array(n),r=0;r<n;++r)for(var o=t[r],a=o.length,s=i[r]=[],u,l=0;l<a;++l)(u=o[l])&&e.call(u,u.__data__,l,o)&&s.push(u);return new Ee(i,this._parents)}function co(e){return new Array(e.length)}function ws(){return new Ee(this._enter||this._groups.map(co),this._parents)}function wn(e,t){this.ownerDocument=e.ownerDocument,this.namespaceURI=e.namespaceURI,this._next=null,this._parent=e,this.__data__=t}wn.prototype={constructor:wn,appendChild:function(e){return this._parent.insertBefore(e,this._next)},insertBefore:function(e,t){return this._parent.insertBefore(e,t)},querySelector:function(e){return this._parent.querySelector(e)},querySelectorAll:function(e){return this._parent.querySelectorAll(e)}};function _s(e){return function(){return e}}function xs(e,t,n,i,r,o){for(var a=0,s,u=t.length,l=o.length;a<l;++a)(s=t[a])?(s.__data__=o[a],i[a]=s):n[a]=new wn(e,o[a]);for(;a<u;++a)(s=t[a])&&(r[a]=s)}function Es(e,t,n,i,r,o,a){var s,u,l=new Map,c=t.length,d=o.length,h=new Array(c),f;for(s=0;s<c;++s)(u=t[s])&&(h[s]=f=a.call(u,u.__data__,s,t)+"",l.has(f)?r[s]=u:l.set(f,u));for(s=0;s<d;++s)f=a.call(e,o[s],s,o)+"",(u=l.get(f))?(i[s]=u,u.__data__=o[s],l.delete(f)):n[s]=new wn(e,o[s]);for(s=0;s<c;++s)(u=t[s])&&l.get(h[s])===u&&(r[s]=u)}function Cs(e){return e.__data__}function ks(e,t){if(!arguments.length)return Array.from(this,Cs);var n=t?Es:xs,i=this._parents,r=this._groups;typeof e!="function"&&(e=_s(e));for(var o=r.length,a=new Array(o),s=new Array(o),u=new Array(o),l=0;l<o;++l){var c=i[l],d=r[l],h=d.length,f=Ts(e.call(c,c&&c.__data__,l,i)),g=f.length,m=s[l]=new Array(g),b=a[l]=new Array(g),C=u[l]=new Array(h);n(c,d,m,b,C,f,t);for(var _=0,x=0,p,v;_<g;++_)if(p=m[_]){for(_>=x&&(x=_+1);!(v=b[x])&&++x<g;);p._next=v||null}}return a=new Ee(a,i),a._enter=s,a._exit=u,a}function Ts(e){return typeof e=="object"&&"length"in e?e:Array.from(e)}function Ss(){return new Ee(this._exit||this._groups.map(co),this._parents)}function As(e,t,n){var i=this.enter(),r=this,o=this.exit();return typeof e=="function"?(i=e(i),i&&(i=i.selection())):i=i.append(e+""),t!=null&&(r=t(r),r&&(r=r.selection())),n==null?o.remove():n(o),i&&r?i.merge(r).order():r}function Ls(e){for(var t=e.selection?e.selection():e,n=this._groups,i=t._groups,r=n.length,o=i.length,a=Math.min(r,o),s=new Array(r),u=0;u<a;++u)for(var l=n[u],c=i[u],d=l.length,h=s[u]=new Array(d),f,g=0;g<d;++g)(f=l[g]||c[g])&&(h[g]=f);for(;u<r;++u)s[u]=n[u];return new Ee(s,this._parents)}function Rs(){for(var e=this._groups,t=-1,n=e.length;++t<n;)for(var i=e[t],r=i.length-1,o=i[r],a;--r>=0;)(a=i[r])&&(o&&a.compareDocumentPosition(o)^4&&o.parentNode.insertBefore(a,o),o=a);return this}function Ns(e){e||(e=Ms);function t(d,h){return d&&h?e(d.__data__,h.__data__):!d-!h}for(var n=this._groups,i=n.length,r=new Array(i),o=0;o<i;++o){for(var a=n[o],s=a.length,u=r[o]=new Array(s),l,c=0;c<s;++c)(l=a[c])&&(u[c]=l);u.sort(t)}return new Ee(r,this._parents).order()}function Ms(e,t){return e<t?-1:e>t?1:e>=t?0:NaN}function Ds(){var e=arguments[0];return arguments[0]=this,e.apply(null,arguments),this}function $s(){return Array.from(this)}function Gs(){for(var e=this._groups,t=0,n=e.length;t<n;++t)for(var i=e[t],r=0,o=i.length;r<o;++r){var a=i[r];if(a)return a}return null}function Ps(){let e=0;for(const t of this)++e;return e}function Fs(){return!this.node()}function Is(e){for(var t=this._groups,n=0,i=t.length;n<i;++n)for(var r=t[n],o=0,a=r.length,s;o<a;++o)(s=r[o])&&e.call(s,s.__data__,o,r);return this}function zs(e){return function(){this.removeAttribute(e)}}function Os(e){return function(){this.removeAttributeNS(e.space,e.local)}}function Bs(e,t){return function(){this.setAttribute(e,t)}}function Us(e,t){return function(){this.setAttributeNS(e.space,e.local,t)}}function Hs(e,t){return function(){var n=t.apply(this,arguments);n==null?this.removeAttribute(e):this.setAttribute(e,n)}}function Ws(e,t){return function(){var n=t.apply(this,arguments);n==null?this.removeAttributeNS(e.space,e.local):this.setAttributeNS(e.space,e.local,n)}}function qs(e,t){var n=Dn(e);if(arguments.length<2){var i=this.node();return n.local?i.getAttributeNS(n.space,n.local):i.getAttribute(n)}return this.each((t==null?n.local?Os:zs:typeof t=="function"?n.local?Ws:Hs:n.local?Us:Bs)(n,t))}function ho(e){return e.ownerDocument&&e.ownerDocument.defaultView||e.document&&e||e.defaultView}function Vs(e){return function(){this.style.removeProperty(e)}}function js(e,t,n){return function(){this.style.setProperty(e,t,n)}}function Ys(e,t,n){return function(){var i=t.apply(this,arguments);i==null?this.style.removeProperty(e):this.style.setProperty(e,i,n)}}function Xs(e,t,n){return arguments.length>1?this.each((t==null?Vs:typeof t=="function"?Ys:js)(e,t,n??"")):Et(this.node(),e)}function Et(e,t){return e.style.getPropertyValue(t)||ho(e).getComputedStyle(e,null).getPropertyValue(t)}function Ks(e){return function(){delete this[e]}}function Zs(e,t){return function(){this[e]=t}}function Js(e,t){return function(){var n=t.apply(this,arguments);n==null?delete this[e]:this[e]=n}}function Qs(e,t){return arguments.length>1?this.each((t==null?Ks:typeof t=="function"?Js:Zs)(e,t)):this.node()[e]}function fo(e){return e.trim().split(/^|\s+/)}function Ai(e){return e.classList||new go(e)}function go(e){this._node=e,this._names=fo(e.getAttribute("class")||"")}go.prototype={add:function(e){var t=this._names.indexOf(e);t<0&&(this._names.push(e),this._node.setAttribute("class",this._names.join(" ")))},remove:function(e){var t=this._names.indexOf(e);t>=0&&(this._names.splice(t,1),this._node.setAttribute("class",this._names.join(" ")))},contains:function(e){return this._names.indexOf(e)>=0}};function po(e,t){for(var n=Ai(e),i=-1,r=t.length;++i<r;)n.add(t[i])}function mo(e,t){for(var n=Ai(e),i=-1,r=t.length;++i<r;)n.remove(t[i])}function eu(e){return function(){po(this,e)}}function tu(e){return function(){mo(this,e)}}function nu(e,t){return function(){(t.apply(this,arguments)?po:mo)(this,e)}}function iu(e,t){var n=fo(e+"");if(arguments.length<2){for(var i=Ai(this.node()),r=-1,o=n.length;++r<o;)if(!i.contains(n[r]))return!1;return!0}return this.each((typeof t=="function"?nu:t?eu:tu)(n,t))}function ru(){this.textContent=""}function ou(e){return function(){this.textContent=e}}function au(e){return function(){var t=e.apply(this,arguments);this.textContent=t??""}}function su(e){return arguments.length?this.each(e==null?ru:(typeof e=="function"?au:ou)(e)):this.node().textContent}function uu(){this.innerHTML=""}function lu(e){return function(){this.innerHTML=e}}function cu(e){return function(){var t=e.apply(this,arguments);this.innerHTML=t??""}}function du(e){return arguments.length?this.each(e==null?uu:(typeof e=="function"?cu:lu)(e)):this.node().innerHTML}function hu(){this.nextSibling&&this.parentNode.appendChild(this)}function fu(){return this.each(hu)}function gu(){this.previousSibling&&this.parentNode.insertBefore(this,this.parentNode.firstChild)}function pu(){return this.each(gu)}function mu(e){var t=typeof e=="function"?e:ao(e);return this.select(function(){return this.appendChild(t.apply(this,arguments))})}function vu(){return null}function yu(e,t){var n=typeof e=="function"?e:ao(e),i=t==null?vu:typeof t=="function"?t:Si(t);return this.select(function(){return this.insertBefore(n.apply(this,arguments),i.apply(this,arguments)||null)})}function bu(){var e=this.parentNode;e&&e.removeChild(this)}function wu(){return this.each(bu)}function _u(){var e=this.cloneNode(!1),t=this.parentNode;return t?t.insertBefore(e,this.nextSibling):e}function xu(){var e=this.cloneNode(!0),t=this.parentNode;return t?t.insertBefore(e,this.nextSibling):e}function Eu(e){return this.select(e?xu:_u)}function Cu(e){return arguments.length?this.property("__data__",e):this.node().__data__}function ku(e){return function(t){e.call(this,t,this.__data__)}}function Tu(e){return e.trim().split(/^|\s+/).map(function(t){var n="",i=t.indexOf(".");return i>=0&&(n=t.slice(i+1),t=t.slice(0,i)),{type:t,name:n}})}function Su(e){return function(){var t=this.__on;if(t){for(var n=0,i=-1,r=t.length,o;n<r;++n)o=t[n],(!e.type||o.type===e.type)&&o.name===e.name?this.removeEventListener(o.type,o.listener,o.options):t[++i]=o;++i?t.length=i:delete this.__on}}}function Au(e,t,n){return function(){var i=this.__on,r,o=ku(t);if(i){for(var a=0,s=i.length;a<s;++a)if((r=i[a]).type===e.type&&r.name===e.name){this.removeEventListener(r.type,r.listener,r.options),this.addEventListener(r.type,r.listener=o,r.options=n),r.value=t;return}}this.addEventListener(e.type,o,n),r={type:e.type,name:e.name,value:t,listener:o,options:n},i?i.push(r):this.__on=[r]}}function Lu(e,t,n){var i=Tu(e+""),r,o=i.length,a;if(arguments.length<2){var s=this.node().__on;if(s){for(var u=0,l=s.length,c;u<l;++u)for(r=0,c=s[u];r<o;++r)if((a=i[r]).type===c.type&&a.name===c.name)return c.value}return}for(s=t?Au:Su,r=0;r<o;++r)this.each(s(i[r],t,n));return this}function vo(e,t,n){var i=ho(e),r=i.CustomEvent;typeof r=="function"?r=new r(t,n):(r=i.document.createEvent("Event"),n?(r.initEvent(t,n.bubbles,n.cancelable),r.detail=n.detail):r.initEvent(t,!1,!1)),e.dispatchEvent(r)}function Ru(e,t){return function(){return vo(this,e,t)}}function Nu(e,t){return function(){return vo(this,e,t.apply(this,arguments))}}function Mu(e,t){return this.each((typeof t=="function"?Nu:Ru)(e,t))}function*Du(){for(var e=this._groups,t=0,n=e.length;t<n;++t)for(var i=e[t],r=0,o=i.length,a;r<o;++r)(a=i[r])&&(yield a)}var yo=[null];function Ee(e,t){this._groups=e,this._parents=t}function Zt(){return new Ee([[document.documentElement]],yo)}function $u(){return this}Ee.prototype=Zt.prototype={constructor:Ee,select:as,selectAll:cs,selectChild:gs,selectChildren:ys,filter:bs,data:ks,enter:ws,exit:Ss,join:As,merge:Ls,selection:$u,order:Rs,sort:Ns,call:Ds,nodes:$s,node:Gs,size:Ps,empty:Fs,each:Is,attr:qs,style:Xs,property:Qs,classed:iu,text:su,html:du,raise:fu,lower:pu,append:mu,insert:yu,remove:wu,clone:Eu,datum:Cu,on:Lu,dispatch:Mu,[Symbol.iterator]:Du};function Le(e){return typeof e=="string"?new Ee([[document.querySelector(e)]],[document.documentElement]):new Ee([[e]],yo)}function He(e){return new Ee([document.querySelectorAll(e)],[document.documentElement])}function Li(e,t,n){e.prototype=t.prototype=n,n.constructor=e}function bo(e,t){var n=Object.create(e.prototype);for(var i in t)n[i]=t[i];return n}function Jt(){}var jt=.7,_n=1/jt,_t="\\s*([+-]?\\d+)\\s*",Yt="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)\\s*",qe="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)%\\s*",Gu=/^#([0-9a-f]{3,8})$/,Pu=new RegExp(`^rgb\\(${_t},${_t},${_t}\\)$`),Fu=new RegExp(`^rgb\\(${qe},${qe},${qe}\\)$`),Iu=new RegExp(`^rgba\\(${_t},${_t},${_t},${Yt}\\)$`),zu=new RegExp(`^rgba\\(${qe},${qe},${qe},${Yt}\\)$`),Ou=new RegExp(`^hsl\\(${Yt},${qe},${qe}\\)$`),Bu=new RegExp(`^hsla\\(${Yt},${qe},${qe},${Yt}\\)$`),ir={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074};Li(Jt,gt,{copy(e){return Object.assign(new this.constructor,this,e)},displayable(){return this.rgb().displayable()},hex:rr,formatHex:rr,formatHex8:Uu,formatHsl:Hu,formatRgb:or,toString:or});function rr(){return this.rgb().formatHex()}function Uu(){return this.rgb().formatHex8()}function Hu(){return wo(this).formatHsl()}function or(){return this.rgb().formatRgb()}function gt(e){var t,n;return e=(e+"").trim().toLowerCase(),(t=Gu.exec(e))?(n=t[1].length,t=parseInt(t[1],16),n===6?ar(t):n===3?new xe(t>>8&15|t>>4&240,t>>4&15|t&240,(t&15)<<4|t&15,1):n===8?tn(t>>24&255,t>>16&255,t>>8&255,(t&255)/255):n===4?tn(t>>12&15|t>>8&240,t>>8&15|t>>4&240,t>>4&15|t&240,((t&15)<<4|t&15)/255):null):(t=Pu.exec(e))?new xe(t[1],t[2],t[3],1):(t=Fu.exec(e))?new xe(t[1]*255/100,t[2]*255/100,t[3]*255/100,1):(t=Iu.exec(e))?tn(t[1],t[2],t[3],t[4]):(t=zu.exec(e))?tn(t[1]*255/100,t[2]*255/100,t[3]*255/100,t[4]):(t=Ou.exec(e))?lr(t[1],t[2]/100,t[3]/100,1):(t=Bu.exec(e))?lr(t[1],t[2]/100,t[3]/100,t[4]):ir.hasOwnProperty(e)?ar(ir[e]):e==="transparent"?new xe(NaN,NaN,NaN,0):null}function ar(e){return new xe(e>>16&255,e>>8&255,e&255,1)}function tn(e,t,n,i){return i<=0&&(e=t=n=NaN),new xe(e,t,n,i)}function Wu(e){return e instanceof Jt||(e=gt(e)),e?(e=e.rgb(),new xe(e.r,e.g,e.b,e.opacity)):new xe}function di(e,t,n,i){return arguments.length===1?Wu(e):new xe(e,t,n,i??1)}function xe(e,t,n,i){this.r=+e,this.g=+t,this.b=+n,this.opacity=+i}Li(xe,di,bo(Jt,{brighter(e){return e=e==null?_n:Math.pow(_n,e),new xe(this.r*e,this.g*e,this.b*e,this.opacity)},darker(e){return e=e==null?jt:Math.pow(jt,e),new xe(this.r*e,this.g*e,this.b*e,this.opacity)},rgb(){return this},clamp(){return new xe(ft(this.r),ft(this.g),ft(this.b),xn(this.opacity))},displayable(){return-.5<=this.r&&this.r<255.5&&-.5<=this.g&&this.g<255.5&&-.5<=this.b&&this.b<255.5&&0<=this.opacity&&this.opacity<=1},hex:sr,formatHex:sr,formatHex8:qu,formatRgb:ur,toString:ur}));function sr(){return`#${ht(this.r)}${ht(this.g)}${ht(this.b)}`}function qu(){return`#${ht(this.r)}${ht(this.g)}${ht(this.b)}${ht((isNaN(this.opacity)?1:this.opacity)*255)}`}function ur(){const e=xn(this.opacity);return`${e===1?"rgb(":"rgba("}${ft(this.r)}, ${ft(this.g)}, ${ft(this.b)}${e===1?")":`, ${e})`}`}function xn(e){return isNaN(e)?1:Math.max(0,Math.min(1,e))}function ft(e){return Math.max(0,Math.min(255,Math.round(e)||0))}function ht(e){return e=ft(e),(e<16?"0":"")+e.toString(16)}function lr(e,t,n,i){return i<=0?e=t=n=NaN:n<=0||n>=1?e=t=NaN:t<=0&&(e=NaN),new ze(e,t,n,i)}function wo(e){if(e instanceof ze)return new ze(e.h,e.s,e.l,e.opacity);if(e instanceof Jt||(e=gt(e)),!e)return new ze;if(e instanceof ze)return e;e=e.rgb();var t=e.r/255,n=e.g/255,i=e.b/255,r=Math.min(t,n,i),o=Math.max(t,n,i),a=NaN,s=o-r,u=(o+r)/2;return s?(t===o?a=(n-i)/s+(n<i)*6:n===o?a=(i-t)/s+2:a=(t-n)/s+4,s/=u<.5?o+r:2-o-r,a*=60):s=u>0&&u<1?0:a,new ze(a,s,u,e.opacity)}function Vu(e,t,n,i){return arguments.length===1?wo(e):new ze(e,t,n,i??1)}function ze(e,t,n,i){this.h=+e,this.s=+t,this.l=+n,this.opacity=+i}Li(ze,Vu,bo(Jt,{brighter(e){return e=e==null?_n:Math.pow(_n,e),new ze(this.h,this.s,this.l*e,this.opacity)},darker(e){return e=e==null?jt:Math.pow(jt,e),new ze(this.h,this.s,this.l*e,this.opacity)},rgb(){var e=this.h%360+(this.h<0)*360,t=isNaN(e)||isNaN(this.s)?0:this.s,n=this.l,i=n+(n<.5?n:1-n)*t,r=2*n-i;return new xe(Vn(e>=240?e-240:e+120,r,i),Vn(e,r,i),Vn(e<120?e+240:e-120,r,i),this.opacity)},clamp(){return new ze(cr(this.h),nn(this.s),nn(this.l),xn(this.opacity))},displayable(){return(0<=this.s&&this.s<=1||isNaN(this.s))&&0<=this.l&&this.l<=1&&0<=this.opacity&&this.opacity<=1},formatHsl(){const e=xn(this.opacity);return`${e===1?"hsl(":"hsla("}${cr(this.h)}, ${nn(this.s)*100}%, ${nn(this.l)*100}%${e===1?")":`, ${e})`}`}}));function cr(e){return e=(e||0)%360,e<0?e+360:e}function nn(e){return Math.max(0,Math.min(1,e||0))}function Vn(e,t,n){return(e<60?t+(n-t)*e/60:e<180?n:e<240?t+(n-t)*(240-e)/60:t)*255}const Ri=e=>()=>e;function ju(e,t){return function(n){return e+n*t}}function Yu(e,t,n){return e=Math.pow(e,n),t=Math.pow(t,n)-e,n=1/n,function(i){return Math.pow(e+i*t,n)}}function Xu(e){return(e=+e)==1?_o:function(t,n){return n-t?Yu(t,n,e):Ri(isNaN(t)?n:t)}}function _o(e,t){var n=t-e;return n?ju(e,n):Ri(isNaN(e)?t:e)}const En=function e(t){var n=Xu(t);function i(r,o){var a=n((r=di(r)).r,(o=di(o)).r),s=n(r.g,o.g),u=n(r.b,o.b),l=_o(r.opacity,o.opacity);return function(c){return r.r=a(c),r.g=s(c),r.b=u(c),r.opacity=l(c),r+""}}return i.gamma=e,i}(1);function Ku(e,t){t||(t=[]);var n=e?Math.min(t.length,e.length):0,i=t.slice(),r;return function(o){for(r=0;r<n;++r)i[r]=e[r]*(1-o)+t[r]*o;return i}}function Zu(e){return ArrayBuffer.isView(e)&&!(e instanceof DataView)}function Ju(e,t){var n=t?t.length:0,i=e?Math.min(n,e.length):0,r=new Array(i),o=new Array(n),a;for(a=0;a<i;++a)r[a]=Ni(e[a],t[a]);for(;a<n;++a)o[a]=t[a];return function(s){for(a=0;a<i;++a)o[a]=r[a](s);return o}}function Qu(e,t){var n=new Date;return e=+e,t=+t,function(i){return n.setTime(e*(1-i)+t*i),n}}function Ie(e,t){return e=+e,t=+t,function(n){return e*(1-n)+t*n}}function el(e,t){var n={},i={},r;(e===null||typeof e!="object")&&(e={}),(t===null||typeof t!="object")&&(t={});for(r in t)r in e?n[r]=Ni(e[r],t[r]):i[r]=t[r];return function(o){for(r in n)i[r]=n[r](o);return i}}var hi=/[-+]?(?:\d+\.?\d*|\.?\d+)(?:[eE][-+]?\d+)?/g,jn=new RegExp(hi.source,"g");function tl(e){return function(){return e}}function nl(e){return function(t){return e(t)+""}}function xo(e,t){var n=hi.lastIndex=jn.lastIndex=0,i,r,o,a=-1,s=[],u=[];for(e=e+"",t=t+"";(i=hi.exec(e))&&(r=jn.exec(t));)(o=r.index)>n&&(o=t.slice(n,o),s[a]?s[a]+=o:s[++a]=o),(i=i[0])===(r=r[0])?s[a]?s[a]+=r:s[++a]=r:(s[++a]=null,u.push({i:a,x:Ie(i,r)})),n=jn.lastIndex;return n<t.length&&(o=t.slice(n),s[a]?s[a]+=o:s[++a]=o),s.length<2?u[0]?nl(u[0].x):tl(t):(t=u.length,function(l){for(var c=0,d;c<t;++c)s[(d=u[c]).i]=d.x(l);return s.join("")})}function Ni(e,t){var n=typeof t,i;return t==null||n==="boolean"?Ri(t):(n==="number"?Ie:n==="string"?(i=gt(t))?(t=i,En):xo:t instanceof gt?En:t instanceof Date?Qu:Zu(t)?Ku:Array.isArray(t)?Ju:typeof t.valueOf!="function"&&typeof t.toString!="function"||isNaN(t)?el:Ie)(e,t)}function il(e,t){return e=+e,t=+t,function(n){return Math.round(e*(1-n)+t*n)}}var dr=180/Math.PI,fi={translateX:0,translateY:0,rotate:0,skewX:0,scaleX:1,scaleY:1};function Eo(e,t,n,i,r,o){var a,s,u;return(a=Math.sqrt(e*e+t*t))&&(e/=a,t/=a),(u=e*n+t*i)&&(n-=e*u,i-=t*u),(s=Math.sqrt(n*n+i*i))&&(n/=s,i/=s,u/=s),e*i<t*n&&(e=-e,t=-t,u=-u,a=-a),{translateX:r,translateY:o,rotate:Math.atan2(t,e)*dr,skewX:Math.atan(u)*dr,scaleX:a,scaleY:s}}var rn;function rl(e){const t=new(typeof DOMMatrix=="function"?DOMMatrix:WebKitCSSMatrix)(e+"");return t.isIdentity?fi:Eo(t.a,t.b,t.c,t.d,t.e,t.f)}function ol(e){return e==null||(rn||(rn=document.createElementNS("http://www.w3.org/2000/svg","g")),rn.setAttribute("transform",e),!(e=rn.transform.baseVal.consolidate()))?fi:(e=e.matrix,Eo(e.a,e.b,e.c,e.d,e.e,e.f))}function Co(e,t,n,i){function r(l){return l.length?l.pop()+" ":""}function o(l,c,d,h,f,g){if(l!==d||c!==h){var m=f.push("translate(",null,t,null,n);g.push({i:m-4,x:Ie(l,d)},{i:m-2,x:Ie(c,h)})}else(d||h)&&f.push("translate("+d+t+h+n)}function a(l,c,d,h){l!==c?(l-c>180?c+=360:c-l>180&&(l+=360),h.push({i:d.push(r(d)+"rotate(",null,i)-2,x:Ie(l,c)})):c&&d.push(r(d)+"rotate("+c+i)}function s(l,c,d,h){l!==c?h.push({i:d.push(r(d)+"skewX(",null,i)-2,x:Ie(l,c)}):c&&d.push(r(d)+"skewX("+c+i)}function u(l,c,d,h,f,g){if(l!==d||c!==h){var m=f.push(r(f)+"scale(",null,",",null,")");g.push({i:m-4,x:Ie(l,d)},{i:m-2,x:Ie(c,h)})}else(d!==1||h!==1)&&f.push(r(f)+"scale("+d+","+h+")")}return function(l,c){var d=[],h=[];return l=e(l),c=e(c),o(l.translateX,l.translateY,c.translateX,c.translateY,d,h),a(l.rotate,c.rotate,d,h),s(l.skewX,c.skewX,d,h),u(l.scaleX,l.scaleY,c.scaleX,c.scaleY,d,h),l=c=null,function(f){for(var g=-1,m=h.length,b;++g<m;)d[(b=h[g]).i]=b.x(f);return d.join("")}}}var al=Co(rl,"px, ","px)","deg)"),sl=Co(ol,", ",")",")"),Ct=0,Bt=0,Dt=0,ko=1e3,Cn,Ut,kn=0,pt=0,$n=0,Xt=typeof performance=="object"&&performance.now?performance:Date,To=typeof window=="object"&&window.requestAnimationFrame?window.requestAnimationFrame.bind(window):function(e){setTimeout(e,17)};function Mi(){return pt||(To(ul),pt=Xt.now()+$n)}function ul(){pt=0}function Tn(){this._call=this._time=this._next=null}Tn.prototype=So.prototype={constructor:Tn,restart:function(e,t,n){if(typeof e!="function")throw new TypeError("callback is not a function");n=(n==null?Mi():+n)+(t==null?0:+t),!this._next&&Ut!==this&&(Ut?Ut._next=this:Cn=this,Ut=this),this._call=e,this._time=n,gi()},stop:function(){this._call&&(this._call=null,this._time=1/0,gi())}};function So(e,t,n){var i=new Tn;return i.restart(e,t,n),i}function ll(){Mi(),++Ct;for(var e=Cn,t;e;)(t=pt-e._time)>=0&&e._call.call(void 0,t),e=e._next;--Ct}function hr(){pt=(kn=Xt.now())+$n,Ct=Bt=0;try{ll()}finally{Ct=0,dl(),pt=0}}function cl(){var e=Xt.now(),t=e-kn;t>ko&&($n-=t,kn=e)}function dl(){for(var e,t=Cn,n,i=1/0;t;)t._call?(i>t._time&&(i=t._time),e=t,t=t._next):(n=t._next,t._next=null,t=e?e._next=n:Cn=n);Ut=e,gi(i)}function gi(e){if(!Ct){Bt&&(Bt=clearTimeout(Bt));var t=e-pt;t>24?(e<1/0&&(Bt=setTimeout(hr,e-Xt.now()-$n)),Dt&&(Dt=clearInterval(Dt))):(Dt||(kn=Xt.now(),Dt=setInterval(cl,ko)),Ct=1,To(hr))}}function fr(e,t,n){var i=new Tn;return t=t==null?0:+t,i.restart(r=>{i.stop(),e(r+t)},t,n),i}var hl=oo("start","end","cancel","interrupt"),fl=[],Ao=0,gr=1,pi=2,pn=3,pr=4,mi=5,mn=6;function Gn(e,t,n,i,r,o){var a=e.__transition;if(!a)e.__transition={};else if(n in a)return;gl(e,n,{name:t,index:i,group:r,on:hl,tween:fl,time:o.time,delay:o.delay,duration:o.duration,ease:o.ease,timer:null,state:Ao})}function Di(e,t){var n=Be(e,t);if(n.state>Ao)throw new Error("too late; already scheduled");return n}function Ve(e,t){var n=Be(e,t);if(n.state>pn)throw new Error("too late; already running");return n}function Be(e,t){var n=e.__transition;if(!n||!(n=n[t]))throw new Error("transition not found");return n}function gl(e,t,n){var i=e.__transition,r;i[t]=n,n.timer=So(o,0,n.time);function o(l){n.state=gr,n.timer.restart(a,n.delay,n.time),n.delay<=l&&a(l-n.delay)}function a(l){var c,d,h,f;if(n.state!==gr)return u();for(c in i)if(f=i[c],f.name===n.name){if(f.state===pn)return fr(a);f.state===pr?(f.state=mn,f.timer.stop(),f.on.call("interrupt",e,e.__data__,f.index,f.group),delete i[c]):+c<t&&(f.state=mn,f.timer.stop(),f.on.call("cancel",e,e.__data__,f.index,f.group),delete i[c])}if(fr(function(){n.state===pn&&(n.state=pr,n.timer.restart(s,n.delay,n.time),s(l))}),n.state=pi,n.on.call("start",e,e.__data__,n.index,n.group),n.state===pi){for(n.state=pn,r=new Array(h=n.tween.length),c=0,d=-1;c<h;++c)(f=n.tween[c].value.call(e,e.__data__,n.index,n.group))&&(r[++d]=f);r.length=d+1}}function s(l){for(var c=l<n.duration?n.ease.call(null,l/n.duration):(n.timer.restart(u),n.state=mi,1),d=-1,h=r.length;++d<h;)r[d].call(e,c);n.state===mi&&(n.on.call("end",e,e.__data__,n.index,n.group),u())}function u(){n.state=mn,n.timer.stop(),delete i[t];for(var l in i)return;delete e.__transition}}function pl(e,t){var n=e.__transition,i,r,o=!0,a;if(n){t=t==null?null:t+"";for(a in n){if((i=n[a]).name!==t){o=!1;continue}r=i.state>pi&&i.state<mi,i.state=mn,i.timer.stop(),i.on.call(r?"interrupt":"cancel",e,e.__data__,i.index,i.group),delete n[a]}o&&delete e.__transition}}function ml(e){return this.each(function(){pl(this,e)})}function vl(e,t){var n,i;return function(){var r=Ve(this,e),o=r.tween;if(o!==n){i=n=o;for(var a=0,s=i.length;a<s;++a)if(i[a].name===t){i=i.slice(),i.splice(a,1);break}}r.tween=i}}function yl(e,t,n){var i,r;if(typeof n!="function")throw new Error;return function(){var o=Ve(this,e),a=o.tween;if(a!==i){r=(i=a).slice();for(var s={name:t,value:n},u=0,l=r.length;u<l;++u)if(r[u].name===t){r[u]=s;break}u===l&&r.push(s)}o.tween=r}}function bl(e,t){var n=this._id;if(e+="",arguments.length<2){for(var i=Be(this.node(),n).tween,r=0,o=i.length,a;r<o;++r)if((a=i[r]).name===e)return a.value;return null}return this.each((t==null?vl:yl)(n,e,t))}function $i(e,t,n){var i=e._id;return e.each(function(){var r=Ve(this,i);(r.value||(r.value={}))[t]=n.apply(this,arguments)}),function(r){return Be(r,i).value[t]}}function Lo(e,t){var n;return(typeof t=="number"?Ie:t instanceof gt?En:(n=gt(t))?(t=n,En):xo)(e,t)}function wl(e){return function(){this.removeAttribute(e)}}function _l(e){return function(){this.removeAttributeNS(e.space,e.local)}}function xl(e,t,n){var i,r=n+"",o;return function(){var a=this.getAttribute(e);return a===r?null:a===i?o:o=t(i=a,n)}}function El(e,t,n){var i,r=n+"",o;return function(){var a=this.getAttributeNS(e.space,e.local);return a===r?null:a===i?o:o=t(i=a,n)}}function Cl(e,t,n){var i,r,o;return function(){var a,s=n(this),u;return s==null?void this.removeAttribute(e):(a=this.getAttribute(e),u=s+"",a===u?null:a===i&&u===r?o:(r=u,o=t(i=a,s)))}}function kl(e,t,n){var i,r,o;return function(){var a,s=n(this),u;return s==null?void this.removeAttributeNS(e.space,e.local):(a=this.getAttributeNS(e.space,e.local),u=s+"",a===u?null:a===i&&u===r?o:(r=u,o=t(i=a,s)))}}function Tl(e,t){var n=Dn(e),i=n==="transform"?sl:Lo;return this.attrTween(e,typeof t=="function"?(n.local?kl:Cl)(n,i,$i(this,"attr."+e,t)):t==null?(n.local?_l:wl)(n):(n.local?El:xl)(n,i,t))}function Sl(e,t){return function(n){this.setAttribute(e,t.call(this,n))}}function Al(e,t){return function(n){this.setAttributeNS(e.space,e.local,t.call(this,n))}}function Ll(e,t){var n,i;function r(){var o=t.apply(this,arguments);return o!==i&&(n=(i=o)&&Al(e,o)),n}return r._value=t,r}function Rl(e,t){var n,i;function r(){var o=t.apply(this,arguments);return o!==i&&(n=(i=o)&&Sl(e,o)),n}return r._value=t,r}function Nl(e,t){var n="attr."+e;if(arguments.length<2)return(n=this.tween(n))&&n._value;if(t==null)return this.tween(n,null);if(typeof t!="function")throw new Error;var i=Dn(e);return this.tween(n,(i.local?Ll:Rl)(i,t))}function Ml(e,t){return function(){Di(this,e).delay=+t.apply(this,arguments)}}function Dl(e,t){return t=+t,function(){Di(this,e).delay=t}}function $l(e){var t=this._id;return arguments.length?this.each((typeof e=="function"?Ml:Dl)(t,e)):Be(this.node(),t).delay}function Gl(e,t){return function(){Ve(this,e).duration=+t.apply(this,arguments)}}function Pl(e,t){return t=+t,function(){Ve(this,e).duration=t}}function Fl(e){var t=this._id;return arguments.length?this.each((typeof e=="function"?Gl:Pl)(t,e)):Be(this.node(),t).duration}function Il(e,t){if(typeof t!="function")throw new Error;return function(){Ve(this,e).ease=t}}function zl(e){var t=this._id;return arguments.length?this.each(Il(t,e)):Be(this.node(),t).ease}function Ol(e,t){return function(){var n=t.apply(this,arguments);if(typeof n!="function")throw new Error;Ve(this,e).ease=n}}function Bl(e){if(typeof e!="function")throw new Error;return this.each(Ol(this._id,e))}function Ul(e){typeof e!="function"&&(e=uo(e));for(var t=this._groups,n=t.length,i=new Array(n),r=0;r<n;++r)for(var o=t[r],a=o.length,s=i[r]=[],u,l=0;l<a;++l)(u=o[l])&&e.call(u,u.__data__,l,o)&&s.push(u);return new Qe(i,this._parents,this._name,this._id)}function Hl(e){if(e._id!==this._id)throw new Error;for(var t=this._groups,n=e._groups,i=t.length,r=n.length,o=Math.min(i,r),a=new Array(i),s=0;s<o;++s)for(var u=t[s],l=n[s],c=u.length,d=a[s]=new Array(c),h,f=0;f<c;++f)(h=u[f]||l[f])&&(d[f]=h);for(;s<i;++s)a[s]=t[s];return new Qe(a,this._parents,this._name,this._id)}function Wl(e){return(e+"").trim().split(/^|\s+/).every(function(t){var n=t.indexOf(".");return n>=0&&(t=t.slice(0,n)),!t||t==="start"})}function ql(e,t,n){var i,r,o=Wl(t)?Di:Ve;return function(){var a=o(this,e),s=a.on;s!==i&&(r=(i=s).copy()).on(t,n),a.on=r}}function Vl(e,t){var n=this._id;return arguments.length<2?Be(this.node(),n).on.on(e):this.each(ql(n,e,t))}function jl(e){return function(){var t=this.parentNode;for(var n in this.__transition)if(+n!==e)return;t&&t.removeChild(this)}}function Yl(){return this.on("end.remove",jl(this._id))}function Xl(e){var t=this._name,n=this._id;typeof e!="function"&&(e=Si(e));for(var i=this._groups,r=i.length,o=new Array(r),a=0;a<r;++a)for(var s=i[a],u=s.length,l=o[a]=new Array(u),c,d,h=0;h<u;++h)(c=s[h])&&(d=e.call(c,c.__data__,h,s))&&("__data__"in c&&(d.__data__=c.__data__),l[h]=d,Gn(l[h],t,n,h,l,Be(c,n)));return new Qe(o,this._parents,t,n)}function Kl(e){var t=this._name,n=this._id;typeof e!="function"&&(e=so(e));for(var i=this._groups,r=i.length,o=[],a=[],s=0;s<r;++s)for(var u=i[s],l=u.length,c,d=0;d<l;++d)if(c=u[d]){for(var h=e.call(c,c.__data__,d,u),f,g=Be(c,n),m=0,b=h.length;m<b;++m)(f=h[m])&&Gn(f,t,n,m,h,g);o.push(h),a.push(c)}return new Qe(o,a,t,n)}var Zl=Zt.prototype.constructor;function Jl(){return new Zl(this._groups,this._parents)}function Ql(e,t){var n,i,r;return function(){var o=Et(this,e),a=(this.style.removeProperty(e),Et(this,e));return o===a?null:o===n&&a===i?r:r=t(n=o,i=a)}}function Ro(e){return function(){this.style.removeProperty(e)}}function ec(e,t,n){var i,r=n+"",o;return function(){var a=Et(this,e);return a===r?null:a===i?o:o=t(i=a,n)}}function tc(e,t,n){var i,r,o;return function(){var a=Et(this,e),s=n(this),u=s+"";return s==null&&(u=s=(this.style.removeProperty(e),Et(this,e))),a===u?null:a===i&&u===r?o:(r=u,o=t(i=a,s))}}function nc(e,t){var n,i,r,o="style."+t,a="end."+o,s;return function(){var u=Ve(this,e),l=u.on,c=u.value[o]==null?s||(s=Ro(t)):void 0;(l!==n||r!==c)&&(i=(n=l).copy()).on(a,r=c),u.on=i}}function ic(e,t,n){var i=(e+="")=="transform"?al:Lo;return t==null?this.styleTween(e,Ql(e,i)).on("end.style."+e,Ro(e)):typeof t=="function"?this.styleTween(e,tc(e,i,$i(this,"style."+e,t))).each(nc(this._id,e)):this.styleTween(e,ec(e,i,t),n).on("end.style."+e,null)}function rc(e,t,n){return function(i){this.style.setProperty(e,t.call(this,i),n)}}function oc(e,t,n){var i,r;function o(){var a=t.apply(this,arguments);return a!==r&&(i=(r=a)&&rc(e,a,n)),i}return o._value=t,o}function ac(e,t,n){var i="style."+(e+="");if(arguments.length<2)return(i=this.tween(i))&&i._value;if(t==null)return this.tween(i,null);if(typeof t!="function")throw new Error;return this.tween(i,oc(e,t,n??""))}function sc(e){return function(){this.textContent=e}}function uc(e){return function(){var t=e(this);this.textContent=t??""}}function lc(e){return this.tween("text",typeof e=="function"?uc($i(this,"text",e)):sc(e==null?"":e+""))}function cc(e){return function(t){this.textContent=e.call(this,t)}}function dc(e){var t,n;function i(){var r=e.apply(this,arguments);return r!==n&&(t=(n=r)&&cc(r)),t}return i._value=e,i}function hc(e){var t="text";if(arguments.length<1)return(t=this.tween(t))&&t._value;if(e==null)return this.tween(t,null);if(typeof e!="function")throw new Error;return this.tween(t,dc(e))}function fc(){for(var e=this._name,t=this._id,n=No(),i=this._groups,r=i.length,o=0;o<r;++o)for(var a=i[o],s=a.length,u,l=0;l<s;++l)if(u=a[l]){var c=Be(u,t);Gn(u,e,n,l,a,{time:c.time+c.delay+c.duration,delay:0,duration:c.duration,ease:c.ease})}return new Qe(i,this._parents,e,n)}function gc(){var e,t,n=this,i=n._id,r=n.size();return new Promise(function(o,a){var s={value:a},u={value:function(){--r===0&&o()}};n.each(function(){var l=Ve(this,i),c=l.on;c!==e&&(t=(e=c).copy(),t._.cancel.push(s),t._.interrupt.push(s),t._.end.push(u)),l.on=t}),r===0&&o()})}var pc=0;function Qe(e,t,n,i){this._groups=e,this._parents=t,this._name=n,this._id=i}function No(){return++pc}var Xe=Zt.prototype;Qe.prototype={constructor:Qe,select:Xl,selectAll:Kl,selectChild:Xe.selectChild,selectChildren:Xe.selectChildren,filter:Ul,merge:Hl,selection:Jl,transition:fc,call:Xe.call,nodes:Xe.nodes,node:Xe.node,size:Xe.size,empty:Xe.empty,each:Xe.each,on:Vl,attr:Tl,attrTween:Nl,style:ic,styleTween:ac,text:lc,textTween:hc,remove:Yl,tween:bl,delay:$l,duration:Fl,ease:zl,easeVarying:Bl,end:gc,[Symbol.iterator]:Xe[Symbol.iterator]};function mc(e){return((e*=2)<=1?e*e*e:(e-=2)*e*e+2)/2}var vc={time:null,delay:0,duration:250,ease:mc};function yc(e,t){for(var n;!(n=e.__transition)||!(n=n[t]);)if(!(e=e.parentNode))throw new Error(`transition ${t} not found`);return n}function bc(e){var t,n;e instanceof Qe?(t=e._id,e=e._name):(t=No(),(n=vc).time=Mi(),e=e==null?null:e+"");for(var i=this._groups,r=i.length,o=0;o<r;++o)for(var a=i[o],s=a.length,u,l=0;l<s;++l)(u=a[l])&&Gn(u,e,t,l,a,n||yc(u,t));return new Qe(i,this._parents,e,t)}Zt.prototype.interrupt=ml;Zt.prototype.transition=bc;const vi=Math.PI,yi=2*vi,dt=1e-6,wc=yi-dt;function Mo(e){this._+=e[0];for(let t=1,n=e.length;t<n;++t)this._+=arguments[t]+e[t]}function _c(e){let t=Math.floor(e);if(!(t>=0))throw new Error(`invalid digits: ${e}`);if(t>15)return Mo;const n=10**t;return function(i){this._+=i[0];for(let r=1,o=i.length;r<o;++r)this._+=Math.round(arguments[r]*n)/n+i[r]}}class xc{constructor(t){this._x0=this._y0=this._x1=this._y1=null,this._="",this._append=t==null?Mo:_c(t)}moveTo(t,n){this._append`M${this._x0=this._x1=+t},${this._y0=this._y1=+n}`}closePath(){this._x1!==null&&(this._x1=this._x0,this._y1=this._y0,this._append`Z`)}lineTo(t,n){this._append`L${this._x1=+t},${this._y1=+n}`}quadraticCurveTo(t,n,i,r){this._append`Q${+t},${+n},${this._x1=+i},${this._y1=+r}`}bezierCurveTo(t,n,i,r,o,a){this._append`C${+t},${+n},${+i},${+r},${this._x1=+o},${this._y1=+a}`}arcTo(t,n,i,r,o){if(t=+t,n=+n,i=+i,r=+r,o=+o,o<0)throw new Error(`negative radius: ${o}`);let a=this._x1,s=this._y1,u=i-t,l=r-n,c=a-t,d=s-n,h=c*c+d*d;if(this._x1===null)this._append`M${this._x1=t},${this._y1=n}`;else if(h>dt)if(!(Math.abs(d*u-l*c)>dt)||!o)this._append`L${this._x1=t},${this._y1=n}`;else{let f=i-a,g=r-s,m=u*u+l*l,b=f*f+g*g,C=Math.sqrt(m),_=Math.sqrt(h),x=o*Math.tan((vi-Math.acos((m+h-b)/(2*C*_)))/2),p=x/_,v=x/C;Math.abs(p-1)>dt&&this._append`L${t+p*c},${n+p*d}`,this._append`A${o},${o},0,0,${+(d*f>c*g)},${this._x1=t+v*u},${this._y1=n+v*l}`}}arc(t,n,i,r,o,a){if(t=+t,n=+n,i=+i,a=!!a,i<0)throw new Error(`negative radius: ${i}`);let s=i*Math.cos(r),u=i*Math.sin(r),l=t+s,c=n+u,d=1^a,h=a?r-o:o-r;this._x1===null?this._append`M${l},${c}`:(Math.abs(this._x1-l)>dt||Math.abs(this._y1-c)>dt)&&this._append`L${l},${c}`,i&&(h<0&&(h=h%yi+yi),h>wc?this._append`A${i},${i},0,1,${d},${t-s},${n-u}A${i},${i},0,1,${d},${this._x1=l},${this._y1=c}`:h>dt&&this._append`A${i},${i},0,${+(h>=vi)},${d},${this._x1=t+i*Math.cos(o)},${this._y1=n+i*Math.sin(o)}`)}rect(t,n,i,r){this._append`M${this._x0=this._x1=+t},${this._y0=this._y1=+n}h${i=+i}v${+r}h${-i}Z`}toString(){return this._}}function Ec(e){return Math.abs(e=Math.round(e))>=1e21?e.toLocaleString("en").replace(/,/g,""):e.toString(10)}function Sn(e,t){if((n=(e=t?e.toExponential(t-1):e.toExponential()).indexOf("e"))<0)return null;var n,i=e.slice(0,n);return[i.length>1?i[0]+i.slice(2):i,+e.slice(n+1)]}function kt(e){return e=Sn(Math.abs(e)),e?e[1]:NaN}function Cc(e,t){return function(n,i){for(var r=n.length,o=[],a=0,s=e[0],u=0;r>0&&s>0&&(u+s+1>i&&(s=Math.max(1,i-u)),o.push(n.substring(r-=s,r+s)),!((u+=s+1)>i));)s=e[a=(a+1)%e.length];return o.reverse().join(t)}}function kc(e){return function(t){return t.replace(/[0-9]/g,function(n){return e[+n]})}}var Tc=/^(?:(.)?([<>=^]))?([+\-( ])?([$#])?(0)?(\d+)?(,)?(\.\d+)?(~)?([a-z%])?$/i;function An(e){if(!(t=Tc.exec(e)))throw new Error("invalid format: "+e);var t;return new Gi({fill:t[1],align:t[2],sign:t[3],symbol:t[4],zero:t[5],width:t[6],comma:t[7],precision:t[8]&&t[8].slice(1),trim:t[9],type:t[10]})}An.prototype=Gi.prototype;function Gi(e){this.fill=e.fill===void 0?" ":e.fill+"",this.align=e.align===void 0?">":e.align+"",this.sign=e.sign===void 0?"-":e.sign+"",this.symbol=e.symbol===void 0?"":e.symbol+"",this.zero=!!e.zero,this.width=e.width===void 0?void 0:+e.width,this.comma=!!e.comma,this.precision=e.precision===void 0?void 0:+e.precision,this.trim=!!e.trim,this.type=e.type===void 0?"":e.type+""}Gi.prototype.toString=function(){return this.fill+this.align+this.sign+this.symbol+(this.zero?"0":"")+(this.width===void 0?"":Math.max(1,this.width|0))+(this.comma?",":"")+(this.precision===void 0?"":"."+Math.max(0,this.precision|0))+(this.trim?"~":"")+this.type};function Sc(e){e:for(var t=e.length,n=1,i=-1,r;n<t;++n)switch(e[n]){case".":i=r=n;break;case"0":i===0&&(i=n),r=n;break;default:if(!+e[n])break e;i>0&&(i=0);break}return i>0?e.slice(0,i)+e.slice(r+1):e}var Do;function Ac(e,t){var n=Sn(e,t);if(!n)return e+"";var i=n[0],r=n[1],o=r-(Do=Math.max(-8,Math.min(8,Math.floor(r/3)))*3)+1,a=i.length;return o===a?i:o>a?i+new Array(o-a+1).join("0"):o>0?i.slice(0,o)+"."+i.slice(o):"0."+new Array(1-o).join("0")+Sn(e,Math.max(0,t+o-1))[0]}function mr(e,t){var n=Sn(e,t);if(!n)return e+"";var i=n[0],r=n[1];return r<0?"0."+new Array(-r).join("0")+i:i.length>r+1?i.slice(0,r+1)+"."+i.slice(r+1):i+new Array(r-i.length+2).join("0")}const vr={"%":(e,t)=>(e*100).toFixed(t),b:e=>Math.round(e).toString(2),c:e=>e+"",d:Ec,e:(e,t)=>e.toExponential(t),f:(e,t)=>e.toFixed(t),g:(e,t)=>e.toPrecision(t),o:e=>Math.round(e).toString(8),p:(e,t)=>mr(e*100,t),r:mr,s:Ac,X:e=>Math.round(e).toString(16).toUpperCase(),x:e=>Math.round(e).toString(16)};function yr(e){return e}var br=Array.prototype.map,wr=["y","z","a","f","p","n","µ","m","","k","M","G","T","P","E","Z","Y"];function Lc(e){var t=e.grouping===void 0||e.thousands===void 0?yr:Cc(br.call(e.grouping,Number),e.thousands+""),n=e.currency===void 0?"":e.currency[0]+"",i=e.currency===void 0?"":e.currency[1]+"",r=e.decimal===void 0?".":e.decimal+"",o=e.numerals===void 0?yr:kc(br.call(e.numerals,String)),a=e.percent===void 0?"%":e.percent+"",s=e.minus===void 0?"−":e.minus+"",u=e.nan===void 0?"NaN":e.nan+"";function l(d){d=An(d);var h=d.fill,f=d.align,g=d.sign,m=d.symbol,b=d.zero,C=d.width,_=d.comma,x=d.precision,p=d.trim,v=d.type;v==="n"?(_=!0,v="g"):vr[v]||(x===void 0&&(x=12),p=!0,v="g"),(b||h==="0"&&f==="=")&&(b=!0,h="0",f="=");var w=m==="$"?n:m==="#"&&/[boxX]/.test(v)?"0"+v.toLowerCase():"",k=m==="$"?i:/[%p]/.test(v)?a:"",D=vr[v],I=/[defgprs%]/.test(v);x=x===void 0?6:/[gprs]/.test(v)?Math.max(1,Math.min(21,x)):Math.max(0,Math.min(20,x));function F(R){var H=w,$=k,W,ae,ue;if(v==="c")$=D(R)+$,R="";else{R=+R;var de=R<0||1/R<0;if(R=isNaN(R)?u:D(Math.abs(R),x),p&&(R=Sc(R)),de&&+R==0&&g!=="+"&&(de=!1),H=(de?g==="("?g:s:g==="-"||g==="("?"":g)+H,$=(v==="s"?wr[8+Do/3]:"")+$+(de&&g==="("?")":""),I){for(W=-1,ae=R.length;++W<ae;)if(ue=R.charCodeAt(W),48>ue||ue>57){$=(ue===46?r+R.slice(W+1):R.slice(W))+$,R=R.slice(0,W);break}}}_&&!b&&(R=t(R,1/0));var le=H.length+R.length+$.length,Q=le<C?new Array(C-le+1).join(h):"";switch(_&&b&&(R=t(Q+R,Q.length?C-$.length:1/0),Q=""),f){case"<":R=H+R+$+Q;break;case"=":R=H+Q+R+$;break;case"^":R=Q.slice(0,le=Q.length>>1)+H+R+$+Q.slice(le);break;default:R=Q+H+R+$;break}return o(R)}return F.toString=function(){return d+""},F}function c(d,h){var f=l((d=An(d),d.type="f",d)),g=Math.max(-8,Math.min(8,Math.floor(kt(h)/3)))*3,m=Math.pow(10,-g),b=wr[8+g/3];return function(C){return f(m*C)+b}}return{format:l,formatPrefix:c}}var on,Pi,$o;Rc({thousands:",",grouping:[3],currency:["$",""]});function Rc(e){return on=Lc(e),Pi=on.format,$o=on.formatPrefix,on}function Nc(e){return Math.max(0,-kt(Math.abs(e)))}function Mc(e,t){return Math.max(0,Math.max(-8,Math.min(8,Math.floor(kt(t)/3)))*3-kt(Math.abs(e)))}function Dc(e,t){return e=Math.abs(e),t=Math.abs(t)-e,Math.max(0,kt(t)-kt(e))+1}function Fi(e,t){switch(arguments.length){case 0:break;case 1:this.range(e);break;default:this.range(t).domain(e);break}return this}const _r=Symbol("implicit");function qt(){var e=new Ki,t=[],n=[],i=_r;function r(o){let a=e.get(o);if(a===void 0){if(i!==_r)return i;e.set(o,a=t.push(o)-1)}return n[a%n.length]}return r.domain=function(o){if(!arguments.length)return t.slice();t=[],e=new Ki;for(const a of o)e.has(a)||e.set(a,t.push(a)-1);return r},r.range=function(o){return arguments.length?(n=Array.from(o),r):n.slice()},r.unknown=function(o){return arguments.length?(i=o,r):i},r.copy=function(){return qt(t,n).unknown(i)},Fi.apply(r,arguments),r}function Go(){var e=qt().unknown(void 0),t=e.domain,n=e.range,i=0,r=1,o,a,s=!1,u=0,l=0,c=.5;delete e.unknown;function d(){var h=t().length,f=r<i,g=f?r:i,m=f?i:r;o=(m-g)/Math.max(1,h-u+l*2),s&&(o=Math.floor(o)),g+=(m-g-o*(h-u))*c,a=o*(1-u),s&&(g=Math.round(g),a=Math.round(a));var b=ja(h).map(function(C){return g+o*C});return n(f?b.reverse():b)}return e.domain=function(h){return arguments.length?(t(h),d()):t()},e.range=function(h){return arguments.length?([i,r]=h,i=+i,r=+r,d()):[i,r]},e.rangeRound=function(h){return[i,r]=h,i=+i,r=+r,s=!0,d()},e.bandwidth=function(){return a},e.step=function(){return o},e.round=function(h){return arguments.length?(s=!!h,d()):s},e.padding=function(h){return arguments.length?(u=Math.min(1,l=+h),d()):u},e.paddingInner=function(h){return arguments.length?(u=Math.min(1,h),d()):u},e.paddingOuter=function(h){return arguments.length?(l=+h,d()):l},e.align=function(h){return arguments.length?(c=Math.max(0,Math.min(1,h)),d()):c},e.copy=function(){return Go(t(),[i,r]).round(s).paddingInner(u).paddingOuter(l).align(c)},Fi.apply(d(),arguments)}function $c(e){return function(){return e}}function Gc(e){return+e}var xr=[0,1];function bt(e){return e}function bi(e,t){return(t-=e=+e)?function(n){return(n-e)/t}:$c(isNaN(t)?NaN:.5)}function Pc(e,t){var n;return e>t&&(n=e,e=t,t=n),function(i){return Math.max(e,Math.min(t,i))}}function Fc(e,t,n){var i=e[0],r=e[1],o=t[0],a=t[1];return r<i?(i=bi(r,i),o=n(a,o)):(i=bi(i,r),o=n(o,a)),function(s){return o(i(s))}}function Ic(e,t,n){var i=Math.min(e.length,t.length)-1,r=new Array(i),o=new Array(i),a=-1;for(e[i]<e[0]&&(e=e.slice().reverse(),t=t.slice().reverse());++a<i;)r[a]=bi(e[a],e[a+1]),o[a]=n(t[a],t[a+1]);return function(s){var u=Fa(e,s,1,i)-1;return o[u](r[u](s))}}function zc(e,t){return t.domain(e.domain()).range(e.range()).interpolate(e.interpolate()).clamp(e.clamp()).unknown(e.unknown())}function Oc(){var e=xr,t=xr,n=Ni,i,r,o,a=bt,s,u,l;function c(){var h=Math.min(e.length,t.length);return a!==bt&&(a=Pc(e[0],e[h-1])),s=h>2?Ic:Fc,u=l=null,d}function d(h){return h==null||isNaN(h=+h)?o:(u||(u=s(e.map(i),t,n)))(i(a(h)))}return d.invert=function(h){return a(r((l||(l=s(t,e.map(i),Ie)))(h)))},d.domain=function(h){return arguments.length?(e=Array.from(h,Gc),c()):e.slice()},d.range=function(h){return arguments.length?(t=Array.from(h),c()):t.slice()},d.rangeRound=function(h){return t=Array.from(h),n=il,c()},d.clamp=function(h){return arguments.length?(a=h?!0:bt,c()):a!==bt},d.interpolate=function(h){return arguments.length?(n=h,c()):n},d.unknown=function(h){return arguments.length?(o=h,d):o},function(h,f){return i=h,r=f,c()}}function Bc(){return Oc()(bt,bt)}function Uc(e,t,n,i){var r=Va(e,t,n),o;switch(i=An(i??",f"),i.type){case"s":{var a=Math.max(Math.abs(e),Math.abs(t));return i.precision==null&&!isNaN(o=Mc(r,a))&&(i.precision=o),$o(i,a)}case"":case"e":case"g":case"p":case"r":{i.precision==null&&!isNaN(o=Dc(r,Math.max(Math.abs(e),Math.abs(t))))&&(i.precision=o-(i.type==="e"));break}case"f":case"%":{i.precision==null&&!isNaN(o=Nc(r))&&(i.precision=o-(i.type==="%")*2);break}}return Pi(i)}function Hc(e){var t=e.domain;return e.ticks=function(n){var i=t();return qa(i[0],i[i.length-1],n??10)},e.tickFormat=function(n,i){var r=t();return Uc(r[0],r[r.length-1],n??10,i)},e.nice=function(n){n==null&&(n=10);var i=t(),r=0,o=i.length-1,a=i[r],s=i[o],u,l,c=10;for(s<a&&(l=a,a=s,s=l,l=r,r=o,o=l);c-- >0;){if(l=ui(a,s,n),l===u)return i[r]=a,i[o]=s,t(i);if(l>0)a=Math.floor(a/l)*l,s=Math.ceil(s/l)*l;else if(l<0)a=Math.ceil(a*l)/l,s=Math.floor(s*l)/l;else break;u=l}return e},e}function Ht(){var e=Bc();return e.copy=function(){return zc(e,Ht())},Fi.apply(e,arguments),Hc(e)}function Wc(e){for(var t=e.length/6|0,n=new Array(t),i=0;i<t;)n[i]="#"+e.slice(i*6,++i*6);return n}const Er=Wc("1f77b4ff7f0e2ca02cd627289467bd8c564be377c27f7f7fbcbd2217becf");function ee(e){return function(){return e}}const Cr=Math.abs,ye=Math.atan2,lt=Math.cos,qc=Math.max,Yn=Math.min,We=Math.sin,wt=Math.sqrt,_e=1e-12,Kt=Math.PI,Ln=Kt/2,vn=2*Kt;function Vc(e){return e>1?0:e<-1?Kt:Math.acos(e)}function kr(e){return e>=1?Ln:e<=-1?-Ln:Math.asin(e)}function Ii(e){let t=3;return e.digits=function(n){if(!arguments.length)return t;if(n==null)t=null;else{const i=Math.floor(n);if(!(i>=0))throw new RangeError(`invalid digits: ${n}`);t=i}return e},()=>new xc(t)}function jc(e){return e.innerRadius}function Yc(e){return e.outerRadius}function Xc(e){return e.startAngle}function Kc(e){return e.endAngle}function Zc(e){return e&&e.padAngle}function Jc(e,t,n,i,r,o,a,s){var u=n-e,l=i-t,c=a-r,d=s-o,h=d*u-c*l;if(!(h*h<_e))return h=(c*(t-o)-d*(e-r))/h,[e+h*u,t+h*l]}function an(e,t,n,i,r,o,a){var s=e-n,u=t-i,l=(a?o:-o)/wt(s*s+u*u),c=l*u,d=-l*s,h=e+c,f=t+d,g=n+c,m=i+d,b=(h+g)/2,C=(f+m)/2,_=g-h,x=m-f,p=_*_+x*x,v=r-o,w=h*m-g*f,k=(x<0?-1:1)*wt(qc(0,v*v*p-w*w)),D=(w*x-_*k)/p,I=(-w*_-x*k)/p,F=(w*x+_*k)/p,R=(-w*_+x*k)/p,H=D-b,$=I-C,W=F-b,ae=R-C;return H*H+$*$>W*W+ae*ae&&(D=F,I=R),{cx:D,cy:I,x01:-c,y01:-d,x11:D*(r/v-1),y11:I*(r/v-1)}}function Qc(){var e=jc,t=Yc,n=ee(0),i=null,r=Xc,o=Kc,a=Zc,s=null,u=Ii(l);function l(){var c,d,h=+e.apply(this,arguments),f=+t.apply(this,arguments),g=r.apply(this,arguments)-Ln,m=o.apply(this,arguments)-Ln,b=Cr(m-g),C=m>g;if(s||(s=c=u()),f<h&&(d=f,f=h,h=d),!(f>_e))s.moveTo(0,0);else if(b>vn-_e)s.moveTo(f*lt(g),f*We(g)),s.arc(0,0,f,g,m,!C),h>_e&&(s.moveTo(h*lt(m),h*We(m)),s.arc(0,0,h,m,g,C));else{var _=g,x=m,p=g,v=m,w=b,k=b,D=a.apply(this,arguments)/2,I=D>_e&&(i?+i.apply(this,arguments):wt(h*h+f*f)),F=Yn(Cr(f-h)/2,+n.apply(this,arguments)),R=F,H=F,$,W;if(I>_e){var ae=kr(I/h*We(D)),ue=kr(I/f*We(D));(w-=ae*2)>_e?(ae*=C?1:-1,p+=ae,v-=ae):(w=0,p=v=(g+m)/2),(k-=ue*2)>_e?(ue*=C?1:-1,_+=ue,x-=ue):(k=0,_=x=(g+m)/2)}var de=f*lt(_),le=f*We(_),Q=h*lt(v),ce=h*We(v);if(F>_e){var se=f*lt(x),te=f*We(x),he=h*lt(p),ke=h*We(p),fe;if(b<Kt)if(fe=Jc(de,le,he,ke,se,te,Q,ce)){var je=de-fe[0],tt=le-fe[1],Ye=se-fe[0],Te=te-fe[1],Ue=1/We(Vc((je*Ye+tt*Te)/(wt(je*je+tt*tt)*wt(Ye*Ye+Te*Te)))/2),$e=wt(fe[0]*fe[0]+fe[1]*fe[1]);R=Yn(F,(h-$e)/(Ue-1)),H=Yn(F,(f-$e)/(Ue+1))}else R=H=0}k>_e?H>_e?($=an(he,ke,de,le,f,H,C),W=an(se,te,Q,ce,f,H,C),s.moveTo($.cx+$.x01,$.cy+$.y01),H<F?s.arc($.cx,$.cy,H,ye($.y01,$.x01),ye(W.y01,W.x01),!C):(s.arc($.cx,$.cy,H,ye($.y01,$.x01),ye($.y11,$.x11),!C),s.arc(0,0,f,ye($.cy+$.y11,$.cx+$.x11),ye(W.cy+W.y11,W.cx+W.x11),!C),s.arc(W.cx,W.cy,H,ye(W.y11,W.x11),ye(W.y01,W.x01),!C))):(s.moveTo(de,le),s.arc(0,0,f,_,x,!C)):s.moveTo(de,le),!(h>_e)||!(w>_e)?s.lineTo(Q,ce):R>_e?($=an(Q,ce,se,te,h,-R,C),W=an(de,le,he,ke,h,-R,C),s.lineTo($.cx+$.x01,$.cy+$.y01),R<F?s.arc($.cx,$.cy,R,ye($.y01,$.x01),ye(W.y01,W.x01),!C):(s.arc($.cx,$.cy,R,ye($.y01,$.x01),ye($.y11,$.x11),!C),s.arc(0,0,h,ye($.cy+$.y11,$.cx+$.x11),ye(W.cy+W.y11,W.cx+W.x11),C),s.arc(W.cx,W.cy,R,ye(W.y11,W.x11),ye(W.y01,W.x01),!C))):s.arc(0,0,h,v,p,C)}if(s.closePath(),c)return s=null,c+""||null}return l.centroid=function(){var c=(+e.apply(this,arguments)+ +t.apply(this,arguments))/2,d=(+r.apply(this,arguments)+ +o.apply(this,arguments))/2-Kt/2;return[lt(d)*c,We(d)*c]},l.innerRadius=function(c){return arguments.length?(e=typeof c=="function"?c:ee(+c),l):e},l.outerRadius=function(c){return arguments.length?(t=typeof c=="function"?c:ee(+c),l):t},l.cornerRadius=function(c){return arguments.length?(n=typeof c=="function"?c:ee(+c),l):n},l.padRadius=function(c){return arguments.length?(i=c==null?null:typeof c=="function"?c:ee(+c),l):i},l.startAngle=function(c){return arguments.length?(r=typeof c=="function"?c:ee(+c),l):r},l.endAngle=function(c){return arguments.length?(o=typeof c=="function"?c:ee(+c),l):o},l.padAngle=function(c){return arguments.length?(a=typeof c=="function"?c:ee(+c),l):a},l.context=function(c){return arguments.length?(s=c??null,l):s},l}function zi(e){return typeof e=="object"&&"length"in e?e:Array.from(e)}function Po(e){this._context=e}Po.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._point=0},lineEnd:function(){(this._line||this._line!==0&&this._point===1)&&this._context.closePath(),this._line=1-this._line},point:function(e,t){switch(e=+e,t=+t,this._point){case 0:this._point=1,this._line?this._context.lineTo(e,t):this._context.moveTo(e,t);break;case 1:this._point=2;default:this._context.lineTo(e,t);break}}};function Fo(e){return new Po(e)}function Io(e){return e[0]}function zo(e){return e[1]}function Oo(e,t){var n=ee(!0),i=null,r=Fo,o=null,a=Ii(s);e=typeof e=="function"?e:e===void 0?Io:ee(e),t=typeof t=="function"?t:t===void 0?zo:ee(t);function s(u){var l,c=(u=zi(u)).length,d,h=!1,f;for(i==null&&(o=r(f=a())),l=0;l<=c;++l)!(l<c&&n(d=u[l],l,u))===h&&((h=!h)?o.lineStart():o.lineEnd()),h&&o.point(+e(d,l,u),+t(d,l,u));if(f)return o=null,f+""||null}return s.x=function(u){return arguments.length?(e=typeof u=="function"?u:ee(+u),s):e},s.y=function(u){return arguments.length?(t=typeof u=="function"?u:ee(+u),s):t},s.defined=function(u){return arguments.length?(n=typeof u=="function"?u:ee(!!u),s):n},s.curve=function(u){return arguments.length?(r=u,i!=null&&(o=r(i)),s):r},s.context=function(u){return arguments.length?(u==null?i=o=null:o=r(i=u),s):i},s}function ed(e,t,n){var i=null,r=ee(!0),o=null,a=Fo,s=null,u=Ii(l);e=typeof e=="function"?e:e===void 0?Io:ee(+e),t=typeof t=="function"?t:ee(t===void 0?0:+t),n=typeof n=="function"?n:n===void 0?zo:ee(+n);function l(d){var h,f,g,m=(d=zi(d)).length,b,C=!1,_,x=new Array(m),p=new Array(m);for(o==null&&(s=a(_=u())),h=0;h<=m;++h){if(!(h<m&&r(b=d[h],h,d))===C)if(C=!C)f=h,s.areaStart(),s.lineStart();else{for(s.lineEnd(),s.lineStart(),g=h-1;g>=f;--g)s.point(x[g],p[g]);s.lineEnd(),s.areaEnd()}C&&(x[h]=+e(b,h,d),p[h]=+t(b,h,d),s.point(i?+i(b,h,d):x[h],n?+n(b,h,d):p[h]))}if(_)return s=null,_+""||null}function c(){return Oo().defined(r).curve(a).context(o)}return l.x=function(d){return arguments.length?(e=typeof d=="function"?d:ee(+d),i=null,l):e},l.x0=function(d){return arguments.length?(e=typeof d=="function"?d:ee(+d),l):e},l.x1=function(d){return arguments.length?(i=d==null?null:typeof d=="function"?d:ee(+d),l):i},l.y=function(d){return arguments.length?(t=typeof d=="function"?d:ee(+d),n=null,l):t},l.y0=function(d){return arguments.length?(t=typeof d=="function"?d:ee(+d),l):t},l.y1=function(d){return arguments.length?(n=d==null?null:typeof d=="function"?d:ee(+d),l):n},l.lineX0=l.lineY0=function(){return c().x(e).y(t)},l.lineY1=function(){return c().x(e).y(n)},l.lineX1=function(){return c().x(i).y(t)},l.defined=function(d){return arguments.length?(r=typeof d=="function"?d:ee(!!d),l):r},l.curve=function(d){return arguments.length?(a=d,o!=null&&(s=a(o)),l):a},l.context=function(d){return arguments.length?(d==null?o=s=null:s=a(o=d),l):o},l}function td(e,t){return t<e?-1:t>e?1:t>=e?0:NaN}function nd(e){return e}function id(){var e=nd,t=td,n=null,i=ee(0),r=ee(vn),o=ee(0);function a(s){var u,l=(s=zi(s)).length,c,d,h=0,f=new Array(l),g=new Array(l),m=+i.apply(this,arguments),b=Math.min(vn,Math.max(-vn,r.apply(this,arguments)-m)),C,_=Math.min(Math.abs(b)/l,o.apply(this,arguments)),x=_*(b<0?-1:1),p;for(u=0;u<l;++u)(p=g[f[u]=u]=+e(s[u],u,s))>0&&(h+=p);for(t!=null?f.sort(function(v,w){return t(g[v],g[w])}):n!=null&&f.sort(function(v,w){return n(s[v],s[w])}),u=0,d=h?(b-l*x)/h:0;u<l;++u,m=C)c=f[u],p=g[c],C=m+(p>0?p*d:0)+x,g[c]={data:s[c],index:u,value:p,startAngle:m,endAngle:C,padAngle:_};return g}return a.value=function(s){return arguments.length?(e=typeof s=="function"?s:ee(+s),a):e},a.sortValues=function(s){return arguments.length?(t=s,n=null,a):t},a.sort=function(s){return arguments.length?(n=s,t=null,a):n},a.startAngle=function(s){return arguments.length?(i=typeof s=="function"?s:ee(+s),a):i},a.endAngle=function(s){return arguments.length?(r=typeof s=="function"?s:ee(+s),a):r},a.padAngle=function(s){return arguments.length?(o=typeof s=="function"?s:ee(+s),a):o},a}function Tr(e){return e<0?-1:1}function Sr(e,t,n){var i=e._x1-e._x0,r=t-e._x1,o=(e._y1-e._y0)/(i||r<0&&-0),a=(n-e._y1)/(r||i<0&&-0),s=(o*r+a*i)/(i+r);return(Tr(o)+Tr(a))*Math.min(Math.abs(o),Math.abs(a),.5*Math.abs(s))||0}function Ar(e,t){var n=e._x1-e._x0;return n?(3*(e._y1-e._y0)/n-t)/2:t}function Xn(e,t,n){var i=e._x0,r=e._y0,o=e._x1,a=e._y1,s=(o-i)/3;e._context.bezierCurveTo(i+s,r+s*t,o-s,a-s*n,o,a)}function Rn(e){this._context=e}Rn.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._y0=this._y1=this._t0=NaN,this._point=0},lineEnd:function(){switch(this._point){case 2:this._context.lineTo(this._x1,this._y1);break;case 3:Xn(this,this._t0,Ar(this,this._t0));break}(this._line||this._line!==0&&this._point===1)&&this._context.closePath(),this._line=1-this._line},point:function(e,t){var n=NaN;if(e=+e,t=+t,!(e===this._x1&&t===this._y1)){switch(this._point){case 0:this._point=1,this._line?this._context.lineTo(e,t):this._context.moveTo(e,t);break;case 1:this._point=2;break;case 2:this._point=3,Xn(this,Ar(this,n=Sr(this,e,t)),n);break;default:Xn(this,this._t0,n=Sr(this,e,t));break}this._x0=this._x1,this._x1=e,this._y0=this._y1,this._y1=t,this._t0=n}}};Object.create(Rn.prototype).point=function(e,t){Rn.prototype.point.call(this,t,e)};function Lr(e){return new Rn(e)}function Wt(e,t,n){this.k=e,this.x=t,this.y=n}Wt.prototype={constructor:Wt,scale:function(e){return e===1?this:new Wt(this.k*e,this.x,this.y)},translate:function(e,t){return e===0&t===0?this:new Wt(this.k,this.x+this.k*e,this.y+this.k*t)},apply:function(e){return[e[0]*this.k+this.x,e[1]*this.k+this.y]},applyX:function(e){return e*this.k+this.x},applyY:function(e){return e*this.k+this.y},invert:function(e){return[(e[0]-this.x)/this.k,(e[1]-this.y)/this.k]},invertX:function(e){return(e-this.x)/this.k},invertY:function(e){return(e-this.y)/this.k},rescaleX:function(e){return e.copy().domain(e.range().map(this.invertX,this).map(e.invert,e))},rescaleY:function(e){return e.copy().domain(e.range().map(this.invertY,this).map(e.invert,e))},toString:function(){return"translate("+this.x+","+this.y+") scale("+this.k+")"}};Wt.prototype;function rd(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}var sn={exports:{}},Rr;function od(){if(Rr)return sn.exports;Rr=1;var e=typeof Reflect=="object"?Reflect:null,t=e&&typeof e.apply=="function"?e.apply:function(v,w,k){return Function.prototype.apply.call(v,w,k)},n;e&&typeof e.ownKeys=="function"?n=e.ownKeys:Object.getOwnPropertySymbols?n=function(v){return Object.getOwnPropertyNames(v).concat(Object.getOwnPropertySymbols(v))}:n=function(v){return Object.getOwnPropertyNames(v)};function i(p){console&&console.warn&&console.warn(p)}var r=Number.isNaN||function(v){return v!==v};function o(){o.init.call(this)}sn.exports=o,sn.exports.once=C,o.EventEmitter=o,o.prototype._events=void 0,o.prototype._eventsCount=0,o.prototype._maxListeners=void 0;var a=10;function s(p){if(typeof p!="function")throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof p)}Object.defineProperty(o,"defaultMaxListeners",{enumerable:!0,get:function(){return a},set:function(p){if(typeof p!="number"||p<0||r(p))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+p+".");a=p}}),o.init=function(){(this._events===void 0||this._events===Object.getPrototypeOf(this)._events)&&(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},o.prototype.setMaxListeners=function(v){if(typeof v!="number"||v<0||r(v))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+v+".");return this._maxListeners=v,this};function u(p){return p._maxListeners===void 0?o.defaultMaxListeners:p._maxListeners}o.prototype.getMaxListeners=function(){return u(this)},o.prototype.emit=function(v){for(var w=[],k=1;k<arguments.length;k++)w.push(arguments[k]);var D=v==="error",I=this._events;if(I!==void 0)D=D&&I.error===void 0;else if(!D)return!1;if(D){var F;if(w.length>0&&(F=w[0]),F instanceof Error)throw F;var R=new Error("Unhandled error."+(F?" ("+F.message+")":""));throw R.context=F,R}var H=I[v];if(H===void 0)return!1;if(typeof H=="function")t(H,this,w);else for(var $=H.length,W=g(H,$),k=0;k<$;++k)t(W[k],this,w);return!0};function l(p,v,w,k){var D,I,F;if(s(w),I=p._events,I===void 0?(I=p._events=Object.create(null),p._eventsCount=0):(I.newListener!==void 0&&(p.emit("newListener",v,w.listener?w.listener:w),I=p._events),F=I[v]),F===void 0)F=I[v]=w,++p._eventsCount;else if(typeof F=="function"?F=I[v]=k?[w,F]:[F,w]:k?F.unshift(w):F.push(w),D=u(p),D>0&&F.length>D&&!F.warned){F.warned=!0;var R=new Error("Possible EventEmitter memory leak detected. "+F.length+" "+String(v)+" listeners added. Use emitter.setMaxListeners() to increase limit");R.name="MaxListenersExceededWarning",R.emitter=p,R.type=v,R.count=F.length,i(R)}return p}o.prototype.addListener=function(v,w){return l(this,v,w,!1)},o.prototype.on=o.prototype.addListener,o.prototype.prependListener=function(v,w){return l(this,v,w,!0)};function c(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,arguments.length===0?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function d(p,v,w){var k={fired:!1,wrapFn:void 0,target:p,type:v,listener:w},D=c.bind(k);return D.listener=w,k.wrapFn=D,D}o.prototype.once=function(v,w){return s(w),this.on(v,d(this,v,w)),this},o.prototype.prependOnceListener=function(v,w){return s(w),this.prependListener(v,d(this,v,w)),this},o.prototype.removeListener=function(v,w){var k,D,I,F,R;if(s(w),D=this._events,D===void 0)return this;if(k=D[v],k===void 0)return this;if(k===w||k.listener===w)--this._eventsCount===0?this._events=Object.create(null):(delete D[v],D.removeListener&&this.emit("removeListener",v,k.listener||w));else if(typeof k!="function"){for(I=-1,F=k.length-1;F>=0;F--)if(k[F]===w||k[F].listener===w){R=k[F].listener,I=F;break}if(I<0)return this;I===0?k.shift():m(k,I),k.length===1&&(D[v]=k[0]),D.removeListener!==void 0&&this.emit("removeListener",v,R||w)}return this},o.prototype.off=o.prototype.removeListener,o.prototype.removeAllListeners=function(v){var w,k,D;if(k=this._events,k===void 0)return this;if(k.removeListener===void 0)return arguments.length===0?(this._events=Object.create(null),this._eventsCount=0):k[v]!==void 0&&(--this._eventsCount===0?this._events=Object.create(null):delete k[v]),this;if(arguments.length===0){var I=Object.keys(k),F;for(D=0;D<I.length;++D)F=I[D],F!=="removeListener"&&this.removeAllListeners(F);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if(w=k[v],typeof w=="function")this.removeListener(v,w);else if(w!==void 0)for(D=w.length-1;D>=0;D--)this.removeListener(v,w[D]);return this};function h(p,v,w){var k=p._events;if(k===void 0)return[];var D=k[v];return D===void 0?[]:typeof D=="function"?w?[D.listener||D]:[D]:w?b(D):g(D,D.length)}o.prototype.listeners=function(v){return h(this,v,!0)},o.prototype.rawListeners=function(v){return h(this,v,!1)},o.listenerCount=function(p,v){return typeof p.listenerCount=="function"?p.listenerCount(v):f.call(p,v)},o.prototype.listenerCount=f;function f(p){var v=this._events;if(v!==void 0){var w=v[p];if(typeof w=="function")return 1;if(w!==void 0)return w.length}return 0}o.prototype.eventNames=function(){return this._eventsCount>0?n(this._events):[]};function g(p,v){for(var w=new Array(v),k=0;k<v;++k)w[k]=p[k];return w}function m(p,v){for(;v+1<p.length;v++)p[v]=p[v+1];p.pop()}function b(p){for(var v=new Array(p.length),w=0;w<v.length;++w)v[w]=p[w].listener||p[w];return v}function C(p,v){return new Promise(function(w,k){function D(F){p.removeListener(v,I),k(F)}function I(){typeof p.removeListener=="function"&&p.removeListener("error",D),w([].slice.call(arguments))}x(p,v,I,{once:!0}),v!=="error"&&_(p,D,{once:!0})})}function _(p,v,w){typeof p.on=="function"&&x(p,"error",v,w)}function x(p,v,w,k){if(typeof p.on=="function")k.once?p.once(v,w):p.on(v,w);else if(typeof p.addEventListener=="function")p.addEventListener(v,function D(I){k.once&&p.removeEventListener(v,D),w(I)});else throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof p)}return sn.exports}var Bo=od();function ad(){const e=arguments[0];for(let t=1,n=arguments.length;t<n;t++)if(arguments[t])for(const i in arguments[t])e[i]=arguments[t][i];return e}let pe=ad;typeof Object.assign=="function"&&(pe=Object.assign);function Ne(e,t,n,i){const r=e._nodes.get(t);let o=null;return r&&(i==="mixed"?o=r.out&&r.out[n]||r.undirected&&r.undirected[n]:i==="directed"?o=r.out&&r.out[n]:o=r.undirected&&r.undirected[n]),o}function ve(e){return typeof e=="object"&&e!==null}function Uo(e){let t;for(t in e)return!1;return!0}function Re(e,t,n){Object.defineProperty(e,t,{enumerable:!1,configurable:!1,writable:!0,value:n})}function Pe(e,t,n){const i={enumerable:!0,configurable:!0};typeof n=="function"?i.get=n:(i.value=n,i.writable=!1),Object.defineProperty(e,t,i)}function Nr(e){return!(!ve(e)||e.attributes&&!Array.isArray(e.attributes))}function sd(){let e=Math.floor(Math.random()*256)&255;return()=>e++}function Je(){const e=arguments;let t=null,n=-1;return{[Symbol.iterator](){return this},next(){let i=null;do{if(t===null){if(n++,n>=e.length)return{done:!0};t=e[n][Symbol.iterator]()}if(i=t.next(),i.done){t=null;continue}break}while(!0);return i}}}function At(){return{[Symbol.iterator](){return this},next(){return{done:!0}}}}class Oi extends Error{constructor(t){super(),this.name="GraphError",this.message=t}}class z extends Oi{constructor(t){super(t),this.name="InvalidArgumentsGraphError",typeof Error.captureStackTrace=="function"&&Error.captureStackTrace(this,z.prototype.constructor)}}class M extends Oi{constructor(t){super(t),this.name="NotFoundGraphError",typeof Error.captureStackTrace=="function"&&Error.captureStackTrace(this,M.prototype.constructor)}}class Y extends Oi{constructor(t){super(t),this.name="UsageGraphError",typeof Error.captureStackTrace=="function"&&Error.captureStackTrace(this,Y.prototype.constructor)}}function Ho(e,t){this.key=e,this.attributes=t,this.clear()}Ho.prototype.clear=function(){this.inDegree=0,this.outDegree=0,this.undirectedDegree=0,this.undirectedLoops=0,this.directedLoops=0,this.in={},this.out={},this.undirected={}};function Wo(e,t){this.key=e,this.attributes=t,this.clear()}Wo.prototype.clear=function(){this.inDegree=0,this.outDegree=0,this.directedLoops=0,this.in={},this.out={}};function qo(e,t){this.key=e,this.attributes=t,this.clear()}qo.prototype.clear=function(){this.undirectedDegree=0,this.undirectedLoops=0,this.undirected={}};function Lt(e,t,n,i,r){this.key=t,this.attributes=r,this.undirected=e,this.source=n,this.target=i}Lt.prototype.attach=function(){let e="out",t="in";this.undirected&&(e=t="undirected");const n=this.source.key,i=this.target.key;this.source[e][i]=this,!(this.undirected&&n===i)&&(this.target[t][n]=this)};Lt.prototype.attachMulti=function(){let e="out",t="in";const n=this.source.key,i=this.target.key;this.undirected&&(e=t="undirected");const r=this.source[e],o=r[i];if(typeof o>"u"){r[i]=this,this.undirected&&n===i||(this.target[t][n]=this);return}o.previous=this,this.next=o,r[i]=this,this.target[t][n]=this};Lt.prototype.detach=function(){const e=this.source.key,t=this.target.key;let n="out",i="in";this.undirected&&(n=i="undirected"),delete this.source[n][t],delete this.target[i][e]};Lt.prototype.detachMulti=function(){const e=this.source.key,t=this.target.key;let n="out",i="in";this.undirected&&(n=i="undirected"),this.previous===void 0?this.next===void 0?(delete this.source[n][t],delete this.target[i][e]):(this.next.previous=void 0,this.source[n][t]=this.next,this.target[i][e]=this.next):(this.previous.next=this.next,this.next!==void 0&&(this.next.previous=this.previous))};const Vo=0,jo=1,ud=2,Yo=3;function et(e,t,n,i,r,o,a){let s,u,l,c;if(i=""+i,n===Vo){if(s=e._nodes.get(i),!s)throw new M(`Graph.${t}: could not find the "${i}" node in the graph.`);l=r,c=o}else if(n===Yo){if(r=""+r,u=e._edges.get(r),!u)throw new M(`Graph.${t}: could not find the "${r}" edge in the graph.`);const d=u.source.key,h=u.target.key;if(i===d)s=u.target;else if(i===h)s=u.source;else throw new M(`Graph.${t}: the "${i}" node is not attached to the "${r}" edge (${d}, ${h}).`);l=o,c=a}else{if(u=e._edges.get(i),!u)throw new M(`Graph.${t}: could not find the "${i}" edge in the graph.`);n===jo?s=u.source:s=u.target,l=r,c=o}return[s,l,c]}function ld(e,t,n){e.prototype[t]=function(i,r,o){const[a,s]=et(this,t,n,i,r,o);return a.attributes[s]}}function cd(e,t,n){e.prototype[t]=function(i,r){const[o]=et(this,t,n,i,r);return o.attributes}}function dd(e,t,n){e.prototype[t]=function(i,r,o){const[a,s]=et(this,t,n,i,r,o);return a.attributes.hasOwnProperty(s)}}function hd(e,t,n){e.prototype[t]=function(i,r,o,a){const[s,u,l]=et(this,t,n,i,r,o,a);return s.attributes[u]=l,this.emit("nodeAttributesUpdated",{key:s.key,type:"set",attributes:s.attributes,name:u}),this}}function fd(e,t,n){e.prototype[t]=function(i,r,o,a){const[s,u,l]=et(this,t,n,i,r,o,a);if(typeof l!="function")throw new z(`Graph.${t}: updater should be a function.`);const c=s.attributes,d=l(c[u]);return c[u]=d,this.emit("nodeAttributesUpdated",{key:s.key,type:"set",attributes:s.attributes,name:u}),this}}function gd(e,t,n){e.prototype[t]=function(i,r,o){const[a,s]=et(this,t,n,i,r,o);return delete a.attributes[s],this.emit("nodeAttributesUpdated",{key:a.key,type:"remove",attributes:a.attributes,name:s}),this}}function pd(e,t,n){e.prototype[t]=function(i,r,o){const[a,s]=et(this,t,n,i,r,o);if(!ve(s))throw new z(`Graph.${t}: provided attributes are not a plain object.`);return a.attributes=s,this.emit("nodeAttributesUpdated",{key:a.key,type:"replace",attributes:a.attributes}),this}}function md(e,t,n){e.prototype[t]=function(i,r,o){const[a,s]=et(this,t,n,i,r,o);if(!ve(s))throw new z(`Graph.${t}: provided attributes are not a plain object.`);return pe(a.attributes,s),this.emit("nodeAttributesUpdated",{key:a.key,type:"merge",attributes:a.attributes,data:s}),this}}function vd(e,t,n){e.prototype[t]=function(i,r,o){const[a,s]=et(this,t,n,i,r,o);if(typeof s!="function")throw new z(`Graph.${t}: provided updater is not a function.`);return a.attributes=s(a.attributes),this.emit("nodeAttributesUpdated",{key:a.key,type:"update",attributes:a.attributes}),this}}const yd=[{name:e=>`get${e}Attribute`,attacher:ld},{name:e=>`get${e}Attributes`,attacher:cd},{name:e=>`has${e}Attribute`,attacher:dd},{name:e=>`set${e}Attribute`,attacher:hd},{name:e=>`update${e}Attribute`,attacher:fd},{name:e=>`remove${e}Attribute`,attacher:gd},{name:e=>`replace${e}Attributes`,attacher:pd},{name:e=>`merge${e}Attributes`,attacher:md},{name:e=>`update${e}Attributes`,attacher:vd}];function bd(e){yd.forEach(function({name:t,attacher:n}){n(e,t("Node"),Vo),n(e,t("Source"),jo),n(e,t("Target"),ud),n(e,t("Opposite"),Yo)})}function wd(e,t,n){e.prototype[t]=function(i,r){let o;if(this.type!=="mixed"&&n!=="mixed"&&n!==this.type)throw new Y(`Graph.${t}: cannot find this type of edges in your ${this.type} graph.`);if(arguments.length>2){if(this.multi)throw new Y(`Graph.${t}: cannot use a {source,target} combo when asking about an edge's attributes in a MultiGraph since we cannot infer the one you want information about.`);const a=""+i,s=""+r;if(r=arguments[2],o=Ne(this,a,s,n),!o)throw new M(`Graph.${t}: could not find an edge for the given path ("${a}" - "${s}").`)}else{if(n!=="mixed")throw new Y(`Graph.${t}: calling this method with only a key (vs. a source and target) does not make sense since an edge with this key could have the other type.`);if(i=""+i,o=this._edges.get(i),!o)throw new M(`Graph.${t}: could not find the "${i}" edge in the graph.`)}return o.attributes[r]}}function _d(e,t,n){e.prototype[t]=function(i){let r;if(this.type!=="mixed"&&n!=="mixed"&&n!==this.type)throw new Y(`Graph.${t}: cannot find this type of edges in your ${this.type} graph.`);if(arguments.length>1){if(this.multi)throw new Y(`Graph.${t}: cannot use a {source,target} combo when asking about an edge's attributes in a MultiGraph since we cannot infer the one you want information about.`);const o=""+i,a=""+arguments[1];if(r=Ne(this,o,a,n),!r)throw new M(`Graph.${t}: could not find an edge for the given path ("${o}" - "${a}").`)}else{if(n!=="mixed")throw new Y(`Graph.${t}: calling this method with only a key (vs. a source and target) does not make sense since an edge with this key could have the other type.`);if(i=""+i,r=this._edges.get(i),!r)throw new M(`Graph.${t}: could not find the "${i}" edge in the graph.`)}return r.attributes}}function xd(e,t,n){e.prototype[t]=function(i,r){let o;if(this.type!=="mixed"&&n!=="mixed"&&n!==this.type)throw new Y(`Graph.${t}: cannot find this type of edges in your ${this.type} graph.`);if(arguments.length>2){if(this.multi)throw new Y(`Graph.${t}: cannot use a {source,target} combo when asking about an edge's attributes in a MultiGraph since we cannot infer the one you want information about.`);const a=""+i,s=""+r;if(r=arguments[2],o=Ne(this,a,s,n),!o)throw new M(`Graph.${t}: could not find an edge for the given path ("${a}" - "${s}").`)}else{if(n!=="mixed")throw new Y(`Graph.${t}: calling this method with only a key (vs. a source and target) does not make sense since an edge with this key could have the other type.`);if(i=""+i,o=this._edges.get(i),!o)throw new M(`Graph.${t}: could not find the "${i}" edge in the graph.`)}return o.attributes.hasOwnProperty(r)}}function Ed(e,t,n){e.prototype[t]=function(i,r,o){let a;if(this.type!=="mixed"&&n!=="mixed"&&n!==this.type)throw new Y(`Graph.${t}: cannot find this type of edges in your ${this.type} graph.`);if(arguments.length>3){if(this.multi)throw new Y(`Graph.${t}: cannot use a {source,target} combo when asking about an edge's attributes in a MultiGraph since we cannot infer the one you want information about.`);const s=""+i,u=""+r;if(r=arguments[2],o=arguments[3],a=Ne(this,s,u,n),!a)throw new M(`Graph.${t}: could not find an edge for the given path ("${s}" - "${u}").`)}else{if(n!=="mixed")throw new Y(`Graph.${t}: calling this method with only a key (vs. a source and target) does not make sense since an edge with this key could have the other type.`);if(i=""+i,a=this._edges.get(i),!a)throw new M(`Graph.${t}: could not find the "${i}" edge in the graph.`)}return a.attributes[r]=o,this.emit("edgeAttributesUpdated",{key:a.key,type:"set",attributes:a.attributes,name:r}),this}}function Cd(e,t,n){e.prototype[t]=function(i,r,o){let a;if(this.type!=="mixed"&&n!=="mixed"&&n!==this.type)throw new Y(`Graph.${t}: cannot find this type of edges in your ${this.type} graph.`);if(arguments.length>3){if(this.multi)throw new Y(`Graph.${t}: cannot use a {source,target} combo when asking about an edge's attributes in a MultiGraph since we cannot infer the one you want information about.`);const s=""+i,u=""+r;if(r=arguments[2],o=arguments[3],a=Ne(this,s,u,n),!a)throw new M(`Graph.${t}: could not find an edge for the given path ("${s}" - "${u}").`)}else{if(n!=="mixed")throw new Y(`Graph.${t}: calling this method with only a key (vs. a source and target) does not make sense since an edge with this key could have the other type.`);if(i=""+i,a=this._edges.get(i),!a)throw new M(`Graph.${t}: could not find the "${i}" edge in the graph.`)}if(typeof o!="function")throw new z(`Graph.${t}: updater should be a function.`);return a.attributes[r]=o(a.attributes[r]),this.emit("edgeAttributesUpdated",{key:a.key,type:"set",attributes:a.attributes,name:r}),this}}function kd(e,t,n){e.prototype[t]=function(i,r){let o;if(this.type!=="mixed"&&n!=="mixed"&&n!==this.type)throw new Y(`Graph.${t}: cannot find this type of edges in your ${this.type} graph.`);if(arguments.length>2){if(this.multi)throw new Y(`Graph.${t}: cannot use a {source,target} combo when asking about an edge's attributes in a MultiGraph since we cannot infer the one you want information about.`);const a=""+i,s=""+r;if(r=arguments[2],o=Ne(this,a,s,n),!o)throw new M(`Graph.${t}: could not find an edge for the given path ("${a}" - "${s}").`)}else{if(n!=="mixed")throw new Y(`Graph.${t}: calling this method with only a key (vs. a source and target) does not make sense since an edge with this key could have the other type.`);if(i=""+i,o=this._edges.get(i),!o)throw new M(`Graph.${t}: could not find the "${i}" edge in the graph.`)}return delete o.attributes[r],this.emit("edgeAttributesUpdated",{key:o.key,type:"remove",attributes:o.attributes,name:r}),this}}function Td(e,t,n){e.prototype[t]=function(i,r){let o;if(this.type!=="mixed"&&n!=="mixed"&&n!==this.type)throw new Y(`Graph.${t}: cannot find this type of edges in your ${this.type} graph.`);if(arguments.length>2){if(this.multi)throw new Y(`Graph.${t}: cannot use a {source,target} combo when asking about an edge's attributes in a MultiGraph since we cannot infer the one you want information about.`);const a=""+i,s=""+r;if(r=arguments[2],o=Ne(this,a,s,n),!o)throw new M(`Graph.${t}: could not find an edge for the given path ("${a}" - "${s}").`)}else{if(n!=="mixed")throw new Y(`Graph.${t}: calling this method with only a key (vs. a source and target) does not make sense since an edge with this key could have the other type.`);if(i=""+i,o=this._edges.get(i),!o)throw new M(`Graph.${t}: could not find the "${i}" edge in the graph.`)}if(!ve(r))throw new z(`Graph.${t}: provided attributes are not a plain object.`);return o.attributes=r,this.emit("edgeAttributesUpdated",{key:o.key,type:"replace",attributes:o.attributes}),this}}function Sd(e,t,n){e.prototype[t]=function(i,r){let o;if(this.type!=="mixed"&&n!=="mixed"&&n!==this.type)throw new Y(`Graph.${t}: cannot find this type of edges in your ${this.type} graph.`);if(arguments.length>2){if(this.multi)throw new Y(`Graph.${t}: cannot use a {source,target} combo when asking about an edge's attributes in a MultiGraph since we cannot infer the one you want information about.`);const a=""+i,s=""+r;if(r=arguments[2],o=Ne(this,a,s,n),!o)throw new M(`Graph.${t}: could not find an edge for the given path ("${a}" - "${s}").`)}else{if(n!=="mixed")throw new Y(`Graph.${t}: calling this method with only a key (vs. a source and target) does not make sense since an edge with this key could have the other type.`);if(i=""+i,o=this._edges.get(i),!o)throw new M(`Graph.${t}: could not find the "${i}" edge in the graph.`)}if(!ve(r))throw new z(`Graph.${t}: provided attributes are not a plain object.`);return pe(o.attributes,r),this.emit("edgeAttributesUpdated",{key:o.key,type:"merge",attributes:o.attributes,data:r}),this}}function Ad(e,t,n){e.prototype[t]=function(i,r){let o;if(this.type!=="mixed"&&n!=="mixed"&&n!==this.type)throw new Y(`Graph.${t}: cannot find this type of edges in your ${this.type} graph.`);if(arguments.length>2){if(this.multi)throw new Y(`Graph.${t}: cannot use a {source,target} combo when asking about an edge's attributes in a MultiGraph since we cannot infer the one you want information about.`);const a=""+i,s=""+r;if(r=arguments[2],o=Ne(this,a,s,n),!o)throw new M(`Graph.${t}: could not find an edge for the given path ("${a}" - "${s}").`)}else{if(n!=="mixed")throw new Y(`Graph.${t}: calling this method with only a key (vs. a source and target) does not make sense since an edge with this key could have the other type.`);if(i=""+i,o=this._edges.get(i),!o)throw new M(`Graph.${t}: could not find the "${i}" edge in the graph.`)}if(typeof r!="function")throw new z(`Graph.${t}: provided updater is not a function.`);return o.attributes=r(o.attributes),this.emit("edgeAttributesUpdated",{key:o.key,type:"update",attributes:o.attributes}),this}}const Ld=[{name:e=>`get${e}Attribute`,attacher:wd},{name:e=>`get${e}Attributes`,attacher:_d},{name:e=>`has${e}Attribute`,attacher:xd},{name:e=>`set${e}Attribute`,attacher:Ed},{name:e=>`update${e}Attribute`,attacher:Cd},{name:e=>`remove${e}Attribute`,attacher:kd},{name:e=>`replace${e}Attributes`,attacher:Td},{name:e=>`merge${e}Attributes`,attacher:Sd},{name:e=>`update${e}Attributes`,attacher:Ad}];function Rd(e){Ld.forEach(function({name:t,attacher:n}){n(e,t("Edge"),"mixed"),n(e,t("DirectedEdge"),"directed"),n(e,t("UndirectedEdge"),"undirected")})}const Nd=[{name:"edges",type:"mixed"},{name:"inEdges",type:"directed",direction:"in"},{name:"outEdges",type:"directed",direction:"out"},{name:"inboundEdges",type:"mixed",direction:"in"},{name:"outboundEdges",type:"mixed",direction:"out"},{name:"directedEdges",type:"directed"},{name:"undirectedEdges",type:"undirected"}];function Md(e,t,n,i){let r=!1;for(const o in t){if(o===i)continue;const a=t[o];if(r=n(a.key,a.attributes,a.source.key,a.target.key,a.source.attributes,a.target.attributes,a.undirected),e&&r)return a.key}}function Dd(e,t,n,i){let r,o,a,s=!1;for(const u in t)if(u!==i){r=t[u];do{if(o=r.source,a=r.target,s=n(r.key,r.attributes,o.key,a.key,o.attributes,a.attributes,r.undirected),e&&s)return r.key;r=r.next}while(r!==void 0)}}function Kn(e,t){const n=Object.keys(e),i=n.length;let r,o=0;return{[Symbol.iterator](){return this},next(){do if(r)r=r.next;else{if(o>=i)return{done:!0};const a=n[o++];if(a===t){r=void 0;continue}r=e[a]}while(!r);return{done:!1,value:{edge:r.key,attributes:r.attributes,source:r.source.key,target:r.target.key,sourceAttributes:r.source.attributes,targetAttributes:r.target.attributes,undirected:r.undirected}}}}}function $d(e,t,n,i){const r=t[n];if(!r)return;const o=r.source,a=r.target;if(i(r.key,r.attributes,o.key,a.key,o.attributes,a.attributes,r.undirected)&&e)return r.key}function Gd(e,t,n,i){let r=t[n];if(!r)return;let o=!1;do{if(o=i(r.key,r.attributes,r.source.key,r.target.key,r.source.attributes,r.target.attributes,r.undirected),e&&o)return r.key;r=r.next}while(r!==void 0)}function Zn(e,t){let n=e[t];if(n.next!==void 0)return{[Symbol.iterator](){return this},next(){if(!n)return{done:!0};const r={edge:n.key,attributes:n.attributes,source:n.source.key,target:n.target.key,sourceAttributes:n.source.attributes,targetAttributes:n.target.attributes,undirected:n.undirected};return n=n.next,{done:!1,value:r}}};let i=!1;return{[Symbol.iterator](){return this},next(){return i===!0?{done:!0}:(i=!0,{done:!1,value:{edge:n.key,attributes:n.attributes,source:n.source.key,target:n.target.key,sourceAttributes:n.source.attributes,targetAttributes:n.target.attributes,undirected:n.undirected}})}}}function Pd(e,t){if(e.size===0)return[];if(t==="mixed"||t===e.type)return Array.from(e._edges.keys());const n=t==="undirected"?e.undirectedSize:e.directedSize,i=new Array(n),r=t==="undirected",o=e._edges.values();let a=0,s,u;for(;s=o.next(),s.done!==!0;)u=s.value,u.undirected===r&&(i[a++]=u.key);return i}function Xo(e,t,n,i){if(t.size===0)return;const r=n!=="mixed"&&n!==t.type,o=n==="undirected";let a,s,u=!1;const l=t._edges.values();for(;a=l.next(),a.done!==!0;){if(s=a.value,r&&s.undirected!==o)continue;const{key:c,attributes:d,source:h,target:f}=s;if(u=i(c,d,h.key,f.key,h.attributes,f.attributes,s.undirected),e&&u)return c}}function Fd(e,t){if(e.size===0)return At();const n=t!=="mixed"&&t!==e.type,i=t==="undirected",r=e._edges.values();return{[Symbol.iterator](){return this},next(){let o,a;for(;;){if(o=r.next(),o.done)return o;if(a=o.value,!(n&&a.undirected!==i))break}return{value:{edge:a.key,attributes:a.attributes,source:a.source.key,target:a.target.key,sourceAttributes:a.source.attributes,targetAttributes:a.target.attributes,undirected:a.undirected},done:!1}}}}function Bi(e,t,n,i,r,o){const a=t?Dd:Md;let s;if(n!=="undirected"&&(i!=="out"&&(s=a(e,r.in,o),e&&s)||i!=="in"&&(s=a(e,r.out,o,i?void 0:r.key),e&&s))||n!=="directed"&&(s=a(e,r.undirected,o),e&&s))return s}function Id(e,t,n,i){const r=[];return Bi(!1,e,t,n,i,function(o){r.push(o)}),r}function zd(e,t,n){let i=At();return e!=="undirected"&&(t!=="out"&&typeof n.in<"u"&&(i=Je(i,Kn(n.in))),t!=="in"&&typeof n.out<"u"&&(i=Je(i,Kn(n.out,t?void 0:n.key)))),e!=="directed"&&typeof n.undirected<"u"&&(i=Je(i,Kn(n.undirected))),i}function Ui(e,t,n,i,r,o,a){const s=n?Gd:$d;let u;if(t!=="undirected"&&(typeof r.in<"u"&&i!=="out"&&(u=s(e,r.in,o,a),e&&u)||typeof r.out<"u"&&i!=="in"&&(i||r.key!==o)&&(u=s(e,r.out,o,a),e&&u))||t!=="directed"&&typeof r.undirected<"u"&&(u=s(e,r.undirected,o,a),e&&u))return u}function Od(e,t,n,i,r){const o=[];return Ui(!1,e,t,n,i,r,function(a){o.push(a)}),o}function Bd(e,t,n,i){let r=At();return e!=="undirected"&&(typeof n.in<"u"&&t!=="out"&&i in n.in&&(r=Je(r,Zn(n.in,i))),typeof n.out<"u"&&t!=="in"&&i in n.out&&(t||n.key!==i)&&(r=Je(r,Zn(n.out,i)))),e!=="directed"&&typeof n.undirected<"u"&&i in n.undirected&&(r=Je(r,Zn(n.undirected,i))),r}function Ud(e,t){const{name:n,type:i,direction:r}=t;e.prototype[n]=function(o,a){if(i!=="mixed"&&this.type!=="mixed"&&i!==this.type)return[];if(!arguments.length)return Pd(this,i);if(arguments.length===1){o=""+o;const s=this._nodes.get(o);if(typeof s>"u")throw new M(`Graph.${n}: could not find the "${o}" node in the graph.`);return Id(this.multi,i==="mixed"?this.type:i,r,s)}if(arguments.length===2){o=""+o,a=""+a;const s=this._nodes.get(o);if(!s)throw new M(`Graph.${n}:  could not find the "${o}" source node in the graph.`);if(!this._nodes.has(a))throw new M(`Graph.${n}:  could not find the "${a}" target node in the graph.`);return Od(i,this.multi,r,s,a)}throw new z(`Graph.${n}: too many arguments (expecting 0, 1 or 2 and got ${arguments.length}).`)}}function Hd(e,t){const{name:n,type:i,direction:r}=t,o="forEach"+n[0].toUpperCase()+n.slice(1,-1);e.prototype[o]=function(l,c,d){if(!(i!=="mixed"&&this.type!=="mixed"&&i!==this.type)){if(arguments.length===1)return d=l,Xo(!1,this,i,d);if(arguments.length===2){l=""+l,d=c;const h=this._nodes.get(l);if(typeof h>"u")throw new M(`Graph.${o}: could not find the "${l}" node in the graph.`);return Bi(!1,this.multi,i==="mixed"?this.type:i,r,h,d)}if(arguments.length===3){l=""+l,c=""+c;const h=this._nodes.get(l);if(!h)throw new M(`Graph.${o}:  could not find the "${l}" source node in the graph.`);if(!this._nodes.has(c))throw new M(`Graph.${o}:  could not find the "${c}" target node in the graph.`);return Ui(!1,i,this.multi,r,h,c,d)}throw new z(`Graph.${o}: too many arguments (expecting 1, 2 or 3 and got ${arguments.length}).`)}};const a="map"+n[0].toUpperCase()+n.slice(1);e.prototype[a]=function(){const l=Array.prototype.slice.call(arguments),c=l.pop();let d;if(l.length===0){let h=0;i!=="directed"&&(h+=this.undirectedSize),i!=="undirected"&&(h+=this.directedSize),d=new Array(h);let f=0;l.push((g,m,b,C,_,x,p)=>{d[f++]=c(g,m,b,C,_,x,p)})}else d=[],l.push((h,f,g,m,b,C,_)=>{d.push(c(h,f,g,m,b,C,_))});return this[o].apply(this,l),d};const s="filter"+n[0].toUpperCase()+n.slice(1);e.prototype[s]=function(){const l=Array.prototype.slice.call(arguments),c=l.pop(),d=[];return l.push((h,f,g,m,b,C,_)=>{c(h,f,g,m,b,C,_)&&d.push(h)}),this[o].apply(this,l),d};const u="reduce"+n[0].toUpperCase()+n.slice(1);e.prototype[u]=function(){let l=Array.prototype.slice.call(arguments);if(l.length<2||l.length>4)throw new z(`Graph.${u}: invalid number of arguments (expecting 2, 3 or 4 and got ${l.length}).`);if(typeof l[l.length-1]=="function"&&typeof l[l.length-2]!="function")throw new z(`Graph.${u}: missing initial value. You must provide it because the callback takes more than one argument and we cannot infer the initial value from the first iteration, as you could with a simple array.`);let c,d;l.length===2?(c=l[0],d=l[1],l=[]):l.length===3?(c=l[1],d=l[2],l=[l[0]]):l.length===4&&(c=l[2],d=l[3],l=[l[0],l[1]]);let h=d;return l.push((f,g,m,b,C,_,x)=>{h=c(h,f,g,m,b,C,_,x)}),this[o].apply(this,l),h}}function Wd(e,t){const{name:n,type:i,direction:r}=t,o="find"+n[0].toUpperCase()+n.slice(1,-1);e.prototype[o]=function(u,l,c){if(i!=="mixed"&&this.type!=="mixed"&&i!==this.type)return!1;if(arguments.length===1)return c=u,Xo(!0,this,i,c);if(arguments.length===2){u=""+u,c=l;const d=this._nodes.get(u);if(typeof d>"u")throw new M(`Graph.${o}: could not find the "${u}" node in the graph.`);return Bi(!0,this.multi,i==="mixed"?this.type:i,r,d,c)}if(arguments.length===3){u=""+u,l=""+l;const d=this._nodes.get(u);if(!d)throw new M(`Graph.${o}:  could not find the "${u}" source node in the graph.`);if(!this._nodes.has(l))throw new M(`Graph.${o}:  could not find the "${l}" target node in the graph.`);return Ui(!0,i,this.multi,r,d,l,c)}throw new z(`Graph.${o}: too many arguments (expecting 1, 2 or 3 and got ${arguments.length}).`)};const a="some"+n[0].toUpperCase()+n.slice(1,-1);e.prototype[a]=function(){const u=Array.prototype.slice.call(arguments),l=u.pop();return u.push((d,h,f,g,m,b,C)=>l(d,h,f,g,m,b,C)),!!this[o].apply(this,u)};const s="every"+n[0].toUpperCase()+n.slice(1,-1);e.prototype[s]=function(){const u=Array.prototype.slice.call(arguments),l=u.pop();return u.push((d,h,f,g,m,b,C)=>!l(d,h,f,g,m,b,C)),!this[o].apply(this,u)}}function qd(e,t){const{name:n,type:i,direction:r}=t,o=n.slice(0,-1)+"Entries";e.prototype[o]=function(a,s){if(i!=="mixed"&&this.type!=="mixed"&&i!==this.type)return At();if(!arguments.length)return Fd(this,i);if(arguments.length===1){a=""+a;const u=this._nodes.get(a);if(!u)throw new M(`Graph.${o}: could not find the "${a}" node in the graph.`);return zd(i,r,u)}if(arguments.length===2){a=""+a,s=""+s;const u=this._nodes.get(a);if(!u)throw new M(`Graph.${o}:  could not find the "${a}" source node in the graph.`);if(!this._nodes.has(s))throw new M(`Graph.${o}:  could not find the "${s}" target node in the graph.`);return Bd(i,r,u,s)}throw new z(`Graph.${o}: too many arguments (expecting 0, 1 or 2 and got ${arguments.length}).`)}}function Vd(e){Nd.forEach(t=>{Ud(e,t),Hd(e,t),Wd(e,t),qd(e,t)})}const jd=[{name:"neighbors",type:"mixed"},{name:"inNeighbors",type:"directed",direction:"in"},{name:"outNeighbors",type:"directed",direction:"out"},{name:"inboundNeighbors",type:"mixed",direction:"in"},{name:"outboundNeighbors",type:"mixed",direction:"out"},{name:"directedNeighbors",type:"directed"},{name:"undirectedNeighbors",type:"undirected"}];function Pn(){this.A=null,this.B=null}Pn.prototype.wrap=function(e){this.A===null?this.A=e:this.B===null&&(this.B=e)};Pn.prototype.has=function(e){return this.A!==null&&e in this.A||this.B!==null&&e in this.B};function $t(e,t,n,i,r){for(const o in i){const a=i[o],s=a.source,u=a.target,l=s===n?u:s;if(t&&t.has(l.key))continue;const c=r(l.key,l.attributes);if(e&&c)return l.key}}function Hi(e,t,n,i,r){if(t!=="mixed"){if(t==="undirected")return $t(e,null,i,i.undirected,r);if(typeof n=="string")return $t(e,null,i,i[n],r)}const o=new Pn;let a;if(t!=="undirected"){if(n!=="out"){if(a=$t(e,null,i,i.in,r),e&&a)return a;o.wrap(i.in)}if(n!=="in"){if(a=$t(e,o,i,i.out,r),e&&a)return a;o.wrap(i.out)}}if(t!=="directed"&&(a=$t(e,o,i,i.undirected,r),e&&a))return a}function Yd(e,t,n){if(e!=="mixed"){if(e==="undirected")return Object.keys(n.undirected);if(typeof t=="string")return Object.keys(n[t])}const i=[];return Hi(!1,e,t,n,function(r){i.push(r)}),i}function Gt(e,t,n){const i=Object.keys(n),r=i.length;let o=0;return{[Symbol.iterator](){return this},next(){let a=null;do{if(o>=r)return e&&e.wrap(n),{done:!0};const s=n[i[o++]],u=s.source,l=s.target;if(a=u===t?l:u,e&&e.has(a.key)){a=null;continue}}while(a===null);return{done:!1,value:{neighbor:a.key,attributes:a.attributes}}}}}function Xd(e,t,n){if(e!=="mixed"){if(e==="undirected")return Gt(null,n,n.undirected);if(typeof t=="string")return Gt(null,n,n[t])}let i=At();const r=new Pn;return e!=="undirected"&&(t!=="out"&&(i=Je(i,Gt(r,n,n.in))),t!=="in"&&(i=Je(i,Gt(r,n,n.out)))),e!=="directed"&&(i=Je(i,Gt(r,n,n.undirected))),i}function Kd(e,t){const{name:n,type:i,direction:r}=t;e.prototype[n]=function(o){if(i!=="mixed"&&this.type!=="mixed"&&i!==this.type)return[];o=""+o;const a=this._nodes.get(o);if(typeof a>"u")throw new M(`Graph.${n}: could not find the "${o}" node in the graph.`);return Yd(i==="mixed"?this.type:i,r,a)}}function Zd(e,t){const{name:n,type:i,direction:r}=t,o="forEach"+n[0].toUpperCase()+n.slice(1,-1);e.prototype[o]=function(l,c){if(i!=="mixed"&&this.type!=="mixed"&&i!==this.type)return;l=""+l;const d=this._nodes.get(l);if(typeof d>"u")throw new M(`Graph.${o}: could not find the "${l}" node in the graph.`);Hi(!1,i==="mixed"?this.type:i,r,d,c)};const a="map"+n[0].toUpperCase()+n.slice(1);e.prototype[a]=function(l,c){const d=[];return this[o](l,(h,f)=>{d.push(c(h,f))}),d};const s="filter"+n[0].toUpperCase()+n.slice(1);e.prototype[s]=function(l,c){const d=[];return this[o](l,(h,f)=>{c(h,f)&&d.push(h)}),d};const u="reduce"+n[0].toUpperCase()+n.slice(1);e.prototype[u]=function(l,c,d){if(arguments.length<3)throw new z(`Graph.${u}: missing initial value. You must provide it because the callback takes more than one argument and we cannot infer the initial value from the first iteration, as you could with a simple array.`);let h=d;return this[o](l,(f,g)=>{h=c(h,f,g)}),h}}function Jd(e,t){const{name:n,type:i,direction:r}=t,o=n[0].toUpperCase()+n.slice(1,-1),a="find"+o;e.prototype[a]=function(l,c){if(i!=="mixed"&&this.type!=="mixed"&&i!==this.type)return;l=""+l;const d=this._nodes.get(l);if(typeof d>"u")throw new M(`Graph.${a}: could not find the "${l}" node in the graph.`);return Hi(!0,i==="mixed"?this.type:i,r,d,c)};const s="some"+o;e.prototype[s]=function(l,c){return!!this[a](l,c)};const u="every"+o;e.prototype[u]=function(l,c){return!this[a](l,(h,f)=>!c(h,f))}}function Qd(e,t){const{name:n,type:i,direction:r}=t,o=n.slice(0,-1)+"Entries";e.prototype[o]=function(a){if(i!=="mixed"&&this.type!=="mixed"&&i!==this.type)return At();a=""+a;const s=this._nodes.get(a);if(typeof s>"u")throw new M(`Graph.${o}: could not find the "${a}" node in the graph.`);return Xd(i==="mixed"?this.type:i,r,s)}}function eh(e){jd.forEach(t=>{Kd(e,t),Zd(e,t),Jd(e,t),Qd(e,t)})}function un(e,t,n,i,r){const o=i._nodes.values(),a=i.type;let s,u,l,c,d,h;for(;s=o.next(),s.done!==!0;){let f=!1;if(u=s.value,a!=="undirected"){c=u.out;for(l in c){d=c[l];do h=d.target,f=!0,r(u.key,h.key,u.attributes,h.attributes,d.key,d.attributes,d.undirected),d=d.next;while(d)}}if(a!=="directed"){c=u.undirected;for(l in c)if(!(t&&u.key>l)){d=c[l];do h=d.target,h.key!==l&&(h=d.source),f=!0,r(u.key,h.key,u.attributes,h.attributes,d.key,d.attributes,d.undirected),d=d.next;while(d)}}n&&!f&&r(u.key,null,u.attributes,null,null,null,null)}}function th(e,t){const n={key:e};return Uo(t.attributes)||(n.attributes=pe({},t.attributes)),n}function nh(e,t,n){const i={key:t,source:n.source.key,target:n.target.key};return Uo(n.attributes)||(i.attributes=pe({},n.attributes)),e==="mixed"&&n.undirected&&(i.undirected=!0),i}function ih(e){if(!ve(e))throw new z('Graph.import: invalid serialized node. A serialized node should be a plain object with at least a "key" property.');if(!("key"in e))throw new z("Graph.import: serialized node is missing its key.");if("attributes"in e&&(!ve(e.attributes)||e.attributes===null))throw new z("Graph.import: invalid attributes. Attributes should be a plain object, null or omitted.")}function rh(e){if(!ve(e))throw new z('Graph.import: invalid serialized edge. A serialized edge should be a plain object with at least a "source" & "target" property.');if(!("source"in e))throw new z("Graph.import: serialized edge is missing its source.");if(!("target"in e))throw new z("Graph.import: serialized edge is missing its target.");if("attributes"in e&&(!ve(e.attributes)||e.attributes===null))throw new z("Graph.import: invalid attributes. Attributes should be a plain object, null or omitted.");if("undirected"in e&&typeof e.undirected!="boolean")throw new z("Graph.import: invalid undirectedness information. Undirected should be boolean or omitted.")}const oh=sd(),ah=new Set(["directed","undirected","mixed"]),Mr=new Set(["domain","_events","_eventsCount","_maxListeners"]),sh=[{name:e=>`${e}Edge`,generateKey:!0},{name:e=>`${e}DirectedEdge`,generateKey:!0,type:"directed"},{name:e=>`${e}UndirectedEdge`,generateKey:!0,type:"undirected"},{name:e=>`${e}EdgeWithKey`},{name:e=>`${e}DirectedEdgeWithKey`,type:"directed"},{name:e=>`${e}UndirectedEdgeWithKey`,type:"undirected"}],uh={allowSelfLoops:!0,multi:!1,type:"mixed"};function lh(e,t,n){if(n&&!ve(n))throw new z(`Graph.addNode: invalid attributes. Expecting an object but got "${n}"`);if(t=""+t,n=n||{},e._nodes.has(t))throw new Y(`Graph.addNode: the "${t}" node already exist in the graph.`);const i=new e.NodeDataClass(t,n);return e._nodes.set(t,i),e.emit("nodeAdded",{key:t,attributes:n}),i}function Dr(e,t,n){const i=new e.NodeDataClass(t,n);return e._nodes.set(t,i),e.emit("nodeAdded",{key:t,attributes:n}),i}function Ko(e,t,n,i,r,o,a,s){if(!i&&e.type==="undirected")throw new Y(`Graph.${t}: you cannot add a directed edge to an undirected graph. Use the #.addEdge or #.addUndirectedEdge instead.`);if(i&&e.type==="directed")throw new Y(`Graph.${t}: you cannot add an undirected edge to a directed graph. Use the #.addEdge or #.addDirectedEdge instead.`);if(s&&!ve(s))throw new z(`Graph.${t}: invalid attributes. Expecting an object but got "${s}"`);if(o=""+o,a=""+a,s=s||{},!e.allowSelfLoops&&o===a)throw new Y(`Graph.${t}: source & target are the same ("${o}"), thus creating a loop explicitly forbidden by this graph 'allowSelfLoops' option set to false.`);const u=e._nodes.get(o),l=e._nodes.get(a);if(!u)throw new M(`Graph.${t}: source node "${o}" not found.`);if(!l)throw new M(`Graph.${t}: target node "${a}" not found.`);const c={key:null,undirected:i,source:o,target:a,attributes:s};if(n)r=e._edgeKeyGenerator();else if(r=""+r,e._edges.has(r))throw new Y(`Graph.${t}: the "${r}" edge already exists in the graph.`);if(!e.multi&&(i?typeof u.undirected[a]<"u":typeof u.out[a]<"u"))throw new Y(`Graph.${t}: an edge linking "${o}" to "${a}" already exists. If you really want to add multiple edges linking those nodes, you should create a multi graph by using the 'multi' option.`);const d=new Lt(i,r,u,l,s);e._edges.set(r,d);const h=o===a;return i?(u.undirectedDegree++,l.undirectedDegree++,h&&(u.undirectedLoops++,e._undirectedSelfLoopCount++)):(u.outDegree++,l.inDegree++,h&&(u.directedLoops++,e._directedSelfLoopCount++)),e.multi?d.attachMulti():d.attach(),i?e._undirectedSize++:e._directedSize++,c.key=r,e.emit("edgeAdded",c),r}function ch(e,t,n,i,r,o,a,s,u){if(!i&&e.type==="undirected")throw new Y(`Graph.${t}: you cannot merge/update a directed edge to an undirected graph. Use the #.mergeEdge/#.updateEdge or #.addUndirectedEdge instead.`);if(i&&e.type==="directed")throw new Y(`Graph.${t}: you cannot merge/update an undirected edge to a directed graph. Use the #.mergeEdge/#.updateEdge or #.addDirectedEdge instead.`);if(s){if(u){if(typeof s!="function")throw new z(`Graph.${t}: invalid updater function. Expecting a function but got "${s}"`)}else if(!ve(s))throw new z(`Graph.${t}: invalid attributes. Expecting an object but got "${s}"`)}o=""+o,a=""+a;let l;if(u&&(l=s,s=void 0),!e.allowSelfLoops&&o===a)throw new Y(`Graph.${t}: source & target are the same ("${o}"), thus creating a loop explicitly forbidden by this graph 'allowSelfLoops' option set to false.`);let c=e._nodes.get(o),d=e._nodes.get(a),h,f;if(!n&&(h=e._edges.get(r),h)){if((h.source.key!==o||h.target.key!==a)&&(!i||h.source.key!==a||h.target.key!==o))throw new Y(`Graph.${t}: inconsistency detected when attempting to merge the "${r}" edge with "${o}" source & "${a}" target vs. ("${h.source.key}", "${h.target.key}").`);f=h}if(!f&&!e.multi&&c&&(f=i?c.undirected[a]:c.out[a]),f){const _=[f.key,!1,!1,!1];if(u?!l:!s)return _;if(u){const x=f.attributes;f.attributes=l(x),e.emit("edgeAttributesUpdated",{type:"replace",key:f.key,attributes:f.attributes})}else pe(f.attributes,s),e.emit("edgeAttributesUpdated",{type:"merge",key:f.key,attributes:f.attributes,data:s});return _}s=s||{},u&&l&&(s=l(s));const g={key:null,undirected:i,source:o,target:a,attributes:s};if(n)r=e._edgeKeyGenerator();else if(r=""+r,e._edges.has(r))throw new Y(`Graph.${t}: the "${r}" edge already exists in the graph.`);let m=!1,b=!1;c||(c=Dr(e,o,{}),m=!0,o===a&&(d=c,b=!0)),d||(d=Dr(e,a,{}),b=!0),h=new Lt(i,r,c,d,s),e._edges.set(r,h);const C=o===a;return i?(c.undirectedDegree++,d.undirectedDegree++,C&&(c.undirectedLoops++,e._undirectedSelfLoopCount++)):(c.outDegree++,d.inDegree++,C&&(c.directedLoops++,e._directedSelfLoopCount++)),e.multi?h.attachMulti():h.attach(),i?e._undirectedSize++:e._directedSize++,g.key=r,e.emit("edgeAdded",g),[r,!0,m,b]}function yt(e,t){e._edges.delete(t.key);const{source:n,target:i,attributes:r}=t,o=t.undirected,a=n===i;o?(n.undirectedDegree--,i.undirectedDegree--,a&&(n.undirectedLoops--,e._undirectedSelfLoopCount--)):(n.outDegree--,i.inDegree--,a&&(n.directedLoops--,e._directedSelfLoopCount--)),e.multi?t.detachMulti():t.detach(),o?e._undirectedSize--:e._directedSize--,e.emit("edgeDropped",{key:t.key,attributes:r,source:n.key,target:i.key,undirected:o})}class oe extends Bo.EventEmitter{constructor(t){if(super(),t=pe({},uh,t),typeof t.multi!="boolean")throw new z(`Graph.constructor: invalid 'multi' option. Expecting a boolean but got "${t.multi}".`);if(!ah.has(t.type))throw new z(`Graph.constructor: invalid 'type' option. Should be one of "mixed", "directed" or "undirected" but got "${t.type}".`);if(typeof t.allowSelfLoops!="boolean")throw new z(`Graph.constructor: invalid 'allowSelfLoops' option. Expecting a boolean but got "${t.allowSelfLoops}".`);const n=t.type==="mixed"?Ho:t.type==="directed"?Wo:qo;Re(this,"NodeDataClass",n);const i="geid_"+oh()+"_";let r=0;const o=()=>{let a;do a=i+r++;while(this._edges.has(a));return a};Re(this,"_attributes",{}),Re(this,"_nodes",new Map),Re(this,"_edges",new Map),Re(this,"_directedSize",0),Re(this,"_undirectedSize",0),Re(this,"_directedSelfLoopCount",0),Re(this,"_undirectedSelfLoopCount",0),Re(this,"_edgeKeyGenerator",o),Re(this,"_options",t),Mr.forEach(a=>Re(this,a,this[a])),Pe(this,"order",()=>this._nodes.size),Pe(this,"size",()=>this._edges.size),Pe(this,"directedSize",()=>this._directedSize),Pe(this,"undirectedSize",()=>this._undirectedSize),Pe(this,"selfLoopCount",()=>this._directedSelfLoopCount+this._undirectedSelfLoopCount),Pe(this,"directedSelfLoopCount",()=>this._directedSelfLoopCount),Pe(this,"undirectedSelfLoopCount",()=>this._undirectedSelfLoopCount),Pe(this,"multi",this._options.multi),Pe(this,"type",this._options.type),Pe(this,"allowSelfLoops",this._options.allowSelfLoops),Pe(this,"implementation",()=>"graphology")}_resetInstanceCounters(){this._directedSize=0,this._undirectedSize=0,this._directedSelfLoopCount=0,this._undirectedSelfLoopCount=0}hasNode(t){return this._nodes.has(""+t)}hasDirectedEdge(t,n){if(this.type==="undirected")return!1;if(arguments.length===1){const i=""+t,r=this._edges.get(i);return!!r&&!r.undirected}else if(arguments.length===2){t=""+t,n=""+n;const i=this._nodes.get(t);return i?i.out.hasOwnProperty(n):!1}throw new z(`Graph.hasDirectedEdge: invalid arity (${arguments.length}, instead of 1 or 2). You can either ask for an edge id or for the existence of an edge between a source & a target.`)}hasUndirectedEdge(t,n){if(this.type==="directed")return!1;if(arguments.length===1){const i=""+t,r=this._edges.get(i);return!!r&&r.undirected}else if(arguments.length===2){t=""+t,n=""+n;const i=this._nodes.get(t);return i?i.undirected.hasOwnProperty(n):!1}throw new z(`Graph.hasDirectedEdge: invalid arity (${arguments.length}, instead of 1 or 2). You can either ask for an edge id or for the existence of an edge between a source & a target.`)}hasEdge(t,n){if(arguments.length===1){const i=""+t;return this._edges.has(i)}else if(arguments.length===2){t=""+t,n=""+n;const i=this._nodes.get(t);return i?typeof i.out<"u"&&i.out.hasOwnProperty(n)||typeof i.undirected<"u"&&i.undirected.hasOwnProperty(n):!1}throw new z(`Graph.hasEdge: invalid arity (${arguments.length}, instead of 1 or 2). You can either ask for an edge id or for the existence of an edge between a source & a target.`)}directedEdge(t,n){if(this.type==="undirected")return;if(t=""+t,n=""+n,this.multi)throw new Y("Graph.directedEdge: this method is irrelevant with multigraphs since there might be multiple edges between source & target. See #.directedEdges instead.");const i=this._nodes.get(t);if(!i)throw new M(`Graph.directedEdge: could not find the "${t}" source node in the graph.`);if(!this._nodes.has(n))throw new M(`Graph.directedEdge: could not find the "${n}" target node in the graph.`);const r=i.out&&i.out[n]||void 0;if(r)return r.key}undirectedEdge(t,n){if(this.type==="directed")return;if(t=""+t,n=""+n,this.multi)throw new Y("Graph.undirectedEdge: this method is irrelevant with multigraphs since there might be multiple edges between source & target. See #.undirectedEdges instead.");const i=this._nodes.get(t);if(!i)throw new M(`Graph.undirectedEdge: could not find the "${t}" source node in the graph.`);if(!this._nodes.has(n))throw new M(`Graph.undirectedEdge: could not find the "${n}" target node in the graph.`);const r=i.undirected&&i.undirected[n]||void 0;if(r)return r.key}edge(t,n){if(this.multi)throw new Y("Graph.edge: this method is irrelevant with multigraphs since there might be multiple edges between source & target. See #.edges instead.");t=""+t,n=""+n;const i=this._nodes.get(t);if(!i)throw new M(`Graph.edge: could not find the "${t}" source node in the graph.`);if(!this._nodes.has(n))throw new M(`Graph.edge: could not find the "${n}" target node in the graph.`);const r=i.out&&i.out[n]||i.undirected&&i.undirected[n]||void 0;if(r)return r.key}areDirectedNeighbors(t,n){t=""+t,n=""+n;const i=this._nodes.get(t);if(!i)throw new M(`Graph.areDirectedNeighbors: could not find the "${t}" node in the graph.`);return this.type==="undirected"?!1:n in i.in||n in i.out}areOutNeighbors(t,n){t=""+t,n=""+n;const i=this._nodes.get(t);if(!i)throw new M(`Graph.areOutNeighbors: could not find the "${t}" node in the graph.`);return this.type==="undirected"?!1:n in i.out}areInNeighbors(t,n){t=""+t,n=""+n;const i=this._nodes.get(t);if(!i)throw new M(`Graph.areInNeighbors: could not find the "${t}" node in the graph.`);return this.type==="undirected"?!1:n in i.in}areUndirectedNeighbors(t,n){t=""+t,n=""+n;const i=this._nodes.get(t);if(!i)throw new M(`Graph.areUndirectedNeighbors: could not find the "${t}" node in the graph.`);return this.type==="directed"?!1:n in i.undirected}areNeighbors(t,n){t=""+t,n=""+n;const i=this._nodes.get(t);if(!i)throw new M(`Graph.areNeighbors: could not find the "${t}" node in the graph.`);return this.type!=="undirected"&&(n in i.in||n in i.out)||this.type!=="directed"&&n in i.undirected}areInboundNeighbors(t,n){t=""+t,n=""+n;const i=this._nodes.get(t);if(!i)throw new M(`Graph.areInboundNeighbors: could not find the "${t}" node in the graph.`);return this.type!=="undirected"&&n in i.in||this.type!=="directed"&&n in i.undirected}areOutboundNeighbors(t,n){t=""+t,n=""+n;const i=this._nodes.get(t);if(!i)throw new M(`Graph.areOutboundNeighbors: could not find the "${t}" node in the graph.`);return this.type!=="undirected"&&n in i.out||this.type!=="directed"&&n in i.undirected}inDegree(t){t=""+t;const n=this._nodes.get(t);if(!n)throw new M(`Graph.inDegree: could not find the "${t}" node in the graph.`);return this.type==="undirected"?0:n.inDegree}outDegree(t){t=""+t;const n=this._nodes.get(t);if(!n)throw new M(`Graph.outDegree: could not find the "${t}" node in the graph.`);return this.type==="undirected"?0:n.outDegree}directedDegree(t){t=""+t;const n=this._nodes.get(t);if(!n)throw new M(`Graph.directedDegree: could not find the "${t}" node in the graph.`);return this.type==="undirected"?0:n.inDegree+n.outDegree}undirectedDegree(t){t=""+t;const n=this._nodes.get(t);if(!n)throw new M(`Graph.undirectedDegree: could not find the "${t}" node in the graph.`);return this.type==="directed"?0:n.undirectedDegree}inboundDegree(t){t=""+t;const n=this._nodes.get(t);if(!n)throw new M(`Graph.inboundDegree: could not find the "${t}" node in the graph.`);let i=0;return this.type!=="directed"&&(i+=n.undirectedDegree),this.type!=="undirected"&&(i+=n.inDegree),i}outboundDegree(t){t=""+t;const n=this._nodes.get(t);if(!n)throw new M(`Graph.outboundDegree: could not find the "${t}" node in the graph.`);let i=0;return this.type!=="directed"&&(i+=n.undirectedDegree),this.type!=="undirected"&&(i+=n.outDegree),i}degree(t){t=""+t;const n=this._nodes.get(t);if(!n)throw new M(`Graph.degree: could not find the "${t}" node in the graph.`);let i=0;return this.type!=="directed"&&(i+=n.undirectedDegree),this.type!=="undirected"&&(i+=n.inDegree+n.outDegree),i}inDegreeWithoutSelfLoops(t){t=""+t;const n=this._nodes.get(t);if(!n)throw new M(`Graph.inDegreeWithoutSelfLoops: could not find the "${t}" node in the graph.`);return this.type==="undirected"?0:n.inDegree-n.directedLoops}outDegreeWithoutSelfLoops(t){t=""+t;const n=this._nodes.get(t);if(!n)throw new M(`Graph.outDegreeWithoutSelfLoops: could not find the "${t}" node in the graph.`);return this.type==="undirected"?0:n.outDegree-n.directedLoops}directedDegreeWithoutSelfLoops(t){t=""+t;const n=this._nodes.get(t);if(!n)throw new M(`Graph.directedDegreeWithoutSelfLoops: could not find the "${t}" node in the graph.`);return this.type==="undirected"?0:n.inDegree+n.outDegree-n.directedLoops*2}undirectedDegreeWithoutSelfLoops(t){t=""+t;const n=this._nodes.get(t);if(!n)throw new M(`Graph.undirectedDegreeWithoutSelfLoops: could not find the "${t}" node in the graph.`);return this.type==="directed"?0:n.undirectedDegree-n.undirectedLoops*2}inboundDegreeWithoutSelfLoops(t){t=""+t;const n=this._nodes.get(t);if(!n)throw new M(`Graph.inboundDegreeWithoutSelfLoops: could not find the "${t}" node in the graph.`);let i=0,r=0;return this.type!=="directed"&&(i+=n.undirectedDegree,r+=n.undirectedLoops*2),this.type!=="undirected"&&(i+=n.inDegree,r+=n.directedLoops),i-r}outboundDegreeWithoutSelfLoops(t){t=""+t;const n=this._nodes.get(t);if(!n)throw new M(`Graph.outboundDegreeWithoutSelfLoops: could not find the "${t}" node in the graph.`);let i=0,r=0;return this.type!=="directed"&&(i+=n.undirectedDegree,r+=n.undirectedLoops*2),this.type!=="undirected"&&(i+=n.outDegree,r+=n.directedLoops),i-r}degreeWithoutSelfLoops(t){t=""+t;const n=this._nodes.get(t);if(!n)throw new M(`Graph.degreeWithoutSelfLoops: could not find the "${t}" node in the graph.`);let i=0,r=0;return this.type!=="directed"&&(i+=n.undirectedDegree,r+=n.undirectedLoops*2),this.type!=="undirected"&&(i+=n.inDegree+n.outDegree,r+=n.directedLoops*2),i-r}source(t){t=""+t;const n=this._edges.get(t);if(!n)throw new M(`Graph.source: could not find the "${t}" edge in the graph.`);return n.source.key}target(t){t=""+t;const n=this._edges.get(t);if(!n)throw new M(`Graph.target: could not find the "${t}" edge in the graph.`);return n.target.key}extremities(t){t=""+t;const n=this._edges.get(t);if(!n)throw new M(`Graph.extremities: could not find the "${t}" edge in the graph.`);return[n.source.key,n.target.key]}opposite(t,n){t=""+t,n=""+n;const i=this._edges.get(n);if(!i)throw new M(`Graph.opposite: could not find the "${n}" edge in the graph.`);const r=i.source.key,o=i.target.key;if(t===r)return o;if(t===o)return r;throw new M(`Graph.opposite: the "${t}" node is not attached to the "${n}" edge (${r}, ${o}).`)}hasExtremity(t,n){t=""+t,n=""+n;const i=this._edges.get(t);if(!i)throw new M(`Graph.hasExtremity: could not find the "${t}" edge in the graph.`);return i.source.key===n||i.target.key===n}isUndirected(t){t=""+t;const n=this._edges.get(t);if(!n)throw new M(`Graph.isUndirected: could not find the "${t}" edge in the graph.`);return n.undirected}isDirected(t){t=""+t;const n=this._edges.get(t);if(!n)throw new M(`Graph.isDirected: could not find the "${t}" edge in the graph.`);return!n.undirected}isSelfLoop(t){t=""+t;const n=this._edges.get(t);if(!n)throw new M(`Graph.isSelfLoop: could not find the "${t}" edge in the graph.`);return n.source===n.target}addNode(t,n){return lh(this,t,n).key}mergeNode(t,n){if(n&&!ve(n))throw new z(`Graph.mergeNode: invalid attributes. Expecting an object but got "${n}"`);t=""+t,n=n||{};let i=this._nodes.get(t);return i?(n&&(pe(i.attributes,n),this.emit("nodeAttributesUpdated",{type:"merge",key:t,attributes:i.attributes,data:n})),[t,!1]):(i=new this.NodeDataClass(t,n),this._nodes.set(t,i),this.emit("nodeAdded",{key:t,attributes:n}),[t,!0])}updateNode(t,n){if(n&&typeof n!="function")throw new z(`Graph.updateNode: invalid updater function. Expecting a function but got "${n}"`);t=""+t;let i=this._nodes.get(t);if(i){if(n){const o=i.attributes;i.attributes=n(o),this.emit("nodeAttributesUpdated",{type:"replace",key:t,attributes:i.attributes})}return[t,!1]}const r=n?n({}):{};return i=new this.NodeDataClass(t,r),this._nodes.set(t,i),this.emit("nodeAdded",{key:t,attributes:r}),[t,!0]}dropNode(t){t=""+t;const n=this._nodes.get(t);if(!n)throw new M(`Graph.dropNode: could not find the "${t}" node in the graph.`);let i;if(this.type!=="undirected"){for(const r in n.out){i=n.out[r];do yt(this,i),i=i.next;while(i)}for(const r in n.in){i=n.in[r];do yt(this,i),i=i.next;while(i)}}if(this.type!=="directed")for(const r in n.undirected){i=n.undirected[r];do yt(this,i),i=i.next;while(i)}this._nodes.delete(t),this.emit("nodeDropped",{key:t,attributes:n.attributes})}dropEdge(t){let n;if(arguments.length>1){const i=""+arguments[0],r=""+arguments[1];if(n=Ne(this,i,r,this.type),!n)throw new M(`Graph.dropEdge: could not find the "${i}" -> "${r}" edge in the graph.`)}else if(t=""+t,n=this._edges.get(t),!n)throw new M(`Graph.dropEdge: could not find the "${t}" edge in the graph.`);return yt(this,n),this}dropDirectedEdge(t,n){if(arguments.length<2)throw new Y("Graph.dropDirectedEdge: it does not make sense to try and drop a directed edge by key. What if the edge with this key is undirected? Use #.dropEdge for this purpose instead.");if(this.multi)throw new Y("Graph.dropDirectedEdge: cannot use a {source,target} combo when dropping an edge in a MultiGraph since we cannot infer the one you want to delete as there could be multiple ones.");t=""+t,n=""+n;const i=Ne(this,t,n,"directed");if(!i)throw new M(`Graph.dropDirectedEdge: could not find a "${t}" -> "${n}" edge in the graph.`);return yt(this,i),this}dropUndirectedEdge(t,n){if(arguments.length<2)throw new Y("Graph.dropUndirectedEdge: it does not make sense to drop a directed edge by key. What if the edge with this key is undirected? Use #.dropEdge for this purpose instead.");if(this.multi)throw new Y("Graph.dropUndirectedEdge: cannot use a {source,target} combo when dropping an edge in a MultiGraph since we cannot infer the one you want to delete as there could be multiple ones.");const i=Ne(this,t,n,"undirected");if(!i)throw new M(`Graph.dropUndirectedEdge: could not find a "${t}" -> "${n}" edge in the graph.`);return yt(this,i),this}clear(){this._edges.clear(),this._nodes.clear(),this._resetInstanceCounters(),this.emit("cleared")}clearEdges(){const t=this._nodes.values();let n;for(;n=t.next(),n.done!==!0;)n.value.clear();this._edges.clear(),this._resetInstanceCounters(),this.emit("edgesCleared")}getAttribute(t){return this._attributes[t]}getAttributes(){return this._attributes}hasAttribute(t){return this._attributes.hasOwnProperty(t)}setAttribute(t,n){return this._attributes[t]=n,this.emit("attributesUpdated",{type:"set",attributes:this._attributes,name:t}),this}updateAttribute(t,n){if(typeof n!="function")throw new z("Graph.updateAttribute: updater should be a function.");const i=this._attributes[t];return this._attributes[t]=n(i),this.emit("attributesUpdated",{type:"set",attributes:this._attributes,name:t}),this}removeAttribute(t){return delete this._attributes[t],this.emit("attributesUpdated",{type:"remove",attributes:this._attributes,name:t}),this}replaceAttributes(t){if(!ve(t))throw new z("Graph.replaceAttributes: provided attributes are not a plain object.");return this._attributes=t,this.emit("attributesUpdated",{type:"replace",attributes:this._attributes}),this}mergeAttributes(t){if(!ve(t))throw new z("Graph.mergeAttributes: provided attributes are not a plain object.");return pe(this._attributes,t),this.emit("attributesUpdated",{type:"merge",attributes:this._attributes,data:t}),this}updateAttributes(t){if(typeof t!="function")throw new z("Graph.updateAttributes: provided updater is not a function.");return this._attributes=t(this._attributes),this.emit("attributesUpdated",{type:"update",attributes:this._attributes}),this}updateEachNodeAttributes(t,n){if(typeof t!="function")throw new z("Graph.updateEachNodeAttributes: expecting an updater function.");if(n&&!Nr(n))throw new z("Graph.updateEachNodeAttributes: invalid hints. Expecting an object having the following shape: {attributes?: [string]}");const i=this._nodes.values();let r,o;for(;r=i.next(),r.done!==!0;)o=r.value,o.attributes=t(o.key,o.attributes);this.emit("eachNodeAttributesUpdated",{hints:n||null})}updateEachEdgeAttributes(t,n){if(typeof t!="function")throw new z("Graph.updateEachEdgeAttributes: expecting an updater function.");if(n&&!Nr(n))throw new z("Graph.updateEachEdgeAttributes: invalid hints. Expecting an object having the following shape: {attributes?: [string]}");const i=this._edges.values();let r,o,a,s;for(;r=i.next(),r.done!==!0;)o=r.value,a=o.source,s=o.target,o.attributes=t(o.key,o.attributes,a.key,s.key,a.attributes,s.attributes,o.undirected);this.emit("eachEdgeAttributesUpdated",{hints:n||null})}forEachAdjacencyEntry(t){if(typeof t!="function")throw new z("Graph.forEachAdjacencyEntry: expecting a callback.");un(!1,!1,!1,this,t)}forEachAdjacencyEntryWithOrphans(t){if(typeof t!="function")throw new z("Graph.forEachAdjacencyEntryWithOrphans: expecting a callback.");un(!1,!1,!0,this,t)}forEachAssymetricAdjacencyEntry(t){if(typeof t!="function")throw new z("Graph.forEachAssymetricAdjacencyEntry: expecting a callback.");un(!1,!0,!1,this,t)}forEachAssymetricAdjacencyEntryWithOrphans(t){if(typeof t!="function")throw new z("Graph.forEachAssymetricAdjacencyEntryWithOrphans: expecting a callback.");un(!1,!0,!0,this,t)}nodes(){return Array.from(this._nodes.keys())}forEachNode(t){if(typeof t!="function")throw new z("Graph.forEachNode: expecting a callback.");const n=this._nodes.values();let i,r;for(;i=n.next(),i.done!==!0;)r=i.value,t(r.key,r.attributes)}findNode(t){if(typeof t!="function")throw new z("Graph.findNode: expecting a callback.");const n=this._nodes.values();let i,r;for(;i=n.next(),i.done!==!0;)if(r=i.value,t(r.key,r.attributes))return r.key}mapNodes(t){if(typeof t!="function")throw new z("Graph.mapNode: expecting a callback.");const n=this._nodes.values();let i,r;const o=new Array(this.order);let a=0;for(;i=n.next(),i.done!==!0;)r=i.value,o[a++]=t(r.key,r.attributes);return o}someNode(t){if(typeof t!="function")throw new z("Graph.someNode: expecting a callback.");const n=this._nodes.values();let i,r;for(;i=n.next(),i.done!==!0;)if(r=i.value,t(r.key,r.attributes))return!0;return!1}everyNode(t){if(typeof t!="function")throw new z("Graph.everyNode: expecting a callback.");const n=this._nodes.values();let i,r;for(;i=n.next(),i.done!==!0;)if(r=i.value,!t(r.key,r.attributes))return!1;return!0}filterNodes(t){if(typeof t!="function")throw new z("Graph.filterNodes: expecting a callback.");const n=this._nodes.values();let i,r;const o=[];for(;i=n.next(),i.done!==!0;)r=i.value,t(r.key,r.attributes)&&o.push(r.key);return o}reduceNodes(t,n){if(typeof t!="function")throw new z("Graph.reduceNodes: expecting a callback.");if(arguments.length<2)throw new z("Graph.reduceNodes: missing initial value. You must provide it because the callback takes more than one argument and we cannot infer the initial value from the first iteration, as you could with a simple array.");let i=n;const r=this._nodes.values();let o,a;for(;o=r.next(),o.done!==!0;)a=o.value,i=t(i,a.key,a.attributes);return i}nodeEntries(){const t=this._nodes.values();return{[Symbol.iterator](){return this},next(){const n=t.next();if(n.done)return n;const i=n.value;return{value:{node:i.key,attributes:i.attributes},done:!1}}}}export(){const t=new Array(this._nodes.size);let n=0;this._nodes.forEach((r,o)=>{t[n++]=th(o,r)});const i=new Array(this._edges.size);return n=0,this._edges.forEach((r,o)=>{i[n++]=nh(this.type,o,r)}),{options:{type:this.type,multi:this.multi,allowSelfLoops:this.allowSelfLoops},attributes:this.getAttributes(),nodes:t,edges:i}}import(t,n=!1){if(t instanceof oe)return t.forEachNode((u,l)=>{n?this.mergeNode(u,l):this.addNode(u,l)}),t.forEachEdge((u,l,c,d,h,f,g)=>{n?g?this.mergeUndirectedEdgeWithKey(u,c,d,l):this.mergeDirectedEdgeWithKey(u,c,d,l):g?this.addUndirectedEdgeWithKey(u,c,d,l):this.addDirectedEdgeWithKey(u,c,d,l)}),this;if(!ve(t))throw new z("Graph.import: invalid argument. Expecting a serialized graph or, alternatively, a Graph instance.");if(t.attributes){if(!ve(t.attributes))throw new z("Graph.import: invalid attributes. Expecting a plain object.");n?this.mergeAttributes(t.attributes):this.replaceAttributes(t.attributes)}let i,r,o,a,s;if(t.nodes){if(o=t.nodes,!Array.isArray(o))throw new z("Graph.import: invalid nodes. Expecting an array.");for(i=0,r=o.length;i<r;i++){a=o[i],ih(a);const{key:u,attributes:l}=a;n?this.mergeNode(u,l):this.addNode(u,l)}}if(t.edges){let u=!1;if(this.type==="undirected"&&(u=!0),o=t.edges,!Array.isArray(o))throw new z("Graph.import: invalid edges. Expecting an array.");for(i=0,r=o.length;i<r;i++){s=o[i],rh(s);const{source:l,target:c,attributes:d,undirected:h=u}=s;let f;"key"in s?(f=n?h?this.mergeUndirectedEdgeWithKey:this.mergeDirectedEdgeWithKey:h?this.addUndirectedEdgeWithKey:this.addDirectedEdgeWithKey,f.call(this,s.key,l,c,d)):(f=n?h?this.mergeUndirectedEdge:this.mergeDirectedEdge:h?this.addUndirectedEdge:this.addDirectedEdge,f.call(this,l,c,d))}}return this}nullCopy(t){const n=new oe(pe({},this._options,t));return n.replaceAttributes(pe({},this.getAttributes())),n}emptyCopy(t){const n=this.nullCopy(t);return this._nodes.forEach((i,r)=>{const o=pe({},i.attributes);i=new n.NodeDataClass(r,o),n._nodes.set(r,i)}),n}copy(t){if(t=t||{},typeof t.type=="string"&&t.type!==this.type&&t.type!=="mixed")throw new Y(`Graph.copy: cannot create an incompatible copy from "${this.type}" type to "${t.type}" because this would mean losing information about the current graph.`);if(typeof t.multi=="boolean"&&t.multi!==this.multi&&t.multi!==!0)throw new Y("Graph.copy: cannot create an incompatible copy by downgrading a multi graph to a simple one because this would mean losing information about the current graph.");if(typeof t.allowSelfLoops=="boolean"&&t.allowSelfLoops!==this.allowSelfLoops&&t.allowSelfLoops!==!0)throw new Y("Graph.copy: cannot create an incompatible copy from a graph allowing self loops to one that does not because this would mean losing information about the current graph.");const n=this.emptyCopy(t),i=this._edges.values();let r,o;for(;r=i.next(),r.done!==!0;)o=r.value,Ko(n,"copy",!1,o.undirected,o.key,o.source.key,o.target.key,pe({},o.attributes));return n}toJSON(){return this.export()}toString(){return"[object Graph]"}inspect(){const t={};this._nodes.forEach((o,a)=>{t[a]=o.attributes});const n={},i={};this._edges.forEach((o,a)=>{const s=o.undirected?"--":"->";let u="",l=o.source.key,c=o.target.key,d;o.undirected&&l>c&&(d=l,l=c,c=d);const h=`(${l})${s}(${c})`;a.startsWith("geid_")?this.multi&&(typeof i[h]>"u"?i[h]=0:i[h]++,u+=`${i[h]}. `):u+=`[${a}]: `,u+=h,n[u]=o.attributes});const r={};for(const o in this)this.hasOwnProperty(o)&&!Mr.has(o)&&typeof this[o]!="function"&&typeof o!="symbol"&&(r[o]=this[o]);return r.attributes=this._attributes,r.nodes=t,r.edges=n,Re(r,"constructor",this.constructor),r}}typeof Symbol<"u"&&(oe.prototype[Symbol.for("nodejs.util.inspect.custom")]=oe.prototype.inspect);sh.forEach(e=>{["add","merge","update"].forEach(t=>{const n=e.name(t),i=t==="add"?Ko:ch;e.generateKey?oe.prototype[n]=function(r,o,a){return i(this,n,!0,(e.type||this.type)==="undirected",null,r,o,a,t==="update")}:oe.prototype[n]=function(r,o,a,s){return i(this,n,!1,(e.type||this.type)==="undirected",r,o,a,s,t==="update")}})});bd(oe);Rd(oe);Vd(oe);eh(oe);class Zo extends oe{constructor(t){const n=pe({type:"directed"},t);if("multi"in n&&n.multi!==!1)throw new z("DirectedGraph.from: inconsistent indication that the graph should be multi in given options!");if(n.type!=="directed")throw new z('DirectedGraph.from: inconsistent "'+n.type+'" type in given options!');super(n)}}class Jo extends oe{constructor(t){const n=pe({type:"undirected"},t);if("multi"in n&&n.multi!==!1)throw new z("UndirectedGraph.from: inconsistent indication that the graph should be multi in given options!");if(n.type!=="undirected")throw new z('UndirectedGraph.from: inconsistent "'+n.type+'" type in given options!');super(n)}}class Qo extends oe{constructor(t){const n=pe({multi:!0},t);if("multi"in n&&n.multi!==!0)throw new z("MultiGraph.from: inconsistent indication that the graph should be simple in given options!");super(n)}}class ea extends oe{constructor(t){const n=pe({type:"directed",multi:!0},t);if("multi"in n&&n.multi!==!0)throw new z("MultiDirectedGraph.from: inconsistent indication that the graph should be simple in given options!");if(n.type!=="directed")throw new z('MultiDirectedGraph.from: inconsistent "'+n.type+'" type in given options!');super(n)}}class ta extends oe{constructor(t){const n=pe({type:"undirected",multi:!0},t);if("multi"in n&&n.multi!==!0)throw new z("MultiUndirectedGraph.from: inconsistent indication that the graph should be simple in given options!");if(n.type!=="undirected")throw new z('MultiUndirectedGraph.from: inconsistent "'+n.type+'" type in given options!');super(n)}}function Rt(e){e.from=function(t,n){const i=pe({},t.options,n),r=new e(i);return r.import(t),r}}Rt(oe);Rt(Zo);Rt(Jo);Rt(Qo);Rt(ea);Rt(ta);oe.Graph=oe;oe.DirectedGraph=Zo;oe.UndirectedGraph=Jo;oe.MultiGraph=Qo;oe.MultiDirectedGraph=ea;oe.MultiUndirectedGraph=ta;oe.InvalidArgumentsGraphError=z;oe.NotFoundGraphError=M;oe.UsageGraphError=Y;function dh(e,t){if(typeof e!="object"||!e)return e;var n=e[Symbol.toPrimitive];if(n!==void 0){var i=n.call(e,t);if(typeof i!="object")return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}function Vt(e){var t=dh(e,"string");return typeof t=="symbol"?t:t+""}function be(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function $r(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,Vt(i.key),i)}}function we(e,t,n){return t&&$r(e.prototype,t),n&&$r(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e}function Tt(e){return Tt=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},Tt(e)}function na(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(na=function(){return!!e})()}function hh(e){if(e===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function fh(e,t){if(t&&(typeof t=="object"||typeof t=="function"))return t;if(t!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return hh(e)}function Me(e,t,n){return t=Tt(t),fh(e,na()?Reflect.construct(t,n||[],Tt(e).constructor):t.apply(e,n))}function wi(e,t){return wi=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(n,i){return n.__proto__=i,n},wi(e,t)}function De(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&wi(e,t)}function gh(e){if(Array.isArray(e))return e}function ph(e,t){var n=e==null?null:typeof Symbol<"u"&&e[Symbol.iterator]||e["@@iterator"];if(n!=null){var i,r,o,a,s=[],u=!0,l=!1;try{if(o=(n=n.call(e)).next,t===0){if(Object(n)!==n)return;u=!1}else for(;!(u=(i=o.call(n)).done)&&(s.push(i.value),s.length!==t);u=!0);}catch(c){l=!0,r=c}finally{try{if(!u&&n.return!=null&&(a=n.return(),Object(a)!==a))return}finally{if(l)throw r}}return s}}function _i(e,t){(t==null||t>e.length)&&(t=e.length);for(var n=0,i=Array(t);n<t;n++)i[n]=e[n];return i}function ia(e,t){if(e){if(typeof e=="string")return _i(e,t);var n={}.toString.call(e).slice(8,-1);return n==="Object"&&e.constructor&&(n=e.constructor.name),n==="Map"||n==="Set"?Array.from(e):n==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?_i(e,t):void 0}}function mh(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function St(e,t){return gh(e)||ph(e,t)||ia(e,t)||mh()}var Jn={black:"#000000",silver:"#C0C0C0",gray:"#808080",grey:"#808080",white:"#FFFFFF",maroon:"#800000",red:"#FF0000",purple:"#800080",fuchsia:"#FF00FF",green:"#008000",lime:"#00FF00",olive:"#808000",yellow:"#FFFF00",navy:"#000080",blue:"#0000FF",teal:"#008080",aqua:"#00FFFF",darkblue:"#00008B",mediumblue:"#0000CD",darkgreen:"#006400",darkcyan:"#008B8B",deepskyblue:"#00BFFF",darkturquoise:"#00CED1",mediumspringgreen:"#00FA9A",springgreen:"#00FF7F",cyan:"#00FFFF",midnightblue:"#191970",dodgerblue:"#1E90FF",lightseagreen:"#20B2AA",forestgreen:"#228B22",seagreen:"#2E8B57",darkslategray:"#2F4F4F",darkslategrey:"#2F4F4F",limegreen:"#32CD32",mediumseagreen:"#3CB371",turquoise:"#40E0D0",royalblue:"#4169E1",steelblue:"#4682B4",darkslateblue:"#483D8B",mediumturquoise:"#48D1CC",indigo:"#4B0082",darkolivegreen:"#556B2F",cadetblue:"#5F9EA0",cornflowerblue:"#6495ED",rebeccapurple:"#663399",mediumaquamarine:"#66CDAA",dimgray:"#696969",dimgrey:"#696969",slateblue:"#6A5ACD",olivedrab:"#6B8E23",slategray:"#708090",slategrey:"#708090",lightslategray:"#778899",lightslategrey:"#778899",mediumslateblue:"#7B68EE",lawngreen:"#7CFC00",chartreuse:"#7FFF00",aquamarine:"#7FFFD4",skyblue:"#87CEEB",lightskyblue:"#87CEFA",blueviolet:"#8A2BE2",darkred:"#8B0000",darkmagenta:"#8B008B",saddlebrown:"#8B4513",darkseagreen:"#8FBC8F",lightgreen:"#90EE90",mediumpurple:"#9370DB",darkviolet:"#9400D3",palegreen:"#98FB98",darkorchid:"#9932CC",yellowgreen:"#9ACD32",sienna:"#A0522D",brown:"#A52A2A",darkgray:"#A9A9A9",darkgrey:"#A9A9A9",lightblue:"#ADD8E6",greenyellow:"#ADFF2F",paleturquoise:"#AFEEEE",lightsteelblue:"#B0C4DE",powderblue:"#B0E0E6",firebrick:"#B22222",darkgoldenrod:"#B8860B",mediumorchid:"#BA55D3",rosybrown:"#BC8F8F",darkkhaki:"#BDB76B",mediumvioletred:"#C71585",indianred:"#CD5C5C",peru:"#CD853F",chocolate:"#D2691E",tan:"#D2B48C",lightgray:"#D3D3D3",lightgrey:"#D3D3D3",thistle:"#D8BFD8",orchid:"#DA70D6",goldenrod:"#DAA520",palevioletred:"#DB7093",crimson:"#DC143C",gainsboro:"#DCDCDC",plum:"#DDA0DD",burlywood:"#DEB887",lightcyan:"#E0FFFF",lavender:"#E6E6FA",darksalmon:"#E9967A",violet:"#EE82EE",palegoldenrod:"#EEE8AA",lightcoral:"#F08080",khaki:"#F0E68C",aliceblue:"#F0F8FF",honeydew:"#F0FFF0",azure:"#F0FFFF",sandybrown:"#F4A460",wheat:"#F5DEB3",beige:"#F5F5DC",whitesmoke:"#F5F5F5",mintcream:"#F5FFFA",ghostwhite:"#F8F8FF",salmon:"#FA8072",antiquewhite:"#FAEBD7",linen:"#FAF0E6",lightgoldenrodyellow:"#FAFAD2",oldlace:"#FDF5E6",magenta:"#FF00FF",deeppink:"#FF1493",orangered:"#FF4500",tomato:"#FF6347",hotpink:"#FF69B4",coral:"#FF7F50",darkorange:"#FF8C00",lightsalmon:"#FFA07A",orange:"#FFA500",lightpink:"#FFB6C1",pink:"#FFC0CB",gold:"#FFD700",peachpuff:"#FFDAB9",navajowhite:"#FFDEAD",moccasin:"#FFE4B5",bisque:"#FFE4C4",mistyrose:"#FFE4E1",blanchedalmond:"#FFEBCD",papayawhip:"#FFEFD5",lavenderblush:"#FFF0F5",seashell:"#FFF5EE",cornsilk:"#FFF8DC",lemonchiffon:"#FFFACD",floralwhite:"#FFFAF0",snow:"#FFFAFA",lightyellow:"#FFFFE0",ivory:"#FFFFF0"},ra=new Int8Array(4),Qn=new Int32Array(ra.buffer,0,1),vh=new Float32Array(ra.buffer,0,1),yh=/^\s*rgba?\s*\(/,bh=/^\s*rgba?\s*\(\s*([0-9]*)\s*,\s*([0-9]*)\s*,\s*([0-9]*)(?:\s*,\s*(.*)?)?\)\s*$/;function wh(e){var t=0,n=0,i=0,r=1;if(e[0]==="#")e.length===4?(t=parseInt(e.charAt(1)+e.charAt(1),16),n=parseInt(e.charAt(2)+e.charAt(2),16),i=parseInt(e.charAt(3)+e.charAt(3),16)):(t=parseInt(e.charAt(1)+e.charAt(2),16),n=parseInt(e.charAt(3)+e.charAt(4),16),i=parseInt(e.charAt(5)+e.charAt(6),16)),e.length===9&&(r=parseInt(e.charAt(7)+e.charAt(8),16)/255);else if(yh.test(e)){var o=e.match(bh);o&&(t=+o[1],n=+o[2],i=+o[3],o[4]&&(r=+o[4]))}return{r:t,g:n,b:i,a:r}}var xt={};for(var ln in Jn)xt[ln]=Nt(Jn[ln]),xt[Jn[ln]]=xt[ln];function oa(e,t,n,i,r){return Qn[0]=i<<24|n<<16|t<<8|e,Qn[0]=Qn[0]&4278190079,vh[0]}function Nt(e){if(e=e.toLowerCase(),typeof xt[e]<"u")return xt[e];var t=wh(e),n=t.r,i=t.g,r=t.b,o=t.a;o=o*255|0;var a=oa(n,i,r,o);return xt[e]=a,a}var ei={};function aa(e){if(typeof ei[e]<"u")return ei[e];var t=(e&16711680)>>>16,n=(e&65280)>>>8,i=e&255,r=255,o=oa(t,n,i,r);return ei[e]=o,o}function Gr(e,t,n,i){return n+(t<<8)+(e<<16)}function Pr(e,t,n,i,r,o){var a=Math.floor(n/o*r),s=Math.floor(e.drawingBufferHeight/o-i/o*r),u=new Uint8Array(4);e.bindFramebuffer(e.FRAMEBUFFER,t),e.readPixels(a,s,1,1,e.RGBA,e.UNSIGNED_BYTE,u);var l=St(u,4),c=l[0],d=l[1],h=l[2],f=l[3];return[c,d,h,f]}function T(e,t,n){return(t=Vt(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function Fr(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable})),n.push.apply(n,i)}return n}function q(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?Fr(Object(n),!0).forEach(function(i){T(e,i,n[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Fr(Object(n)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(n,i))})}return e}function _h(e,t){for(;!{}.hasOwnProperty.call(e,t)&&(e=Tt(e))!==null;);return e}function xi(){return xi=typeof Reflect<"u"&&Reflect.get?Reflect.get.bind():function(e,t,n){var i=_h(e,t);if(i){var r=Object.getOwnPropertyDescriptor(i,t);return r.get?r.get.call(arguments.length<3?e:n):r.value}},xi.apply(null,arguments)}function sa(e,t,n,i){var r=xi(Tt(e.prototype),t,n);return typeof r=="function"?function(o){return r.apply(n,o)}:r}function xh(e){return e.normalized?1:e.size}function ti(e){var t=0;return e.forEach(function(n){return t+=xh(n)}),t}function ua(e,t,n){var i=e==="VERTEX"?t.VERTEX_SHADER:t.FRAGMENT_SHADER,r=t.createShader(i);if(r===null)throw new Error("loadShader: error while creating the shader");t.shaderSource(r,n),t.compileShader(r);var o=t.getShaderParameter(r,t.COMPILE_STATUS);if(!o){var a=t.getShaderInfoLog(r);throw t.deleteShader(r),new Error(`loadShader: error while compiling the shader:
`.concat(a,`
`).concat(n))}return r}function Eh(e,t){return ua("VERTEX",e,t)}function Ch(e,t){return ua("FRAGMENT",e,t)}function kh(e,t){var n=e.createProgram();if(n===null)throw new Error("loadProgram: error while creating the program.");var i,r;for(i=0,r=t.length;i<r;i++)e.attachShader(n,t[i]);e.linkProgram(n);var o=e.getProgramParameter(n,e.LINK_STATUS);if(!o)throw e.deleteProgram(n),new Error("loadProgram: error while linking the program.");return n}function Ir(e){var t=e.gl,n=e.buffer,i=e.program,r=e.vertexShader,o=e.fragmentShader;t.deleteShader(r),t.deleteShader(o),t.deleteProgram(i),t.deleteBuffer(n)}var zr=`#define PICKING_MODE
`,Th=T(T(T(T(T(T(T(T({},WebGL2RenderingContext.BOOL,1),WebGL2RenderingContext.BYTE,1),WebGL2RenderingContext.UNSIGNED_BYTE,1),WebGL2RenderingContext.SHORT,2),WebGL2RenderingContext.UNSIGNED_SHORT,2),WebGL2RenderingContext.INT,4),WebGL2RenderingContext.UNSIGNED_INT,4),WebGL2RenderingContext.FLOAT,4),la=function(){function e(t,n,i){be(this,e),T(this,"array",new Float32Array),T(this,"constantArray",new Float32Array),T(this,"capacity",0),T(this,"verticesCount",0);var r=this.getDefinition();if(this.VERTICES=r.VERTICES,this.VERTEX_SHADER_SOURCE=r.VERTEX_SHADER_SOURCE,this.FRAGMENT_SHADER_SOURCE=r.FRAGMENT_SHADER_SOURCE,this.UNIFORMS=r.UNIFORMS,this.ATTRIBUTES=r.ATTRIBUTES,this.METHOD=r.METHOD,this.CONSTANT_ATTRIBUTES="CONSTANT_ATTRIBUTES"in r?r.CONSTANT_ATTRIBUTES:[],this.CONSTANT_DATA="CONSTANT_DATA"in r?r.CONSTANT_DATA:[],this.isInstanced="CONSTANT_ATTRIBUTES"in r,this.ATTRIBUTES_ITEMS_COUNT=ti(this.ATTRIBUTES),this.STRIDE=this.VERTICES*this.ATTRIBUTES_ITEMS_COUNT,this.renderer=i,this.normalProgram=this.getProgramInfo("normal",t,r.VERTEX_SHADER_SOURCE,r.FRAGMENT_SHADER_SOURCE,null),this.pickProgram=n?this.getProgramInfo("pick",t,zr+r.VERTEX_SHADER_SOURCE,zr+r.FRAGMENT_SHADER_SOURCE,n):null,this.isInstanced){var o=ti(this.CONSTANT_ATTRIBUTES);if(this.CONSTANT_DATA.length!==this.VERTICES)throw new Error("Program: error while getting constant data (expected ".concat(this.VERTICES," items, received ").concat(this.CONSTANT_DATA.length," instead)"));this.constantArray=new Float32Array(this.CONSTANT_DATA.length*o);for(var a=0;a<this.CONSTANT_DATA.length;a++){var s=this.CONSTANT_DATA[a];if(s.length!==o)throw new Error("Program: error while getting constant data (one vector has ".concat(s.length," items instead of ").concat(o,")"));for(var u=0;u<s.length;u++)this.constantArray[a*o+u]=s[u]}this.STRIDE=this.ATTRIBUTES_ITEMS_COUNT}}return we(e,[{key:"kill",value:function(){Ir(this.normalProgram),this.pickProgram&&(Ir(this.pickProgram),this.pickProgram=null)}},{key:"getProgramInfo",value:function(n,i,r,o,a){var s=this.getDefinition(),u=i.createBuffer();if(u===null)throw new Error("Program: error while creating the WebGL buffer.");var l=Eh(i,r),c=Ch(i,o),d=kh(i,[l,c]),h={};s.UNIFORMS.forEach(function(m){var b=i.getUniformLocation(d,m);b&&(h[m]=b)});var f={};s.ATTRIBUTES.forEach(function(m){f[m.name]=i.getAttribLocation(d,m.name)});var g;if("CONSTANT_ATTRIBUTES"in s&&(s.CONSTANT_ATTRIBUTES.forEach(function(m){f[m.name]=i.getAttribLocation(d,m.name)}),g=i.createBuffer(),g===null))throw new Error("Program: error while creating the WebGL constant buffer.");return{name:n,program:d,gl:i,frameBuffer:a,buffer:u,constantBuffer:g||{},uniformLocations:h,attributeLocations:f,isPicking:n==="pick",vertexShader:l,fragmentShader:c}}},{key:"bindProgram",value:function(n){var i=this,r=0,o=n.gl,a=n.buffer;this.isInstanced?(o.bindBuffer(o.ARRAY_BUFFER,n.constantBuffer),r=0,this.CONSTANT_ATTRIBUTES.forEach(function(s){return r+=i.bindAttribute(s,n,r,!1)}),o.bufferData(o.ARRAY_BUFFER,this.constantArray,o.STATIC_DRAW),o.bindBuffer(o.ARRAY_BUFFER,n.buffer),r=0,this.ATTRIBUTES.forEach(function(s){return r+=i.bindAttribute(s,n,r,!0)}),o.bufferData(o.ARRAY_BUFFER,this.array,o.DYNAMIC_DRAW)):(o.bindBuffer(o.ARRAY_BUFFER,a),r=0,this.ATTRIBUTES.forEach(function(s){return r+=i.bindAttribute(s,n,r)}),o.bufferData(o.ARRAY_BUFFER,this.array,o.DYNAMIC_DRAW)),o.bindBuffer(o.ARRAY_BUFFER,null)}},{key:"unbindProgram",value:function(n){var i=this;this.isInstanced?(this.CONSTANT_ATTRIBUTES.forEach(function(r){return i.unbindAttribute(r,n,!1)}),this.ATTRIBUTES.forEach(function(r){return i.unbindAttribute(r,n,!0)})):this.ATTRIBUTES.forEach(function(r){return i.unbindAttribute(r,n)})}},{key:"bindAttribute",value:function(n,i,r,o){var a=Th[n.type];if(typeof a!="number")throw new Error('Program.bind: yet unsupported attribute type "'.concat(n.type,'"'));var s=i.attributeLocations[n.name],u=i.gl;if(s!==-1){u.enableVertexAttribArray(s);var l=this.isInstanced?(o?this.ATTRIBUTES_ITEMS_COUNT:ti(this.CONSTANT_ATTRIBUTES))*Float32Array.BYTES_PER_ELEMENT:this.ATTRIBUTES_ITEMS_COUNT*Float32Array.BYTES_PER_ELEMENT;if(u.vertexAttribPointer(s,n.size,n.type,n.normalized||!1,l,r),this.isInstanced&&o)if(u instanceof WebGL2RenderingContext)u.vertexAttribDivisor(s,1);else{var c=u.getExtension("ANGLE_instanced_arrays");c&&c.vertexAttribDivisorANGLE(s,1)}}return n.size*a}},{key:"unbindAttribute",value:function(n,i,r){var o=i.attributeLocations[n.name],a=i.gl;if(o!==-1&&(a.disableVertexAttribArray(o),this.isInstanced&&r))if(a instanceof WebGL2RenderingContext)a.vertexAttribDivisor(o,0);else{var s=a.getExtension("ANGLE_instanced_arrays");s&&s.vertexAttribDivisorANGLE(o,0)}}},{key:"reallocate",value:function(n){n!==this.capacity&&(this.capacity=n,this.verticesCount=this.VERTICES*n,this.array=new Float32Array(this.isInstanced?this.capacity*this.ATTRIBUTES_ITEMS_COUNT:this.verticesCount*this.ATTRIBUTES_ITEMS_COUNT))}},{key:"hasNothingToRender",value:function(){return this.verticesCount===0}},{key:"renderProgram",value:function(n,i){var r=i.gl,o=i.program;r.enable(r.BLEND),r.useProgram(o),this.setUniforms(n,i),this.drawWebGL(this.METHOD,i)}},{key:"render",value:function(n){this.hasNothingToRender()||(this.pickProgram&&(this.pickProgram.gl.viewport(0,0,n.width*n.pixelRatio/n.downSizingRatio,n.height*n.pixelRatio/n.downSizingRatio),this.bindProgram(this.pickProgram),this.renderProgram(q(q({},n),{},{pixelRatio:n.pixelRatio/n.downSizingRatio}),this.pickProgram),this.unbindProgram(this.pickProgram)),this.normalProgram.gl.viewport(0,0,n.width*n.pixelRatio,n.height*n.pixelRatio),this.bindProgram(this.normalProgram),this.renderProgram(n,this.normalProgram),this.unbindProgram(this.normalProgram))}},{key:"drawWebGL",value:function(n,i){var r=i.gl,o=i.frameBuffer;if(r.bindFramebuffer(r.FRAMEBUFFER,o),!this.isInstanced)r.drawArrays(n,0,this.verticesCount);else if(r instanceof WebGL2RenderingContext)r.drawArraysInstanced(n,0,this.VERTICES,this.capacity);else{var a=r.getExtension("ANGLE_instanced_arrays");a&&a.drawArraysInstancedANGLE(n,0,this.VERTICES,this.capacity)}}}])}(),Sh=function(e){function t(){return be(this,t),Me(this,t,arguments)}return De(t,e),we(t,[{key:"kill",value:function(){sa(t,"kill",this)([])}},{key:"process",value:function(i,r,o){var a=r*this.STRIDE;if(o.hidden){for(var s=a+this.STRIDE;a<s;a++)this.array[a]=0;return}return this.processVisibleItem(aa(i),a,o)}}])}(la),Fn=function(e){function t(){var n;be(this,t);for(var i=arguments.length,r=new Array(i),o=0;o<i;o++)r[o]=arguments[o];return n=Me(this,t,[].concat(r)),T(n,"drawLabel",void 0),n}return De(t,e),we(t,[{key:"kill",value:function(){sa(t,"kill",this)([])}},{key:"process",value:function(i,r,o,a,s){var u=r*this.STRIDE;if(s.hidden||o.hidden||a.hidden){for(var l=u+this.STRIDE;u<l;u++)this.array[u]=0;return}return this.processVisibleItem(aa(i),u,o,a,s)}}])}(la);function Ah(e,t){return function(){function n(i,r,o){be(this,n),T(this,"drawLabel",t),this.programs=e.map(function(a){return new a(i,r,o)})}return we(n,[{key:"reallocate",value:function(r){this.programs.forEach(function(o){return o.reallocate(r)})}},{key:"process",value:function(r,o,a,s,u){this.programs.forEach(function(l){return l.process(r,o,a,s,u)})}},{key:"render",value:function(r){this.programs.forEach(function(o){return o.render(r)})}},{key:"kill",value:function(){this.programs.forEach(function(r){return r.kill()})}}])}()}function Lh(e,t,n,i,r){var o=r.edgeLabelSize,a=r.edgeLabelFont,s=r.edgeLabelWeight,u=r.edgeLabelColor.attribute?t[r.edgeLabelColor.attribute]||r.edgeLabelColor.color||"#000":r.edgeLabelColor.color,l=t.label;if(l){e.fillStyle=u,e.font="".concat(s," ").concat(o,"px ").concat(a);var c=n.size,d=i.size,h=n.x,f=n.y,g=i.x,m=i.y,b=(h+g)/2,C=(f+m)/2,_=g-h,x=m-f,p=Math.sqrt(_*_+x*x);if(!(p<c+d)){h+=_*c/p,f+=x*c/p,g-=_*d/p,m-=x*d/p,b=(h+g)/2,C=(f+m)/2,_=g-h,x=m-f,p=Math.sqrt(_*_+x*x);var v=e.measureText(l).width;if(v>p){var w="…";for(l=l+w,v=e.measureText(l).width;v>p&&l.length>1;)l=l.slice(0,-2)+w,v=e.measureText(l).width;if(l.length<4)return}var k;_>0?x>0?k=Math.acos(_/p):k=Math.asin(x/p):x>0?k=Math.acos(_/p)+Math.PI:k=Math.asin(_/p)+Math.PI/2,e.save(),e.translate(b,C),e.rotate(k),e.fillText(l,-v/2,t.size/2+o),e.restore()}}}function ca(e,t,n){if(t.label){var i=n.labelSize,r=n.labelFont,o=n.labelWeight,a=n.labelColor.attribute?t[n.labelColor.attribute]||n.labelColor.color||"#000":n.labelColor.color;e.fillStyle=a,e.font="".concat(o," ").concat(i,"px ").concat(r),e.fillText(t.label,t.x+t.size+3,t.y+i/3)}}function Rh(e,t,n){var i=n.labelSize,r=n.labelFont,o=n.labelWeight;e.font="".concat(o," ").concat(i,"px ").concat(r),e.fillStyle="#FFF",e.shadowOffsetX=0,e.shadowOffsetY=0,e.shadowBlur=8,e.shadowColor="#000";var a=2;if(typeof t.label=="string"){var s=e.measureText(t.label).width,u=Math.round(s+5),l=Math.round(i+2*a),c=Math.max(t.size,i/2)+a,d=Math.asin(l/2/c),h=Math.sqrt(Math.abs(Math.pow(c,2)-Math.pow(l/2,2)));e.beginPath(),e.moveTo(t.x+h,t.y+l/2),e.lineTo(t.x+c+u,t.y+l/2),e.lineTo(t.x+c+u,t.y-l/2),e.lineTo(t.x+h,t.y-l/2),e.arc(t.x,t.y,c,d,-d),e.closePath(),e.fill()}else e.beginPath(),e.arc(t.x,t.y,t.size+a,0,Math.PI*2),e.closePath(),e.fill();e.shadowOffsetX=0,e.shadowOffsetY=0,e.shadowBlur=0,ca(e,t,n)}var Nh=`
precision highp float;

varying vec4 v_color;
varying vec2 v_diffVector;
varying float v_radius;

uniform float u_correctionRatio;

const vec4 transparent = vec4(0.0, 0.0, 0.0, 0.0);

void main(void) {
  float border = u_correctionRatio * 2.0;
  float dist = length(v_diffVector) - v_radius + border;

  // No antialiasing for picking mode:
  #ifdef PICKING_MODE
  if (dist > border)
    gl_FragColor = transparent;
  else
    gl_FragColor = v_color;

  #else
  float t = 0.0;
  if (dist > border)
    t = 1.0;
  else if (dist > 0.0)
    t = dist / border;

  gl_FragColor = mix(v_color, transparent, t);
  #endif
}
`,Mh=Nh,Dh=`
attribute vec4 a_id;
attribute vec4 a_color;
attribute vec2 a_position;
attribute float a_size;
attribute float a_angle;

uniform mat3 u_matrix;
uniform float u_sizeRatio;
uniform float u_correctionRatio;

varying vec4 v_color;
varying vec2 v_diffVector;
varying float v_radius;
varying float v_border;

const float bias = 255.0 / 254.0;

void main() {
  float size = a_size * u_correctionRatio / u_sizeRatio * 4.0;
  vec2 diffVector = size * vec2(cos(a_angle), sin(a_angle));
  vec2 position = a_position + diffVector;
  gl_Position = vec4(
    (u_matrix * vec3(position, 1)).xy,
    0,
    1
  );

  v_diffVector = diffVector;
  v_radius = size / 2.0;

  #ifdef PICKING_MODE
  // For picking mode, we use the ID as the color:
  v_color = a_id;
  #else
  // For normal mode, we use the color:
  v_color = a_color;
  #endif

  v_color.a *= bias;
}
`,$h=Dh,da=WebGLRenderingContext,Or=da.UNSIGNED_BYTE,ni=da.FLOAT,Gh=["u_sizeRatio","u_correctionRatio","u_matrix"],In=function(e){function t(){return be(this,t),Me(this,t,arguments)}return De(t,e),we(t,[{key:"getDefinition",value:function(){return{VERTICES:3,VERTEX_SHADER_SOURCE:$h,FRAGMENT_SHADER_SOURCE:Mh,METHOD:WebGLRenderingContext.TRIANGLES,UNIFORMS:Gh,ATTRIBUTES:[{name:"a_position",size:2,type:ni},{name:"a_size",size:1,type:ni},{name:"a_color",size:4,type:Or,normalized:!0},{name:"a_id",size:4,type:Or,normalized:!0}],CONSTANT_ATTRIBUTES:[{name:"a_angle",size:1,type:ni}],CONSTANT_DATA:[[t.ANGLE_1],[t.ANGLE_2],[t.ANGLE_3]]}}},{key:"processVisibleItem",value:function(i,r,o){var a=this.array,s=Nt(o.color);a[r++]=o.x,a[r++]=o.y,a[r++]=o.size,a[r++]=s,a[r++]=i}},{key:"setUniforms",value:function(i,r){var o=r.gl,a=r.uniformLocations,s=a.u_sizeRatio,u=a.u_correctionRatio,l=a.u_matrix;o.uniform1f(u,i.correctionRatio),o.uniform1f(s,i.sizeRatio),o.uniformMatrix3fv(l,!1,i.matrix)}}])}(Sh);T(In,"ANGLE_1",0);T(In,"ANGLE_2",2*Math.PI/3);T(In,"ANGLE_3",4*Math.PI/3);var Ph=`
precision mediump float;

varying vec4 v_color;

void main(void) {
  gl_FragColor = v_color;
}
`,Fh=Ph,Ih=`
attribute vec2 a_position;
attribute vec2 a_normal;
attribute float a_radius;
attribute vec3 a_barycentric;

#ifdef PICKING_MODE
attribute vec4 a_id;
#else
attribute vec4 a_color;
#endif

uniform mat3 u_matrix;
uniform float u_sizeRatio;
uniform float u_correctionRatio;
uniform float u_minEdgeThickness;
uniform float u_lengthToThicknessRatio;
uniform float u_widenessToThicknessRatio;

varying vec4 v_color;

const float bias = 255.0 / 254.0;

void main() {
  float minThickness = u_minEdgeThickness;

  float normalLength = length(a_normal);
  vec2 unitNormal = a_normal / normalLength;

  // These first computations are taken from edge.vert.glsl and
  // edge.clamped.vert.glsl. Please read it to get better comments on what's
  // happening:
  float pixelsThickness = max(normalLength / u_sizeRatio, minThickness);
  float webGLThickness = pixelsThickness * u_correctionRatio;
  float webGLNodeRadius = a_radius * 2.0 * u_correctionRatio / u_sizeRatio;
  float webGLArrowHeadLength = webGLThickness * u_lengthToThicknessRatio * 2.0;
  float webGLArrowHeadThickness = webGLThickness * u_widenessToThicknessRatio;

  float da = a_barycentric.x;
  float db = a_barycentric.y;
  float dc = a_barycentric.z;

  vec2 delta = vec2(
      da * (webGLNodeRadius * unitNormal.y)
    + db * ((webGLNodeRadius + webGLArrowHeadLength) * unitNormal.y + webGLArrowHeadThickness * unitNormal.x)
    + dc * ((webGLNodeRadius + webGLArrowHeadLength) * unitNormal.y - webGLArrowHeadThickness * unitNormal.x),

      da * (-webGLNodeRadius * unitNormal.x)
    + db * (-(webGLNodeRadius + webGLArrowHeadLength) * unitNormal.x + webGLArrowHeadThickness * unitNormal.y)
    + dc * (-(webGLNodeRadius + webGLArrowHeadLength) * unitNormal.x - webGLArrowHeadThickness * unitNormal.y)
  );

  vec2 position = (u_matrix * vec3(a_position + delta, 1)).xy;

  gl_Position = vec4(position, 0, 1);

  #ifdef PICKING_MODE
  // For picking mode, we use the ID as the color:
  v_color = a_id;
  #else
  // For normal mode, we use the color:
  v_color = a_color;
  #endif

  v_color.a *= bias;
}
`,zh=Ih,ha=WebGLRenderingContext,Br=ha.UNSIGNED_BYTE,cn=ha.FLOAT,Oh=["u_matrix","u_sizeRatio","u_correctionRatio","u_minEdgeThickness","u_lengthToThicknessRatio","u_widenessToThicknessRatio"],zn={extremity:"target",lengthToThicknessRatio:2.5,widenessToThicknessRatio:2};function fa(e){var t=q(q({},zn),{});return function(n){function i(){return be(this,i),Me(this,i,arguments)}return De(i,n),we(i,[{key:"getDefinition",value:function(){return{VERTICES:3,VERTEX_SHADER_SOURCE:zh,FRAGMENT_SHADER_SOURCE:Fh,METHOD:WebGLRenderingContext.TRIANGLES,UNIFORMS:Oh,ATTRIBUTES:[{name:"a_position",size:2,type:cn},{name:"a_normal",size:2,type:cn},{name:"a_radius",size:1,type:cn},{name:"a_color",size:4,type:Br,normalized:!0},{name:"a_id",size:4,type:Br,normalized:!0}],CONSTANT_ATTRIBUTES:[{name:"a_barycentric",size:3,type:cn}],CONSTANT_DATA:[[1,0,0],[0,1,0],[0,0,1]]}}},{key:"processVisibleItem",value:function(o,a,s,u,l){if(t.extremity==="source"){var c=[u,s];s=c[0],u=c[1]}var d=l.size||1,h=u.size||1,f=s.x,g=s.y,m=u.x,b=u.y,C=Nt(l.color),_=m-f,x=b-g,p=_*_+x*x,v=0,w=0;p&&(p=1/Math.sqrt(p),v=-x*p*d,w=_*p*d);var k=this.array;k[a++]=m,k[a++]=b,k[a++]=-v,k[a++]=-w,k[a++]=h,k[a++]=C,k[a++]=o}},{key:"setUniforms",value:function(o,a){var s=a.gl,u=a.uniformLocations,l=u.u_matrix,c=u.u_sizeRatio,d=u.u_correctionRatio,h=u.u_minEdgeThickness,f=u.u_lengthToThicknessRatio,g=u.u_widenessToThicknessRatio;s.uniformMatrix3fv(l,!1,o.matrix),s.uniform1f(c,o.sizeRatio),s.uniform1f(d,o.correctionRatio),s.uniform1f(h,o.minEdgeThickness),s.uniform1f(f,t.lengthToThicknessRatio),s.uniform1f(g,t.widenessToThicknessRatio)}}])}(Fn)}fa();var Bh=`
precision mediump float;

varying vec4 v_color;
varying vec2 v_normal;
varying float v_thickness;
varying float v_feather;

const vec4 transparent = vec4(0.0, 0.0, 0.0, 0.0);

void main(void) {
  // We only handle antialiasing for normal mode:
  #ifdef PICKING_MODE
  gl_FragColor = v_color;
  #else
  float dist = length(v_normal) * v_thickness;

  float t = smoothstep(
    v_thickness - v_feather,
    v_thickness,
    dist
  );

  gl_FragColor = mix(v_color, transparent, t);
  #endif
}
`,ga=Bh,Uh=`
attribute vec4 a_id;
attribute vec4 a_color;
attribute vec2 a_normal;
attribute float a_normalCoef;
attribute vec2 a_positionStart;
attribute vec2 a_positionEnd;
attribute float a_positionCoef;
attribute float a_radius;
attribute float a_radiusCoef;

uniform mat3 u_matrix;
uniform float u_zoomRatio;
uniform float u_sizeRatio;
uniform float u_pixelRatio;
uniform float u_correctionRatio;
uniform float u_minEdgeThickness;
uniform float u_lengthToThicknessRatio;
uniform float u_feather;

varying vec4 v_color;
varying vec2 v_normal;
varying float v_thickness;
varying float v_feather;

const float bias = 255.0 / 254.0;

void main() {
  float minThickness = u_minEdgeThickness;

  float radius = a_radius * a_radiusCoef;
  vec2 normal = a_normal * a_normalCoef;
  vec2 position = a_positionStart * (1.0 - a_positionCoef) + a_positionEnd * a_positionCoef;

  float normalLength = length(normal);
  vec2 unitNormal = normal / normalLength;

  // These first computations are taken from edge.vert.glsl. Please read it to
  // get better comments on what's happening:
  float pixelsThickness = max(normalLength, minThickness * u_sizeRatio);
  float webGLThickness = pixelsThickness * u_correctionRatio / u_sizeRatio;

  // Here, we move the point to leave space for the arrow head:
  float direction = sign(radius);
  float webGLNodeRadius = direction * radius * 2.0 * u_correctionRatio / u_sizeRatio;
  float webGLArrowHeadLength = webGLThickness * u_lengthToThicknessRatio * 2.0;

  vec2 compensationVector = vec2(-direction * unitNormal.y, direction * unitNormal.x) * (webGLNodeRadius + webGLArrowHeadLength);

  // Here is the proper position of the vertex
  gl_Position = vec4((u_matrix * vec3(position + unitNormal * webGLThickness + compensationVector, 1)).xy, 0, 1);

  v_thickness = webGLThickness / u_zoomRatio;

  v_normal = unitNormal;

  v_feather = u_feather * u_correctionRatio / u_zoomRatio / u_pixelRatio * 2.0;

  #ifdef PICKING_MODE
  // For picking mode, we use the ID as the color:
  v_color = a_id;
  #else
  // For normal mode, we use the color:
  v_color = a_color;
  #endif

  v_color.a *= bias;
}
`,Hh=Uh,pa=WebGLRenderingContext,Ur=pa.UNSIGNED_BYTE,ct=pa.FLOAT,Wh=["u_matrix","u_zoomRatio","u_sizeRatio","u_correctionRatio","u_pixelRatio","u_feather","u_minEdgeThickness","u_lengthToThicknessRatio"],qh={lengthToThicknessRatio:zn.lengthToThicknessRatio};function ma(e){var t=q(q({},qh),{});return function(n){function i(){return be(this,i),Me(this,i,arguments)}return De(i,n),we(i,[{key:"getDefinition",value:function(){return{VERTICES:6,VERTEX_SHADER_SOURCE:Hh,FRAGMENT_SHADER_SOURCE:ga,METHOD:WebGLRenderingContext.TRIANGLES,UNIFORMS:Wh,ATTRIBUTES:[{name:"a_positionStart",size:2,type:ct},{name:"a_positionEnd",size:2,type:ct},{name:"a_normal",size:2,type:ct},{name:"a_color",size:4,type:Ur,normalized:!0},{name:"a_id",size:4,type:Ur,normalized:!0},{name:"a_radius",size:1,type:ct}],CONSTANT_ATTRIBUTES:[{name:"a_positionCoef",size:1,type:ct},{name:"a_normalCoef",size:1,type:ct},{name:"a_radiusCoef",size:1,type:ct}],CONSTANT_DATA:[[0,1,0],[0,-1,0],[1,1,1],[1,1,1],[0,-1,0],[1,-1,-1]]}}},{key:"processVisibleItem",value:function(o,a,s,u,l){var c=l.size||1,d=s.x,h=s.y,f=u.x,g=u.y,m=Nt(l.color),b=f-d,C=g-h,_=u.size||1,x=b*b+C*C,p=0,v=0;x&&(x=1/Math.sqrt(x),p=-C*x*c,v=b*x*c);var w=this.array;w[a++]=d,w[a++]=h,w[a++]=f,w[a++]=g,w[a++]=p,w[a++]=v,w[a++]=m,w[a++]=o,w[a++]=_}},{key:"setUniforms",value:function(o,a){var s=a.gl,u=a.uniformLocations,l=u.u_matrix,c=u.u_zoomRatio,d=u.u_feather,h=u.u_pixelRatio,f=u.u_correctionRatio,g=u.u_sizeRatio,m=u.u_minEdgeThickness,b=u.u_lengthToThicknessRatio;s.uniformMatrix3fv(l,!1,o.matrix),s.uniform1f(c,o.zoomRatio),s.uniform1f(g,o.sizeRatio),s.uniform1f(f,o.correctionRatio),s.uniform1f(h,o.pixelRatio),s.uniform1f(d,o.antiAliasingFeather),s.uniform1f(m,o.minEdgeThickness),s.uniform1f(b,t.lengthToThicknessRatio)}}])}(Fn)}ma();function Vh(e){return Ah([ma(),fa()])}var jh=Vh(),Yh=jh,Xh=`
attribute vec4 a_id;
attribute vec4 a_color;
attribute vec2 a_normal;
attribute float a_normalCoef;
attribute vec2 a_positionStart;
attribute vec2 a_positionEnd;
attribute float a_positionCoef;

uniform mat3 u_matrix;
uniform float u_sizeRatio;
uniform float u_zoomRatio;
uniform float u_pixelRatio;
uniform float u_correctionRatio;
uniform float u_minEdgeThickness;
uniform float u_feather;

varying vec4 v_color;
varying vec2 v_normal;
varying float v_thickness;
varying float v_feather;

const float bias = 255.0 / 254.0;

void main() {
  float minThickness = u_minEdgeThickness;

  vec2 normal = a_normal * a_normalCoef;
  vec2 position = a_positionStart * (1.0 - a_positionCoef) + a_positionEnd * a_positionCoef;

  float normalLength = length(normal);
  vec2 unitNormal = normal / normalLength;

  // We require edges to be at least "minThickness" pixels thick *on screen*
  // (so we need to compensate the size ratio):
  float pixelsThickness = max(normalLength, minThickness * u_sizeRatio);

  // Then, we need to retrieve the normalized thickness of the edge in the WebGL
  // referential (in a ([0, 1], [0, 1]) space), using our "magic" correction
  // ratio:
  float webGLThickness = pixelsThickness * u_correctionRatio / u_sizeRatio;

  // Here is the proper position of the vertex
  gl_Position = vec4((u_matrix * vec3(position + unitNormal * webGLThickness, 1)).xy, 0, 1);

  // For the fragment shader though, we need a thickness that takes the "magic"
  // correction ratio into account (as in webGLThickness), but so that the
  // antialiasing effect does not depend on the zoom level. So here's yet
  // another thickness version:
  v_thickness = webGLThickness / u_zoomRatio;

  v_normal = unitNormal;

  v_feather = u_feather * u_correctionRatio / u_zoomRatio / u_pixelRatio * 2.0;

  #ifdef PICKING_MODE
  // For picking mode, we use the ID as the color:
  v_color = a_id;
  #else
  // For normal mode, we use the color:
  v_color = a_color;
  #endif

  v_color.a *= bias;
}
`,Kh=Xh,va=WebGLRenderingContext,Hr=va.UNSIGNED_BYTE,Pt=va.FLOAT,Zh=["u_matrix","u_zoomRatio","u_sizeRatio","u_correctionRatio","u_pixelRatio","u_feather","u_minEdgeThickness"],Jh=function(e){function t(){return be(this,t),Me(this,t,arguments)}return De(t,e),we(t,[{key:"getDefinition",value:function(){return{VERTICES:6,VERTEX_SHADER_SOURCE:Kh,FRAGMENT_SHADER_SOURCE:ga,METHOD:WebGLRenderingContext.TRIANGLES,UNIFORMS:Zh,ATTRIBUTES:[{name:"a_positionStart",size:2,type:Pt},{name:"a_positionEnd",size:2,type:Pt},{name:"a_normal",size:2,type:Pt},{name:"a_color",size:4,type:Hr,normalized:!0},{name:"a_id",size:4,type:Hr,normalized:!0}],CONSTANT_ATTRIBUTES:[{name:"a_positionCoef",size:1,type:Pt},{name:"a_normalCoef",size:1,type:Pt}],CONSTANT_DATA:[[0,1],[0,-1],[1,1],[1,1],[0,-1],[1,-1]]}}},{key:"processVisibleItem",value:function(i,r,o,a,s){var u=s.size||1,l=o.x,c=o.y,d=a.x,h=a.y,f=Nt(s.color),g=d-l,m=h-c,b=g*g+m*m,C=0,_=0;b&&(b=1/Math.sqrt(b),C=-m*b*u,_=g*b*u);var x=this.array;x[r++]=l,x[r++]=c,x[r++]=d,x[r++]=h,x[r++]=C,x[r++]=_,x[r++]=f,x[r++]=i}},{key:"setUniforms",value:function(i,r){var o=r.gl,a=r.uniformLocations,s=a.u_matrix,u=a.u_zoomRatio,l=a.u_feather,c=a.u_pixelRatio,d=a.u_correctionRatio,h=a.u_sizeRatio,f=a.u_minEdgeThickness;o.uniformMatrix3fv(s,!1,i.matrix),o.uniform1f(u,i.zoomRatio),o.uniform1f(h,i.sizeRatio),o.uniform1f(d,i.correctionRatio),o.uniform1f(c,i.pixelRatio),o.uniform1f(l,i.antiAliasingFeather),o.uniform1f(f,i.minEdgeThickness)}}])}(Fn),Wi=function(e){function t(){var n;return be(this,t),n=Me(this,t),n.rawEmitter=n,n}return De(t,e),we(t)}(Bo.EventEmitter),ii,Wr;function Qh(){return Wr||(Wr=1,ii=function(t){return t!==null&&typeof t=="object"&&typeof t.addUndirectedEdgeWithKey=="function"&&typeof t.dropNode=="function"&&typeof t.multi=="boolean"}),ii}var ef=Qh();const tf=rd(ef);var nf=function(t){return t},rf=function(t){return t*t},of=function(t){return t*(2-t)},af=function(t){return(t*=2)<1?.5*t*t:-.5*(--t*(t-2)-1)},sf=function(t){return t*t*t},uf=function(t){return--t*t*t+1},lf=function(t){return(t*=2)<1?.5*t*t*t:.5*((t-=2)*t*t+2)},cf={linear:nf,quadraticIn:rf,quadraticOut:of,quadraticInOut:af,cubicIn:sf,cubicOut:uf,cubicInOut:lf},df={easing:"quadraticInOut",duration:150};function Fe(){return Float32Array.of(1,0,0,0,1,0,0,0,1)}function dn(e,t,n){return e[0]=t,e[4]=typeof n=="number"?n:t,e}function qr(e,t){var n=Math.sin(t),i=Math.cos(t);return e[0]=i,e[1]=n,e[3]=-n,e[4]=i,e}function Vr(e,t,n){return e[6]=t,e[7]=n,e}function ot(e,t){var n=e[0],i=e[1],r=e[2],o=e[3],a=e[4],s=e[5],u=e[6],l=e[7],c=e[8],d=t[0],h=t[1],f=t[2],g=t[3],m=t[4],b=t[5],C=t[6],_=t[7],x=t[8];return e[0]=d*n+h*o+f*u,e[1]=d*i+h*a+f*l,e[2]=d*r+h*s+f*c,e[3]=g*n+m*o+b*u,e[4]=g*i+m*a+b*l,e[5]=g*r+m*s+b*c,e[6]=C*n+_*o+x*u,e[7]=C*i+_*a+x*l,e[8]=C*r+_*s+x*c,e}function Ei(e,t){var n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:1,i=e[0],r=e[1],o=e[3],a=e[4],s=e[6],u=e[7],l=t.x,c=t.y;return{x:l*i+c*o+s*n,y:l*r+c*a+u*n}}function hf(e,t){var n=e.height/e.width,i=t.height/t.width;return n<1&&i>1||n>1&&i<1?1:Math.min(Math.max(i,1/i),Math.max(1/n,n))}function Ft(e,t,n,i,r){var o=e.angle,a=e.ratio,s=e.x,u=e.y,l=t.width,c=t.height,d=Fe(),h=Math.min(l,c)-2*i,f=hf(t,n);return r?(ot(d,Vr(Fe(),s,u)),ot(d,dn(Fe(),a)),ot(d,qr(Fe(),o)),ot(d,dn(Fe(),l/h/2/f,c/h/2/f))):(ot(d,dn(Fe(),2*(h/l)*f,2*(h/c)*f)),ot(d,qr(Fe(),-o)),ot(d,dn(Fe(),1/a)),ot(d,Vr(Fe(),-s,-u))),d}function ff(e,t,n){var i=Ei(e,{x:Math.cos(t.angle),y:Math.sin(t.angle)},0),r=i.x,o=i.y;return 1/Math.sqrt(Math.pow(r,2)+Math.pow(o,2))/n.width}function gf(e){if(!e.order)return{x:[0,1],y:[0,1]};var t=1/0,n=-1/0,i=1/0,r=-1/0;return e.forEachNode(function(o,a){var s=a.x,u=a.y;s<t&&(t=s),s>n&&(n=s),u<i&&(i=u),u>r&&(r=u)}),{x:[t,n],y:[i,r]}}function pf(e){if(!tf(e))throw new Error("Sigma: invalid graph instance.");e.forEachNode(function(t,n){if(!Number.isFinite(n.x)||!Number.isFinite(n.y))throw new Error("Sigma: Coordinates of node ".concat(t," are invalid. A node must have a numeric 'x' and 'y' attribute."))})}function mf(e,t,n){var i=document.createElement(e);if(t)for(var r in t)i.style[r]=t[r];if(n)for(var o in n)i.setAttribute(o,n[o]);return i}function jr(){return typeof window.devicePixelRatio<"u"?window.devicePixelRatio:1}function Yr(e,t,n){return n.sort(function(i,r){var o=t(i)||0,a=t(r)||0;return o<a?-1:o>a?1:0})}function Xr(e){var t=St(e.x,2),n=t[0],i=t[1],r=St(e.y,2),o=r[0],a=r[1],s=Math.max(i-n,a-o),u=(i+n)/2,l=(a+o)/2;(s===0||Math.abs(s)===1/0||isNaN(s))&&(s=1),isNaN(u)&&(u=0),isNaN(l)&&(l=0);var c=function(h){return{x:.5+(h.x-u)/s,y:.5+(h.y-l)/s}};return c.applyTo=function(d){d.x=.5+(d.x-u)/s,d.y=.5+(d.y-l)/s},c.inverse=function(d){return{x:u+s*(d.x-.5),y:l+s*(d.y-.5)}},c.ratio=s,c}function Ci(e){"@babel/helpers - typeof";return Ci=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Ci(e)}function Kr(e,t){var n=t.size;if(n!==0){var i=e.length;e.length+=n;var r=0;t.forEach(function(o){e[i+r]=o,r++})}}function ri(e){e=e||{};for(var t=0,n=arguments.length<=1?0:arguments.length-1;t<n;t++){var i=t+1<1||arguments.length<=t+1?void 0:arguments[t+1];i&&Object.assign(e,i)}return e}var qi={hideEdgesOnMove:!1,hideLabelsOnMove:!1,renderLabels:!0,renderEdgeLabels:!1,enableEdgeEvents:!1,defaultNodeColor:"#999",defaultNodeType:"circle",defaultEdgeColor:"#ccc",defaultEdgeType:"line",labelFont:"Arial",labelSize:14,labelWeight:"normal",labelColor:{color:"#000"},edgeLabelFont:"Arial",edgeLabelSize:14,edgeLabelWeight:"normal",edgeLabelColor:{attribute:"color"},stagePadding:30,defaultDrawEdgeLabel:Lh,defaultDrawNodeLabel:ca,defaultDrawNodeHover:Rh,minEdgeThickness:1.7,antiAliasingFeather:1,dragTimeout:100,draggedEventsTolerance:3,inertiaDuration:200,inertiaRatio:3,zoomDuration:250,zoomingRatio:1.7,doubleClickTimeout:300,doubleClickZoomingRatio:2.2,doubleClickZoomingDuration:200,tapMoveTolerance:10,zoomToSizeRatioFunction:Math.sqrt,itemSizesReference:"screen",autoRescale:!0,autoCenter:!0,labelDensity:1,labelGridCellSize:100,labelRenderedSizeThreshold:6,nodeReducer:null,edgeReducer:null,zIndex:!1,minCameraRatio:null,maxCameraRatio:null,enableCameraZooming:!0,enableCameraPanning:!0,enableCameraRotation:!0,cameraPanBoundaries:null,allowInvalidContainer:!1,nodeProgramClasses:{},nodeHoverProgramClasses:{},edgeProgramClasses:{}},vf={circle:In},yf={arrow:Yh,line:Jh};function oi(e){if(typeof e.labelDensity!="number"||e.labelDensity<0)throw new Error("Settings: invalid `labelDensity`. Expecting a positive number.");var t=e.minCameraRatio,n=e.maxCameraRatio;if(typeof t=="number"&&typeof n=="number"&&n<t)throw new Error("Settings: invalid camera ratio boundaries. Expecting `maxCameraRatio` to be greater than `minCameraRatio`.")}function bf(e){var t=ri({},qi,e);return t.nodeProgramClasses=ri({},vf,t.nodeProgramClasses),t.edgeProgramClasses=ri({},yf,t.edgeProgramClasses),t}var hn=1.5,Zr=function(e){function t(){var n;return be(this,t),n=Me(this,t),T(n,"x",.5),T(n,"y",.5),T(n,"angle",0),T(n,"ratio",1),T(n,"minRatio",null),T(n,"maxRatio",null),T(n,"enabledZooming",!0),T(n,"enabledPanning",!0),T(n,"enabledRotation",!0),T(n,"clean",null),T(n,"nextFrame",null),T(n,"previousState",null),T(n,"enabled",!0),n.previousState=n.getState(),n}return De(t,e),we(t,[{key:"enable",value:function(){return this.enabled=!0,this}},{key:"disable",value:function(){return this.enabled=!1,this}},{key:"getState",value:function(){return{x:this.x,y:this.y,angle:this.angle,ratio:this.ratio}}},{key:"hasState",value:function(i){return this.x===i.x&&this.y===i.y&&this.ratio===i.ratio&&this.angle===i.angle}},{key:"getPreviousState",value:function(){var i=this.previousState;return i?{x:i.x,y:i.y,angle:i.angle,ratio:i.ratio}:null}},{key:"getBoundedRatio",value:function(i){var r=i;return typeof this.minRatio=="number"&&(r=Math.max(r,this.minRatio)),typeof this.maxRatio=="number"&&(r=Math.min(r,this.maxRatio)),r}},{key:"validateState",value:function(i){var r={};return this.enabledPanning&&typeof i.x=="number"&&(r.x=i.x),this.enabledPanning&&typeof i.y=="number"&&(r.y=i.y),this.enabledZooming&&typeof i.ratio=="number"&&(r.ratio=this.getBoundedRatio(i.ratio)),this.enabledRotation&&typeof i.angle=="number"&&(r.angle=i.angle),this.clean?this.clean(q(q({},this.getState()),r)):r}},{key:"isAnimated",value:function(){return!!this.nextFrame}},{key:"setState",value:function(i){if(!this.enabled)return this;this.previousState=this.getState();var r=this.validateState(i);return typeof r.x=="number"&&(this.x=r.x),typeof r.y=="number"&&(this.y=r.y),typeof r.ratio=="number"&&(this.ratio=r.ratio),typeof r.angle=="number"&&(this.angle=r.angle),this.hasState(this.previousState)||this.emit("updated",this.getState()),this}},{key:"updateState",value:function(i){return this.setState(i(this.getState())),this}},{key:"animate",value:function(i){var r=this,o=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},a=arguments.length>2?arguments[2]:void 0;if(!a)return new Promise(function(f){return r.animate(i,o,f)});if(this.enabled){var s=q(q({},df),o),u=this.validateState(i),l=typeof s.easing=="function"?s.easing:cf[s.easing],c=Date.now(),d=this.getState(),h=function(){var g=(Date.now()-c)/s.duration;if(g>=1){r.nextFrame=null,r.setState(u),r.animationCallback&&(r.animationCallback.call(null),r.animationCallback=void 0);return}var m=l(g),b={};typeof u.x=="number"&&(b.x=d.x+(u.x-d.x)*m),typeof u.y=="number"&&(b.y=d.y+(u.y-d.y)*m),r.enabledRotation&&typeof u.angle=="number"&&(b.angle=d.angle+(u.angle-d.angle)*m),typeof u.ratio=="number"&&(b.ratio=d.ratio+(u.ratio-d.ratio)*m),r.setState(b),r.nextFrame=requestAnimationFrame(h)};this.nextFrame?(cancelAnimationFrame(this.nextFrame),this.animationCallback&&this.animationCallback.call(null),this.nextFrame=requestAnimationFrame(h)):h(),this.animationCallback=a}}},{key:"animatedZoom",value:function(i){return i?typeof i=="number"?this.animate({ratio:this.ratio/i}):this.animate({ratio:this.ratio/(i.factor||hn)},i):this.animate({ratio:this.ratio/hn})}},{key:"animatedUnzoom",value:function(i){return i?typeof i=="number"?this.animate({ratio:this.ratio*i}):this.animate({ratio:this.ratio*(i.factor||hn)},i):this.animate({ratio:this.ratio*hn})}},{key:"animatedReset",value:function(i){return this.animate({x:.5,y:.5,ratio:1,angle:0},i)}},{key:"copy",value:function(){return t.from(this.getState())}}],[{key:"from",value:function(i){var r=new t;return r.setState(i)}}])}(Wi);function Oe(e,t){var n=t.getBoundingClientRect();return{x:e.clientX-n.left,y:e.clientY-n.top}}function Ke(e,t){var n=q(q({},Oe(e,t)),{},{sigmaDefaultPrevented:!1,preventSigmaDefault:function(){n.sigmaDefaultPrevented=!0},original:e});return n}function It(e){var t="x"in e?e:q(q({},e.touches[0]||e.previousTouches[0]),{},{original:e.original,sigmaDefaultPrevented:e.sigmaDefaultPrevented,preventSigmaDefault:function(){e.sigmaDefaultPrevented=!0,t.sigmaDefaultPrevented=!0}});return t}function wf(e,t){return q(q({},Ke(e,t)),{},{delta:ya(e)})}var _f=2;function yn(e){for(var t=[],n=0,i=Math.min(e.length,_f);n<i;n++)t.push(e[n]);return t}function zt(e,t,n){var i={touches:yn(e.touches).map(function(r){return Oe(r,n)}),previousTouches:t.map(function(r){return Oe(r,n)}),sigmaDefaultPrevented:!1,preventSigmaDefault:function(){i.sigmaDefaultPrevented=!0},original:e};return i}function ya(e){if(typeof e.deltaY<"u")return e.deltaY*-3/360;if(typeof e.detail<"u")return e.detail/-9;throw new Error("Captor: could not extract delta from event.")}var ba=function(e){function t(n,i){var r;return be(this,t),r=Me(this,t),r.container=n,r.renderer=i,r}return De(t,e),we(t)}(Wi),xf=["doubleClickTimeout","doubleClickZoomingDuration","doubleClickZoomingRatio","dragTimeout","draggedEventsTolerance","inertiaDuration","inertiaRatio","zoomDuration","zoomingRatio"],Ef=xf.reduce(function(e,t){return q(q({},e),{},T({},t,qi[t]))},{}),Cf=function(e){function t(n,i){var r;return be(this,t),r=Me(this,t,[n,i]),T(r,"enabled",!0),T(r,"draggedEvents",0),T(r,"downStartTime",null),T(r,"lastMouseX",null),T(r,"lastMouseY",null),T(r,"isMouseDown",!1),T(r,"isMoving",!1),T(r,"movingTimeout",null),T(r,"startCameraState",null),T(r,"clicks",0),T(r,"doubleClickTimeout",null),T(r,"currentWheelDirection",0),T(r,"settings",Ef),r.handleClick=r.handleClick.bind(r),r.handleRightClick=r.handleRightClick.bind(r),r.handleDown=r.handleDown.bind(r),r.handleUp=r.handleUp.bind(r),r.handleMove=r.handleMove.bind(r),r.handleWheel=r.handleWheel.bind(r),r.handleLeave=r.handleLeave.bind(r),r.handleEnter=r.handleEnter.bind(r),n.addEventListener("click",r.handleClick,{capture:!1}),n.addEventListener("contextmenu",r.handleRightClick,{capture:!1}),n.addEventListener("mousedown",r.handleDown,{capture:!1}),n.addEventListener("wheel",r.handleWheel,{capture:!1}),n.addEventListener("mouseleave",r.handleLeave,{capture:!1}),n.addEventListener("mouseenter",r.handleEnter,{capture:!1}),document.addEventListener("mousemove",r.handleMove,{capture:!1}),document.addEventListener("mouseup",r.handleUp,{capture:!1}),r}return De(t,e),we(t,[{key:"kill",value:function(){var i=this.container;i.removeEventListener("click",this.handleClick),i.removeEventListener("contextmenu",this.handleRightClick),i.removeEventListener("mousedown",this.handleDown),i.removeEventListener("wheel",this.handleWheel),i.removeEventListener("mouseleave",this.handleLeave),i.removeEventListener("mouseenter",this.handleEnter),document.removeEventListener("mousemove",this.handleMove),document.removeEventListener("mouseup",this.handleUp)}},{key:"handleClick",value:function(i){var r=this;if(this.enabled){if(this.clicks++,this.clicks===2)return this.clicks=0,typeof this.doubleClickTimeout=="number"&&(clearTimeout(this.doubleClickTimeout),this.doubleClickTimeout=null),this.handleDoubleClick(i);setTimeout(function(){r.clicks=0,r.doubleClickTimeout=null},this.settings.doubleClickTimeout),this.draggedEvents<this.settings.draggedEventsTolerance&&this.emit("click",Ke(i,this.container))}}},{key:"handleRightClick",value:function(i){this.enabled&&this.emit("rightClick",Ke(i,this.container))}},{key:"handleDoubleClick",value:function(i){if(this.enabled){i.preventDefault(),i.stopPropagation();var r=Ke(i,this.container);if(this.emit("doubleClick",r),!r.sigmaDefaultPrevented){var o=this.renderer.getCamera(),a=o.getBoundedRatio(o.getState().ratio/this.settings.doubleClickZoomingRatio);o.animate(this.renderer.getViewportZoomedState(Oe(i,this.container),a),{easing:"quadraticInOut",duration:this.settings.doubleClickZoomingDuration})}}}},{key:"handleDown",value:function(i){if(this.enabled){if(i.button===0){this.startCameraState=this.renderer.getCamera().getState();var r=Oe(i,this.container),o=r.x,a=r.y;this.lastMouseX=o,this.lastMouseY=a,this.draggedEvents=0,this.downStartTime=Date.now(),this.isMouseDown=!0}this.emit("mousedown",Ke(i,this.container))}}},{key:"handleUp",value:function(i){var r=this;if(!(!this.enabled||!this.isMouseDown)){var o=this.renderer.getCamera();this.isMouseDown=!1,typeof this.movingTimeout=="number"&&(clearTimeout(this.movingTimeout),this.movingTimeout=null);var a=Oe(i,this.container),s=a.x,u=a.y,l=o.getState(),c=o.getPreviousState()||{x:0,y:0};this.isMoving?o.animate({x:l.x+this.settings.inertiaRatio*(l.x-c.x),y:l.y+this.settings.inertiaRatio*(l.y-c.y)},{duration:this.settings.inertiaDuration,easing:"quadraticOut"}):(this.lastMouseX!==s||this.lastMouseY!==u)&&o.setState({x:l.x,y:l.y}),this.isMoving=!1,setTimeout(function(){var d=r.draggedEvents>0;r.draggedEvents=0,d&&r.renderer.getSetting("hideEdgesOnMove")&&r.renderer.refresh()},0),this.emit("mouseup",Ke(i,this.container))}}},{key:"handleMove",value:function(i){var r=this;if(this.enabled){var o=Ke(i,this.container);if(this.emit("mousemovebody",o),(i.target===this.container||i.composedPath()[0]===this.container)&&this.emit("mousemove",o),!o.sigmaDefaultPrevented&&this.isMouseDown){this.isMoving=!0,this.draggedEvents++,typeof this.movingTimeout=="number"&&clearTimeout(this.movingTimeout),this.movingTimeout=window.setTimeout(function(){r.movingTimeout=null,r.isMoving=!1},this.settings.dragTimeout);var a=this.renderer.getCamera(),s=Oe(i,this.container),u=s.x,l=s.y,c=this.renderer.viewportToFramedGraph({x:this.lastMouseX,y:this.lastMouseY}),d=this.renderer.viewportToFramedGraph({x:u,y:l}),h=c.x-d.x,f=c.y-d.y,g=a.getState(),m=g.x+h,b=g.y+f;a.setState({x:m,y:b}),this.lastMouseX=u,this.lastMouseY=l,i.preventDefault(),i.stopPropagation()}}}},{key:"handleLeave",value:function(i){this.emit("mouseleave",Ke(i,this.container))}},{key:"handleEnter",value:function(i){this.emit("mouseenter",Ke(i,this.container))}},{key:"handleWheel",value:function(i){var r=this,o=this.renderer.getCamera();if(!(!this.enabled||!o.enabledZooming)){var a=ya(i);if(a){var s=wf(i,this.container);if(this.emit("wheel",s),s.sigmaDefaultPrevented){i.preventDefault(),i.stopPropagation();return}var u=o.getState().ratio,l=a>0?1/this.settings.zoomingRatio:this.settings.zoomingRatio,c=o.getBoundedRatio(u*l),d=a>0?1:-1,h=Date.now();u!==c&&(i.preventDefault(),i.stopPropagation(),!(this.currentWheelDirection===d&&this.lastWheelTriggerTime&&h-this.lastWheelTriggerTime<this.settings.zoomDuration/5)&&(o.animate(this.renderer.getViewportZoomedState(Oe(i,this.container),c),{easing:"quadraticOut",duration:this.settings.zoomDuration},function(){r.currentWheelDirection=0}),this.currentWheelDirection=d,this.lastWheelTriggerTime=h))}}}},{key:"setSettings",value:function(i){this.settings=i}}])}(ba),kf=["dragTimeout","inertiaDuration","inertiaRatio","doubleClickTimeout","doubleClickZoomingRatio","doubleClickZoomingDuration","tapMoveTolerance"],Tf=kf.reduce(function(e,t){return q(q({},e),{},T({},t,qi[t]))},{}),Sf=function(e){function t(n,i){var r;return be(this,t),r=Me(this,t,[n,i]),T(r,"enabled",!0),T(r,"isMoving",!1),T(r,"hasMoved",!1),T(r,"touchMode",0),T(r,"startTouchesPositions",[]),T(r,"lastTouches",[]),T(r,"lastTap",null),T(r,"settings",Tf),r.handleStart=r.handleStart.bind(r),r.handleLeave=r.handleLeave.bind(r),r.handleMove=r.handleMove.bind(r),n.addEventListener("touchstart",r.handleStart,{capture:!1}),n.addEventListener("touchcancel",r.handleLeave,{capture:!1}),document.addEventListener("touchend",r.handleLeave,{capture:!1,passive:!1}),document.addEventListener("touchmove",r.handleMove,{capture:!1,passive:!1}),r}return De(t,e),we(t,[{key:"kill",value:function(){var i=this.container;i.removeEventListener("touchstart",this.handleStart),i.removeEventListener("touchcancel",this.handleLeave),document.removeEventListener("touchend",this.handleLeave),document.removeEventListener("touchmove",this.handleMove)}},{key:"getDimensions",value:function(){return{width:this.container.offsetWidth,height:this.container.offsetHeight}}},{key:"handleStart",value:function(i){var r=this;if(this.enabled){i.preventDefault();var o=yn(i.touches);if(this.touchMode=o.length,this.startCameraState=this.renderer.getCamera().getState(),this.startTouchesPositions=o.map(function(f){return Oe(f,r.container)}),this.touchMode===2){var a=St(this.startTouchesPositions,2),s=a[0],u=s.x,l=s.y,c=a[1],d=c.x,h=c.y;this.startTouchesAngle=Math.atan2(h-l,d-u),this.startTouchesDistance=Math.sqrt(Math.pow(d-u,2)+Math.pow(h-l,2))}this.emit("touchdown",zt(i,this.lastTouches,this.container)),this.lastTouches=o,this.lastTouchesPositions=this.startTouchesPositions}}},{key:"handleLeave",value:function(i){if(!(!this.enabled||!this.startTouchesPositions.length)){switch(i.cancelable&&i.preventDefault(),this.movingTimeout&&(this.isMoving=!1,clearTimeout(this.movingTimeout)),this.touchMode){case 2:if(i.touches.length===1){this.handleStart(i),i.preventDefault();break}case 1:if(this.isMoving){var r=this.renderer.getCamera(),o=r.getState(),a=r.getPreviousState()||{x:0,y:0};r.animate({x:o.x+this.settings.inertiaRatio*(o.x-a.x),y:o.y+this.settings.inertiaRatio*(o.y-a.y)},{duration:this.settings.inertiaDuration,easing:"quadraticOut"})}this.hasMoved=!1,this.isMoving=!1,this.touchMode=0;break}if(this.emit("touchup",zt(i,this.lastTouches,this.container)),!i.touches.length){var s=Oe(this.lastTouches[0],this.container),u=this.startTouchesPositions[0],l=Math.pow(s.x-u.x,2)+Math.pow(s.y-u.y,2);if(!i.touches.length&&l<Math.pow(this.settings.tapMoveTolerance,2))if(this.lastTap&&Date.now()-this.lastTap.time<this.settings.doubleClickTimeout){var c=zt(i,this.lastTouches,this.container);if(this.emit("doubletap",c),this.lastTap=null,!c.sigmaDefaultPrevented){var d=this.renderer.getCamera(),h=d.getBoundedRatio(d.getState().ratio/this.settings.doubleClickZoomingRatio);d.animate(this.renderer.getViewportZoomedState(s,h),{easing:"quadraticInOut",duration:this.settings.doubleClickZoomingDuration})}}else{var f=zt(i,this.lastTouches,this.container);this.emit("tap",f),this.lastTap={time:Date.now(),position:f.touches[0]||f.previousTouches[0]}}}this.lastTouches=yn(i.touches),this.startTouchesPositions=[]}}},{key:"handleMove",value:function(i){var r=this;if(!(!this.enabled||!this.startTouchesPositions.length)){i.preventDefault();var o=yn(i.touches),a=o.map(function(se){return Oe(se,r.container)}),s=this.lastTouches;this.lastTouches=o,this.lastTouchesPositions=a;var u=zt(i,s,this.container);if(this.emit("touchmove",u),!u.sigmaDefaultPrevented&&(this.hasMoved||(this.hasMoved=a.some(function(se,te){var he=r.startTouchesPositions[te];return he&&(se.x!==he.x||se.y!==he.y)})),!!this.hasMoved)){this.isMoving=!0,this.movingTimeout&&clearTimeout(this.movingTimeout),this.movingTimeout=window.setTimeout(function(){r.isMoving=!1},this.settings.dragTimeout);var l=this.renderer.getCamera(),c=this.startCameraState,d=this.renderer.getSetting("stagePadding");switch(this.touchMode){case 1:{var h=this.renderer.viewportToFramedGraph((this.startTouchesPositions||[])[0]),f=h.x,g=h.y,m=this.renderer.viewportToFramedGraph(a[0]),b=m.x,C=m.y;l.setState({x:c.x+f-b,y:c.y+g-C});break}case 2:{var _={x:.5,y:.5,angle:0,ratio:1},x=a[0],p=x.x,v=x.y,w=a[1],k=w.x,D=w.y,I=Math.atan2(D-v,k-p)-this.startTouchesAngle,F=Math.hypot(D-v,k-p)/this.startTouchesDistance,R=l.getBoundedRatio(c.ratio/F);_.ratio=R,_.angle=c.angle+I;var H=this.getDimensions(),$=this.renderer.viewportToFramedGraph((this.startTouchesPositions||[])[0],{cameraState:c}),W=Math.min(H.width,H.height)-2*d,ae=W/H.width,ue=W/H.height,de=R/W,le=p-W/2/ae,Q=v-W/2/ue,ce=[le*Math.cos(-_.angle)-Q*Math.sin(-_.angle),Q*Math.cos(-_.angle)+le*Math.sin(-_.angle)];le=ce[0],Q=ce[1],_.x=$.x-le*de,_.y=$.y+Q*de,l.setState(_);break}}}}}},{key:"setSettings",value:function(i){this.settings=i}}])}(ba);function Af(e){if(Array.isArray(e))return _i(e)}function Lf(e){if(typeof Symbol<"u"&&e[Symbol.iterator]!=null||e["@@iterator"]!=null)return Array.from(e)}function Rf(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function Jr(e){return Af(e)||Lf(e)||ia(e)||Rf()}function Nf(e,t){if(e==null)return{};var n={};for(var i in e)if({}.hasOwnProperty.call(e,i)){if(t.indexOf(i)!==-1)continue;n[i]=e[i]}return n}function ai(e,t){if(e==null)return{};var n,i,r=Nf(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(i=0;i<o.length;i++)n=o[i],t.indexOf(n)===-1&&{}.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}var Qr=function(){function e(t,n){be(this,e),this.key=t,this.size=n}return we(e,null,[{key:"compare",value:function(n,i){return n.size>i.size?-1:n.size<i.size||n.key>i.key?1:-1}}])}(),eo=function(){function e(){be(this,e),T(this,"width",0),T(this,"height",0),T(this,"cellSize",0),T(this,"columns",0),T(this,"rows",0),T(this,"cells",{})}return we(e,[{key:"resizeAndClear",value:function(n,i){this.width=n.width,this.height=n.height,this.cellSize=i,this.columns=Math.ceil(n.width/i),this.rows=Math.ceil(n.height/i),this.cells={}}},{key:"getIndex",value:function(n){var i=Math.floor(n.x/this.cellSize),r=Math.floor(n.y/this.cellSize);return r*this.columns+i}},{key:"add",value:function(n,i,r){var o=new Qr(n,i),a=this.getIndex(r),s=this.cells[a];s||(s=[],this.cells[a]=s),s.push(o)}},{key:"organize",value:function(){for(var n in this.cells){var i=this.cells[n];i.sort(Qr.compare)}}},{key:"getLabelsToDisplay",value:function(n,i){var r=this.cellSize*this.cellSize,o=r/n/n,a=o*i/r,s=Math.ceil(a),u=[];for(var l in this.cells)for(var c=this.cells[l],d=0;d<Math.min(s,c.length);d++)u.push(c[d].key);return u}}])}();function Mf(e){var t=e.graph,n=e.hoveredNode,i=e.highlightedNodes,r=e.displayedNodeLabels,o=[];return t.forEachEdge(function(a,s,u,l){(u===n||l===n||i.has(u)||i.has(l)||r.has(u)&&r.has(l))&&o.push(a)}),o}var Df=150,$f=50,Ze=Object.prototype.hasOwnProperty;function Gf(e,t,n){if(!Ze.call(n,"x")||!Ze.call(n,"y"))throw new Error('Sigma: could not find a valid position (x, y) for node "'.concat(t,'". All your nodes must have a number "x" and "y". Maybe your forgot to apply a layout or your "nodeReducer" is not returning the correct data?'));return n.color||(n.color=e.defaultNodeColor),!n.label&&n.label!==""&&(n.label=null),n.label!==void 0&&n.label!==null?n.label=""+n.label:n.label=null,n.size||(n.size=2),Ze.call(n,"hidden")||(n.hidden=!1),Ze.call(n,"highlighted")||(n.highlighted=!1),Ze.call(n,"forceLabel")||(n.forceLabel=!1),(!n.type||n.type==="")&&(n.type=e.defaultNodeType),n.zIndex||(n.zIndex=0),n}function Pf(e,t,n){return n.color||(n.color=e.defaultEdgeColor),n.label||(n.label=""),n.size||(n.size=.5),Ze.call(n,"hidden")||(n.hidden=!1),Ze.call(n,"forceLabel")||(n.forceLabel=!1),(!n.type||n.type==="")&&(n.type=e.defaultEdgeType),n.zIndex||(n.zIndex=0),n}var Ff=function(e){function t(n,i){var r,o=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};if(be(this,t),r=Me(this,t),T(r,"elements",{}),T(r,"canvasContexts",{}),T(r,"webGLContexts",{}),T(r,"pickingLayers",new Set),T(r,"textures",{}),T(r,"frameBuffers",{}),T(r,"activeListeners",{}),T(r,"labelGrid",new eo),T(r,"nodeDataCache",{}),T(r,"edgeDataCache",{}),T(r,"nodeProgramIndex",{}),T(r,"edgeProgramIndex",{}),T(r,"nodesWithForcedLabels",new Set),T(r,"edgesWithForcedLabels",new Set),T(r,"nodeExtent",{x:[0,1],y:[0,1]}),T(r,"nodeZExtent",[1/0,-1/0]),T(r,"edgeZExtent",[1/0,-1/0]),T(r,"matrix",Fe()),T(r,"invMatrix",Fe()),T(r,"correctionRatio",1),T(r,"customBBox",null),T(r,"normalizationFunction",Xr({x:[0,1],y:[0,1]})),T(r,"graphToViewportRatio",1),T(r,"itemIDsIndex",{}),T(r,"nodeIndices",{}),T(r,"edgeIndices",{}),T(r,"width",0),T(r,"height",0),T(r,"pixelRatio",jr()),T(r,"pickingDownSizingRatio",2*r.pixelRatio),T(r,"displayedNodeLabels",new Set),T(r,"displayedEdgeLabels",new Set),T(r,"highlightedNodes",new Set),T(r,"hoveredNode",null),T(r,"hoveredEdge",null),T(r,"renderFrame",null),T(r,"renderHighlightedNodesFrame",null),T(r,"needToProcess",!1),T(r,"checkEdgesEventsFrame",null),T(r,"nodePrograms",{}),T(r,"nodeHoverPrograms",{}),T(r,"edgePrograms",{}),r.settings=bf(o),oi(r.settings),pf(n),!(i instanceof HTMLElement))throw new Error("Sigma: container should be an html element.");r.graph=n,r.container=i,r.createWebGLContext("edges",{picking:o.enableEdgeEvents}),r.createCanvasContext("edgeLabels"),r.createWebGLContext("nodes",{picking:!0}),r.createCanvasContext("labels"),r.createCanvasContext("hovers"),r.createWebGLContext("hoverNodes"),r.createCanvasContext("mouse",{style:{touchAction:"none",userSelect:"none"}}),r.resize();for(var a in r.settings.nodeProgramClasses)r.registerNodeProgram(a,r.settings.nodeProgramClasses[a],r.settings.nodeHoverProgramClasses[a]);for(var s in r.settings.edgeProgramClasses)r.registerEdgeProgram(s,r.settings.edgeProgramClasses[s]);return r.camera=new Zr,r.bindCameraHandlers(),r.mouseCaptor=new Cf(r.elements.mouse,r),r.mouseCaptor.setSettings(r.settings),r.touchCaptor=new Sf(r.elements.mouse,r),r.touchCaptor.setSettings(r.settings),r.bindEventHandlers(),r.bindGraphHandlers(),r.handleSettingsUpdate(),r.refresh(),r}return De(t,e),we(t,[{key:"registerNodeProgram",value:function(i,r,o){return this.nodePrograms[i]&&this.nodePrograms[i].kill(),this.nodeHoverPrograms[i]&&this.nodeHoverPrograms[i].kill(),this.nodePrograms[i]=new r(this.webGLContexts.nodes,this.frameBuffers.nodes,this),this.nodeHoverPrograms[i]=new(o||r)(this.webGLContexts.hoverNodes,null,this),this}},{key:"registerEdgeProgram",value:function(i,r){return this.edgePrograms[i]&&this.edgePrograms[i].kill(),this.edgePrograms[i]=new r(this.webGLContexts.edges,this.frameBuffers.edges,this),this}},{key:"unregisterNodeProgram",value:function(i){if(this.nodePrograms[i]){var r=this.nodePrograms,o=r[i],a=ai(r,[i].map(Vt));o.kill(),this.nodePrograms=a}if(this.nodeHoverPrograms[i]){var s=this.nodeHoverPrograms,u=s[i],l=ai(s,[i].map(Vt));u.kill(),this.nodePrograms=l}return this}},{key:"unregisterEdgeProgram",value:function(i){if(this.edgePrograms[i]){var r=this.edgePrograms,o=r[i],a=ai(r,[i].map(Vt));o.kill(),this.edgePrograms=a}return this}},{key:"resetWebGLTexture",value:function(i){var r=this.webGLContexts[i],o=this.frameBuffers[i],a=this.textures[i];a&&r.deleteTexture(a);var s=r.createTexture();return r.bindFramebuffer(r.FRAMEBUFFER,o),r.bindTexture(r.TEXTURE_2D,s),r.texImage2D(r.TEXTURE_2D,0,r.RGBA,this.width,this.height,0,r.RGBA,r.UNSIGNED_BYTE,null),r.framebufferTexture2D(r.FRAMEBUFFER,r.COLOR_ATTACHMENT0,r.TEXTURE_2D,s,0),this.textures[i]=s,this}},{key:"bindCameraHandlers",value:function(){var i=this;return this.activeListeners.camera=function(){i.scheduleRender()},this.camera.on("updated",this.activeListeners.camera),this}},{key:"unbindCameraHandlers",value:function(){return this.camera.removeListener("updated",this.activeListeners.camera),this}},{key:"getNodeAtPosition",value:function(i){var r=i.x,o=i.y,a=Pr(this.webGLContexts.nodes,this.frameBuffers.nodes,r,o,this.pixelRatio,this.pickingDownSizingRatio),s=Gr.apply(void 0,Jr(a)),u=this.itemIDsIndex[s];return u&&u.type==="node"?u.id:null}},{key:"bindEventHandlers",value:function(){var i=this;this.activeListeners.handleResize=function(){i.scheduleRefresh()},window.addEventListener("resize",this.activeListeners.handleResize),this.activeListeners.handleMove=function(o){var a=It(o),s={event:a,preventSigmaDefault:function(){a.preventSigmaDefault()}},u=i.getNodeAtPosition(a);if(u&&i.hoveredNode!==u&&!i.nodeDataCache[u].hidden){i.hoveredNode&&i.emit("leaveNode",q(q({},s),{},{node:i.hoveredNode})),i.hoveredNode=u,i.emit("enterNode",q(q({},s),{},{node:u})),i.scheduleHighlightedNodesRender();return}if(i.hoveredNode&&i.getNodeAtPosition(a)!==i.hoveredNode){var l=i.hoveredNode;i.hoveredNode=null,i.emit("leaveNode",q(q({},s),{},{node:l})),i.scheduleHighlightedNodesRender();return}if(i.settings.enableEdgeEvents){var c=i.hoveredNode?null:i.getEdgeAtPoint(s.event.x,s.event.y);c!==i.hoveredEdge&&(i.hoveredEdge&&i.emit("leaveEdge",q(q({},s),{},{edge:i.hoveredEdge})),c&&i.emit("enterEdge",q(q({},s),{},{edge:c})),i.hoveredEdge=c)}},this.activeListeners.handleMoveBody=function(o){var a=It(o);i.emit("moveBody",{event:a,preventSigmaDefault:function(){a.preventSigmaDefault()}})},this.activeListeners.handleLeave=function(o){var a=It(o),s={event:a,preventSigmaDefault:function(){a.preventSigmaDefault()}};i.hoveredNode&&(i.emit("leaveNode",q(q({},s),{},{node:i.hoveredNode})),i.scheduleHighlightedNodesRender()),i.settings.enableEdgeEvents&&i.hoveredEdge&&(i.emit("leaveEdge",q(q({},s),{},{edge:i.hoveredEdge})),i.scheduleHighlightedNodesRender()),i.emit("leaveStage",q({},s))},this.activeListeners.handleEnter=function(o){var a=It(o),s={event:a,preventSigmaDefault:function(){a.preventSigmaDefault()}};i.emit("enterStage",q({},s))};var r=function(a){return function(s){var u=It(s),l={event:u,preventSigmaDefault:function(){u.preventSigmaDefault()}},c=i.getNodeAtPosition(u);if(c)return i.emit("".concat(a,"Node"),q(q({},l),{},{node:c}));if(i.settings.enableEdgeEvents){var d=i.getEdgeAtPoint(u.x,u.y);if(d)return i.emit("".concat(a,"Edge"),q(q({},l),{},{edge:d}))}return i.emit("".concat(a,"Stage"),l)}};return this.activeListeners.handleClick=r("click"),this.activeListeners.handleRightClick=r("rightClick"),this.activeListeners.handleDoubleClick=r("doubleClick"),this.activeListeners.handleWheel=r("wheel"),this.activeListeners.handleDown=r("down"),this.activeListeners.handleUp=r("up"),this.mouseCaptor.on("mousemove",this.activeListeners.handleMove),this.mouseCaptor.on("mousemovebody",this.activeListeners.handleMoveBody),this.mouseCaptor.on("click",this.activeListeners.handleClick),this.mouseCaptor.on("rightClick",this.activeListeners.handleRightClick),this.mouseCaptor.on("doubleClick",this.activeListeners.handleDoubleClick),this.mouseCaptor.on("wheel",this.activeListeners.handleWheel),this.mouseCaptor.on("mousedown",this.activeListeners.handleDown),this.mouseCaptor.on("mouseup",this.activeListeners.handleUp),this.mouseCaptor.on("mouseleave",this.activeListeners.handleLeave),this.mouseCaptor.on("mouseenter",this.activeListeners.handleEnter),this.touchCaptor.on("touchdown",this.activeListeners.handleDown),this.touchCaptor.on("touchdown",this.activeListeners.handleMove),this.touchCaptor.on("touchup",this.activeListeners.handleUp),this.touchCaptor.on("touchmove",this.activeListeners.handleMove),this.touchCaptor.on("tap",this.activeListeners.handleClick),this.touchCaptor.on("doubletap",this.activeListeners.handleDoubleClick),this.touchCaptor.on("touchmove",this.activeListeners.handleMoveBody),this}},{key:"bindGraphHandlers",value:function(){var i=this,r=this.graph,o=new Set(["x","y","zIndex","type"]);return this.activeListeners.eachNodeAttributesUpdatedGraphUpdate=function(a){var s,u=(s=a.hints)===null||s===void 0?void 0:s.attributes;i.graph.forEachNode(function(c){return i.updateNode(c)});var l=!u||u.some(function(c){return o.has(c)});i.refresh({partialGraph:{nodes:r.nodes()},skipIndexation:!l,schedule:!0})},this.activeListeners.eachEdgeAttributesUpdatedGraphUpdate=function(a){var s,u=(s=a.hints)===null||s===void 0?void 0:s.attributes;i.graph.forEachEdge(function(c){return i.updateEdge(c)});var l=u&&["zIndex","type"].some(function(c){return u==null?void 0:u.includes(c)});i.refresh({partialGraph:{edges:r.edges()},skipIndexation:!l,schedule:!0})},this.activeListeners.addNodeGraphUpdate=function(a){var s=a.key;i.addNode(s),i.refresh({partialGraph:{nodes:[s]},skipIndexation:!1,schedule:!0})},this.activeListeners.updateNodeGraphUpdate=function(a){var s=a.key;i.refresh({partialGraph:{nodes:[s]},skipIndexation:!1,schedule:!0})},this.activeListeners.dropNodeGraphUpdate=function(a){var s=a.key;i.removeNode(s),i.refresh({schedule:!0})},this.activeListeners.addEdgeGraphUpdate=function(a){var s=a.key;i.addEdge(s),i.refresh({partialGraph:{edges:[s]},schedule:!0})},this.activeListeners.updateEdgeGraphUpdate=function(a){var s=a.key;i.refresh({partialGraph:{edges:[s]},skipIndexation:!1,schedule:!0})},this.activeListeners.dropEdgeGraphUpdate=function(a){var s=a.key;i.removeEdge(s),i.refresh({schedule:!0})},this.activeListeners.clearEdgesGraphUpdate=function(){i.clearEdgeState(),i.clearEdgeIndices(),i.refresh({schedule:!0})},this.activeListeners.clearGraphUpdate=function(){i.clearEdgeState(),i.clearNodeState(),i.clearEdgeIndices(),i.clearNodeIndices(),i.refresh({schedule:!0})},r.on("nodeAdded",this.activeListeners.addNodeGraphUpdate),r.on("nodeDropped",this.activeListeners.dropNodeGraphUpdate),r.on("nodeAttributesUpdated",this.activeListeners.updateNodeGraphUpdate),r.on("eachNodeAttributesUpdated",this.activeListeners.eachNodeAttributesUpdatedGraphUpdate),r.on("edgeAdded",this.activeListeners.addEdgeGraphUpdate),r.on("edgeDropped",this.activeListeners.dropEdgeGraphUpdate),r.on("edgeAttributesUpdated",this.activeListeners.updateEdgeGraphUpdate),r.on("eachEdgeAttributesUpdated",this.activeListeners.eachEdgeAttributesUpdatedGraphUpdate),r.on("edgesCleared",this.activeListeners.clearEdgesGraphUpdate),r.on("cleared",this.activeListeners.clearGraphUpdate),this}},{key:"unbindGraphHandlers",value:function(){var i=this.graph;i.removeListener("nodeAdded",this.activeListeners.addNodeGraphUpdate),i.removeListener("nodeDropped",this.activeListeners.dropNodeGraphUpdate),i.removeListener("nodeAttributesUpdated",this.activeListeners.updateNodeGraphUpdate),i.removeListener("eachNodeAttributesUpdated",this.activeListeners.eachNodeAttributesUpdatedGraphUpdate),i.removeListener("edgeAdded",this.activeListeners.addEdgeGraphUpdate),i.removeListener("edgeDropped",this.activeListeners.dropEdgeGraphUpdate),i.removeListener("edgeAttributesUpdated",this.activeListeners.updateEdgeGraphUpdate),i.removeListener("eachEdgeAttributesUpdated",this.activeListeners.eachEdgeAttributesUpdatedGraphUpdate),i.removeListener("edgesCleared",this.activeListeners.clearEdgesGraphUpdate),i.removeListener("cleared",this.activeListeners.clearGraphUpdate)}},{key:"getEdgeAtPoint",value:function(i,r){var o=Pr(this.webGLContexts.edges,this.frameBuffers.edges,i,r,this.pixelRatio,this.pickingDownSizingRatio),a=Gr.apply(void 0,Jr(o)),s=this.itemIDsIndex[a];return s&&s.type==="edge"?s.id:null}},{key:"process",value:function(){var i=this;this.emit("beforeProcess");var r=this.graph,o=this.settings,a=this.getDimensions();if(this.nodeExtent=gf(this.graph),!this.settings.autoRescale){var s=a.width,u=a.height,l=this.nodeExtent,c=l.x,d=l.y;this.nodeExtent={x:[(c[0]+c[1])/2-s/2,(c[0]+c[1])/2+s/2],y:[(d[0]+d[1])/2-u/2,(d[0]+d[1])/2+u/2]}}this.normalizationFunction=Xr(this.customBBox||this.nodeExtent);var h=new Zr,f=Ft(h.getState(),a,this.getGraphDimensions(),this.getStagePadding());this.labelGrid.resizeAndClear(a,o.labelGridCellSize);for(var g={},m={},b={},C={},_=1,x=r.nodes(),p=0,v=x.length;p<v;p++){var w=x[p],k=this.nodeDataCache[w],D=r.getNodeAttributes(w);k.x=D.x,k.y=D.y,this.normalizationFunction.applyTo(k),typeof k.label=="string"&&!k.hidden&&this.labelGrid.add(w,k.size,this.framedGraphToViewport(k,{matrix:f})),g[k.type]=(g[k.type]||0)+1}this.labelGrid.organize();for(var I in this.nodePrograms){if(!Ze.call(this.nodePrograms,I))throw new Error('Sigma: could not find a suitable program for node type "'.concat(I,'"!'));this.nodePrograms[I].reallocate(g[I]||0),g[I]=0}this.settings.zIndex&&this.nodeZExtent[0]!==this.nodeZExtent[1]&&(x=Yr(this.nodeZExtent,function(fe){return i.nodeDataCache[fe].zIndex},x));for(var F=0,R=x.length;F<R;F++){var H=x[F];m[H]=_,C[m[H]]={type:"node",id:H},_++;var $=this.nodeDataCache[H];this.addNodeToProgram(H,m[H],g[$.type]++)}for(var W={},ae=r.edges(),ue=0,de=ae.length;ue<de;ue++){var le=ae[ue],Q=this.edgeDataCache[le];W[Q.type]=(W[Q.type]||0)+1}this.settings.zIndex&&this.edgeZExtent[0]!==this.edgeZExtent[1]&&(ae=Yr(this.edgeZExtent,function(fe){return i.edgeDataCache[fe].zIndex},ae));for(var ce in this.edgePrograms){if(!Ze.call(this.edgePrograms,ce))throw new Error('Sigma: could not find a suitable program for edge type "'.concat(ce,'"!'));this.edgePrograms[ce].reallocate(W[ce]||0),W[ce]=0}for(var se=0,te=ae.length;se<te;se++){var he=ae[se];b[he]=_,C[b[he]]={type:"edge",id:he},_++;var ke=this.edgeDataCache[he];this.addEdgeToProgram(he,b[he],W[ke.type]++)}return this.itemIDsIndex=C,this.nodeIndices=m,this.edgeIndices=b,this.emit("afterProcess"),this}},{key:"handleSettingsUpdate",value:function(i){var r=this,o=this.settings;if(this.camera.minRatio=o.minCameraRatio,this.camera.maxRatio=o.maxCameraRatio,this.camera.enabledZooming=o.enableCameraZooming,this.camera.enabledPanning=o.enableCameraPanning,this.camera.enabledRotation=o.enableCameraRotation,o.cameraPanBoundaries?this.camera.clean=function(c){return r.cleanCameraState(c,o.cameraPanBoundaries&&Ci(o.cameraPanBoundaries)==="object"?o.cameraPanBoundaries:{})}:this.camera.clean=null,this.camera.setState(this.camera.validateState(this.camera.getState())),i){if(i.edgeProgramClasses!==o.edgeProgramClasses){for(var a in o.edgeProgramClasses)o.edgeProgramClasses[a]!==i.edgeProgramClasses[a]&&this.registerEdgeProgram(a,o.edgeProgramClasses[a]);for(var s in i.edgeProgramClasses)o.edgeProgramClasses[s]||this.unregisterEdgeProgram(s)}if(i.nodeProgramClasses!==o.nodeProgramClasses||i.nodeHoverProgramClasses!==o.nodeHoverProgramClasses){for(var u in o.nodeProgramClasses)(o.nodeProgramClasses[u]!==i.nodeProgramClasses[u]||o.nodeHoverProgramClasses[u]!==i.nodeHoverProgramClasses[u])&&this.registerNodeProgram(u,o.nodeProgramClasses[u],o.nodeHoverProgramClasses[u]);for(var l in i.nodeProgramClasses)o.nodeProgramClasses[l]||this.unregisterNodeProgram(l)}}return this.mouseCaptor.setSettings(this.settings),this.touchCaptor.setSettings(this.settings),this}},{key:"cleanCameraState",value:function(i){var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},o=r.tolerance,a=o===void 0?0:o,s=r.boundaries,u=q({},i),l=s||this.nodeExtent,c=St(l.x,2),d=c[0],h=c[1],f=St(l.y,2),g=f[0],m=f[1],b=[this.graphToViewport({x:d,y:g},{cameraState:i}),this.graphToViewport({x:h,y:g},{cameraState:i}),this.graphToViewport({x:d,y:m},{cameraState:i}),this.graphToViewport({x:h,y:m},{cameraState:i})],C=1/0,_=-1/0,x=1/0,p=-1/0;b.forEach(function(W){var ae=W.x,ue=W.y;C=Math.min(C,ae),_=Math.max(_,ae),x=Math.min(x,ue),p=Math.max(p,ue)});var v=_-C,w=p-x,k=this.getDimensions(),D=k.width,I=k.height,F=0,R=0;if(v>=D?_<D-a?F=_-(D-a):C>a&&(F=C-a):_>D+a?F=_-(D+a):C<-a&&(F=C+a),w>=I?p<I-a?R=p-(I-a):x>a&&(R=x-a):p>I+a?R=p-(I+a):x<-a&&(R=x+a),F||R){var H=this.viewportToFramedGraph({x:0,y:0},{cameraState:i}),$=this.viewportToFramedGraph({x:F,y:R},{cameraState:i});F=$.x-H.x,R=$.y-H.y,u.x+=F,u.y+=R}return u}},{key:"renderLabels",value:function(){if(!this.settings.renderLabels)return this;var i=this.camera.getState(),r=this.labelGrid.getLabelsToDisplay(i.ratio,this.settings.labelDensity);Kr(r,this.nodesWithForcedLabels),this.displayedNodeLabels=new Set;for(var o=this.canvasContexts.labels,a=0,s=r.length;a<s;a++){var u=r[a],l=this.nodeDataCache[u];if(!this.displayedNodeLabels.has(u)&&!l.hidden){var c=this.framedGraphToViewport(l),d=c.x,h=c.y,f=this.scaleSize(l.size);if(!(!l.forceLabel&&f<this.settings.labelRenderedSizeThreshold)&&!(d<-150||d>this.width+Df||h<-50||h>this.height+$f)){this.displayedNodeLabels.add(u);var g=this.settings.defaultDrawNodeLabel,m=this.nodePrograms[l.type],b=(m==null?void 0:m.drawLabel)||g;b(o,q(q({key:u},l),{},{size:f,x:d,y:h}),this.settings)}}}return this}},{key:"renderEdgeLabels",value:function(){if(!this.settings.renderEdgeLabels)return this;var i=this.canvasContexts.edgeLabels;i.clearRect(0,0,this.width,this.height);var r=Mf({graph:this.graph,hoveredNode:this.hoveredNode,displayedNodeLabels:this.displayedNodeLabels,highlightedNodes:this.highlightedNodes});Kr(r,this.edgesWithForcedLabels);for(var o=new Set,a=0,s=r.length;a<s;a++){var u=r[a],l=this.graph.extremities(u),c=this.nodeDataCache[l[0]],d=this.nodeDataCache[l[1]],h=this.edgeDataCache[u];if(!o.has(u)&&!(h.hidden||c.hidden||d.hidden)){var f=this.settings.defaultDrawEdgeLabel,g=this.edgePrograms[h.type],m=(g==null?void 0:g.drawLabel)||f;m(i,q(q({key:u},h),{},{size:this.scaleSize(h.size)}),q(q(q({key:l[0]},c),this.framedGraphToViewport(c)),{},{size:this.scaleSize(c.size)}),q(q(q({key:l[1]},d),this.framedGraphToViewport(d)),{},{size:this.scaleSize(d.size)}),this.settings),o.add(u)}}return this.displayedEdgeLabels=o,this}},{key:"renderHighlightedNodes",value:function(){var i=this,r=this.canvasContexts.hovers;r.clearRect(0,0,this.width,this.height);var o=function(f){var g=i.nodeDataCache[f],m=i.framedGraphToViewport(g),b=m.x,C=m.y,_=i.scaleSize(g.size),x=i.settings.defaultDrawNodeHover,p=i.nodePrograms[g.type],v=(p==null?void 0:p.drawHover)||x;v(r,q(q({key:f},g),{},{size:_,x:b,y:C}),i.settings)},a=[];this.hoveredNode&&!this.nodeDataCache[this.hoveredNode].hidden&&a.push(this.hoveredNode),this.highlightedNodes.forEach(function(h){h!==i.hoveredNode&&a.push(h)}),a.forEach(function(h){return o(h)});var s={};a.forEach(function(h){var f=i.nodeDataCache[h].type;s[f]=(s[f]||0)+1});for(var u in this.nodeHoverPrograms)this.nodeHoverPrograms[u].reallocate(s[u]||0),s[u]=0;a.forEach(function(h){var f=i.nodeDataCache[h];i.nodeHoverPrograms[f.type].process(0,s[f.type]++,f)}),this.webGLContexts.hoverNodes.clear(this.webGLContexts.hoverNodes.COLOR_BUFFER_BIT);var l=this.getRenderParams();for(var c in this.nodeHoverPrograms){var d=this.nodeHoverPrograms[c];d.render(l)}}},{key:"scheduleHighlightedNodesRender",value:function(){var i=this;this.renderHighlightedNodesFrame||this.renderFrame||(this.renderHighlightedNodesFrame=requestAnimationFrame(function(){i.renderHighlightedNodesFrame=null,i.renderHighlightedNodes(),i.renderEdgeLabels()}))}},{key:"render",value:function(){var i=this;this.emit("beforeRender");var r=function(){return i.emit("afterRender"),i};if(this.renderFrame&&(cancelAnimationFrame(this.renderFrame),this.renderFrame=null),this.resize(),this.needToProcess&&this.process(),this.needToProcess=!1,this.clear(),this.pickingLayers.forEach(function(b){return i.resetWebGLTexture(b)}),!this.graph.order)return r();var o=this.mouseCaptor,a=this.camera.isAnimated()||o.isMoving||o.draggedEvents||o.currentWheelDirection,s=this.camera.getState(),u=this.getDimensions(),l=this.getGraphDimensions(),c=this.getStagePadding();this.matrix=Ft(s,u,l,c),this.invMatrix=Ft(s,u,l,c,!0),this.correctionRatio=ff(this.matrix,s,u),this.graphToViewportRatio=this.getGraphToViewportRatio();var d=this.getRenderParams();for(var h in this.nodePrograms){var f=this.nodePrograms[h];f.render(d)}if(!this.settings.hideEdgesOnMove||!a)for(var g in this.edgePrograms){var m=this.edgePrograms[g];m.render(d)}return this.settings.hideLabelsOnMove&&a||(this.renderLabels(),this.renderEdgeLabels(),this.renderHighlightedNodes()),r()}},{key:"addNode",value:function(i){var r=Object.assign({},this.graph.getNodeAttributes(i));this.settings.nodeReducer&&(r=this.settings.nodeReducer(i,r));var o=Gf(this.settings,i,r);this.nodeDataCache[i]=o,this.nodesWithForcedLabels.delete(i),o.forceLabel&&!o.hidden&&this.nodesWithForcedLabels.add(i),this.highlightedNodes.delete(i),o.highlighted&&!o.hidden&&this.highlightedNodes.add(i),this.settings.zIndex&&(o.zIndex<this.nodeZExtent[0]&&(this.nodeZExtent[0]=o.zIndex),o.zIndex>this.nodeZExtent[1]&&(this.nodeZExtent[1]=o.zIndex))}},{key:"updateNode",value:function(i){this.addNode(i);var r=this.nodeDataCache[i];this.normalizationFunction.applyTo(r)}},{key:"removeNode",value:function(i){delete this.nodeDataCache[i],delete this.nodeProgramIndex[i],this.highlightedNodes.delete(i),this.hoveredNode===i&&(this.hoveredNode=null),this.nodesWithForcedLabels.delete(i)}},{key:"addEdge",value:function(i){var r=Object.assign({},this.graph.getEdgeAttributes(i));this.settings.edgeReducer&&(r=this.settings.edgeReducer(i,r));var o=Pf(this.settings,i,r);this.edgeDataCache[i]=o,this.edgesWithForcedLabels.delete(i),o.forceLabel&&!o.hidden&&this.edgesWithForcedLabels.add(i),this.settings.zIndex&&(o.zIndex<this.edgeZExtent[0]&&(this.edgeZExtent[0]=o.zIndex),o.zIndex>this.edgeZExtent[1]&&(this.edgeZExtent[1]=o.zIndex))}},{key:"updateEdge",value:function(i){this.addEdge(i)}},{key:"removeEdge",value:function(i){delete this.edgeDataCache[i],delete this.edgeProgramIndex[i],this.hoveredEdge===i&&(this.hoveredEdge=null),this.edgesWithForcedLabels.delete(i)}},{key:"clearNodeIndices",value:function(){this.labelGrid=new eo,this.nodeExtent={x:[0,1],y:[0,1]},this.nodeDataCache={},this.edgeProgramIndex={},this.nodesWithForcedLabels=new Set,this.nodeZExtent=[1/0,-1/0],this.highlightedNodes=new Set}},{key:"clearEdgeIndices",value:function(){this.edgeDataCache={},this.edgeProgramIndex={},this.edgesWithForcedLabels=new Set,this.edgeZExtent=[1/0,-1/0]}},{key:"clearIndices",value:function(){this.clearEdgeIndices(),this.clearNodeIndices()}},{key:"clearNodeState",value:function(){this.displayedNodeLabels=new Set,this.highlightedNodes=new Set,this.hoveredNode=null}},{key:"clearEdgeState",value:function(){this.displayedEdgeLabels=new Set,this.highlightedNodes=new Set,this.hoveredEdge=null}},{key:"clearState",value:function(){this.clearEdgeState(),this.clearNodeState()}},{key:"addNodeToProgram",value:function(i,r,o){var a=this.nodeDataCache[i],s=this.nodePrograms[a.type];if(!s)throw new Error('Sigma: could not find a suitable program for node type "'.concat(a.type,'"!'));s.process(r,o,a),this.nodeProgramIndex[i]=o}},{key:"addEdgeToProgram",value:function(i,r,o){var a=this.edgeDataCache[i],s=this.edgePrograms[a.type];if(!s)throw new Error('Sigma: could not find a suitable program for edge type "'.concat(a.type,'"!'));var u=this.graph.extremities(i),l=this.nodeDataCache[u[0]],c=this.nodeDataCache[u[1]];s.process(r,o,l,c,a),this.edgeProgramIndex[i]=o}},{key:"getRenderParams",value:function(){return{matrix:this.matrix,invMatrix:this.invMatrix,width:this.width,height:this.height,pixelRatio:this.pixelRatio,zoomRatio:this.camera.ratio,cameraAngle:this.camera.angle,sizeRatio:1/this.scaleSize(),correctionRatio:this.correctionRatio,downSizingRatio:this.pickingDownSizingRatio,minEdgeThickness:this.settings.minEdgeThickness,antiAliasingFeather:this.settings.antiAliasingFeather}}},{key:"getStagePadding",value:function(){var i=this.settings,r=i.stagePadding,o=i.autoRescale;return o&&r||0}},{key:"createLayer",value:function(i,r){var o=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};if(this.elements[i])throw new Error('Sigma: a layer named "'.concat(i,'" already exists'));var a=mf(r,{position:"absolute"},{class:"sigma-".concat(i)});return o.style&&Object.assign(a.style,o.style),this.elements[i]=a,"beforeLayer"in o&&o.beforeLayer?this.elements[o.beforeLayer].before(a):"afterLayer"in o&&o.afterLayer?this.elements[o.afterLayer].after(a):this.container.appendChild(a),a}},{key:"createCanvas",value:function(i){var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return this.createLayer(i,"canvas",r)}},{key:"createCanvasContext",value:function(i){var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},o=this.createCanvas(i,r),a={preserveDrawingBuffer:!1,antialias:!1};return this.canvasContexts[i]=o.getContext("2d",a),this}},{key:"createWebGLContext",value:function(i){var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},o=(r==null?void 0:r.canvas)||this.createCanvas(i,r);r.hidden&&o.remove();var a=q({preserveDrawingBuffer:!1,antialias:!1},r),s;s=o.getContext("webgl2",a),s||(s=o.getContext("webgl",a)),s||(s=o.getContext("experimental-webgl",a));var u=s;if(this.webGLContexts[i]=u,u.blendFunc(u.ONE,u.ONE_MINUS_SRC_ALPHA),r.picking){this.pickingLayers.add(i);var l=u.createFramebuffer();if(!l)throw new Error("Sigma: cannot create a new frame buffer for layer ".concat(i));this.frameBuffers[i]=l}return u}},{key:"killLayer",value:function(i){var r=this.elements[i];if(!r)throw new Error("Sigma: cannot kill layer ".concat(i,", which does not exist"));if(this.webGLContexts[i]){var o,a=this.webGLContexts[i];(o=a.getExtension("WEBGL_lose_context"))===null||o===void 0||o.loseContext(),delete this.webGLContexts[i]}else this.canvasContexts[i]&&delete this.canvasContexts[i];return r.remove(),delete this.elements[i],this}},{key:"getCamera",value:function(){return this.camera}},{key:"setCamera",value:function(i){this.unbindCameraHandlers(),this.camera=i,this.bindCameraHandlers()}},{key:"getContainer",value:function(){return this.container}},{key:"getGraph",value:function(){return this.graph}},{key:"setGraph",value:function(i){i!==this.graph&&(this.hoveredNode&&!i.hasNode(this.hoveredNode)&&(this.hoveredNode=null),this.hoveredEdge&&!i.hasEdge(this.hoveredEdge)&&(this.hoveredEdge=null),this.unbindGraphHandlers(),this.checkEdgesEventsFrame!==null&&(cancelAnimationFrame(this.checkEdgesEventsFrame),this.checkEdgesEventsFrame=null),this.graph=i,this.bindGraphHandlers(),this.refresh())}},{key:"getMouseCaptor",value:function(){return this.mouseCaptor}},{key:"getTouchCaptor",value:function(){return this.touchCaptor}},{key:"getDimensions",value:function(){return{width:this.width,height:this.height}}},{key:"getGraphDimensions",value:function(){var i=this.customBBox||this.nodeExtent;return{width:i.x[1]-i.x[0]||1,height:i.y[1]-i.y[0]||1}}},{key:"getNodeDisplayData",value:function(i){var r=this.nodeDataCache[i];return r?Object.assign({},r):void 0}},{key:"getEdgeDisplayData",value:function(i){var r=this.edgeDataCache[i];return r?Object.assign({},r):void 0}},{key:"getNodeDisplayedLabels",value:function(){return new Set(this.displayedNodeLabels)}},{key:"getEdgeDisplayedLabels",value:function(){return new Set(this.displayedEdgeLabels)}},{key:"getSettings",value:function(){return q({},this.settings)}},{key:"getSetting",value:function(i){return this.settings[i]}},{key:"setSetting",value:function(i,r){var o=q({},this.settings);return this.settings[i]=r,oi(this.settings),this.handleSettingsUpdate(o),this.scheduleRefresh(),this}},{key:"updateSetting",value:function(i,r){return this.setSetting(i,r(this.settings[i])),this}},{key:"setSettings",value:function(i){var r=q({},this.settings);return this.settings=q(q({},this.settings),i),oi(this.settings),this.handleSettingsUpdate(r),this.scheduleRefresh(),this}},{key:"resize",value:function(i){var r=this.width,o=this.height;if(this.width=this.container.offsetWidth,this.height=this.container.offsetHeight,this.pixelRatio=jr(),this.width===0)if(this.settings.allowInvalidContainer)this.width=1;else throw new Error("Sigma: Container has no width. You can set the allowInvalidContainer setting to true to stop seeing this error.");if(this.height===0)if(this.settings.allowInvalidContainer)this.height=1;else throw new Error("Sigma: Container has no height. You can set the allowInvalidContainer setting to true to stop seeing this error.");if(!i&&r===this.width&&o===this.height)return this;for(var a in this.elements){var s=this.elements[a];s.style.width=this.width+"px",s.style.height=this.height+"px"}for(var u in this.canvasContexts)this.elements[u].setAttribute("width",this.width*this.pixelRatio+"px"),this.elements[u].setAttribute("height",this.height*this.pixelRatio+"px"),this.pixelRatio!==1&&this.canvasContexts[u].scale(this.pixelRatio,this.pixelRatio);for(var l in this.webGLContexts){this.elements[l].setAttribute("width",this.width*this.pixelRatio+"px"),this.elements[l].setAttribute("height",this.height*this.pixelRatio+"px");var c=this.webGLContexts[l];if(c.viewport(0,0,this.width*this.pixelRatio,this.height*this.pixelRatio),this.pickingLayers.has(l)){var d=this.textures[l];d&&c.deleteTexture(d)}}return this.emit("resize"),this}},{key:"clear",value:function(){return this.emit("beforeClear"),this.webGLContexts.nodes.bindFramebuffer(WebGLRenderingContext.FRAMEBUFFER,null),this.webGLContexts.nodes.clear(WebGLRenderingContext.COLOR_BUFFER_BIT),this.webGLContexts.edges.bindFramebuffer(WebGLRenderingContext.FRAMEBUFFER,null),this.webGLContexts.edges.clear(WebGLRenderingContext.COLOR_BUFFER_BIT),this.webGLContexts.hoverNodes.clear(WebGLRenderingContext.COLOR_BUFFER_BIT),this.canvasContexts.labels.clearRect(0,0,this.width,this.height),this.canvasContexts.hovers.clearRect(0,0,this.width,this.height),this.canvasContexts.edgeLabels.clearRect(0,0,this.width,this.height),this.emit("afterClear"),this}},{key:"refresh",value:function(i){var r=this,o=(i==null?void 0:i.skipIndexation)!==void 0?i==null?void 0:i.skipIndexation:!1,a=(i==null?void 0:i.schedule)!==void 0?i.schedule:!1,s=!i||!i.partialGraph;if(s)this.clearEdgeIndices(),this.clearNodeIndices(),this.graph.forEachNode(function(p){return r.addNode(p)}),this.graph.forEachEdge(function(p){return r.addEdge(p)});else{for(var u,l,c=((u=i.partialGraph)===null||u===void 0?void 0:u.nodes)||[],d=0,h=(c==null?void 0:c.length)||0;d<h;d++){var f=c[d];if(this.updateNode(f),o){var g=this.nodeProgramIndex[f];if(g===void 0)throw new Error('Sigma: node "'.concat(f,`" can't be repaint`));this.addNodeToProgram(f,this.nodeIndices[f],g)}}for(var m=(i==null||(l=i.partialGraph)===null||l===void 0?void 0:l.edges)||[],b=0,C=m.length;b<C;b++){var _=m[b];if(this.updateEdge(_),o){var x=this.edgeProgramIndex[_];if(x===void 0)throw new Error('Sigma: edge "'.concat(_,`" can't be repaint`));this.addEdgeToProgram(_,this.edgeIndices[_],x)}}}return(s||!o)&&(this.needToProcess=!0),a?this.scheduleRender():this.render(),this}},{key:"scheduleRender",value:function(){var i=this;return this.renderFrame||(this.renderFrame=requestAnimationFrame(function(){i.render()})),this}},{key:"scheduleRefresh",value:function(i){return this.refresh(q(q({},i),{},{schedule:!0}))}},{key:"getViewportZoomedState",value:function(i,r){var o=this.camera.getState(),a=o.ratio,s=o.angle,u=o.x,l=o.y,c=this.settings,d=c.minCameraRatio,h=c.maxCameraRatio;typeof h=="number"&&(r=Math.min(r,h)),typeof d=="number"&&(r=Math.max(r,d));var f=r/a,g={x:this.width/2,y:this.height/2},m=this.viewportToFramedGraph(i),b=this.viewportToFramedGraph(g);return{angle:s,x:(m.x-b.x)*(1-f)+u,y:(m.y-b.y)*(1-f)+l,ratio:r}}},{key:"viewRectangle",value:function(){var i=this.viewportToFramedGraph({x:0,y:0}),r=this.viewportToFramedGraph({x:this.width,y:0}),o=this.viewportToFramedGraph({x:0,y:this.height});return{x1:i.x,y1:i.y,x2:r.x,y2:r.y,height:r.y-o.y}}},{key:"framedGraphToViewport",value:function(i){var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},o=!!r.cameraState||!!r.viewportDimensions||!!r.graphDimensions,a=r.matrix?r.matrix:o?Ft(r.cameraState||this.camera.getState(),r.viewportDimensions||this.getDimensions(),r.graphDimensions||this.getGraphDimensions(),r.padding||this.getStagePadding()):this.matrix,s=Ei(a,i);return{x:(1+s.x)*this.width/2,y:(1-s.y)*this.height/2}}},{key:"viewportToFramedGraph",value:function(i){var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},o=!!r.cameraState||!!r.viewportDimensions||!r.graphDimensions,a=r.matrix?r.matrix:o?Ft(r.cameraState||this.camera.getState(),r.viewportDimensions||this.getDimensions(),r.graphDimensions||this.getGraphDimensions(),r.padding||this.getStagePadding(),!0):this.invMatrix,s=Ei(a,{x:i.x/this.width*2-1,y:1-i.y/this.height*2});return isNaN(s.x)&&(s.x=0),isNaN(s.y)&&(s.y=0),s}},{key:"viewportToGraph",value:function(i){var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return this.normalizationFunction.inverse(this.viewportToFramedGraph(i,r))}},{key:"graphToViewport",value:function(i){var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return this.framedGraphToViewport(this.normalizationFunction(i),r)}},{key:"getGraphToViewportRatio",value:function(){var i={x:0,y:0},r={x:1,y:1},o=Math.sqrt(Math.pow(i.x-r.x,2)+Math.pow(i.y-r.y,2)),a=this.graphToViewport(i),s=this.graphToViewport(r),u=Math.sqrt(Math.pow(a.x-s.x,2)+Math.pow(a.y-s.y,2));return u/o}},{key:"getBBox",value:function(){return this.nodeExtent}},{key:"getCustomBBox",value:function(){return this.customBBox}},{key:"setCustomBBox",value:function(i){return this.customBBox=i,this.scheduleRender(),this}},{key:"kill",value:function(){this.emit("kill"),this.removeAllListeners(),this.unbindCameraHandlers(),window.removeEventListener("resize",this.activeListeners.handleResize),this.mouseCaptor.kill(),this.touchCaptor.kill(),this.unbindGraphHandlers(),this.clearIndices(),this.clearState(),this.nodeDataCache={},this.edgeDataCache={},this.highlightedNodes.clear(),this.renderFrame&&(cancelAnimationFrame(this.renderFrame),this.renderFrame=null),this.renderHighlightedNodesFrame&&(cancelAnimationFrame(this.renderHighlightedNodesFrame),this.renderHighlightedNodesFrame=null);for(var i=this.container;i.firstChild;)i.removeChild(i.firstChild);for(var r in this.nodePrograms)this.nodePrograms[r].kill();for(var o in this.nodeHoverPrograms)this.nodeHoverPrograms[o].kill();for(var a in this.edgePrograms)this.edgePrograms[a].kill();this.nodePrograms={},this.nodeHoverPrograms={},this.edgePrograms={};for(var s in this.elements)this.killLayer(s);this.canvasContexts={},this.webGLContexts={},this.elements={}}},{key:"scaleSize",value:function(){var i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:1,r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:this.camera.ratio;return i/this.settings.zoomToSizeRatioFunction(r)*(this.getSetting("itemSizesReference")==="positions"?r*this.graphToViewportRatio:1)}},{key:"getCanvases",value:function(){var i={};for(var r in this.elements)this.elements[r]instanceof HTMLCanvasElement&&(i[r]=this.elements[r]);return i}}])}(Wi),If=Ff;function zf(e,t){if(typeof e!="object"||!e)return e;var n=e[Symbol.toPrimitive];if(n!==void 0){var i=n.call(e,t);if(typeof i!="object")return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}function wa(e){var t=zf(e,"string");return typeof t=="symbol"?t:t+""}function _a(e,t,n){return(t=wa(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function to(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable})),n.push.apply(n,i)}return n}function Nn(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?to(Object(n),!0).forEach(function(i){_a(e,i,n[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):to(Object(n)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(n,i))})}return e}function Of(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function Bf(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,wa(i.key),i)}}function Uf(e,t,n){return t&&Bf(e.prototype,t),Object.defineProperty(e,"prototype",{writable:!1}),e}function Mn(e){return Mn=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},Mn(e)}function xa(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(xa=function(){return!!e})()}function Ea(e){if(e===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function Hf(e,t){if(t&&(typeof t=="object"||typeof t=="function"))return t;if(t!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return Ea(e)}function Wf(e,t,n){return t=Mn(t),Hf(e,xa()?Reflect.construct(t,n||[],Mn(e).constructor):t.apply(e,n))}function ki(e,t){return ki=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(n,i){return n.__proto__=i,n},ki(e,t)}function qf(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&ki(e,t)}function Ti(e,t){(t==null||t>e.length)&&(t=e.length);for(var n=0,i=Array(t);n<t;n++)i[n]=e[n];return i}function Vf(e){if(Array.isArray(e))return Ti(e)}function jf(e){if(typeof Symbol<"u"&&e[Symbol.iterator]!=null||e["@@iterator"]!=null)return Array.from(e)}function Yf(e,t){if(e){if(typeof e=="string")return Ti(e,t);var n={}.toString.call(e).slice(8,-1);return n==="Object"&&e.constructor&&(n=e.constructor.name),n==="Map"||n==="Set"?Array.from(e):n==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?Ti(e,t):void 0}}function Xf(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function si(e){return Vf(e)||jf(e)||Yf(e)||Xf()}function Ca(e,t,n,i){var r=Math.pow(1-e,2)*t.x+2*(1-e)*e*n.x+Math.pow(e,2)*i.x,o=Math.pow(1-e,2)*t.y+2*(1-e)*e*n.y+Math.pow(e,2)*i.y;return{x:r,y:o}}function Kf(e,t,n){for(var i=20,r=0,o=e,a=0;a<i;a++){var s=Ca((a+1)/i,e,t,n);r+=Math.sqrt(Math.pow(o.x-s.x,2)+Math.pow(o.y-s.y,2)),o=s}return r}function Zf(e){var t=e.curvatureAttribute,n=e.defaultCurvature,i=e.keepLabelUpright,r=i===void 0?!0:i;return function(o,a,s,u,l){var c=l.edgeLabelSize,d=a[t]||n,h=l.edgeLabelFont,f=l.edgeLabelWeight,g=l.edgeLabelColor.attribute?a[l.edgeLabelColor.attribute]||l.edgeLabelColor.color||"#000":l.edgeLabelColor.color,m=a.label;if(m){o.fillStyle=g,o.font="".concat(f," ").concat(c,"px ").concat(h);var b=!r||s.x<u.x,C=b?s.x:u.x,_=b?s.y:u.y,x=b?u.x:s.x,p=b?u.y:s.y,v=(C+x)/2,w=(_+p)/2,k=x-C,D=p-_,I=Math.sqrt(Math.pow(k,2)+Math.pow(D,2)),F=b?1:-1,R=v+D*d*F,H=w-k*d*F,$=a.size*.7+5,W={x:H-_,y:-(R-C)},ae=Math.sqrt(Math.pow(W.x,2)+Math.pow(W.y,2)),ue={x:p-H,y:-(x-R)},de=Math.sqrt(Math.pow(ue.x,2)+Math.pow(ue.y,2));C+=$*W.x/ae,_+=$*W.y/ae,x+=$*ue.x/de,p+=$*ue.y/de,R+=$*D/I,H-=$*k/I;var le={x:R,y:H},Q={x:C,y:_},ce={x,y:p},se=Kf(Q,le,ce);if(!(se<s.size+u.size)){var te=o.measureText(m).width,he=se-s.size-u.size;if(te>he){var ke="…";for(m=m+ke,te=o.measureText(m).width;te>he&&m.length>1;)m=m.slice(0,-2)+ke,te=o.measureText(m).width;if(m.length<4)return}for(var fe={},je=0,tt=m.length;je<tt;je++){var Ye=m[je];fe[Ye]||(fe[Ye]=o.measureText(Ye).width*(1+d*.35))}for(var Te=.5-te/se/2,Ue=0,$e=m.length;Ue<$e;Ue++){var nt=m[Ue],mt=Ca(Te,Q,le,ce),On=2*(1-Te)*(R-C)+2*Te*(x-R),it=2*(1-Te)*(H-_)+2*Te*(p-H),Ce=Math.atan2(it,On);o.save(),o.translate(mt.x,mt.y),o.rotate(Ce),o.fillText(nt,0,0),o.restore(),Te+=fe[nt]/se}}}}}function Jf(e){var t=e.arrowHead,n=(t==null?void 0:t.extremity)==="target"||(t==null?void 0:t.extremity)==="both",i=(t==null?void 0:t.extremity)==="source"||(t==null?void 0:t.extremity)==="both",r=`
precision highp float;

varying vec4 v_color;
varying float v_thickness;
varying float v_feather;
varying vec2 v_cpA;
varying vec2 v_cpB;
varying vec2 v_cpC;
`.concat(n?`
varying float v_targetSize;
varying vec2 v_targetPoint;`:"",`
`).concat(i?`
varying float v_sourceSize;
varying vec2 v_sourcePoint;`:"",`
`).concat(t?`
uniform float u_lengthToThicknessRatio;
uniform float u_widenessToThicknessRatio;`:"",`

float det(vec2 a, vec2 b) {
  return a.x * b.y - b.x * a.y;
}

vec2 getDistanceVector(vec2 b0, vec2 b1, vec2 b2) {
  float a = det(b0, b2), b = 2.0 * det(b1, b0), d = 2.0 * det(b2, b1);
  float f = b * d - a * a;
  vec2 d21 = b2 - b1, d10 = b1 - b0, d20 = b2 - b0;
  vec2 gf = 2.0 * (b * d21 + d * d10 + a * d20);
  gf = vec2(gf.y, -gf.x);
  vec2 pp = -f * gf / dot(gf, gf);
  vec2 d0p = b0 - pp;
  float ap = det(d0p, d20), bp = 2.0 * det(d10, d0p);
  float t = clamp((ap + bp) / (2.0 * a + b + d), 0.0, 1.0);
  return mix(mix(b0, b1, t), mix(b1, b2, t), t);
}

float distToQuadraticBezierCurve(vec2 p, vec2 b0, vec2 b1, vec2 b2) {
  return length(getDistanceVector(b0 - p, b1 - p, b2 - p));
}

const vec4 transparent = vec4(0.0, 0.0, 0.0, 0.0);

void main(void) {
  float dist = distToQuadraticBezierCurve(gl_FragCoord.xy, v_cpA, v_cpB, v_cpC);
  float thickness = v_thickness;
`).concat(n?`
  float distToTarget = length(gl_FragCoord.xy - v_targetPoint);
  float targetArrowLength = v_targetSize + thickness * u_lengthToThicknessRatio;
  if (distToTarget < targetArrowLength) {
    thickness = (distToTarget - v_targetSize) / (targetArrowLength - v_targetSize) * u_widenessToThicknessRatio * thickness;
  }`:"",`
`).concat(i?`
  float distToSource = length(gl_FragCoord.xy - v_sourcePoint);
  float sourceArrowLength = v_sourceSize + thickness * u_lengthToThicknessRatio;
  if (distToSource < sourceArrowLength) {
    thickness = (distToSource - v_sourceSize) / (sourceArrowLength - v_sourceSize) * u_widenessToThicknessRatio * thickness;
  }`:"",`

  float halfThickness = thickness / 2.0;
  if (dist < halfThickness) {
    #ifdef PICKING_MODE
    gl_FragColor = v_color;
    #else
    float t = smoothstep(
      halfThickness - v_feather,
      halfThickness,
      dist
    );

    gl_FragColor = mix(v_color, transparent, t);
    #endif
  } else {
    gl_FragColor = transparent;
  }
}
`);return r}function Qf(e){var t=e.arrowHead,n=(t==null?void 0:t.extremity)==="target"||(t==null?void 0:t.extremity)==="both",i=(t==null?void 0:t.extremity)==="source"||(t==null?void 0:t.extremity)==="both",r=`
attribute vec4 a_id;
attribute vec4 a_color;
attribute float a_direction;
attribute float a_thickness;
attribute vec2 a_source;
attribute vec2 a_target;
attribute float a_current;
attribute float a_curvature;
`.concat(n?`attribute float a_targetSize;
`:"",`
`).concat(i?`attribute float a_sourceSize;
`:"",`

uniform mat3 u_matrix;
uniform float u_sizeRatio;
uniform float u_pixelRatio;
uniform vec2 u_dimensions;
uniform float u_minEdgeThickness;
uniform float u_feather;

varying vec4 v_color;
varying float v_thickness;
varying float v_feather;
varying vec2 v_cpA;
varying vec2 v_cpB;
varying vec2 v_cpC;
`).concat(n?`
varying float v_targetSize;
varying vec2 v_targetPoint;`:"",`
`).concat(i?`
varying float v_sourceSize;
varying vec2 v_sourcePoint;`:"",`
`).concat(t?`
uniform float u_widenessToThicknessRatio;`:"",`

const float bias = 255.0 / 254.0;
const float epsilon = 0.7;

vec2 clipspaceToViewport(vec2 pos, vec2 dimensions) {
  return vec2(
    (pos.x + 1.0) * dimensions.x / 2.0,
    (pos.y + 1.0) * dimensions.y / 2.0
  );
}

vec2 viewportToClipspace(vec2 pos, vec2 dimensions) {
  return vec2(
    pos.x / dimensions.x * 2.0 - 1.0,
    pos.y / dimensions.y * 2.0 - 1.0
  );
}

void main() {
  float minThickness = u_minEdgeThickness;

  // Selecting the correct position
  // Branchless "position = a_source if a_current == 1.0 else a_target"
  vec2 position = a_source * max(0.0, a_current) + a_target * max(0.0, 1.0 - a_current);
  position = (u_matrix * vec3(position, 1)).xy;

  vec2 source = (u_matrix * vec3(a_source, 1)).xy;
  vec2 target = (u_matrix * vec3(a_target, 1)).xy;

  vec2 viewportPosition = clipspaceToViewport(position, u_dimensions);
  vec2 viewportSource = clipspaceToViewport(source, u_dimensions);
  vec2 viewportTarget = clipspaceToViewport(target, u_dimensions);

  vec2 delta = viewportTarget.xy - viewportSource.xy;
  float len = length(delta);
  vec2 normal = vec2(-delta.y, delta.x) * a_direction;
  vec2 unitNormal = normal / len;
  float boundingBoxThickness = len * a_curvature;

  float curveThickness = max(minThickness, a_thickness / u_sizeRatio);
  v_thickness = curveThickness * u_pixelRatio;
  v_feather = u_feather;

  v_cpA = viewportSource;
  v_cpB = 0.5 * (viewportSource + viewportTarget) + unitNormal * a_direction * boundingBoxThickness;
  v_cpC = viewportTarget;

  vec2 viewportOffsetPosition = (
    viewportPosition +
    unitNormal * (boundingBoxThickness / 2.0 + sign(boundingBoxThickness) * (`).concat(t?"curveThickness * u_widenessToThicknessRatio":"curveThickness",` + epsilon)) *
    max(0.0, a_direction) // NOTE: cutting the bounding box in half to avoid overdraw
  );

  position = viewportToClipspace(viewportOffsetPosition, u_dimensions);
  gl_Position = vec4(position, 0, 1);
    
`).concat(n?`
  v_targetSize = a_targetSize * u_pixelRatio / u_sizeRatio;
  v_targetPoint = viewportTarget;
`:"",`
`).concat(i?`
  v_sourceSize = a_sourceSize * u_pixelRatio / u_sizeRatio;
  v_sourcePoint = viewportSource;
`:"",`

  #ifdef PICKING_MODE
  // For picking mode, we use the ID as the color:
  v_color = a_id;
  #else
  // For normal mode, we use the color:
  v_color = a_color;
  #endif

  v_color.a *= bias;
}
`);return r}var ka=.25,eg={arrowHead:null,curvatureAttribute:"curvature",defaultCurvature:ka},Ta=WebGLRenderingContext,no=Ta.UNSIGNED_BYTE,at=Ta.FLOAT;function Vi(e){var t=Nn(Nn({},eg),e||{}),n=t,i=n.arrowHead,r=n.curvatureAttribute,o=n.drawLabel,a=(i==null?void 0:i.extremity)==="target"||(i==null?void 0:i.extremity)==="both",s=(i==null?void 0:i.extremity)==="source"||(i==null?void 0:i.extremity)==="both",u=["u_matrix","u_sizeRatio","u_dimensions","u_pixelRatio","u_feather","u_minEdgeThickness"].concat(si(i?["u_lengthToThicknessRatio","u_widenessToThicknessRatio"]:[]));return function(l){qf(c,l);function c(){var d;Of(this,c);for(var h=arguments.length,f=new Array(h),g=0;g<h;g++)f[g]=arguments[g];return d=Wf(this,c,[].concat(f)),_a(Ea(d),"drawLabel",o||Zf(t)),d}return Uf(c,[{key:"getDefinition",value:function(){return{VERTICES:6,VERTEX_SHADER_SOURCE:Qf(t),FRAGMENT_SHADER_SOURCE:Jf(t),METHOD:WebGLRenderingContext.TRIANGLES,UNIFORMS:u,ATTRIBUTES:[{name:"a_source",size:2,type:at},{name:"a_target",size:2,type:at}].concat(si(a?[{name:"a_targetSize",size:1,type:at}]:[]),si(s?[{name:"a_sourceSize",size:1,type:at}]:[]),[{name:"a_thickness",size:1,type:at},{name:"a_curvature",size:1,type:at},{name:"a_color",size:4,type:no,normalized:!0},{name:"a_id",size:4,type:no,normalized:!0}]),CONSTANT_ATTRIBUTES:[{name:"a_current",size:1,type:at},{name:"a_direction",size:1,type:at}],CONSTANT_DATA:[[0,1],[0,-1],[1,1],[0,-1],[1,1],[1,-1]]}}},{key:"processVisibleItem",value:function(h,f,g,m,b){var C,_=b.size||1,x=g.x,p=g.y,v=m.x,w=m.y,k=Nt(b.color),D=(C=b[r])!==null&&C!==void 0?C:ka,I=this.array;I[f++]=x,I[f++]=p,I[f++]=v,I[f++]=w,a&&(I[f++]=m.size),s&&(I[f++]=g.size),I[f++]=_,I[f++]=D,I[f++]=k,I[f++]=h}},{key:"setUniforms",value:function(h,f){var g=f.gl,m=f.uniformLocations,b=m.u_matrix,C=m.u_pixelRatio,_=m.u_feather,x=m.u_sizeRatio,p=m.u_dimensions,v=m.u_minEdgeThickness;if(g.uniformMatrix3fv(b,!1,h.matrix),g.uniform1f(C,h.pixelRatio),g.uniform1f(x,h.sizeRatio),g.uniform1f(_,h.antiAliasingFeather),g.uniform2f(p,h.width*h.pixelRatio,h.height*h.pixelRatio),g.uniform1f(v,h.minEdgeThickness),i){var w=m.u_lengthToThicknessRatio,k=m.u_widenessToThicknessRatio;g.uniform1f(w,i.lengthToThicknessRatio),g.uniform1f(k,i.widenessToThicknessRatio)}}}]),c}(Fn)}var tg=Vi();Vi({arrowHead:zn});Vi({arrowHead:Nn(Nn({},zn),{},{extremity:"both"})});function ng(){const e=document.getElementById("yearFrom"),t=document.getElementById("yearTo"),n=document.getElementById("areaFilter"),i=document.getElementById("institutionFilter"),r=document.getElementById("typeFilter"),o=document.getElementById("clearFilters"),a=document.getElementById("selectedAreas"),s=document.getElementById("selectedInstitutions"),u=document.getElementById("selectedTypes"),l=document.getElementById("standardSearch"),c=document.getElementById("standardSearchBtn"),d=document.getElementById("searchSuggestions"),h=document.getElementById("selectedAuthor"),f=document.getElementById("authorLimitMessage"),g=document.getElementById("clusteringModel"),m=document.getElementById("nClusters"),b=document.getElementById("nClustersValue"),C=document.getElementById("nClustersContainer"),_=document.getElementById("modelDescription");document.getElementById("applyClustering");const x=document.getElementById("rangeContainer"),p=document.getElementById("dbscanOptions"),v=document.getElementById("hdbscanOptions"),w=document.getElementById("dbscanClusters"),k=document.getElementById("hdbscanClusters"),D=document.getElementById("manualMode"),I=document.getElementById("globalBestMode"),F=document.getElementById("modelManualMode"),R=document.getElementById("modelAutoMode"),H=document.getElementById("manualConfigContainer"),$={kmeans:'Agrupa los datos en un número fijo de categorías (clusters) tratando de minimizar la distancia entre los puntos de cada grupo y su centroide, es decir, su "centro". Este método busca particiones compactas y bien separadas, y es especialmente útil cuando los grupos tienen forma redonda o esférica. Es rápido y eficiente, aunque sensible a la elección inicial del número de grupos (k) y a los valores extremos.',agglomerative:"Construye agrupaciones de forma jerárquica: comienza considerando cada autor como un grupo separado y va fusionando los más similares en pasos sucesivos. El resultado es una estructura en forma de árbol (dendrograma), que permite explorar diferentes niveles de agrupación según la profundidad del corte. Es útil cuando no se conoce el número exacto de grupos y se desea analizar la relación progresiva entre autores.",spectral:"Transforma la relación entre autores en una red (o grafo) de similitudes y la descompone matemáticamente para encontrar estructuras ocultas. Posteriormente, agrupa los autores en ese nuevo espacio. Es muy útil cuando las agrupaciones no tienen una forma clara o son no convexas, como anillos o cadenas, y aprovecha la conectividad global de los datos.",gmm:"Parte de la idea de que los datos provienen de una combinación de distribuciones estadísticas llamadas gaussianas (curvas en forma de campana). En lugar de asignar cada punto a un solo grupo, estima la probabilidad de que pertenezca a cada uno. Esto permite detectar agrupaciones solapadas o de forma más compleja que las que detecta KMeans, siendo ideal cuando se sospecha que los datos tienen estructuras suaves o ambiguas.",dbscan:"Encuentra grupos basándose en la densidad de autores: considera que un cluster es una región donde hay muchos autores cercanos entre sí. Los autores aislados o poco conectados son considerados como ruido. No necesita que se indique cuántos grupos buscar, y puede detectar agrupaciones de formas variadas. Es especialmente robusto frente a valores atípicos.",hdbscan:"Es una versión mejorada y jerárquica de DBSCAN. Construye un mapa de densidades y extrae agrupaciones estables y significativas, incluso si estas tienen tamaños o densidades diferentes. También identifica automáticamente qué autores no pertenecen a ningún grupo claro. Es ideal para representar comunidades complejas o con estructuras poco homogéneas."},W={kmeans:'It groups the data into a fixed number of categories (clusters) trying to minimize the distance between the points of each group and its centroid, that is, its "center". This method looks for compact and well-separated partitions, and is especially useful when the clusters are round or spherical in shape. It is fast and efficient, although sensitive to the initial choice of the number of groups (k) and to extreme values.',agglomerative:"It builds groupings in a hierarchical way: it starts by considering each author as a separate group and merges the most similar ones in successive steps. The result is a tree-like structure (dendrogram), which allows exploring different levels of grouping according to the depth of the cut. It is useful when the exact number of groups is not known and it is desired to analyze the progressive relationship between authors.",spectral:"It transforms the relationship between authors into a network (or graph) of similarities and decomposes it mathematically to find hidden structures. It then clusters the authors in this new space. It is very useful when the groupings do not have a clear shape or are non-convex, such as rings or chains, and takes advantage of the global connectivity of the data.",gmm:"It starts from the idea that the data come from a combination of statistical distributions called Gaussian (bell-shaped curves). Instead of assigning each point to a single cluster, it estimates the probability that it belongs to each cluster. This allows it to detect overlapping or more complex-shaped clusters than KMeans detects, making it ideal when data are suspected of having soft or ambiguous structures.",dbscan:"It finds groups based on the density of authors: it considers a cluster as a region where there are many authors close to each other. Isolated or loosely connected authors are considered as noise. It does not need to be told how many clusters to look for, and can detect clusters of various shapes. It is especially robust to outliers.",hdbscan:"It is an enhanced, hierarchical version of DBSCAN. It builds a density map and extracts stable and meaningful clusters, even if they have different sizes or densities. It also automatically identifies which authors do not belong to any clear group. It is ideal for representing complex or inhomogeneously structured communities."},ae={clusters:"clusters",bestConfig:"Mejor Configuración",globalBestConfig:"Mejor Configuración Global",manualConfig:"Configuración Manual",numberOfClusters:"Número de Clusters",clusteringModel:"Modelo de Clustering",apply:"Aplicar",cancel:"Cancelar",globalBestDescription:"Usa la mejor configuración de clustering encontrada entre todos los modelos y parámetros."},ue={clusters:"clusters",bestConfig:"Best Configuration",globalBestConfig:"Global Best Configuration",manualConfig:"Manual Configuration",numberOfClusters:"Number of Clusters",clusteringModel:"Clustering Model",apply:"Apply",cancel:"Cancel",globalBestDescription:"Uses the best clustering configuration found across all models and parameters."};function de(){const y=Mt==="es"?ae:ue,N=Mt==="es"?$:W,S={clusteringModelLabel:document.querySelector('label[for="clusteringModel"]'),nClustersLabel:document.querySelector('label[for="nClusters"]'),manualModeLabel:document.querySelector('label[for="manualMode"]'),globalBestModeLabel:document.querySelector('label[for="globalBestMode"]'),modelManualModeLabel:document.querySelector('label[for="modelManualMode"]'),modelAutoModeLabel:document.querySelector('label[for="modelAutoMode"]'),globalBestDescription:document.querySelector("#globalBestMode + .form-text"),applyButton:document.getElementById("applyClustering"),cancelButton:document.querySelector(".btn-secondary")};S.clusteringModelLabel&&(S.clusteringModelLabel.textContent=y.clusteringModel),S.nClustersLabel&&(S.nClustersLabel.textContent=y.numberOfClusters),S.manualModeLabel&&(S.manualModeLabel.textContent=y.manualConfig),S.globalBestModeLabel&&(S.globalBestModeLabel.textContent=y.globalBestConfig),S.modelManualModeLabel&&(S.modelManualModeLabel.textContent=y.manualConfig),S.modelAutoModeLabel&&(S.modelAutoModeLabel.textContent=y.bestConfig),S.globalBestDescription&&(S.globalBestDescription.textContent=y.globalBestDescription),S.applyButton&&(S.applyButton.textContent=y.apply),S.cancelButton&&(S.cancelButton.textContent=y.cancel),w&&Array.from(w.options).forEach(E=>{E.text=`${E.value} ${y.clusters}`}),k&&Array.from(k.options).forEach(E=>{E.text=`${E.value} ${y.clusters}`}),g&&_&&(_.textContent=N[g.value]||"")}g&&_&&g.addEventListener("change",function(){const y=this.value,N=Mt==="es"?$:W;_.textContent=N[y]||"",y==="dbscan"?(x.classList.add("d-none"),p.classList.remove("d-none"),v.classList.add("d-none")):y==="hdbscan"?(x.classList.add("d-none"),p.classList.add("d-none"),v.classList.remove("d-none")):(x.classList.remove("d-none"),p.classList.add("d-none"),v.classList.add("d-none"))}),D&&I&&H&&(D.addEventListener("change",function(){this.checked&&H.classList.remove("d-none")}),I.addEventListener("change",function(){this.checked&&H.classList.add("d-none")})),F&&R&&C&&(F.addEventListener("change",function(){this.checked&&C.classList.remove("d-none")}),R.addEventListener("change",function(){this.checked&&C.classList.add("d-none")})),m&&b&&m.addEventListener("input",function(){b.textContent=this.value});const le=document.getElementById("clusteringModal");le&&le.addEventListener("show.bs.modal",function(){de()}),document.querySelectorAll(".dropdown-item.network-community-view").forEach(y=>{y.addEventListener("click",function(N){N.preventDefault();const S=this.dataset.communityView;if(S==="keywords"){new bootstrap.Modal(document.getElementById("clusteringModal")).show();return}if(Ge===S){document.querySelectorAll(".dropdown-item.network-community-view").forEach(E=>{E.classList.remove("active")}),this.classList.add("active");return}Ge=S,document.querySelectorAll(".dropdown-item.network-community-view").forEach(E=>{E.classList.remove("active")}),this.classList.add("active"),it()})});let Q=new Set,ce=new Set,se=new Set,te=null,he=null;function ke(){te?(c.classList.remove("btn-primary","btn-success"),c.classList.add("btn-secondary"),c.disabled=!0):(c.innerHTML='<i class="fas fa-search"></i>',c.classList.remove("btn-success","btn-secondary"),c.classList.add("btn-primary"),c.disabled=!1)}function fe(y){if(!y||te){d.style.display="none";return}fetch(`/api/search/authors/?q=${encodeURIComponent(y)}`).then(N=>N.json()).then(N=>{const S=d.querySelector(".list-group");if(S.innerHTML="",N.suggestions.length===0){d.style.display="none";return}N.suggestions.forEach(E=>{const V=document.createElement("a");V.href="#",V.className="list-group-item list-group-item-action",V.innerHTML=`
                        ${E.name}
                        <span class="badge bg-secondary float-end">${E.count} pub.</span>
                    `,V.addEventListener("click",G=>{G.preventDefault(),je(E.name)}),S.appendChild(V)}),d.style.display="block"}).catch(N=>{console.error("Error fetching author suggestions:",N),d.style.display="none"})}function je(y){te=y,l.value="",l.disabled=!0,d.style.display="none",f.style.display="block",ke(),h.innerHTML=`
            <span class="badge bg-primary me-2 mb-2">
                ${y}
                <button type="button" class="btn-close btn-close-white ms-1" 
                        style="font-size: 0.5rem; vertical-align: middle;"
                        aria-label="Remove"></button>
            </span>
        `,h.querySelector(".btn-close").addEventListener("click",()=>{te=null,h.innerHTML="",l.disabled=!1,f.style.display="none",ke();const ie=document.getElementById("authorMetricsCard");ie&&ie.remove();const X=document.getElementById("networkCol");X&&(X.className="col-12"),rt()});const N=document.getElementById("collaborationRow"),S=document.createElement("div");S.id="authorMetricsCard",S.className="col-md-6 mt-3 mt-md-0 mb-10 h-100";const E=window.location.pathname.split("/")[1],V=E==="es"?"Resumen de Métricas del Autor":"Author Metrics Summary",G=E==="es"?"Métrica":"Metrics",P=E==="es"?"Valor":"Value";S.innerHTML=`
            <div class="card dashboard-card h-100">
                <div class="card-body d-flex flex-column">
                    <div class="d-flex justify-content-between align-items-center mb-3">
                        <h5 class="card-title mb-0">${V}</h5>
                    </div>
                    <div id="authorMetricsContent" class="flex-grow-1">
                        <div class="table-responsive">
                            <table class="table table-hover">
                                <thead>
                                    <tr>
                                        <th>${G}</th>
                                        <th>${P}</th>
                                    </tr>
                                </thead>
                                <tbody id="authorMetricsTable">
                                    <!-- Data will be loaded dynamically -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
        `,N.appendChild(S);const j=document.getElementById("networkCol");j&&(j.className="col-12 col-md-6 mb-10");const Z=document.getElementById("pubsCol");Z&&(Z.className="col-12 mt-4"),fetch(`/api/author/metrics/?author_id=${encodeURIComponent(y)}`).then(ie=>ie.json()).then(ie=>{if(ie.error){console.error("Error fetching author metrics:",ie.error);return}const X=document.getElementById("authorMetricsTable");if(!X)return;const B={orcid:"ORCID",total_publications:"Total Publications",total_citations:"Total Citations",citations_wos:"WoS Citations",citations_scopus:"Scopus Citations",h_index:"H-index (WoS/Scopus)",h_index_gb:"H-index (Gesbib)",h_index_h5gb:"H5-index (Gesbib)",international_index:"International Collaboration Index"};X.innerHTML="",Object.entries(ie.metrics).forEach(([O,A])=>{const U=document.createElement("tr");if(O==="orcid"&&typeof A=="string"&&A.trim()!==""){const L=A.replace(/^http:/,"https:");U.innerHTML=`
                            <td>${B[O]}</td>
                            <td><a href="${L}" target="_blank" rel="noopener noreferrer">${L}</a></td>
                        `}else U.innerHTML=`
                            <td>${B[O]||O}</td>
                            <td>${A}</td>
                        `;X.appendChild(U)})}).catch(ie=>{console.error("Error fetching author metrics:",ie)}),rt()}function tt(){if(!te&&!l.value.trim())return;c.innerHTML='<i class="fas fa-spinner fa-spin"></i>';const y=new URLSearchParams;te?y.append("author",te):y.append("q",l.value.trim()),fetch(`/api/search/?${y.toString()}`).then(N=>N.json()).then(N=>{c.innerHTML='<i class="fas fa-search"></i>',Ye(N.results)}).catch(N=>{console.error("Error performing search:",N),c.innerHTML='<i class="fas fa-search"></i>',alert("Error al realizar la búsqueda. Por favor, inténtelo de nuevo.")})}function Ye(y){const S=window.location.pathname.split("/")[1]==="es"?"Resultados de la búsqueda":"Search Results";let E=document.getElementById("searchResultsModal");E||(E=document.createElement("div"),E.id="searchResultsModal",E.className="modal fade",E.setAttribute("tabindex","-1"),E.innerHTML=`
                <div class="modal-dialog modal-lg">
                    <div class="modal-content">
                        <div class="modal-header">
                            <h5 class="modal-title">${S}</h5>
                            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                        </div>
                        <div class="modal-body">
                            <div id="searchResultsList"></div>
                        </div>
                    </div>
                </div>
            `,document.body.appendChild(E));const V=document.getElementById("searchResultsList");y.length===0?V.innerHTML='<p class="text-center">No se encontraron resultados.</p>':V.innerHTML=y.map(P=>`
                <div class="card mb-3">
                    <div class="card-body" data-publication-id="${P.id}" style="cursor: pointer;">
                        <h5 class="card-title">${P.title}</h5>
                        <h6 class="card-subtitle mb-2 text-muted">
                            ${P.year} - ${P.publication_type}
                        </h6>
                        <p class="card-text">
                            <strong>Autores:</strong> ${P.authors.join(", ")}<br>
                            <strong>Instituciones:</strong> ${P.institutions.join(", ")}<br>
                            <strong>Áreas:</strong> ${P.areas.join(", ")}
                        </p>
                        ${P.url?`<a href="${P.url}" class="card-link" target="_blank">Ver publicación</a>`:""}
                    </div>
                </div>
            `).join(""),V.querySelectorAll(".card-body").forEach(P=>{P.addEventListener("click",function(){const j=this.dataset.publicationId;j&&(window.location.href=`/publication/${j}/`)})}),new bootstrap.Modal(E).show()}l.addEventListener("input",function(){te||(clearTimeout(he),he=setTimeout(()=>{fe(this.value.trim())},300))}),l.addEventListener("focus",function(){this.value.trim()&&!te&&fe(this.value.trim())}),document.addEventListener("click",function(y){!y.target.closest("#standardSearch")&&!y.target.closest("#searchSuggestions")&&(d.style.display="none")}),c.addEventListener("click",tt),l.addEventListener("keypress",function(y){y.key==="Enter"&&tt()}),ke(),Te(),On();function Te(){fetch("/api/dashboard/filters/").then(y=>y.json()).then(y=>{const N=y.years.map(S=>S.year);e.min=Math.min(...N),e.max=Math.max(...N),t.min=Math.min(...N),t.max=Math.max(...N),y.areas.forEach(S=>{const E=document.createElement("option");E.value=S.name,E.textContent=`${S.name} (${S.count})`,n.appendChild(E)}),y.institutions.forEach(S=>{const E=document.createElement("option");E.value=S.name,E.textContent=`${S.name} (${S.count})`,i.appendChild(E)}),y.publication_types.forEach(S=>{const E=document.createElement("option");E.value=S.publication_type,E.textContent=`${S.publication_type} (${S.count})`,r.appendChild(E)}),it()}).catch(y=>console.error("Error loading filter data:",y))}function Ue(y,N,S){const E=document.createElement("span");E.className="badge bg-primary me-2 mb-2";const V=y.length>40?y.substring(0,40)+"...":y;E.innerHTML=`
            ${V}
            <button type="button" class="btn-close btn-close-white ms-1" 
                    style="font-size: 0.5rem; vertical-align: middle;"
                    aria-label="Remove"></button>
        `,E.querySelector(".btn-close").addEventListener("click",()=>{S.delete(y),E.remove(),it()}),N.appendChild(E)}let $e="pie",nt=null;function mt(y){$e==="pie"?Aa(y):La(y)}function On(){const y=document.querySelector('[data-areas-view="pie"]'),N=document.querySelector('[data-areas-view="bar"]');!y||!N||(y.addEventListener("click",function(){y.classList.contains("active")||(y.classList.add("active"),N.classList.remove("active"),$e="pie",nt&&mt(nt))}),N.addEventListener("click",function(){N.classList.contains("active")||(N.classList.add("active"),y.classList.remove("active"),$e="bar",nt&&mt(nt))}))}function it(){const y={year_from:e.value,year_to:t.value,areas:Array.from(Q),institutions:Array.from(ce),types:Array.from(se)},N=y.year_from&&y.year_to&&y.year_from===y.year_to,S=document.querySelector('[data-view="monthly"]'),E=document.querySelector('[data-view="yearly"]');S.disabled=!N,N?y.view_type=S.classList.contains("active")?"monthly":"yearly":(S.classList.remove("active"),E.classList.add("active"),y.view_type="yearly");const V=new URLSearchParams;y.year_from&&V.append("year_from",y.year_from),y.year_to&&V.append("year_to",y.year_to),y.areas.forEach(G=>V.append("areas",G)),y.institutions.forEach(G=>V.append("institutions",G)),y.types.forEach(G=>V.append("types",G)),V.append("view_type",y.view_type),te&&V.append("author",te),fetch(`/api/dashboard/data/?${V.toString()}`).then(G=>G.json()).then(G=>{const P=new URLSearchParams(V);P.append("view_type",Ge),fetch(`/api/dashboard/collaboration-network/?${P.toString()}`).then(ie=>ie.json()).then(ie=>{ji(ie)}).catch(ie=>{console.error("Error fetching collaboration network data:",ie)}),Sa(G.timeline,y.view_type,G.timeline_info),nt=G.areas;const j=document.querySelector('[data-areas-view="pie"]'),Z=document.querySelector('[data-areas-view="bar"]');j&&Z&&!j.classList.contains("active")&&!Z.classList.contains("active")?(j.classList.add("active"),Z.classList.remove("active"),$e="pie"):Z&&Z.classList.contains("active")?$e="bar":j&&j.classList.contains("active")&&($e="pie"),mt(G.areas),Bn(1).then(()=>{})}).catch(G=>console.error("Error updating visualizations:",G))}let Ce={metric:null,direction:"desc"};function Bn(y=1){const N=document.getElementById("metricsTable"),S=document.getElementById("publicationsPagination"),E=N.closest("table");if(E){let P=E.querySelector(".loading-overlay");P||(P=document.createElement("div"),P.className="loading-overlay",P.style.cssText=`
                    position: absolute;
                    top: 0;
                    left: 0;
                    width: 100%;
                    height: 100%;
                    background: rgba(255, 255, 255, 0.8);
                    display: flex;
                    justify-content: center;
                    align-items: center;
                    z-index: 1000;
                `,P.innerHTML=`
                    <div class="spinner-border text-primary" role="status">
                        <span class="visually-hidden">Cargando...</span>
                    </div>
                `,E.style.position="relative",E.appendChild(P)),P.style.display="flex",E.style.pointerEvents="none",E.style.opacity="0.7"}const V={year_from:e.value,year_to:t.value,areas:Array.from(Q),institutions:Array.from(ce),types:Array.from(se),page:y},G=new URLSearchParams;return V.year_from&&G.append("year_from",V.year_from),V.year_to&&G.append("year_to",V.year_to),V.areas.forEach(P=>G.append("areas",P)),V.institutions.forEach(P=>G.append("institutions",P)),V.types.forEach(P=>G.append("types",P)),G.append("page",V.page),te&&G.append("author",te),Ce.metric&&(G.append("sort_by",Ce.metric),G.append("sort_order",Ce.direction)),fetch(`/api/dashboard/publications/?${G.toString()}`).then(P=>{if(!P.ok)throw new Error("Network response was not ok");return P.json()}).then(P=>{if(!N||!S)return Promise.reject("Required elements not found");const{data:j,pagination:Z}=P.publications,ie=[{key:"Dimensions Citations",label:"Dimensions Citations"},{key:"WoS Citations",label:"WoS Citations"},{key:"Scopus Citations",label:"Scopus Citations"},{key:"FCR",label:"FCR"},{key:"RCR",label:"RCR"},{key:"International Collaboration",label:"International Collaboration"}],X=document.createElement("thead");if(X.innerHTML=`
                    <tr>
                        <th style="max-width: 300px;">Título</th>
                        ${ie.map(({key:O,label:A})=>`
                            <th class="sortable" data-metric="${O}">
                                ${A}
                                <i class="fas fa-sort${Ce.metric===O?`-${Ce.direction==="desc"?"down":"up"}`:""} ms-1"></i>
                            </th>
                        `).join("")}
                    </tr>
                `,E){const O=E.querySelector("thead");O&&O.remove(),E.insertBefore(X,N)}X.querySelectorAll(".sortable").forEach(O=>{O.addEventListener("click",function(){const A=this.dataset.metric,U=this.querySelector("i");X.querySelectorAll(".sortable i").forEach(L=>{L.className="fas fa-sort ms-1"}),Ce.metric===A?Ce.direction=Ce.direction==="desc"?"asc":"desc":(Ce.metric=A,Ce.direction="desc"),U.className=`fas fa-sort-${Ce.direction==="desc"?"down":"up"} ms-1`,Bn(1)})});function B(O){N.innerHTML=O.map(A=>`
                        <tr class="publication-row" data-publication-id="${A.id}" style="cursor: pointer;">
                            <td style="max-width: 300px; overflow: hidden; text-overflow: ellipsis; white-space: nowrap;">${A.title}</td>
                            ${ie.map(({key:U})=>{const L=A.metrics[U];return`<td>${L&&L.value!==null?L.value:""}</td>`}).join("")}
                            <td>${A.international_collab!==null?A.international_collab:"-"}</td>
                        </tr>
                    `).join(""),N.querySelectorAll(".publication-row").forEach(A=>{A.addEventListener("click",function(){const U=this.dataset.publicationId;U&&(window.location.href=`/publication/${U}/`)})})}if(B(j),Z.total_pages>1){let O=`
                        <li class="page-item ${Z.current_page===1?"disabled":""}">
                            <a class="page-link" href="#" data-page="1">&laquo;</a>
                        </li>
                        <li class="page-item ${Z.current_page===1?"disabled":""}">
                            <a class="page-link" href="#" data-page="${Z.current_page-1}">&lt;</a>
                        </li>
                    `;const A=Math.max(1,Z.current_page-2),U=Math.min(Z.total_pages,Z.current_page+2);for(let L=A;L<=U;L++)O+=`
                            <li class="page-item ${L===Z.current_page?"active":""}">
                                <a class="page-link" href="#" data-page="${L}">${L}</a>
                            </li>
                        `;O+=`
                        <li class="page-item ${Z.current_page===Z.total_pages?"disabled":""}">
                            <a class="page-link" href="#" data-page="${Z.current_page+1}">&gt;</a>
                        </li>
                        <li class="page-item ${Z.current_page===Z.total_pages?"disabled":""}">
                            <a class="page-link" href="#" data-page="${Z.total_pages}">&raquo;</a>
                        </li>
                    `,S.innerHTML=O}else S.innerHTML="";if(S.querySelectorAll(".page-link").forEach(O=>{O.addEventListener("click",function(A){A.preventDefault();const U=parseInt(this.dataset.page);isNaN(U)||Bn(U)})}),E){const O=E.querySelector(".loading-overlay");O&&(O.style.display="none"),E.style.pointerEvents="auto",E.style.opacity="1"}return Promise.resolve()}).catch(P=>{if(console.error("Error updating publications table:",P),E){const j=E.querySelector(".loading-overlay");j&&(j.style.display="none"),E.style.pointerEvents="auto",E.style.opacity="1"}return Promise.reject(P)})}function Sa(y,N,S){Le("#timelineChart").html("");const E={top:20,right:20,bottom:70,left:60},V=document.getElementById("timelineChart").clientWidth-E.left-E.right,G=300-E.top-E.bottom,P=Le("#timelineChart").append("svg").attr("width",V+E.left+E.right).attr("height",G+E.top+E.bottom).style("display","block").style("margin","0 auto").append("g").attr("transform",`translate(${E.left},${E.top})`);let j;N==="monthly"?j=Ht().domain([1,12]).range([0,V]):j=Ht().domain(Ia(y,L=>L.year)).range([0,V]);const Z=Ht().domain([0,Ji(y,L=>L.count)]).nice().range([G,0]);let ie;N==="monthly"?ie=qn(j).ticks(12).tickFormat(L=>["Ene","Feb","Mar","Abr","May","Jun","Jul","Ago","Sep","Oct","Nov","Dic"][L-1]):ie=qn(j).ticks(V/80).tickFormat(Pi("d"));const X=er(Z).ticks(G/40);P.append("g").attr("transform",`translate(0,${G})`).call(ie).selectAll("text").style("text-anchor","middle"),P.append("g").call(X);const B=Oo().x(L=>j(N==="monthly"?L.month:L.year)).y(L=>Z(L.count)).curve(Lr),O=ed().x(L=>j(N==="monthly"?L.month:L.year)).y0(G).y1(L=>Z(L.count)).curve(Lr);P.append("path").datum(y).attr("fill","#e3f2fd").attr("d",O),P.append("path").datum(y).attr("fill","none").attr("stroke","#2196f3").attr("stroke-width",2).attr("d",B);const A=document.createElement("div");A.className="tooltip",A.style.opacity=0,A.style.position="absolute",A.style.backgroundColor="rgba(255,255,255,0.95)",A.style.border="1px solid #2196f3",A.style.borderRadius="4px",A.style.padding="6px 10px",A.style.fontSize="13px",A.style.pointerEvents="none",A.style.zIndex="1000",A.style.boxShadow="0 2px 4px rgba(0,0,0,0.1)",document.body.appendChild(A);const U=document.createElement("div");if(U.className="info-box",U.style.display="none",U.style.position="absolute",U.style.backgroundColor="white",U.style.border="2px solid #2196f3",U.style.borderRadius="6px",U.style.padding="10px 15px",U.style.fontSize="14px",U.style.zIndex="1000",U.style.boxShadow="0 4px 8px rgba(0,0,0,0.1)",U.style.pointerEvents="none",document.body.appendChild(U),P.selectAll(".point").data(y).enter().append("circle").attr("class","point").attr("cx",L=>j(N==="monthly"?L.month:L.year)).attr("cy",L=>Z(L.count)).attr("r",5).attr("fill","#2196f3").attr("stroke","#fff").attr("stroke-width",2).style("cursor","pointer").on("mouseover",function(L,ne){Le(this).attr("r",7).attr("fill","#1976d2"),A.style.opacity=1;let K;N==="monthly"?K=`<b>${["Enero","Febrero","Marzo","Abril","Mayo","Junio","Julio","Agosto","Septiembre","Octubre","Noviembre","Diciembre"][ne.month-1]}</b><br><b>Publicaciones:</b> ${ne.count}`:K=`<b>Año:</b> ${ne.year}<br><b>Publicaciones:</b> ${ne.count}`,A.innerHTML=K,A.style.left=`${L.pageX+10}px`,A.style.top=`${L.pageY+10}px`}).on("mouseout",function(){Le(this).attr("r",5).attr("fill","#2196f3"),A.style.opacity=0}).on("click",function(L,ne){L.stopPropagation(),He(".info-box").style("display","none");const K=document.getElementById("timelineChart").getBoundingClientRect(),J=L.clientX-K.left,ge=L.clientY-K.top,re=120,me=60;let Ae=J,st=ge-me-10;Ae+re/2>K.width?Ae=K.width-re/2:Ae-re/2<0&&(Ae=re/2),st<0&&(st=ge+10);let ut;N==="monthly"?ut=`
                        <div style="font-weight: bold; margin-bottom: 5px;">${["Enero","Febrero","Marzo","Abril","Mayo","Junio","Julio","Agosto","Septiembre","Octubre","Noviembre","Diciembre"][ne.month-1]}</div>
                        <div>Publicaciones: ${ne.count}</div>
                    `:ut=`
                        <div style="font-weight: bold; margin-bottom: 5px;">Año ${ne.year}</div>
                        <div>Publicaciones: ${ne.count}</div>
                    `,U.innerHTML=ut,U.style.display="block",U.style.left=`${Ae-re/2}px`,U.style.top=`${st}px`}),P.on("click",function(L){L.target.classList.contains("point")||He(".info-box").style("display","none")}),document.addEventListener("click",function(L){L.target.closest("#timelineChart")||He(".info-box").style("display","none")}),document.getElementById("timelineChart").addEventListener("click",function(L){L.target.closest(".point")||He(".info-box").style("display","none")}),P.append("text").attr("transform","rotate(-90)").attr("y",0-E.left+20).attr("x",0-G/2).attr("dy","1em").style("text-anchor","middle").style("font-size","12px").text("Número de publicaciones"),P.append("text").attr("transform",`translate(${V/2}, ${G+E.bottom-30})`).attr("dy","1em").style("text-anchor","middle").style("font-size","12px").text(N==="monthly"?"Mes":"Año"),N==="monthly"&&S&&S.no_month_count>0){const L=Le("#timelineChart").append("div").attr("class","alert alert-info").style("position","absolute").style("top","50px").style("right","10px").style("padding","8px 12px").style("font-size","12px").style("border-radius","4px").style("background-color","#e3f2fd").style("border","1px solid #2196f3").style("color","#0d47a1").style("z-index","1000").style("display","flex").style("align-items","center").style("gap","8px").style("max-width","300px");(S.no_month_count/S.total_count*100).toFixed(1),L.html(`
                <div style="flex-grow: 1;">
                    <i class="fas fa-info-circle"></i>
                    ${S.no_month_count} publicación(es) sin mes asignado 
                    se han contabilizado en enero
                </div>
                <button type="button" class="btn-close" style="font-size: 0.7rem;" aria-label="Close"></button>
            `),L.select(".btn-close").on("click",function(){L.remove()})}}function Aa(y){y=y.filter(A=>A.thematic_areas__name!==null);const N=14;if(y.length>N){const A=y.slice().sort((K,J)=>J.count-K.count),U=A.slice(0,N);y=[{thematic_areas__name:"Otras",count:A.slice(N).reduce((K,J)=>K+J.count,0)},...U]}Le("#areasChart").html("");const S={top:20,right:150,bottom:20,left:20},E=document.getElementById("areasChart").clientWidth-S.left-S.right,V=320-S.top-S.bottom,G=Math.min(E,V)/2,P=Le("#areasChart").append("svg").attr("width",E+S.left+S.right).attr("height",V+S.top+S.bottom).style("display","block").style("margin","0 auto").append("g").attr("transform",`translate(${G+S.left},${V/2+S.top})`),j=qt().domain(y.map(A=>A.thematic_areas__name)).range(Er),Z=id().value(A=>A.count).sort(null),ie=Qc().innerRadius(0).outerRadius(G),X=Le("#areasChart").append("div").attr("class","info-box").style("display","none").style("position","absolute").style("background-color","white").style("border","2px solid #2196f3").style("border-radius","6px").style("padding","10px 15px").style("font-size","14px").style("z-index","1000").style("box-shadow","0 4px 8px rgba(0,0,0,0.1)").style("pointer-events","none");P.selectAll("path").data(Z(y)).enter().append("path").attr("d",ie).attr("fill",A=>j(A.data.thematic_areas__name)).attr("stroke","white").style("stroke-width","2px").style("cursor","pointer").on("click",function(A,U){A.stopPropagation(),He(".info-box").style("display","none");const L=document.getElementById("areasChart").getBoundingClientRect(),ne=A.clientX-L.left,K=A.clientY-L.top,J=180,ge=70;let re=ne,me=K-ge-10;re+J/2>L.width?re=L.width-J/2:re-J/2<0&&(re=J/2),me<0&&(me=K+10);const Ae=(U.data.count/Un(y,en=>en.count)*100).toFixed(1),st=`
                    <div style="font-weight: bold; margin-bottom: 5px;">${U.data.thematic_areas__name}</div>
                    <div>Publicaciones: ${U.data.count}</div>
                    <div>Porcentaje: ${Ae}%</div>
                `,ut=j(U.data.thematic_areas__name);X.html(st).style("display","block").style("left",re-J/2+"px").style("top",me+"px").style("border",`2px solid ${ut}`)});const O=P.append("g").attr("transform",`translate(${G+20}, ${-280/2})`).selectAll(".legend-item").data(y).enter().append("g").attr("class","legend-item").attr("transform",(A,U)=>`translate(0, ${U*20})`);O.append("rect").attr("width",15).attr("height",15).attr("fill",A=>j(A.thematic_areas__name)),O.append("text").attr("x",20).attr("y",12).style("font-size","10px").text(A=>{const U=A.thematic_areas__name,L=(A.count/Un(y,ne=>ne.count)*100).toFixed(1);return`${U} (${A.count} pubs, ${L}%)`}),document.getElementById("areasChart").addEventListener("click",function(A){A.target.closest("path")||He(".info-box").style("display","none")}),document.addEventListener("click",function(A){A.target.closest("#areasChart")||He(".info-box").style("display","none")})}function La(y){y=y.filter(X=>X.thematic_areas__name!==null);const N=25;if(y.length>N){const X=y.slice().sort((U,L)=>L.count-U.count),B=X.slice(0,N),A=X.slice(N).reduce((U,L)=>U+L.count,0);y=[...B,{thematic_areas__name:"Otras",count:A}]}Le("#areasChart").html("");const S={top:20,right:20,bottom:30,left:60},E=document.getElementById("areasChart").clientWidth-S.left-S.right,V=300-S.top-S.bottom,G=Le("#areasChart").append("svg").attr("width",E+S.left+S.right).attr("height",V+S.top+S.bottom).style("display","block").style("margin","0 auto").append("g").attr("transform",`translate(${S.left},${S.top})`),P=Go().domain(y.map(X=>X.thematic_areas__name)).range([0,E]).padding(.2),j=Ht().domain([0,Ji(y,X=>X.count)]).nice().range([V,0]);G.append("g").attr("transform",`translate(0,${V})`).call(qn(P).tickFormat("")),G.append("g").call(er(j).ticks(V/40));const Z=qt().domain(y.map(X=>X.thematic_areas__name)).range(Er),ie=Le("#areasChart").append("div").attr("class","info-box").style("display","none").style("position","absolute").style("background-color","white").style("border","2px solid #2196f3").style("border-radius","6px").style("padding","10px 15px").style("font-size","14px").style("z-index","1000").style("box-shadow","0 4px 8px rgba(0,0,0,0.1)").style("pointer-events","none");G.selectAll(".bar").data(y).enter().append("rect").attr("class","bar").attr("x",X=>P(X.thematic_areas__name)).attr("y",X=>j(X.count)).attr("width",P.bandwidth()).attr("height",X=>V-j(X.count)).attr("fill",X=>Z(X.thematic_areas__name)).style("cursor","pointer").on("click",function(X,B){X.stopPropagation(),He(".info-box").style("display","none");const O=document.getElementById("areasChart").getBoundingClientRect(),A=X.clientX-O.left,U=X.clientY-O.top,L=180,ne=70;let K=A,J=U-ne-10;K+L/2>O.width?K=O.width-L/2:K-L/2<0&&(K=L/2),J<0&&(J=U+10);const ge=(B.count/Un(y,Ae=>Ae.count)*100).toFixed(1),re=`
                    <div style="font-weight: bold; margin-bottom: 5px;">${B.thematic_areas__name}</div>
                    <div>Publicaciones: ${B.count}</div>
                    <div>Porcentaje: ${ge}%</div>
                `,me=Z(B.thematic_areas__name);ie.html(re).style("display","block").style("left",K-L/2+"px").style("top",J+"px").style("border",`2px solid ${me}`)}),document.getElementById("areasChart").addEventListener("click",function(X){X.target.closest("rect")||He(".info-box").style("display","none")}),document.addEventListener("click",function(X){X.target.closest("#areasChart")||He(".info-box").style("display","none")}),G.append("text").attr("transform","rotate(-90)").attr("y",-40).attr("x",-250/2).attr("dy","1em").style("text-anchor","middle").style("font-size","12px").text("Número de publicaciones"),G.append("text").attr("transform",`translate(${E/2}, ${V+S.bottom-20})`).attr("dy","1em").style("text-anchor","middle").style("font-size","12px").text("Áreas temáticas")}document.querySelectorAll("[data-view]").forEach(y=>{y.addEventListener("click",function(){this.disabled||(document.querySelectorAll("[data-view]").forEach(N=>N.classList.remove("active")),this.classList.add("active"),it())})}),e.addEventListener("change",rt),t.addEventListener("change",rt),n.addEventListener("change",()=>{const y=n.value;y&&!Q.has(y)&&(Q.add(y),Ue(y,a,Q),rt()),n.value=""}),i.addEventListener("change",()=>{const y=i.value;y&&!ce.has(y)&&(ce.add(y),Ue(y,s,ce),rt()),i.value=""}),r.addEventListener("change",()=>{const y=r.value;y&&!se.has(y)&&(se.add(y),Ue(y,u,se),rt()),r.value=""}),o.addEventListener("click",()=>{e.value="",t.value="",Q.clear(),ce.clear(),se.clear(),a.innerHTML="",s.innerHTML="",u.innerHTML="",rt()});let Se=null,vt=!1;const Qt=document.getElementById("toggleLabelsBtn"),Mt=window.location.pathname.split("/")[1],Ra=Mt==="es"?"Ocultar etiquetas extra":"Hide Extra Labels",Na=Mt==="es"?"Mostrar etiquetas":"Show All Labels";Qt&&Qt.addEventListener("click",()=>{Se&&(vt=!vt,vt?(Se.setSettings({labelDensity:1/0,labelGridCellSize:1,labelRenderedSizeThreshold:0}),Qt.textContent=`${Ra}`):(Se.setSettings({labelDensity:1,labelGridCellSize:200,labelRenderedSizeThreshold:0}),Qt.textContent=`${Na}`),Se.refresh())});let Ge="modularity-7";document.querySelectorAll(".dropdown-item.network-community-view").forEach(y=>{y.addEventListener("click",function(N){N.preventDefault();const S=this.dataset.communityView;if(Ge===S){document.querySelectorAll(".dropdown-item.network-community-view").forEach(E=>{E.classList.remove("active")}),this.classList.add("active");return}Ge=S,document.querySelectorAll(".dropdown-item.network-community-view").forEach(E=>{E.classList.remove("active")}),this.classList.add("active"),it()})});function ji(y){const N=document.getElementById("collaborationNetwork");if(!N)return;const S=document.querySelector("#collaborationNetwork").closest(".card").querySelector(".card-title");if(y.is_author_view){const B=y.nodes.find(A=>A.is_selected);if(B){const A=window.location.pathname.split("/")[1];S.textContent=A==="es"?`Colaboraciones de ${B.label}`:`Collaborations of ${B.label}`}const O=document.querySelector("#communityViewDropdown").closest(".dropdown");O&&(O.style.display="none")}else{const B=document.querySelector("#communityViewDropdown").closest(".dropdown");B&&(B.style.display="block")}Se&&(Se.kill(),Se=null),N.innerHTML="";const E=new oe,V=["#e6194b","#3cb44b","#ffe119","#4363d8","#f58231","#911eb4","#42d4f4","#f032e6","#bfef45","#fabed4","#469990","#dcbeff","#9a6324","#fffac8","#800000","#aaffc3","#808000","#ffd8b1","#000075","#a9a9a9","#000000","#6a3d9a","#b15928","#1f78b4"],G=B=>V[B%V.length],P=qt().domain(["Departamento 1","Departamento 2","Departamento 3","Unknown"]).range(["#1f78b4","#ff7f0e","#2ca02c","#999999"]);if(y.is_author_view){console.log("Posicionando nodos para vista de autor");const B=N.clientWidth/2,O=N.clientHeight/2,A=250,U=y.nodes.find(K=>K.is_selected);if(!U)return;U.x=B,U.y=O;const L=y.nodes.filter(K=>!K.is_selected),ne=2*Math.PI/Math.max(L.length,1);L.forEach((K,J)=>{const ge=J*ne;K.x=B+A*Math.cos(ge),K.y=O+A*Math.sin(ge)})}else{let B,O;Ge==="department"?(B="department",O=[...new Set(y.nodes.map(re=>re.department))]):Ge==="modularity-5"?(B="leiden_community",O=[...new Set(y.nodes.map(re=>parseInt(re.leiden_community)))]):(B="community",O=[...new Set(y.nodes.map(re=>parseInt(re.community)))]);const A=O.indexOf(-1);A>-1&&(O.splice(A,1),O.push(-1));const U={};O.forEach(re=>{U[re]=B==="department"?y.nodes.filter(me=>me[B]===re):y.nodes.filter(me=>parseInt(me[B])===re)});const L=N.clientWidth/2,ne=N.clientHeight/2,K=O.length,J=Math.min(L,ne)*.8,ge=J/Math.sqrt(K)*.5;O.forEach((re,me)=>{const Ae=U[re],st=2*Math.PI/Math.max(Ae.length,5),ut=L+J*Math.cos(2*Math.PI*me/K),en=ne+J*Math.sin(2*Math.PI*me/K);Ae.forEach((Yi,Ma)=>{const Xi=Ma*st;Yi.x=ut+ge*Math.cos(Xi),Yi.y=en+ge*Math.sin(Xi)})})}const j={};y.edges.forEach(B=>{j[B.source]=(j[B.source]||0)+1,j[B.target]=(j[B.target]||0)+1}),y.nodes.forEach(B=>{const O=parseInt(B.community),A=parseInt(B.leiden_community),U=B.department,L=y.is_author_view?B.is_selected?"#e6194b":"#bbbbbb":Ge==="department"?P(U):G(Ge==="modularity-5"?A:O);E.addNode(B.id,{label:B.label,x:B.x,y:B.y,size:B.is_selected?18:12,color:L,highlighted:B.is_selected,forceLabel:vt})}),y.edges.forEach(B=>{if(E.hasNode(B.source)&&E.hasNode(B.target)){const O=B.weight||1,A=Math.pow(O,.7),U=Math.min(4,Math.max(1.5,A)),ne=`rgba(3, 138, 255, ${Math.min(.9,.5+.05*O).toFixed(2)})`;E.addEdge(B.source,B.target,{size:U,color:ne,type:"curve"})}}),Se=new If(E,N,{minCameraRatio:.1,maxCameraRatio:10,defaultEdgeType:"curve",edgeProgramClasses:{curve:tg},renderLabels:!0,labelDensity:1,labelGridCellSize:300,labelRenderedSizeThreshold:0,defaultLabelSize:8,zIndex:!0,enableEdgeHovering:!1,enableNodeHovering:!1,enableCamera:!1});const Z=document.createElement("div");Object.assign(Z.style,{position:"absolute",backgroundColor:"#fff",border:"1px solid #aaa",padding:"4px 8px",fontSize:"12px",borderRadius:"4px",pointerEvents:"none",display:"none",zIndex:1e3}),document.body.appendChild(Z);const ie=()=>{const B=Le("#collaborationNetwork").append("div").attr("class","alert alert-info").style("position","absolute").style("top","10px").style("left","10px").style("padding","8px 12px").style("font-size","12px").style("border-radius","4px").style("background-color","#e3f2fd").style("border","1px solid #2196f3").style("color","#0d47a1").style("z-index","1000").style("display","flex").style("align-items","center").style("gap","8px").style("max-width","300px");B.html(`
                <div style="flex-grow: 1;">
                    <i class="fas fa-info-circle"></i>
                    La red contiene ${E.order} autores y ${E.size} colaboraciones
                </div>
                <button type="button" class="btn-close" style="font-size: 0.7rem;" aria-label="Close"></button>
            `),B.select(".btn-close").on("click",()=>B.remove()),Se.setSettings({enableEdgeHovering:!0,enableNodeHovering:!0,enableCamera:!0}),Se.on("enterNode",({node:O,event:A})=>{const U=E.getNodeAttribute(O,"label"),L=E.neighbors(O),ne=[];L.forEach(J=>{const ge=E.edge(O,J)||E.edge(J,O),re=E.getEdgeAttribute(ge,"size")||1,me=E.getNodeAttribute(J,"label");ne.push(`• ${me} (${re})`)}),Z.innerText=`${U}
Colabora con:
${ne.join(`
`)}`,Z.style.left=`${A.clientX+10}px`,Z.style.top=`${A.clientY+10}px`,Z.style.display="block";const K=new Set(L);K.add(O),E.forEachNode(J=>{E.setNodeAttribute(J,"hidden",!K.has(J)),E.setNodeAttribute(J,"forceLabel",vt||K.has(J))}),E.forEachEdge(J=>{const ge=E.source(J),re=E.target(J),me=K.has(ge)&&K.has(re);E.setEdgeAttribute(J,"hidden",!me)})}),Se.on("leaveNode",()=>{Z.style.display="none",E.forEachNode(O=>{E.removeNodeAttribute(O,"hidden"),E.setNodeAttribute(O,"forceLabel",vt)}),E.forEachEdge(O=>E.removeEdgeAttribute(O,"hidden"))})};N.style.position="relative";const X=document.createElement("div");if(X.innerText="Haz click para activar la red",Object.assign(X.style,{position:"absolute",top:0,left:0,width:"100%",height:"100%",backgroundColor:"rgba(255,255,255,0.85)",display:"flex",alignItems:"center",justifyContent:"center",fontSize:"24px",fontWeight:"bold",color:"#333",cursor:"pointer",zIndex:1e3,borderRadius:getComputedStyle(N).borderRadius}),N.appendChild(X),X.addEventListener("click",()=>{X.remove(),ie()}),Se.getCamera().animatedReset({duration:500}),Ge==="department"&&!y.is_author_view){const B=document.createElement("div");B.id="departmentLegend",Object.assign(B.style,{position:"absolute",bottom:"10px",left:"10px",backgroundColor:"rgba(255,255,255,0.9)",border:"1px solid #ccc",borderRadius:"4px",padding:"10px",fontSize:"12px",zIndex:1e3});const O=[...new Set(y.nodes.map(L=>L.department))].filter(L=>L!=="Unknown").sort(),A=document.createElement("div");A.style.fontWeight="bold",A.style.marginBottom="5px";const U=window.location.pathname.split("/")[1];A.textContent=U==="es"?"Departamentos":"Departments",B.appendChild(A),O.forEach(L=>{const ne=P(L),K=document.createElement("div");Object.assign(K.style,{display:"flex",alignItems:"center",marginBottom:"5px"});const J=document.createElement("div");Object.assign(J.style,{width:"15px",height:"15px",backgroundColor:ne,marginRight:"8px",border:"1px solid #000"});const ge=document.createElement("span");ge.textContent=L,K.appendChild(J),K.appendChild(ge),B.appendChild(K)}),N.appendChild(B)}}document.getElementById("applyClustering").addEventListener("click",()=>{const y=document.querySelector('input[name="configMode"]:checked').value,N=document.getElementById("clusteringModel").value,S=document.querySelector('input[name="modelConfigMode"]:checked').value;let E=document.getElementById("nClusters").value;N==="dbscan"?E=document.getElementById("dbscanClusters").value:N==="hdbscan"&&(E=document.getElementById("hdbscanClusters").value),Ge="keywords";const V=new URLSearchParams({communityView:"keywords",clusteringModel:N,nClusters:E,autoMode:S==="auto",globalMode:y==="global"});fetch(`/api/dashboard/collaboration-network/?${V.toString()}`).then(G=>G.json()).then(G=>{if(G.error){console.error("Error desde backend:",G.error),alert(`Ocurrió un error al generar la red: ${G.error}`);return}if(!G.nodes||!G.edges){console.error("Respuesta incompleta del backend:",G),alert("La respuesta del servidor no contiene datos de red válidos.");return}window.currentNetworkData=G,ji(G),document.activeElement.blur(),bootstrap.Modal.getInstance(document.getElementById("clusteringModal")).hide()}).catch(G=>{console.error("Error en la petición fetch:",G)})});function rt(){const y=new URLSearchParams;e.value&&y.append("year_from",e.value),t.value&&y.append("year_to",t.value),Q.forEach(G=>y.append("areas",G)),ce.forEach(G=>y.append("institutions",G)),se.forEach(G=>y.append("types",G)),te&&y.append("author",te);const N=window.location.pathname.split("/")[1],S=N==="es"?"Todas las Áreas":"All areas",E=N==="es"?"Todas las Instituciones":"All Institutions",V=N==="es"?"Todos los tipos":"All types";fetch(`/api/dashboard/filters/?${y.toString()}`).then(G=>{if(!G.ok)throw new Error(`HTTP error! status: ${G.status}`);return G.json()}).then(G=>{n.innerHTML=`<option value="">${S}</option>`,G.areas.forEach(P=>{const j=document.createElement("option");j.value=P.name,j.textContent=`${P.name} (${P.count})`,n.appendChild(j)}),i.innerHTML=`<option value="">${E}</option>`,G.institutions.forEach(P=>{const j=document.createElement("option");j.value=P.name,j.textContent=`${P.name} (${P.count})`,i.appendChild(j)}),r.innerHTML=`<option value="">${V}</option>`,G.publication_types.forEach(P=>{const j=document.createElement("option");j.value=P.publication_type,j.textContent=`${P.publication_type} (${P.count})`,r.appendChild(j)})}).catch(G=>{console.error("Error updating filters:",G);const P=document.createElement("div");P.className="alert alert-danger",P.style.position="fixed",P.style.top="20px",P.style.right="20px",P.style.zIndex="9999",P.innerHTML=`
                    <strong>Error:</strong> No se pudieron actualizar los filtros.
                    <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
                `,document.body.appendChild(P),setTimeout(()=>{P.remove()},5e3)}),it()}}document.addEventListener("DOMContentLoaded",()=>{ng()});
